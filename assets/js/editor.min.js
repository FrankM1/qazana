!function e(t,a,n){function i(s,r){if(!a[s]){if(!t[s]){var l="function"==typeof require&&require;if(!r&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[s]={exports:{}};t[s][0].call(d.exports,function(e){var a=t[s][1][e];return i(a||e)},d,d.exports,e,t,a,n)}return a[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,a){var n=e("qazana-dynamic-tags/tag-panel-view");t.exports=Marionette.Behavior.extend({tagView:null,listenerAttached:!1,ui:{tagArea:".qazana-control-tag-area",dynamicSwitcher:".qazana-control-dynamic-switcher"},events:{"click @ui.dynamicSwitcher":"onDynamicSwitcherClick"},initialize:function(){this.listenerAttached||(this.listenTo(this.view.options.elementSettingsModel,"change:external:__dynamic__",this.onAfterExternalChange),this.listenerAttached=!0)},renderTools:function(){if(!this.getOption("dynamicSettings").default){var e=jQuery(Marionette.Renderer.render("#tmpl-qazana-control-dynamic-switcher"));this.ui.controlTitle[this.view.model.get("label_block")?"after":"before"](e),this.ui.dynamicSwitcher=this.$el.find(this.ui.dynamicSwitcher.selector)}},toggleDynamicClass:function(){this.$el.toggleClass("qazana-control-dynamic-value",this.isDynamicMode())},isDynamicMode:function(){var e=this.view.elementSettingsModel.get("__dynamic__");return!(!e||!e[this.view.model.get("name")])},createTagsList:function(){var e=_.groupBy(this.getOption("tags"),"group"),t=qazana.dynamicTags.getConfig("groups"),a=this.ui.tagsList=jQuery("<div>",{class:"qazana-tags-list"}),n=jQuery("<div>",{class:"qazana-tags-list__inner"});a.append(n),jQuery.each(t,function(t){var a=e[t];if(a){var i=this,o=jQuery("<div>",{class:"qazana-tags-list__group-title"}).text(i.title);n.append(o),a.forEach(function(e){var t=jQuery("<div>",{class:"qazana-tags-list__item"});t.text(e.title).attr("data-tag-name",e.name),n.append(t)})}}),n.on("click",".qazana-tags-list__item",this.onTagsListItemClick.bind(this)),qazana.$body.append(a)},getTagsList:function(){return this.ui.tagsList||this.createTagsList(),this.ui.tagsList},toggleTagsList:function(){var e=this.getTagsList();e.is(":visible")?e.hide():e.show().position({my:"right top",at:"right bottom+5",of:this.ui.dynamicSwitcher})},setTagView:function(e,t,a){this.tagView&&this.tagView.destroy();var i=this.tagView=new n({id:e,name:t,settings:a,dynamicSettings:this.getOption("dynamicSettings")});i.render(),this.ui.tagArea.after(i.el),this.listenTo(i.model,"change",this.onTagViewModelChange.bind(this)).listenTo(i,"remove",this.onTagViewRemove.bind(this))},setDefaultTagView:function(){var e=qazana.dynamicTags.tagTextToTagData(this.getDynamicValue());this.setTagView(e.id,e.name,e.settings)},tagViewToTagText:function(){var e=this.tagView;return qazana.dynamicTags.tagDataToTagText(e.getOption("id"),e.getOption("name"),e.model)},getDynamicValue:function(){return this.view.elementSettingsModel.get("__dynamic__")[this.view.model.get("name")]},getDynamicControlSettings:function(){return{control:{name:"__dynamic__",label:this.view.model.get("label")}}},setDynamicValue:function(e){var t=this.view.model.get("name"),a=this.view.elementSettingsModel.get("__dynamic__")||{};(a=qazana.helpers.cloneObject(a))[t]=e,this.view.elementSettingsModel.set("__dynamic__",a,this.getDynamicControlSettings(t)),this.toggleDynamicClass()},destroyTagView:function(){this.tagView&&(this.tagView.destroy(),this.tagView=null)},onRender:function(){this.$el.addClass("qazana-control-dynamic"),this.renderTools(),this.toggleDynamicClass(),this.isDynamicMode()&&this.setDefaultTagView()},onDynamicSwitcherClick:function(){this.toggleTagsList()},onTagsListItemClick:function(e){var t=jQuery(e.currentTarget);this.setTagView(qazana.helpers.getUniqueID(),t.data("tagName"),{}),this.setDynamicValue(this.tagViewToTagText()),this.toggleTagsList(),this.tagView.getTagConfig().settings_required&&this.tagView.showSettingsPopup()},onTagViewModelChange:function(){this.setDynamicValue(this.tagViewToTagText())},onTagViewRemove:function(){var e=this.view.model.get("name"),t=this.view.elementSettingsModel.get("__dynamic__");delete(t=qazana.helpers.cloneObject(t))[e],Object.keys(t).length?this.view.elementSettingsModel.set("__dynamic__",t,this.getDynamicControlSettings(e)):this.view.elementSettingsModel.unset("__dynamic__",this.getDynamicControlSettings(e)),this.toggleDynamicClass()},onAfterExternalChange:function(){this.destroyTagView(),this.isDynamicMode()&&this.setDefaultTagView(),this.toggleDynamicClass()},onDestroy:function(){this.destroyTagView()}})},{"qazana-dynamic-tags/tag-panel-view":5}],2:[function(e,t,a){var n=e("qazana-utils/module"),i=e("qazana-elements/models/base-settings");t.exports=n.extend({CACHE_KEY_NOT_FOUND_ERROR:"Cache key not found",tags:{Base:e("qazana-dynamic-tags/tag")},cache:{},cacheRequests:{},cacheCallbacks:[],addCacheRequest:function(e){this.cacheRequests[this.createCacheKey(e)]=!0},createCacheKey:function(e){return btoa(e.getOption("name"))+"-"+btoa(encodeURIComponent(JSON.stringify(e.model)))},loadTagDataFromCache:function(e){var t=this.createCacheKey(e);if(void 0!==this.cache[t])return this.cache[t];this.cacheRequests[t]||this.addCacheRequest(e)},loadCacheRequests:function(){var e=this.cache,t=this.cacheRequests,a=this.cacheCallbacks;this.cacheRequests={},this.cacheCallbacks=[],qazana.ajax.send("render_tags",{data:{post_id:qazana.config.document.id,tags:Object.keys(t)},success:function(t){jQuery.extend(e,t),a.forEach(function(e){e()})}})},refreshCacheFromServer:function(e){this.cacheCallbacks.push(e),this.loadCacheRequests()},getConfig:function(e){return this.getItems(qazana.config.dynamicTags,e)},parseTagsText:function(e,t,a){var n=this;return"object"===t.returnType?n.parseTagText(e,t,a):e.replace(/\[qazana-tag[^\]]+]/g,function(e){return n.parseTagText(e,t,a)})},parseTagText:function(e,t,a){var n=this.tagTextToTagData(e);return n?a(n.id,n.name,n.settings):"object"===t.returnType?{}:""},tagTextToTagData:function(e){var t=e.match(/id="(.*?(?="))"/),a=e.match(/name="(.*?(?="))"/),n=e.match(/settings="(.*?(?="]))/);return!!(t&&a&&n)&&{id:t[1],name:a[1],settings:JSON.parse(decodeURIComponent(n[1]))}},createTag:function(e,t,a){var n=this.getConfig("tags."+t);if(n)return new(this.tags[t]||this.tags.Base)({id:e,name:t,model:new i(a,{controls:n.controls})})},getTagDataContent:function(e,t,a){var n=this.createTag(e,t,a);if(n)return n.getContent()},tagDataToTagText:function(e,t,a){return a=encodeURIComponent(JSON.stringify(a&&a.toJSON({removeDefault:!0})||{})),'[qazana-tag id="'+e+'" name="'+t+'" settings="'+a+'"]'},cleanCache:function(){this.cache={}},onInit:function(){this.loadCacheRequests=_.debounce(this.loadCacheRequests,300)}})},{"qazana-dynamic-tags/tag":6,"qazana-elements/models/base-settings":71,"qazana-utils/module":140}],3:[function(e,t,a){t.exports=Marionette.ItemView.extend({className:"qazana-tag-controls-stack-empty",template:"#tmpl-qazana-tag-controls-stack-empty"})},{}],4:[function(e,t,a){var n=e("qazana-views/controls-stack"),i=e("qazana-dynamic-tags/tag-controls-stack-empty");t.exports=n.extend({activeTab:"content",template:_.noop,emptyView:i,isEmpty:function(){return this.collection.length<2},childViewOptions:function(){return{elementSettingsModel:this.model}},onRenderTemplate:function(){this.activateFirstSection()}})},{"qazana-dynamic-tags/tag-controls-stack-empty":3,"qazana-views/controls-stack":135}],5:[function(e,t,a){var n=e("qazana-dynamic-tags/tag-controls-stack"),i=e("qazana-elements/models/base-settings");t.exports=Marionette.ItemView.extend({className:"qazana-dynamic-cover qazana-input-style",tagControlsStack:null,templateHelpers:function(){var e={};return this.model&&(e.controls=this.model.options.controls),e},ui:{remove:".qazana-dynamic-cover__remove"},events:function(){var e={"click @ui.remove":"onRemoveClick"};return this.hasSettings()&&(e.click="onClick"),e},getTemplate:function(){var e=this.getTagConfig(),t=Marionette.TemplateCache.get("#tmpl-qazana-control-dynamic-cover"),a=Marionette.Renderer.render(t,{hasSettings:this.hasSettings(),isRemovable:!this.getOption("dynamicSettings").default,title:e.title,content:e.panel_template});return Marionette.TemplateCache.prototype.compileTemplate(a.trim())},getTagConfig:function(){return qazana.dynamicTags.getConfig("tags."+this.getOption("name"))},initSettingsPopup:function(){var e={className:"qazana-tag-settings-popup",position:{my:"left top+5",at:"left bottom",of:this.$el,autoRefresh:!0}},t=qazana.dialogsManager.createWidget("buttons",e);this.getSettingsPopup=function(){return t}},hasSettings:function(){return!!Object.values(this.getTagConfig().controls).length},showSettingsPopup:function(){this.tagControlsStack||this.initTagControlsStack();var e=this.getSettingsPopup();e.isVisible()||e.show()},initTagControlsStack:function(){this.tagControlsStack=new n({model:this.model,controls:this.model.controls,el:this.getSettingsPopup().getElements("message")[0]}),this.tagControlsStack.render()},initModel:function(){this.model=new i(this.getOption("settings"),{controls:this.getTagConfig().controls})},initialize:function(){this.hasSettings()&&(this.initModel(),this.initSettingsPopup(),this.listenTo(this.model,"change",this.render))},onClick:function(){this.showSettingsPopup()},onRemoveClick:function(e){e.stopPropagation(),this.destroy(),this.trigger("remove")},onDestroy:function(){this.hasSettings()&&this.getSettingsPopup().destroy()}})},{"qazana-dynamic-tags/tag-controls-stack":4,"qazana-elements/models/base-settings":71}],6:[function(e,t,a){t.exports=Marionette.ItemView.extend({hasTemplate:!0,tagName:"span",className:function(){return"qazana-tag"},getTemplate:function(){return!!this.hasTemplate&&Marionette.TemplateCache.get("#tmpl-qazana-tag-"+this.getOption("name")+"-content")},initialize:function(){try{this.getTemplate()}catch(e){this.hasTemplate=!1}},getConfig:function(e){var t=qazana.dynamicTags.getConfig("tags."+this.getOption("name"));return e?t[e]:t},getContent:function(){var e,t=this.getConfig("content_type");if(!this.hasTemplate&&void 0===(e=qazana.dynamicTags.loadTagDataFromCache(this)))throw new Error(qazana.dynamicTags.CACHE_KEY_NOT_FOUND_ERROR);if("ui"===t){if(this.render(),this.hasTemplate)return this.el.outerHTML;this.getConfig("wrapped_tag")&&(e=jQuery(e).html()),this.$el.html(e)}return e},onRender:function(){this.el.id="qazana-tag-"+this.getOption("id")}})},{}],7:[function(e,t,a){t.exports=Marionette.Behavior.extend({previewWindow:null,ui:function(){return{buttonPreview:"#qazana-panel-saver-button-preview",buttonPublish:"#qazana-panel-saver-button-publish",buttonSaveOptions:"#qazana-panel-saver-button-save-options",buttonPublishLabel:"#qazana-panel-saver-button-publish-label",menuSaveDraft:"#qazana-panel-saver-menu-save-draft",lastEditedWrapper:".qazana-last-edited-wrapper"}},events:function(){return{"click @ui.buttonPreview":"onClickButtonPreview","click @ui.buttonPublish":"onClickButtonPublish","click @ui.menuSaveDraft":"onClickMenuSaveDraft"}},initialize:function(){qazana.saver.on("before:save",this.onBeforeSave.bind(this)).on("after:save",this.onAfterSave.bind(this)).on("after:saveError",this.onAfterSaveError.bind(this)).on("page:status:change",this.onPageStatusChange),qazana.settings.page.model.on("change",this.onPageSettingsChange.bind(this)),qazana.channels.editor.on("status:change",this.activateSaveButtons.bind(this))},activateSaveButtons:function(e){e=e||"draft"===qazana.settings.page.model.get("post_status"),this.ui.buttonPublish.add(this.ui.menuSaveDraft).toggleClass("qazana-saver-disabled",!e),this.ui.buttonSaveOptions.toggleClass("qazana-saver-disabled",!e)},onRender:function(){this.setMenuItems(qazana.settings.page.model.get("post_status")),this.addTooltip()},onPageSettingsChange:function(e){var t=e.changed;_.isUndefined(t.post_status)||(this.setMenuItems(t.post_status),this.refreshWpPreview(),"page_settings"===qazana.getPanelView().getCurrentPageName()&&qazana.getPanelView().getCurrentPageView().render())},onPageStatusChange:function(e){"publish"===e&&qazana.notifications.showToast({message:qazana.config.document.panel.messages.publish_notification,buttons:[{name:"view_page",text:qazana.translate("have_a_look"),callback:function(){open(qazana.config.document.urls.permalink)}}]})},onBeforeSave:function(e){NProgress.start(),"autosave"===e.status?this.ui.lastEditedWrapper.addClass("qazana-state-active"):this.ui.buttonPublish.addClass("qazana-button-state")},onAfterSave:function(e){NProgress.done(),this.ui.buttonPublish.removeClass("qazana-button-state"),this.ui.lastEditedWrapper.removeClass("qazana-state-active"),this.refreshWpPreview(),this.setLastEdited(e)},setLastEdited:function(e){this.ui.lastEditedWrapper.removeClass("qazana-button-state").find(".qazana-last-edited").html(e.config.last_edited)},onAfterSaveError:function(){NProgress.done(),this.ui.buttonPublish.removeClass("qazana-button-state")},onClickButtonPreview:function(){this.previewWindow=open(qazana.config.document.urls.wp_preview,"wp-preview-"+qazana.config.document.id),qazana.saver.isEditorChanged()&&(qazana.saver.isSaving&&(qazana.saver.isSaving=!1),qazana.saver.doAutoSave())},onClickButtonPublish:function(){var e=qazana.settings.page.model.get("post_status");if(!this.ui.buttonPublish.hasClass("qazana-saver-disabled"))switch(e){case"publish":case"private":qazana.saver.update();break;case"draft":qazana.config.current_user_can_publish?qazana.saver.publish():qazana.saver.savePending();break;case"pending":case void 0:qazana.config.current_user_can_publish?qazana.saver.publish():qazana.saver.update()}},onClickMenuSaveDraft:function(){qazana.saver.saveDraft()},setMenuItems:function(e){var t="publish";switch(e){case"publish":case"private":t="update",qazana.config.current_revision_id!==qazana.config.document.id&&this.activateSaveButtons(!0);break;case"draft":qazana.config.current_user_can_publish||(t="submit"),this.activateSaveButtons(!0);break;case"pending":case void 0:qazana.config.current_user_can_publish||(t="update")}this.ui.buttonPublishLabel.html(qazana.translate(t))},addTooltip:function(){this.$el.find(".tooltip-target").tipsy({gravity:"s",title:function(){return this.getAttribute("data-tooltip")}})},refreshWpPreview:function(){if(this.previewWindow)try{this.previewWindow.location.href=qazana.config.document.urls.wp_preview}catch(e){}}})},{}],8:[function(e,t,a){var n=e("./footer-saver");t.exports=n.extend({ui:function(){return{buttonPreview:"#qazana-panel-header-saver-button-preview",buttonPublish:"#qazana-panel-header-saver-button-publish",buttonSaveOptions:"#qazana-panel-header-saver-button-save-options",buttonPublishLabel:"#qazana-panel-header-saver-button-publish-label",menuSaveDraft:"#qazana-panel-header-saver-button-save-draft",lastEditedWrapper:".qazana-last-edited-wrapper"}},addTooltip:function(){this.$el.find(".tooltip-target").tipsy({gravity:function(){var e=jQuery(this).data("tooltip-pos");return void 0!==e?e:"n"},title:function(){return this.getAttribute("data-tooltip")}})},activateSaveButtons:function(e){e=e||"draft"===qazana.settings.page.model.get("post_status"),this.ui.buttonPublish.add(this.ui.menuSaveDraft).toggleClass("qazana-saver-disabled",!e),this.ui.buttonSaveOptions.toggleClass("qazana-saver-disabled",!e)}})},{"./footer-saver":7}],9:[function(e,t,a){var n=e("qazana-utils/module");t.exports=n.extend({autoSaveTimer:null,autosaveInterval:1e3*qazana.config.autosave_interval,isSaving:!1,isChangedDuringSave:!1,__construct:function(){this.setWorkSaver()},startTimer:function(e){clearTimeout(this.autoSaveTimer),e&&(this.autoSaveTimer=setTimeout(_.bind(this.doAutoSave,this),this.autosaveInterval))},saveDraft:function(){var e=qazana.settings.page.model.get("post_status");if(qazana.saver.isEditorChanged()||"draft"===e)switch(e){case"publish":case"private":this.doAutoSave();break;default:this.update()}},doAutoSave:function(){"edit"===qazana.channels.dataEditMode.request("activeMode")&&this.saveAutoSave()},saveAutoSave:function(e){this.isEditorChanged()&&(e=_.extend({status:"autosave"},e),this.saveEditor(e))},savePending:function(e){e=_.extend({status:"pending"},e),this.saveEditor(e)},discard:function(){var e=this;qazana.ajax.addRequest("discard_changes",{success:function(){e.setFlagEditorChange(!1),location.href=qazana.config.document.urls.exit_to_dashboard}})},update:function(e){e=_.extend({status:qazana.settings.page.model.get("post_status")},e),this.saveEditor(e)},publish:function(e){e=_.extend({status:"publish"},e),this.saveEditor(e)},setFlagEditorChange:function(e){e&&this.isSaving&&(this.isChangedDuringSave=!0),this.startTimer(e),qazana.channels.editor.reply("status",e).trigger("status:change",e)},isEditorChanged:function(){return!0===qazana.channels.editor.request("status")},setWorkSaver:function(){var e=this;qazana.$window.on("beforeunload",function(){if(e.isEditorChanged())return qazana.translate("before_unload_alert")})},saveEditor:function(e){if(!this.isSaving){e=_.extend({status:"draft",onSuccess:null},e);var t=this,a=qazana.elements.toJSON({removeDefault:!0}),n=qazana.settings.page.model.toJSON({removeDefault:!0}),i=qazana.settings.page.model.get("post_status"),o=i!==e.status;t.trigger("before:save",e).trigger("before:save:"+e.status,e),t.isSaving=!0,t.isChangedDuringSave=!1,n.post_status=e.status,qazana.ajax.addRequest("save_builder",{data:{status:e.status,elements:a,settings:n},success:function(n){t.afterAjax(),"autosave"!==e.status&&(o&&qazana.settings.page.model.set("post_status",e.status),t.isChangedDuringSave||t.setFlagEditorChange(!1)),n.config&&jQuery.extend(!0,qazana.config,n.config),qazana.config.data=a,qazana.channels.editor.trigger("saved",n),t.trigger("after:save",n).trigger("after:save:"+e.status,n),o&&t.trigger("page:status:change",e.status,i),_.isFunction(e.onSuccess)&&e.onSuccess.call(this,n)},error:function(a){t.afterAjax(),t.trigger("after:saveError",a).trigger("after:saveError:"+e.status,a);var n;_.isString(a)?n=a:a.statusText?(n=qazana.ajax.createErrorMessage(a),0===a.readyState&&(n+=" "+qazana.translate("saving_disabled"))):a[0]&&a[0].code&&(n=qazana.translate("server_error")+" "+a[0].code),qazana.notifications.showToast({message:n})}})}},afterAjax:function(){this.isSaving=!1}})},{"qazana-utils/module":140}],10:[function(e,t,a){var n=e("qazana-utils/view-module"),i=e("qazana-elements/models/base-settings"),o=e("qazana-editor-utils/controls-css-parser");t.exports=n.extend({model:null,hasChange:!1,reloadPreviewFlag:!1,changeCallbacks:{},addChangeCallback:function(e,t){this.changeCallbacks[e]=t},bindEvents:function(){qazana.on("preview:loaded",this.onQazanaPreviewLoaded),this.model.on("change",this.onModelChange)},addPanelPage:function(){var e=this.getSettings("name");qazana.getPanelView().addPage(e+"_settings",{view:qazana.settings.panelPages[e]||qazana.settings.panelPages.base,title:this.getSettings("panelPage.title"),options:{model:this.model,controls:this.model.controls,name:e}})},updateStylesheet:function(e){var t=this.getControlsCSS();e||t.stylesheet.empty(),t.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/{{WRAPPER}}/g],[this.getSettings("cssWrapperSelector")]),t.addStyleToDocument()},initModel:function(){this.model=new i(this.getSettings("settings"),{controls:this.getSettings("controls")})},initControlsCSSParser:function(){var e;this.getControlsCSS=function(){return e||(e=new o({id:this.getSettings("name"),settingsModel:this.model}),this.controlsCSS=e),e}},getDataToSave:function(e){return e},save:function(e){var t=this;if(t.hasChange){var a=this.model.toJSON({removeDefault:!0}),n=this.getDataToSave({data:a});NProgress.start(),qazana.ajax.addRequest("save_"+this.getSettings("name")+"_settings",{data:n,success:function(){NProgress.done(),t.setSettings("settings",a),t.hasChange=!1,t.reloadPreviewFlag&&(t.reloadPreviewFlag=!1,t.reloadPreview()),e&&e.apply(t,arguments)},error:function(){alert("An error occurred")}})}},addPanelMenuItem:function(){var e=this.getSettings("panelPage.menu");if(e){var t={icon:e.icon,title:this.getSettings("panelPage.title"),type:"page",pageName:this.getSettings("name")+"_settings"};qazana.modules.layouts.panel.pages.menu.Menu.addItem(t,"settings",e.beforeItem)}},onInit:function(){this.initModel(),this.initControlsCSSParser(),this.addPanelMenuItem(),this.debounceSave=_.debounce(this.save,3e3),n.prototype.onInit.apply(this,arguments)},onModelChange:function(e){var t=this;t.hasChange=!0,this.getControlsCSS().stylesheet.empty(),_.each(e.changed,function(e,a){t.changeCallbacks[a]&&t.changeCallbacks[a].call(t,e),"preview"===t.model.controls[a].render_type&&(t.reloadPreviewFlag=!0)}),t.updateStylesheet(!0),t.debounceSave()},onQazanaPreviewLoaded:function(){this.updateStylesheet(),this.addPanelPage(),qazana.userCan("design")||qazana.panel.currentView.setPage("page_settings")}})},{"qazana-editor-utils/controls-css-parser":119,"qazana-elements/models/base-settings":71,"qazana-utils/view-module":141}],11:[function(e,t,a){var n=e("qazana-views/controls-stack");t.exports=n.extend({id:function(){return"qazana-panel-"+this.getOption("name")+"-settings"},getTemplate:function(){return"#tmpl-qazana-panel-"+this.getOption("name")+"-settings"},childViewContainer:function(){return"#qazana-panel-"+this.getOption("name")+"-settings-controls"},childViewOptions:function(){return{elementSettingsModel:this.model}}})},{"qazana-views/controls-stack":135}],12:[function(e,t,a){var n=e("qazana-editor/components/settings/base/manager");t.exports=n.extend({changeCallbacks:{qazana_page_title_selector:function(e){var t=e||"h1.entry-title";(qazana.settings.page.model.controls.hide_title.selectors={})[t]="display: none",qazana.settings.page.updateStylesheet()},custom_css:function(e){this.custom_css(e)}},custom_css:function(e){var t=this.getControlsCSS();e||(e=this.model.get("custom_css")),e&&(e=e.replace(/selector/g,this.getSettings("cssWrapperSelector")),t.stylesheet.addRawCSS("general-settings-custom-css",e))},updateStylesheet:function(e){var t=this.getControlsCSS();e||t.stylesheet.empty(),t.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/{{WRAPPER}}/g],[this.getSettings("cssWrapperSelector")]),this.custom_css(),t.addStyleToDocument()},reloadPreview:function(){qazana.reloadPreview(),qazana.once("preview:loaded",function(){qazana.getPanelView().setPage("general_settings")})}})},{"qazana-editor/components/settings/base/manager":10}],13:[function(e,t,a){var n=e("qazana-editor/components/settings/base/manager");t.exports=n.extend({save:function(){},changeCallbacks:{post_title:function(e){qazanaFrontend.getElements("$document").find(qazana.config.page_title_selector).text(e)},template:function(){qazana.saver.saveAutoSave({onSuccess:function(){qazana.reloadPreview(),qazana.once("preview:loaded",function(){qazana.getPanelView().setPage("page_settings")})}})},custom_css:function(e){this.custom_css(e)}},custom_css:function(e){var t=this.getControlsCSS();e||(e=this.model.get("custom_css")),e&&(e=e.replace(/selector/g,this.getSettings("cssWrapperSelector")),t.stylesheet.addRawCSS("page-settings-custom-css",e))},updateStylesheet:function(e){var t=this.getControlsCSS();e||t.stylesheet.empty(),t.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/{{WRAPPER}}/g],[this.getSettings("cssWrapperSelector")]),this.custom_css(),t.addStyleToDocument()},renderStyles:function(){var e=this.getControlsCSS();e.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/\{\{WRAPPER}}/g],["body.qazana-page-"+qazana.config.post_id]),e.stylesheet.addRawCSS("page-settings-custom-css",this.model.get("custom_css").replace(/selector/g,"body.qazana-page-"+qazana.config.post_id))},onModelChange:function(){qazana.saver.setFlagEditorChange(!0),n.prototype.onModelChange.apply(this,arguments)},getDataToSave:function(e){return e.id=qazana.config.document.id,e},reloadPreview:function(){qazana.reloadPreview(),qazana.once("preview:loaded",function(){qazana.getPanelView().setPage("page_settings")})}})},{"qazana-editor/components/settings/base/manager":10}],14:[function(e,t,a){var n=e("qazana-utils/module");t.exports=n.extend({modules:{base:e("qazana-editor/components/settings/base/manager"),general:e("qazana-editor/components/settings/general/manager"),page:e("qazana-editor/components/settings/page/manager")},panelPages:{base:e("qazana-editor/components/settings/base/panel")},onInit:function(){this.initSettings()},initSettings:function(){var e=this;_.each(qazana.config.settings,function(t,a){var n=e.modules[a]||e.modules.base;e[a]=new n(t)})}})},{"qazana-editor/components/settings/base/manager":10,"qazana-editor/components/settings/base/panel":11,"qazana-editor/components/settings/general/manager":12,"qazana-editor/components/settings/page/manager":13,"qazana-utils/module":140}],15:[function(e,t,a){var n;n=Marionette.Behavior.extend({ui:{insertButton:".qazana-template-library-template-insert"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){this.view.model.get("hasPageSettings")?n.showImportDialog(this.view.model):qazana.templates.importTemplate(this.view.model)}},{dialog:null,showImportDialog:function(e){var t=n.getDialog();t.onConfirm=function(){qazana.templates.importTemplate(e,{withPageSettings:!0})},t.onCancel=function(){qazana.templates.importTemplate(e)},t.show()},initDialog:function(){n.dialog=qazana.dialogsManager.createWidget("confirm",{id:"qazana-insert-template-settings-dialog",headerMessage:qazana.translate("import_template_dialog_header"),message:qazana.translate("import_template_dialog_message")+"<br>"+qazana.translate("import_template_dialog_message_attention"),strings:{confirm:qazana.translate("yes"),cancel:qazana.translate("no")}})},getDialog:function(){return n.dialog||n.initDialog(),n.dialog}}),t.exports=n},{}],16:[function(e,t,a){var n,i=e("qazana-templates/models/template");n=Backbone.Collection.extend({model:i}),t.exports=n},{"qazana-templates/models/template":18}],17:[function(e,t,a){var n,i=e("qazana-templates/views/library-layout"),o=e("qazana-templates/collections/templates");n=function(){var e,t,a,n,s=this,r={},l={},c={},d={},u=function(){a=new i},h=function(){var e={saveDialog:{description:qazana.translate("save_your_template_description")},ajaxParams:{success:function(e){s.getTemplatesCollection().add(e),s.setTemplatesPage("local")},error:function(e){s.showErrorDialog(e)}}};_.each(["page","section"],function(t){var a=jQuery.extend(!0,{},e,{saveDialog:{title:qazana.translate("save_your_template",[qazana.translate(t)])}});s.registerTemplateType(t,a)})},g=function(){d={text:{callback:function(e){return e=e.toLowerCase(),this.get("title").toLowerCase().indexOf(e)>=0||_.any(this.get("tags"),function(t){return t.toLowerCase().indexOf(e)>=0})}},type:{},subtype:{},favorite:{}}},p=function(){jQuery.each(l.filters,function(e,t){s.setFilter(e,t,!0)})};this.init=function(){h(),g(),qazana.addBackgroundClickListener("libraryToggleMore",{element:".qazana-template-library-template-more"})},this.getTemplateTypes=function(e){return e?c[e]:c},this.registerTemplateType=function(e,t){c[e]=t},this.deleteTemplate=function(e,t){var a=s.getDeleteDialog();a.onConfirm=function(){t.onConfirm&&t.onConfirm(),qazana.ajax.send("delete_template",{data:{source:e.get("source"),template_id:e.get("template_id")},success:function(a){n.remove(e,{silent:!0}),t.onSuccess&&t.onSuccess(a)}})},a.show()},this.importTemplate=function(e,t){t=t||{},a.showLoadingView(),s.requestTemplateContent(e.get("source"),e.get("template_id"),{data:{page_settings:t.withPageSettings},success:function(a){s.closeModal(),qazana.channels.data.trigger("template:before:insert",e),qazana.getPreviewView().addChildModel(a.content,l.importOptions||{}),qazana.channels.data.trigger("template:after:insert",e),t.withPageSettings&&qazana.settings.page.model.set(a.page_settings)},error:function(e){s.showErrorDialog(e)},complete:function(){a.hideLoadingView()}})},this.saveTemplate=function(e,t){var a=c[e];_.extend(t,{source:"local",type:e}),a.prepareSavedData&&(t=a.prepareSavedData(t)),t.content=JSON.stringify(t.content);var n={data:t};a.ajaxParams&&_.extend(n,a.ajaxParams),qazana.ajax.send("save_template",n)},this.requestTemplateContent=function(e,t,a){var n={data:{source:e,edit_mode:!0,display:!0,template_id:t}};return a&&jQuery.extend(!0,n,a),qazana.ajax.send("get_template_data",n)},this.markAsFavorite=function(e,t){var a={data:{source:e.get("source"),template_id:e.get("template_id"),favorite:t}};return qazana.ajax.send("mark_template_as_favorite",a)},this.getDeleteDialog=function(){return e||(e=qazana.dialogsManager.createWidget("confirm",{id:"qazana-template-library-delete-dialog",headerMessage:qazana.translate("delete_template"),message:qazana.translate("delete_template_confirm"),strings:{confirm:qazana.translate("delete")}})),e},this.getErrorDialog=function(){return t||(t=qazana.dialogsManager.createWidget("alert",{id:"qazana-template-library-error-dialog",headerMessage:qazana.translate("an_error_occurred")})),t},this.getLayout=function(){return a},this.getTemplatesCollection=function(){return n},this.getConfig=function(e){return e?r[e]:r},this.requestLibraryData=function(e){if(!n||e.forceUpdate){e.onBeforeUpdate&&e.onBeforeUpdate();var t={data:{},success:function(t){n=new o(t.templates),r=t.config,e.onUpdate&&e.onUpdate()}};e.forceSync&&(t.data.sync=!0),qazana.ajax.send("get_library_data",t)}else e.onUpdate&&e.onUpdate()},this.startModal=function(e){a||u(),a.showModal(),s.requestLibraryData({onBeforeUpdate:a.showLoadingView.bind(a),onUpdate:function(){var t=qazana.config.document.remote_type,n=r.categories&&-1!==r.categories.indexOf(t),i=Object.create(l);l=jQuery.extend({filters:{source:"remote",type:n?"block":"page",subtype:n?t:null},onReady:s.showTemplates},e),_.isEqual(Object.getPrototypeOf(i),l)&&"qazana-template-library-templates"===a.modalContent.currentView.id||(a.hideLoadingView(),p(),l.onReady())}})},this.closeModal=function(){a.hideModal()},this.getFilter=function(e){return qazana.channels.templates.request("filter:"+e)},this.setFilter=function(e,t,a){qazana.channels.templates.reply("filter:"+e,t),a||qazana.channels.templates.trigger("filter:change")},this.getFilterTerms=function(e){return e?d[e]:d},this.setTemplatesPage=function(e,t,a){qazana.channels.templates.stopReplying(),s.setFilter("source",e,!0),t&&s.setFilter("type",t,!0),a||s.showTemplates()},this.showTemplates=function(){var e=s.getFilter("source"),t=n.filter(function(t){if(e!==t.get("source"))return!1;var a=c[t.get("type")];return!a||!1!==a.showInLibrary});a.showTemplatesView(new o(t))},this.showErrorDialog=function(e){if("object"==typeof e){var t="";_.each(e,function(e){t+="<div>"+e.message+".</div>"}),e=t}else e?e+=".":e="<i>&#60;The error message is empty&#62;</i>";s.getErrorDialog().setMessage(qazana.translate("templates_request_error")+'<div id="qazana-template-library-error-info">'+e+"</div>").show()}},t.exports=new n},{"qazana-templates/collections/templates":16,"qazana-templates/views/library-layout":20}],18:[function(e,t,a){t.exports=Backbone.Model.extend({defaults:{template_id:0,name:"",title:"",source:"",type:"",subtype:"",author:"",thumbnail:"",url:"",export_link:"",categories:[],tags:[],keywords:[]}})},{}],19:[function(e,t,a){var n=e("qazana-templates/views/parts/header"),i=e("qazana-templates/views/parts/header-parts/logo"),o=e("qazana-templates/views/parts/loading");t.exports=Marionette.LayoutView.extend({el:function(){return this.modal.getElements("widget")},modal:null,regions:function(){return{modalHeader:".dialog-header",modalContent:".dialog-lightbox-content",modalLoading:".dialog-lightbox-loading"}},constructor:function(){this.initModal(),Marionette.LayoutView.prototype.constructor.apply(this,arguments)},initialize:function(){this.modalHeader.show(new n)},initModal:function(){var e={className:"qazana-templates-modal",closeButton:!1,hide:{onOutsideClick:!1}};jQuery.extend(!0,e,this.getModalOptions()),this.modal=qazana.dialogsManager.createWidget("lightbox",e),this.modal.getElements("message").append(this.modal.addElement("content"),this.modal.addElement("loading"))},showModal:function(){this.modal.show()},hideModal:function(){this.modal.hide()},getModalOptions:function(){return{}},getLogoOptions:function(){return{}},getHeaderView:function(){return this.modalHeader.currentView},showLoadingView:function(){this.modalLoading.show(new o),this.modalLoading.$el.show(),this.modalContent.$el.hide()},hideLoadingView:function(){this.modalContent.$el.show(),this.modalLoading.$el.hide()},showLogo:function(){this.getHeaderView().logoArea.show(new i(this.getLogoOptions()))}})},{"qazana-templates/views/parts/header":26,"qazana-templates/views/parts/header-parts/logo":23,"qazana-templates/views/parts/loading":28}],20:[function(e,t,a){var n=e("qazana-templates/views/base-modal-layout"),i=e("qazana-templates/views/parts/header-parts/actions"),o=e("qazana-templates/views/parts/header-parts/menu"),s=e("qazana-templates/views/parts/header-parts/preview"),r=e("qazana-templates/views/parts/header-parts/back"),l=e("qazana-templates/views/parts/templates"),c=e("qazana-templates/views/parts/save-template"),d=e("qazana-templates/views/parts/import"),u=e("qazana-templates/views/parts/preview");t.exports=n.extend({getModalOptions:function(){return{id:"qazana-template-library-modal"}},getLogoOptions:function(){return{title:qazana.translate("library"),click:function(){qazana.templates.setTemplatesPage("remote","page")}}},getTemplateActionButton:function(e){var t="#tmpl-qazana-template-library-insert-button";t=qazana.hooks.applyFilters("qazana/editor/template-library/template/action-button",t,e);var a=Marionette.TemplateCache.get(t);return Marionette.Renderer.render(a)},setHeaderDefaultParts:function(){var e=this.getHeaderView();e.tools.show(new i),e.menuArea.show(new o),this.showLogo()},showTemplatesView:function(e){this.modalContent.show(new l({collection:e})),this.setHeaderDefaultParts()},showImportView:function(){this.getHeaderView().menuArea.reset(),this.modalContent.show(new d)},showSaveTemplateView:function(e){this.getHeaderView().menuArea.reset(),this.modalContent.show(new c({model:e}))},showPreviewView:function(e){this.modalContent.show(new u({url:e.get("url")}));var t=this.getHeaderView();t.menuArea.reset(),t.tools.show(new s({model:e})),t.logoArea.show(new r)}})},{"qazana-templates/views/base-modal-layout":19,"qazana-templates/views/parts/header-parts/actions":21,"qazana-templates/views/parts/header-parts/back":22,"qazana-templates/views/parts/header-parts/menu":24,"qazana-templates/views/parts/header-parts/preview":25,"qazana-templates/views/parts/import":27,"qazana-templates/views/parts/preview":29,"qazana-templates/views/parts/save-template":30,"qazana-templates/views/parts/templates":32}],21:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-actions",id:"qazana-template-library-header-actions",ui:{import:"#qazana-template-library-header-import i",sync:"#qazana-template-library-header-sync i",save:"#qazana-template-library-header-save i"},events:{"click @ui.import":"onImportClick","click @ui.sync":"onSyncClick","click @ui.save":"onSaveClick"},onImportClick:function(){qazana.templates.getLayout().showImportView()},onSyncClick:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),qazana.templates.requestLibraryData({onUpdate:function(){e.ui.sync.removeClass("eicon-animation-spin"),qazana.templates.setTemplatesPage(qazana.templates.getFilter("source"),qazana.templates.getFilter("type"))},forceUpdate:!0,forceSync:!0})},onSaveClick:function(){qazana.templates.getLayout().showSaveTemplateView()}})},{}],22:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-back",id:"qazana-template-library-header-preview-back",events:{click:"onClick"},onClick:function(){qazana.templates.showTemplates()}})},{}],23:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-templates-modal__header__logo",className:"qazana-templates-modal__header__logo",events:{click:"onClick"},templateHelpers:function(){return{title:this.getOption("title")}},onClick:function(){var e=this.getOption("click");e&&e()}})},{}],24:[function(e,t,a){t.exports=Marionette.ItemView.extend({options:{activeClass:"qazana-active"},template:"#tmpl-qazana-template-library-header-menu",id:"qazana-template-library-header-menu",ui:{menuItems:".qazana-template-library-menu-item"},events:{"click @ui.menuItems":"onMenuItemClick"},$activeItem:null,activateMenuItem:function(e){var t=this.getOption("activeClass");this.$activeItem!==e&&(this.$activeItem&&this.$activeItem.removeClass(t),e.addClass(t),this.$activeItem=e)},onRender:function(){var e=qazana.templates.getFilter("source"),t=this.ui.menuItems.filter('[data-template-source="'+e+'"]');"remote"===e&&(t=t.filter('[data-template-type="'+qazana.templates.getFilter("type")+'"]')),this.activateMenuItem(t)},onMenuItemClick:function(e){var t=e.currentTarget,a=t.dataset;this.activateMenuItem(jQuery(t)),qazana.templates.setTemplatesPage(t.dataset.templateSource,a.templateType)}})},{}],25:[function(e,t,a){var n=e("qazana-templates/behaviors/insert-template");t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-preview",id:"qazana-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:n}}})},{"qazana-templates/behaviors/insert-template":15}],26:[function(e,t,a){var n;n=Marionette.LayoutView.extend({className:"qazana-templates-modal__header",template:"#tmpl-qazana-templates-modal__header",regions:{logoArea:".qazana-templates-modal__header__logo-area",tools:"#qazana-template-library-header-tools",menuArea:".qazana-templates-modal__header__menu-area"},ui:{closeModal:".qazana-templates-modal__header__close-modal"},events:{"click @ui.closeModal":"onCloseModalClick"},onCloseModalClick:function(){this._parent._parent._parent.hideModal()}}),t.exports=n},{}],27:[function(e,t,a){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-import",id:"qazana-template-library-import",ui:{uploadForm:"#qazana-template-library-import-form",fileInput:"#qazana-template-library-import-form-input"},events:{"change @ui.fileInput":"onFileInputChange"},droppedFiles:null,submitForm:function(){var e=qazana.templates.getLayout(),t=new FormData;this.droppedFiles?(t.append("file",this.droppedFiles[0]),this.droppedFiles=null):(t.append("file",this.ui.fileInput[0].files[0]),this.ui.uploadForm[0].reset());var a={data:t,processData:!1,contentType:!1,success:function(e){qazana.templates.getTemplatesCollection().add(e),qazana.templates.setTemplatesPage("local")},error:function(t){qazana.templates.showErrorDialog(t),e.showImportView()},complete:function(){e.hideLoadingView()}};qazana.ajax.send("import_template",a),e.showLoadingView()},onRender:function(){this.ui.uploadForm.on({"drag dragstart dragend dragover dragenter dragleave drop":this.onFormActions.bind(this),dragenter:this.onFormDragEnter.bind(this),"dragleave drop":this.onFormDragLeave.bind(this),drop:this.onFormDrop.bind(this)})},onFormActions:function(e){e.preventDefault(),e.stopPropagation()},onFormDragEnter:function(){this.ui.uploadForm.addClass("qazana-drag-over")},onFormDragLeave:function(e){jQuery(e.relatedTarget).closest(this.ui.uploadForm).length||this.ui.uploadForm.removeClass("qazana-drag-over")},onFormDrop:function(e){this.droppedFiles=e.originalEvent.dataTransfer.files,this.submitForm()},onFileInputChange:function(){this.submitForm()}}),t.exports=n},{}],28:[function(e,t,a){var n;n=Marionette.ItemView.extend({id:"qazana-template-library-loading",template:"#tmpl-qazana-template-library-loading"}),t.exports=n},{}],29:[function(e,t,a){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-preview",id:"qazana-template-library-preview",ui:{iframe:"> iframe"},onRender:function(){this.ui.iframe.attr("src",this.getOption("url"))}}),t.exports=n},{}],30:[function(e,t,a){var n;n=Marionette.ItemView.extend({id:"qazana-template-library-save-template",template:"#tmpl-qazana-template-library-save-template",ui:{form:"#qazana-template-library-save-template-form",submitButton:"#qazana-template-library-save-template-submit"},events:{"submit @ui.form":"onFormSubmit"},getSaveType:function(){return this.model?this.model.get("elType"):"page"},templateHelpers:function(){var e=this.getSaveType();return qazana.templates.getTemplateTypes(e).saveDialog},onFormSubmit:function(e){e.preventDefault();var t=this.ui.form.qazanaSerializeObject(),a=this.model?this.model.get("elType"):"page",n={removeDefault:!0};t.content=this.model?[this.model.toJSON(n)]:qazana.elements.toJSON(n),this.ui.submitButton.addClass("qazana-button-state"),qazana.templates.saveTemplate(a,t)}}),t.exports=n},{}],31:[function(e,t,a){var n;n=Marionette.ItemView.extend({id:"qazana-template-library-templates-empty",template:"#tmpl-qazana-template-library-templates-empty",ui:{title:".qazana-template-library-blank-title",message:".qazana-template-library-blank-message"},modesStrings:{empty:{title:qazana.translate("templates_empty_title"),message:qazana.translate("templates_empty_message")},noResults:{title:qazana.translate("templates_no_results_title"),message:qazana.translate("templates_no_results_message")},noFavorites:{title:qazana.translate("templates_no_favorites_title"),message:qazana.translate("templates_no_favorites_message")}},getCurrentMode:function(){return qazana.templates.getFilter("text")?"noResults":qazana.templates.getFilter("favorite")?"noFavorites":"empty"},onRender:function(){var e=this.modesStrings[this.getCurrentMode()];this.ui.title.html(e.title),this.ui.message.html(e.message)}}),t.exports=n},{}],32:[function(e,t,a){var n,i=e("qazana-templates/views/template/local"),o=e("qazana-templates/views/template/remote"),s=e("qazana-utils/masonry");n=Marionette.CompositeView.extend({template:"#tmpl-qazana-template-library-templates",id:"qazana-template-library-templates",childViewContainer:"#qazana-template-library-templates-container",reorderOnSort:!0,emptyView:function(){return new(e("qazana-templates/views/parts/templates-empty"))},ui:{textFilter:"#qazana-template-library-filter-text",selectFilter:".qazana-template-library-filter-select",myFavoritesFilter:"#qazana-template-library-filter-my-favorites",orderInputs:".qazana-template-library-order-input",orderLabels:".qazana-template-library-order-label"},events:{"input @ui.textFilter":"onTextFilterInput","change @ui.selectFilter":"onSelectFilterChange","change @ui.myFavoritesFilter":"onMyFavoritesFilterChange","mousedown @ui.orderLabels":"onOrderLabelsClick"},comparators:{title:function(e){return e.get("title").toLowerCase()},popularityIndex:function(e){var t=e.get("popularityIndex");return t||(t=e.get("date")),-t},trendIndex:function(e){var t=e.get("trendIndex");return t||(t=e.get("date")),-t}},getChildView:function(e){return"remote"===e.get("source")?o:i},initialize:function(){this.listenTo(qazana.channels.templates,"filter:change",this._renderChildren)},filter:function(e){var t=qazana.templates.getFilterTerms(),a=!0;return jQuery.each(t,function(t){var n=qazana.templates.getFilter(t);if(n){if(this.callback){var i=this.callback.call(e,n);return i||(a=!1),i}var o=n===e.get(t);return o||(a=!1),o}}),a},order:function(e,t){var a=this.comparators[e]||e;t&&(a=this.reverseOrder(a)),this.collection.comparator=a,this.collection.sort()},reverseOrder:function(e){if("function"!=typeof e){var t=e;e=function(e){return e.get(t)}}return function(t,a){var n=e(t),i=e(a);return void 0===n?-1:void 0===i?1:n<i?1:n>i?-1:0}},addSourceData:function(){var e=this.children.isEmpty();this.$el.attr("data-template-source",e?"empty":qazana.templates.getFilter("source"))},setFiltersUI:function(){this.$(this.ui.selectFilter).select2({placeholder:qazana.translate("category"),allowClear:!0,width:150})},setMasonrySkin:function(){var e=new s({container:this.$childViewContainer,items:this.$childViewContainer.children()});this.$childViewContainer.imagesLoaded(e.run.bind(e))},toggleFilterClass:function(){this.$el.toggleClass("qazana-templates-filter-active",!(!qazana.templates.getFilter("text")&&!qazana.templates.getFilter("favorite")))},onRenderCollection:function(){this.addSourceData(),this.toggleFilterClass(),"remote"===qazana.templates.getFilter("source")&&"block"===qazana.templates.getFilter("type")&&(this.setFiltersUI(),this.setMasonrySkin())},onBeforeRenderEmpty:function(){this.addSourceData()},onTextFilterInput:function(){qazana.templates.setFilter("text",this.ui.textFilter.val())},onSelectFilterChange:function(e){var t=jQuery(e.currentTarget),a=t.data("qazana-filter");qazana.templates.setFilter(a,t.val())},onMyFavoritesFilterChange:function(){qazana.templates.setFilter("favorite",this.ui.myFavoritesFilter[0].checked)},onOrderLabelsClick:function(e){var t,a=jQuery(e.currentTarget.control);a[0].checked||(t="asc"!==a.data("default-ordering-direction")),a.toggleClass("qazana-template-library-order-reverse",t),this.order(a.val(),a.hasClass("qazana-template-library-order-reverse"))}}),t.exports=n},{"qazana-templates/views/parts/templates-empty":31,"qazana-templates/views/template/local":34,"qazana-templates/views/template/remote":35,"qazana-utils/masonry":139}],33:[function(e,t,a){var n,i=e("qazana-templates/behaviors/insert-template");n=Marionette.ItemView.extend({className:function(){var e="qazana-template-library-template",t=this.model.get("source");return e+=" qazana-template-library-template-"+t,"remote"===t&&(e+=" qazana-template-library-template-"+this.model.get("type")),e},ui:function(){return{insertButton:".qazana-template-library-template-insert",previewButton:".qazana-template-library-template-preview"}},events:function(){return{"click @ui.insertButton":"onInsertButtonClick","click @ui.previewButton":"onPreviewButtonClick"}},behaviors:{insertTemplate:{behaviorClass:i}}}),t.exports=n},{"qazana-templates/behaviors/insert-template":15}],34:[function(e,t,a){var n,i=e("qazana-templates/views/template/base");n=i.extend({template:"#tmpl-qazana-template-library-template-local",ui:function(){return _.extend(i.prototype.ui.apply(this,arguments),{deleteButton:".qazana-template-library-template-delete",morePopup:".qazana-template-library-template-more",toggleMore:".qazana-template-library-template-more-toggle",toggleMoreIcon:".qazana-template-library-template-more-toggle i"})},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.deleteButton":"onDeleteButtonClick","click @ui.toggleMore":"onToggleMoreClick"})},onDeleteButtonClick:function(){var e=this.ui.toggleMoreIcon;qazana.templates.deleteTemplate(this.model,{onConfirm:function(){e.removeClass("eicon-ellipsis-h").addClass("fa fa-circle-o-notch fa-spin")},onSuccess:function(){qazana.templates.showTemplates()}})},onToggleMoreClick:function(){this.ui.morePopup.show()},onPreviewButtonClick:function(){open(this.model.get("url"),"_blank")}}),t.exports=n},{"qazana-templates/views/template/base":33}],35:[function(e,t,a){var n,i=e("qazana-templates/views/template/base");n=i.extend({template:"#tmpl-qazana-template-library-template-remote",ui:function(){return jQuery.extend(i.prototype.ui.apply(this,arguments),{favoriteCheckbox:".qazana-template-library-template-favorite-input"})},events:function(){return jQuery.extend(i.prototype.events.apply(this,arguments),{"change @ui.favoriteCheckbox":"onFavoriteCheckboxChange"})},onPreviewButtonClick:function(){qazana.templates.getLayout().showPreviewView(this.model)},onFavoriteCheckboxChange:function(){var e=this.ui.favoriteCheckbox[0].checked;this.model.set("favorite",e),qazana.templates.markAsFavorite(this.model,e),!e&&qazana.templates.getFilter("favorite")&&qazana.channels.templates.trigger("filter:change")}}),t.exports=n},{"qazana-templates/views/template/base":33}],36:[function(e,t,a){var n;n=e("qazana-utils/module").extend({errors:[],__construct:function(e){var t=e.customValidationMethod;t&&(this.validationMethod=t)},getDefaultSettings:function(){return{validationTerms:{}}},isValid:function(){var e=this.validationMethod.apply(this,arguments);return!e.length||(this.errors=e,!1)},validationMethod:function(e){var t=[];return this.getSettings("validationTerms").required&&((""+e).length||t.push("Required value is empty")),t}}),t.exports=n},{"qazana-utils/module":140}],37:[function(e,t,a){var n=e("qazana-validator/base");t.exports=n.extend({validationMethod:function(e){var t=this.getSettings("validationTerms"),a=[];return _.isFinite(e)&&(void 0!==t.min&&e<t.min&&a.push("Value is less than minimum"),void 0!==t.max&&e>t.max&&a.push("Value is greater than maximum")),a}})},{"qazana-validator/base":36}],38:[function(e,t,a){var n,i=e("qazana-controls/base"),o=e("qazana-dynamic-tags/control-behavior"),s=e("qazana-validator/base");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return _.extend(e,{input:'input[data-setting][type!="checkbox"][type!="radio"]',checkbox:'input[data-setting][type="checkbox"]',radio:'input[data-setting][type="radio"]',select:"select[data-setting]",textarea:"textarea[data-setting]",responsiveSwitchers:".qazana-responsive-switcher",contentEditable:'[contenteditable="true"]',tooltipTarget:".tooltip-target"}),e},templateHelpers:function(){var e=i.prototype.templateHelpers.apply(this,arguments);return e.data.controlValue=this.getControlValue(),e},events:function(){return{"input @ui.input":"onBaseInputChange","change @ui.checkbox":"onBaseInputChange","change @ui.radio":"onBaseInputChange","input @ui.textarea":"onBaseInputChange","change @ui.select":"onBaseInputChange","input @ui.contentEditable":"onBaseInputChange","click @ui.responsiveSwitchers":"onResponsiveSwitchersClick"}},behaviors:function(){var e={},t=this.options.model.get("dynamic");if(t&&t.active){var a=_.filter(qazana.dynamicTags.getConfig("tags"),function(e){return _.intersection(e.categories,t.categories).length});a.length&&(e.tags={behaviorClass:o,tags:a,dynamicSettings:t})}return e},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.registerValidators(),this.listenTo(this.elementSettingsModel,"change:external:"+this.model.get("name"),this.onAfterExternalChange)},getControlValue:function(){return this.elementSettingsModel.get(this.model.get("name"))},setValue:function(e){this.setSettingsModel(e)},setSettingsModel:function(e){this.elementSettingsModel.set(this.model.get("name"),e),this.triggerMethod("settings:change")},applySavedValue:function(){this.setInputValue('[data-setting="'+this.model.get("name")+'"]',this.getControlValue())},getEditSettings:function(e){var t=this.getOption("elementEditSettings").toJSON();return e?t[e]:t},setEditSetting:function(e,t){this.getOption("elementEditSettings").set(e,t)},getInputValue:function(e){var t=this.$(e);if(t.is('[contenteditable="true"]'))return t.html();var a=t.val(),n=t.attr("type");return-1!==["radio","checkbox"].indexOf(n)?t.prop("checked")?a:"":"number"===n&&_.isFinite(a)?+a:("SELECT"===e.tagName&&t.prop("multiple")&&null===a&&(a=[]),a)},setInputValue:function(e,t){var a=this.$(e),n=a.attr("type");"checkbox"===n?a.prop("checked",!!t):"radio"===n?a.filter('[value="'+t+'"]').prop("checked",!0):a.val(t)},addValidator:function(e){this.validators.push(e)},registerValidators:function(){this.validators=[];var e={};this.model.get("required")&&(e.required=!0),jQuery.isEmptyObject(e)||this.addValidator(new s({validationTerms:e}))},onRender:function(){i.prototype.onRender.apply(this,arguments),this.model.get("responsive")&&this.renderResponsiveSwitchers(),this.applySavedValue(),this.triggerMethod("ready"),this.toggleControlVisibility(),this.addTooltip()},onBaseInputChange:function(e){clearTimeout(this.correctionTimeout);var t=e.currentTarget,a=this.getInputValue(t),n=this.validators.slice(0),i=this.elementSettingsModel.validators[this.model.get("name")];if(i&&(n=n.concat(i)),n){var o=this.getControlValue(t.dataset.setting);if(!n.every(function(e){return e.isValid(a,o)}))return void(this.correctionTimeout=setTimeout(this.setInputValue.bind(this,t,o),1200))}this.updateElementModel(a,t),this.triggerMethod("input:change",e)},onResponsiveSwitchersClick:function(e){var t=jQuery(e.currentTarget).data("device");qazana.changeDeviceMode(t),this.triggerMethod("responsive:switcher:click",t)},renderResponsiveSwitchers:function(){var e=Marionette.Renderer.render("#tmpl-qazana-control-responsive-switchers",this.model.attributes);this.ui.controlTitle.after(e)},onAfterExternalChange:function(){this.hideTooltip(),this.applySavedValue()},addTooltip:function(){this.ui.tooltipTarget&&this.ui.tooltipTarget.tipsy({gravity:function(){var e=jQuery(this).data("tooltip-pos");return void 0!==e?e:"n"},title:function(){return this.getAttribute("data-tooltip")}})},hideTooltip:function(){this.ui.tooltipTarget&&this.ui.tooltipTarget.tipsy("hide")},updateElementModel:function(e){this.setValue(e)}},{getStyleValue:function(e,t){return t},onPasteStyle:function(){return!0}}),t.exports=n},{"qazana-controls/base":41,"qazana-dynamic-tags/control-behavior":1,"qazana-validator/base":36}],39:[function(e,t,a){var n;n=e("qazana-controls/base-data").extend({applySavedValue:function(){var e=this.getControlValue(),t=this.$("[data-setting]"),a=this;_.each(e,function(e,n){var i=t.filter(function(){return n===this.dataset.setting});a.setInputValue(i,e)})},getControlValue:function(e){var t=this.elementSettingsModel.get(this.model.get("name"));if(!jQuery.isPlainObject(t))return{};if(e){var a=t[e];return void 0===a&&(a=""),a}return qazana.helpers.cloneObject(t)},setValue:function(e,t){var a=this.getControlValue();"object"==typeof e?_.each(e,function(e,t){a[t]=e}):a[e]=t,this.setSettingsModel(a)},updateElementModel:function(e,t){var a=t.dataset.setting;this.setValue(a,e)}},{getStyleValue:function(e,t){return _.isObject(t)?t[e]:""}}),t.exports=n},{"qazana-controls/base-data":38}],40:[function(e,t,a){var n;n=e("qazana-controls/base-multiple").extend({getCurrentRange:function(){return this.getUnitRange(this.getControlValue("unit"))},getUnitRange:function(e){var t=this.model.get("range");return!(!t||!t[e])&&t[e]}}),t.exports=n},{"qazana-controls/base-multiple":39}],41:[function(e,t,a){var n;n=Marionette.CompositeView.extend({ui:function(){return{controlTitle:".qazana-control-title"}},behaviors:function(){var e={};return qazana.hooks.applyFilters("controls/base/behaviors",e,this)},getBehavior:function(e){return this._behaviors[Object.keys(this.behaviors()).indexOf(e)]},className:function(){var e="qazana-control qazana-control-"+this.model.get("name")+" qazana-control-type-"+this.model.get("type"),t=this.model.get("classes"),a=this.model.get("responsive");return _.isEmpty(t)||(e+=" "+t),_.isEmpty(a)||(e+=" qazana-control-responsive-"+a.max),e},templateHelpers:function(){var e={_cid:this.model.cid};return{data:_.extend({},this.model.toJSON(),e)}},getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-control-"+this.model.get("type")+"-content")},initialize:function(e){this.elementSettingsModel=e.elementSettingsModel;var t=this.model.get("type"),a=jQuery.extend(!0,{},qazana.config.controls[t],this.model.attributes);this.model.set(a),this.listenTo(this.elementSettingsModel,"change",this.toggleControlVisibility)},toggleControlVisibility:function(){var e=qazana.helpers.isActiveControl(this.model,this.elementSettingsModel.attributes);this.$el.toggleClass("qazana-hidden-control",!e),qazana.getPanelView().updateScrollbar()},onRender:function(){var e=this.model.get("label_block")?"block":"inline",t=this.model.get("show_label"),a=this.model.get("custom_class"),n="qazana-label-"+e;n+=" qazana-control-separator-"+this.model.get("separator"),t||(n+=" qazana-control-hidden-label"),a&&(n+=" qazana-control-custom-class-"+a),this.$el.addClass(n),this.toggleControlVisibility()}}),t.exports=n},{}],42:[function(e,t,a){var n,i=e("qazana-controls/base-multiple");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.sliders=".qazana-slider",e.colors=".qazana-shadow-color-picker",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"slide @ui.sliders":"onSlideChange"})},initSliders:function(){var e=this.getControlValue();this.ui.sliders.each(function(){var t=jQuery(this),a=t.next(".qazana-slider-input").find("input");t.slider({value:e[this.dataset.input],min:+a.attr("min"),max:+a.attr("max")})})},initColors:function(){var e=this;qazana.helpers.wpColorPicker(this.ui.colors,{change:function(){var t=jQuery(this),a=t.data("setting");e.setValue(a,t.wpColorPicker("color"))},clear:function(){e.setValue(this.dataset.setting,"")}})},onInputChange:function(e){var t=e.currentTarget.dataset.setting;this.ui.sliders.filter('[data-input="'+t+'"]').slider("value",this.getControlValue(t))},onReady:function(){this.initSliders(),this.initColors()},onSlideChange:function(e,t){var a=e.currentTarget.dataset.input;this.ui.input.filter('[data-setting="'+a+'"]').val(t.value),this.setValue(a,t.value)},onBeforeDestroy:function(){this.ui.colors.each(function(){var e=jQuery(this);e.wpColorPicker("instance")&&e.wpColorPicker("close")}),this.$el.remove()}}),t.exports=n},{"qazana-controls/base-multiple":39}],43:[function(e,t,a){var n=e("qazana-controls/base");t.exports=n.extend({ui:function(){var e=n.prototype.ui.apply(this,arguments);return e.button="button",e},events:{"click @ui.button":"onButtonClick"},onButtonClick:function(){var e=this.model.get("event");qazana.channels.editor.trigger(e,this)}})},{"qazana-controls/base":41}],44:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.inputs='[type="radio"]',e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"mousedown label":"onMouseDownLabel","click @ui.inputs":"onClickInput","change @ui.inputs":"onBaseInputChange"})},onMouseDownLabel:function(e){var t=this.$(e.currentTarget),a=this.$("#"+t.attr("for"));a.data("checked",a.prop("checked"))},onClickInput:function(e){if(this.model.get("toggle")){var t=this.$(e.currentTarget);t.data("checked")&&t.prop("checked",!1).trigger("change")}},onRender:function(){i.prototype.onRender.apply(this,arguments);var e=this.getControlValue();e&&this.ui.inputs.filter('[value="'+e+'"]').prop("checked",!0)}},{onPasteStyle:function(e,t){return""===t||void 0!==e.options[t]}}),t.exports=n},{"qazana-controls/base-data":38}],45:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.editor=".qazana-code-editor",e},onReady:function(){var e=this;if("undefined"!=typeof ace){var t=ace.require("ace/ext/language_tools");if(e.editor=ace.edit(this.ui.editor[0]),jQuery(e.editor.container).addClass("qazana-input-style qazana-code-editor"),e.editor.setOptions({mode:"ace/mode/"+e.model.attributes.language,minLines:10,maxLines:1/0,showGutter:!0,useWorker:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),e.editor.getSession().setUseWrapMode(!0),qazana.panel.$el.on("resize.aceEditor",e.onResize.bind(this)),"css"===e.model.attributes.language){var a={getCompletions:function(e,t,a,n,i){var o=[],s=t.getTokenAt(a.row,a.column);0<n.length&&"selector".match(n)&&"constant"===s.type&&(o=[{name:"selector",value:"selector",score:1,meta:"Qazana"}]),i(null,o)}};t.addCompleter(a)}if(e.editor.setValue(e.getControlValue(),-1),e.editor.on("change",function(){e.setValue(e.editor.getValue())}),"html"===e.model.attributes.language){var n=e.editor.getSession();n.on("changeAnnotation",function(){for(var e=n.getAnnotations()||[],t=e.length,a=e.length;a--;)/doctype first\. Expected/.test(e[a].text)&&e.splice(a,1);t>e.length&&n.setAnnotations(e)})}}},onResize:function(){this.editor.resize()},onDestroy:function(){qazana.panel.$el.off("resize.aceEditor")}}),t.exports=n},{"qazana-controls/base-data":38}],46:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({applySavedValue:function(){i.prototype.applySavedValue.apply(this,arguments);var e=this,t=e.getControlValue();e.ui.input.wpColorPicker("instance")?(e.ui.input.wpColorPicker("color",t),t||e.ui.input.data("a8cIris")._change()):qazana.helpers.wpColorPicker(e.ui.input,{change:function(){e.setValue(e.ui.input.wpColorPicker("color"))},clear:function(){e.setValue("")}})},onBeforeDestroy:function(){this.ui.input.wpColorPicker("instance")&&this.ui.input.wpColorPicker("close"),this.$el.remove()}}),t.exports=n},{"qazana-controls/base-data":38}],47:[function(e,t,a){var n;n=e("qazana-controls/base-data").extend({onReady:function(){var e=this,t=_.extend({onClose:function(){e.saveValue()},enableTime:!0,minuteIncrement:1},this.model.get("picker_options"));this.ui.input.flatpickr(t)},saveValue:function(){this.setValue(this.ui.input.val())},onBeforeDestroy:function(){this.saveValue(),this.ui.input.flatpickr().destroy()}}),t.exports=n},{"qazana-controls/base-data":38}],48:[function(e,t,a){var n,i=e("qazana-controls/base-units");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.controls=".qazana-control-dimension > input:enabled",e.link="button.qazana-link-dimensions",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.link":"onLinkDimensionsClicked"})},defaultDimensionValue:0,initialize:function(){i.prototype.initialize.apply(this,arguments),this.model.set("allowed_dimensions",this.filterDimensions(this.model.get("allowed_dimensions")))},getPossibleDimensions:function(){return["top","right","bottom","left"]},filterDimensions:function(e){e=e||"all";var t=this.getPossibleDimensions();return"all"===e?t:(_.isArray(e)||("horizontal"===e?e=["right","left"]:"vertical"===e&&(e=["top","bottom"])),e)},onReady:function(){var e=this,t=e.getControlValue();e.isLinkedDimensions()||(e.ui.link.addClass("unlinked"),e.ui.controls.each(function(a,n){var i=t[n.dataset.setting];_.isEmpty(i)&&(i=e.defaultDimensionValue),e.$(n).val(i)})),e.fillEmptyDimensions()},updateDimensionsValue:function(){var e={},t=this.getPossibleDimensions(),a=this.ui.controls,n=this.defaultDimensionValue;t.forEach(function(t){var i=a.filter('[data-setting="'+t+'"]');e[t]=i.length?i.val():n}),this.setValue(e)},fillEmptyDimensions:function(){var e=this.getPossibleDimensions(),t=this.model.get("allowed_dimensions"),a=this.ui.controls,n=this.defaultDimensionValue;this.isLinkedDimensions()||e.forEach(function(e){var i=a.filter('[data-setting="'+e+'"]');-1!==_.indexOf(t,e)&&i.length&&_.isEmpty(i.val())&&i.val(n)})},updateDimensions:function(){this.fillEmptyDimensions(),this.updateDimensionsValue()},resetDimensions:function(){this.ui.controls.val(""),this.updateDimensionsValue()},onInputChange:function(e){var t=e.target.dataset.setting;if("unit"===t&&this.resetDimensions(),_.contains(this.getPossibleDimensions(),t)){if(this.isLinkedDimensions()){var a=this.$(e.target);this.ui.controls.val(a.val())}this.updateDimensions()}},onLinkDimensionsClicked:function(e){e.preventDefault(),e.stopPropagation(),this.ui.link.toggleClass("unlinked"),this.setValue("isLinked",!this.ui.link.hasClass("unlinked")),this.isLinkedDimensions()&&this.ui.controls.val(this.ui.controls.eq(0).val()),this.updateDimensions()},isLinkedDimensions:function(){return this.getControlValue("isLinked")}}),t.exports=n},{"qazana-controls/base-units":40}],49:[function(e,t,a){var n=e("qazana-controls/select2");t.exports=n.extend({getSelect2Options:function(){return{dir:qazana.config.is_rtl?"rtl":"ltr"}},templateHelpers:function(){var e=n.prototype.templateHelpers.apply(this,arguments),t=this.model.get("options");return e.getFontsByGroups=function(e){var a={};return _.each(t,function(t,n){(_.isArray(e)&&_.contains(e,t)||t===e)&&(a[n]=n)}),a},e}})},{"qazana-controls/select2":61}],50:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.addImages=".qazana-control-gallery-add",e.clearGallery=".qazana-control-gallery-clear",e.galleryThumbnails=".qazana-control-gallery-thumbnails",e.status=".qazana-control-gallery-status-title",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.addImages":"onAddImagesClick","click @ui.clearGallery":"onClearGalleryClick","click @ui.galleryThumbnails":"onGalleryThumbnailsClick"})},onReady:function(){this.initRemoveDialog()},applySavedValue:function(){var e=this.getControlValue().length,t=!!e;this.$el.toggleClass("qazana-gallery-has-images",t).toggleClass("qazana-gallery-empty",!t);var a=this.ui.galleryThumbnails;a.empty(),this.ui.status.text(qazana.translate(t?"gallery_images_selected":"gallery_no_images_selected",[e])),t&&this.getControlValue().forEach(function(e){var t=jQuery("<div>",{class:"qazana-control-gallery-thumbnail"});t.css("background-image","url("+e.url+")"),a.append(t)})},hasImages:function(){return!!this.getControlValue().length},openFrame:function(e){this.initFrame(e),this.frame.open()},initFrame:function(e){var t={frame:"post",multiple:!0,state:{create:"gallery",add:"gallery-library",edit:"gallery-edit"}[e],button:{text:qazana.translate("insert_media")}};this.hasImages()&&(t.selection=this.fetchSelection()),this.frame=wp.media(t),this.frame.on({update:this.select,"menu:render:default":this.menuRender,"content:render:browse":this.gallerySettings},this)},menuRender:function(e){e.unset("insert"),e.unset("featured-image")},gallerySettings:function(e){e.sidebar.on("ready",function(){e.sidebar.unset("gallery")})},fetchSelection:function(){var e=wp.media.query({orderby:"post__in",order:"ASC",type:"image",perPage:-1,post__in:_.pluck(this.getControlValue(),"id")});return new wp.media.model.Selection(e.models,{props:e.props.toJSON(),multiple:!0})},select:function(e){var t=[];e.each(function(e){t.push({id:e.get("id"),url:e.get("url")})}),this.setValue(t),this.applySavedValue()},onBeforeDestroy:function(){this.frame&&this.frame.off(),this.$el.remove()},resetGallery:function(){this.setValue(""),this.applySavedValue()},initRemoveDialog:function(){var e;this.getRemoveDialog=function(){return e||(e=qazana.dialogsManager.createWidget("confirm",{message:qazana.translate("dialog_confirm_gallery_delete"),headerMessage:qazana.translate("delete_gallery"),strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},defaultOption:"confirm",onConfirm:this.resetGallery.bind(this)})),e}},onAddImagesClick:function(){this.openFrame(this.hasImages()?"add":"create")},onClearGalleryClick:function(){this.getRemoveDialog().show()},onGalleryThumbnailsClick:function(){this.openFrame("edit")}}),t.exports=n},{"qazana-controls/base-data":38}],51:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),this.filterIcons()},filterIcons:function(){var e=this.model.get("options"),t=this.model.get("include"),a=this.model.get("exclude");if(t){var n={};return _.each(t,function(t){n[t]=e[t]}),void this.model.set("options",n)}a&&_.each(a,function(t){delete e[t]})},iconsList:function(e){return e.id?jQuery('<span><i class="'+e.id+'"></i> '+e.text+"</span>"):e.text},onReady:function(){this.ui.select.fontIconPicker({theme:"fip-grey"})},templateHelpers:function(){var e=i.prototype.templateHelpers.apply(this,arguments);return e.getIconsByGroups=_.bind(function(e){var t=this.model.get("options"),a={};return _.each(t,function(t,n){(_.isArray(e)&&_.contains(e,t)||t===e)&&(a[n]=t)}),a},this),e}}),t.exports=n},{"qazana-controls/base-data":38}],52:[function(e,t,a){var n;n=e("qazana-controls/base-multiple").extend({ui:function(){return{inputWidth:'input[data-setting="width"]',inputHeight:'input[data-setting="height"]',btnApply:"button.qazana-image-dimensions-apply-button"}},events:function(){return{"click @ui.btnApply":"onApplyClicked"}},onApplyClicked:function(e){e.preventDefault(),this.setValue({width:this.ui.inputWidth.val(),height:this.ui.inputHeight.val()})}}),t.exports=n},{"qazana-controls/base-multiple":39}],53:[function(e,t,a){var n,i=e("qazana-controls/base-multiple");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.controlMedia=".qazana-control-media",e.mediaImage=".qazana-control-media-image",e.mediaVideo=".qazana-control-media-video",e.frameOpeners=".qazana-control-preview-area",e.deleteButton=".qazana-control-media-delete",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.frameOpeners":"openFrame","click @ui.deleteButton":"deleteImage"})},getMediaType:function(){return this.model.get("media_type")},applySavedValue:function(){var e=this.getControlValue("url"),t=this.getMediaType();"image"===t?this.ui.mediaImage.css("background-image",e?"url("+e+")":""):"video"===t&&this.ui.mediaVideo.attr("src",e),this.ui.controlMedia.toggleClass("qazana-media-empty",!e)},openFrame:function(){this.frame||this.initFrame(),this.frame.open()},deleteImage:function(e){e.stopPropagation(),this.setValue({url:"",id:""}),this.applySavedValue()},initFrame:function(){wp.media.view.settings.post.id=qazana.config.document.id,this.frame=wp.media({button:{text:qazana.translate("insert_media")},states:[new wp.media.controller.Library({title:qazana.translate("insert_media"),library:wp.media.query({type:this.getMediaType()}),multiple:!1,date:!1})]}),this.frame.on("insert select",this.select.bind(this))},select:function(){this.trigger("before:select");var e=this.frame.state().get("selection").first().toJSON();e.url&&(this.setValue({url:e.url,id:e.id}),this.applySavedValue()),this.trigger("after:select")},onBeforeDestroy:function(){this.$el.remove()}}),t.exports=n},{"qazana-controls/base-multiple":39}],54:[function(e,t,a){var n,i=e("qazana-controls/base-data"),o=e("qazana-validator/number");n=i.extend({registerValidators:function(){i.prototype.registerValidators.apply(this,arguments);var e={},t=this.model;["min","max"].forEach(function(a){var n=t.get(a);_.isFinite(n)&&(e[a]=n)}),jQuery.isEmptyObject(e)||this.addValidator(new o({validationTerms:e}))}}),t.exports=n},{"qazana-controls/base-data":38,"qazana-validator/number":37}],55:[function(e,t,a){var n,i=e("qazana-controls/base-multiple");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.reverseOrderLabel=".qazana-control-order-label",e},changeLabelTitle:function(){var e=this.getControlValue("reverse_order");this.ui.reverseOrderLabel.attr("title",qazana.translate(e?"asc":"desc"))},onRender:function(){i.prototype.onRender.apply(this,arguments),this.changeLabelTitle()},onInputChange:function(){this.changeLabelTitle()}}),t.exports=n},{"qazana-controls/base-multiple":39}],56:[function(e,t,a){var n,i=e("qazana-controls/choose");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.popoverToggle=".qazana-control-popover-toggle-toggle",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.popoverToggle":"onPopoverToggleClick"})},onPopoverToggleClick:function(){this.$el.next(".qazana-controls-popover").toggle()}},{onPasteStyle:function(e,t){return!t||t===e.return_value}}),t.exports=n},{"qazana-controls/choose":44}],57:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=Marionette.CompositeView.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-repeater-row"),className:"qazana-repeater-fields",ui:{duplicateButton:".qazana-repeater-tool-duplicate",editButton:".qazana-repeater-tool-edit",removeButton:".qazana-repeater-tool-remove",itemTitle:".qazana-repeater-row-item-title"},behaviors:{HandleInnerTabs:{behaviorClass:e("qazana-behaviors/inner-tabs")}},triggers:{"click @ui.removeButton":"click:remove","click @ui.duplicateButton":"click:duplicate","click @ui.itemTitle":"click:edit"},modelEvents:{change:"onModelChange"},templateHelpers:function(){return{itemIndex:this.getOption("itemIndex")}},childViewContainer:".qazana-repeater-row-controls",getChildView:function(e){var t=e.get("type");return qazana.getControlView(t)},childViewOptions:function(){return{elementSettingsModel:this.model}},updateIndex:function(e){this.itemIndex=e},setTitle:function(){var e=this.getOption("titleField"),t="";if(e){var a={};this.children.each(function(e){e instanceof i&&(a[e.model.get("name")]=e.getControlValue())}),t=Marionette.TemplateCache.prototype.compileTemplate(e)(this.model.parseDynamicSettings())}t||(t=qazana.translate("Item #{0}",[this.getOption("itemIndex")])),this.ui.itemTitle.html(t)},initialize:function(e){this.itemIndex=0,this.collection=new Backbone.Collection(_.values(qazana.mergeControlsSettings(e.controlFields)))},onRender:function(){this.setTitle()},onModelChange:function(){this.getOption("titleField")&&this.setTitle()},onChildviewResponsiveSwitcherClick:function(e,t){"desktop"===t&&qazana.getPanelView().getCurrentPageView().$el.toggleClass("qazana-responsive-switchers-open")}}),t.exports=n},{"qazana-behaviors/inner-tabs":77,"qazana-controls/base-data":38}],58:[function(e,t,a){var n,i=e("qazana-controls/base-data"),o=e("qazana-controls/repeater-row"),s=e("qazana-elements/models/base-settings");n=i.extend({ui:{btnAddRow:".qazana-repeater-add",fieldContainer:".qazana-repeater-fields-wrapper"},events:function(){return{"click @ui.btnAddRow":"onButtonAddRowClick","sortstart @ui.fieldContainer":"onSortStart","sortupdate @ui.fieldContainer":"onSortUpdate","sortstop @ui.fieldContainer":"onSortStop"}},childView:o,childViewContainer:".qazana-repeater-fields-wrapper",templateHelpers:function(){return{data:_.extend({},this.model.toJSON(),{controlValue:[]})}},childViewOptions:function(){return{controlFields:this.model.get("fields"),titleField:this.model.get("title_field")}},createItemModel:function(e,t,a){return t=t||{},t.controls=a.model.get("fields"),e._id||(e._id=qazana.helpers.getUniqueID()),new s(e,t)},fillCollection:function(){var e=this.model.get("name");this.collection=this.elementSettingsModel.get(e),this.collection instanceof Backbone.Collection||(this.collection=new Backbone.Collection(this.collection,{model:_.partial(this.createItemModel,_,_,this)}),this.elementSettingsModel.set(e,this.collection,{silent:!0}),this.listenTo(this.collection,"change",this.onRowControlChange),this.listenTo(this.collection,"update",this.onRowUpdate,this))},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.fillCollection(),this.listenTo(this.collection,"change",this.onRowControlChange),this.listenTo(this.collection,"update",this.onRowUpdate,this)},addRow:function(e,t){var a=qazana.helpers.getUniqueID();return e instanceof Backbone.Model?e.set("_id",a):e._id=a,this.collection.add(e,t)},editRow:function(e){if(this.currentEditableChild){var t=this.currentEditableChild.getChildViewContainer(this.currentEditableChild);t.removeClass("editable"),t.find(".qazana-wp-editor").each(function(){tinymce.get(this.id).fire("hide")})}this.currentEditableChild!==e?(e.getChildViewContainer(e).addClass("editable"),this.currentEditableChild=e,this.updateActiveRow()):delete this.currentEditableChild},toggleMinRowsClass:function(){this.model.get("prevent_empty")&&this.$el.toggleClass("qazana-repeater-has-minimum-rows",1>=this.collection.length)},updateActiveRow:function(){var e=1;this.currentEditableChild&&(e=this.currentEditableChild.itemIndex),this.setEditSetting("activeItemIndex",e)},updateChildIndexes:function(){var e=this.collection;this.children.each(function(t){t.updateIndex(e.indexOf(t.model)+1),t.setTitle()})},onRender:function(){i.prototype.onRender.apply(this,arguments),this.ui.fieldContainer.sortable({axis:"y",handle:".qazana-repeater-row-tools"}),this.toggleMinRowsClass()},onSortStart:function(e,t){t.item.data("oldIndex",t.item.index())},onSortStop:function(e,t){var a=this;if(-1!==t.item.index()){var n=a.children.findByIndex(t.item.index()),i=n.children._views;jQuery.each(i,function(){if("wysiwyg"===this.model.get("type"))return n.render(),delete a.currentEditableChild,!1})}},onSortUpdate:function(e,t){var a=t.item.data("oldIndex"),n=this.collection.at(a),i=t.item.index();this.collection.remove(n),this.addRow(n,{at:i})},onAddChild:function(){this.updateChildIndexes(),this.updateActiveRow()},onRowUpdate:function(e,t){var a=this.elementSettingsModel,n=e.clone(),i=this.model.get("name");t.add?n.remove(t.changes.added[0]):n.add(t.changes.removed[0],{at:t.index}),a.changed={},a.changed[i]=e,a._previousAttributes={},a._previousAttributes[i]=n.toJSON(),a.trigger("change",a,a._pending),delete a.changed,delete a._previousAttributes,this.toggleMinRowsClass()},onRowControlChange:function(e){if(Object.keys(e.changed).length){var t=e.collection.toJSON(),a=e.collection.findIndex(e),n=this._parent.model.get("settings"),i=this.model.get("name");t[a]=e._previousAttributes,n.changed={},n.changed[i]=e.collection,n._previousAttributes={},n._previousAttributes[i]=t,n.trigger("change",n),delete n.changed,delete n._previousAttributes}},onButtonAddRowClick:function(){var e={};_.each(this.model.get("fields"),function(t){e[t.name]=t.default});var t=this.addRow(e),a=this.children.findByModel(t);this.editRow(a)},onChildviewClickRemove:function(e){e.model.destroy(),e===this.currentEditableChild&&delete this.currentEditableChild,this.updateChildIndexes(),this.updateActiveRow()},onChildviewClickDuplicate:function(e){var t=this.createItemModel(e.model.toJSON(),{},this);this.addRow(t,{at:e.itemIndex})},onChildviewClickEdit:function(e){this.editRow(e)},onAfterExternalChange:function(){this.fillCollection(),i.prototype.onAfterExternalChange.apply(this,arguments)}}),t.exports=n},{"qazana-controls/base-data":38,"qazana-controls/repeater-row":57,"qazana-elements/models/base-settings":71}],59:[function(e,t,a){var n,i=e("qazana-controls/base");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.heading=".qazana-panel-heading",e},triggers:{click:"control:section:clicked"}}),t.exports=n},{"qazana-controls/base":41}],60:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({},{onPasteStyle:function(e,t){return e.groups?e.groups.some(function(e){return n.onPasteStyle(e,t)}):void 0!==e.options[t]}}),t.exports=n},{"qazana-controls/base-data":38}],61:[function(e,t,a){var n;n=e("qazana-controls/base-data").extend({getSelect2Placeholder:function(){return this.ui.select.children('option:first[value=""]').text()},getSelect2DefaultOptions:function(){return{allowClear:!0,placeholder:this.getSelect2Placeholder(),dir:qazana.config.is_rtl?"rtl":"ltr"}},getSelect2Options:function(){return jQuery.extend(this.getSelect2DefaultOptions(),this.model.get("select2options"))},onReady:function(){this.ui.select.select2(this.getSelect2Options())},onBeforeDestroy:function(){this.ui.select.data("select2")&&this.ui.select.select2("destroy"),this.$el.remove()}}),t.exports=n},{"qazana-controls/base-data":38}],62:[function(e,t,a){var n,i=e("qazana-controls/base-units");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.slider=".qazana-slider",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"slide @ui.slider":"onSlideChange"})},initSlider:function(){var e=this.getControlValue("size"),t=this.getCurrentRange();this.ui.input.attr(t).val(e),this.ui.slider.slider(_.extend({},t,{value:e}))},resetSize:function(){this.setValue("size",""),this.initSlider()},onReady:function(){this.initSlider()},onSlideChange:function(e,t){this.setValue("size",t.value),this.ui.input.val(t.value)},onInputChange:function(e){var t=e.currentTarget.dataset.setting;"size"===t?this.ui.slider.slider("value",this.getControlValue("size")):"unit"===t&&this.resetSize()},onBeforeDestroy:function(){this.ui.slider.data("uiSlider")&&this.ui.slider.slider("destroy"),this.$el.remove()}}),t.exports=n},{"qazana-controls/base-units":40}],63:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.resetStructure=".qazana-control-structure-reset",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.resetStructure":"onResetStructureClick"})},templateHelpers:function(){var e=i.prototype.templateHelpers.apply(this,arguments);return e.getMorePresets=this.getMorePresets.bind(this),e},getCurrentEditedSection:function(){return qazana.getPanelView().getCurrentPageView().getOption("editedElementView")},getMorePresets:function(){var e=qazana.presetsFactory.getParsedStructure(this.getControlValue());return qazana.presetsFactory.getPresets(e.columnsCount)},onInputChange:function(){this.getCurrentEditedSection().redefineLayout(),this.render()},onResetStructureClick:function(){this.getCurrentEditedSection().resetColumnsCustomSize()}}),t.exports=n},{"qazana-controls/base-data":38}],64:[function(e,t,a){var n=e("qazana-controls/base-data");t.exports=n.extend({setInputValue:function(e,t){this.$(e).prop("checked",this.model.get("return_value")===t)}},{onPasteStyle:function(e,t){return!t||t===e.return_value}})},{"qazana-controls/base-data":38}],65:[function(e,t,a){var n;n=e("qazana-controls/base").extend({triggers:{click:{event:"control:tab:clicked",stopPropagation:!1}}}),t.exports=n},{"qazana-controls/base":41}],66:[function(e,t,a){var n=e("qazana-controls/base-multiple");t.exports=n.extend({onReady:function(){var e,t,a=this;this.ui.input.autocomplete({source:function(n,i){if(e!==n.term){if(/^https?:/.test(n.term)||-1!==n.term.indexOf("."))return i();a.ui.input.prev().show(),jQuery.post(window.ajaxurl,{editor:"qazana",action:"wp-link-ajax",page:1,search:n.term,_ajax_linking_nonce:jQuery("#_ajax_linking_nonce").val()},function(e){t=e,i(e)},"json").always(function(){a.ui.input.prev().hide()}),e=n.term}else i(t)},focus:function(e,t){e.preventDefault()},select:function(e,t){return a.ui.input.val(t.item.permalink),a.setValue("url",t.item.permalink),!1},open:function(e){jQuery(e.target).data("uiAutocomplete").menu.activeMenu.addClass("qazana-autocomplete-menu")},minLength:2,position:{my:"left top+2"}}).autocomplete("instance")._renderItem=function(e,t){var a=window.wpLinkL10n?window.wpLinkL10n.noTitle:"",n=t.title?t.title:a;return jQuery('<li role="option" id="mce-wp-autocomplete-'+t.ID+'">').append("<span>"+n+'</span>&nbsp;<span class="qazana-autocomplete-item-info">'+t.info+"</span>").appendTo(e)}},onBeforeDestroy:function(){this.ui.input.data("autocomplete")&&this.ui.input.autocomplete("destroy"),this.$el.remove()}})},{"qazana-controls/base-multiple":39}],67:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.form="form",e.loading=".wp-widget-form-loading",e},events:function(){return{"keyup @ui.form :input":"onFormChanged","change @ui.form :input":"onFormChanged"}},onFormChanged:function(){var e="widget-"+this.model.get("id_base"),t=this.ui.form.qazanaSerializeObject()[e].REPLACE_TO_ID;this.setValue(t)},onReady:function(){var e=this;qazana.ajax.addRequest("editor_get_wp_widget_form",{data:{id:e.model.cid,widget_type:e.model.get("widget"),data:e.elementSettingsModel.toJSON()},success:function(t){if(e.ui.form.html(t),wp.textWidgets){e.ui.form.addClass("open");var a=new jQuery.Event("widget-added");wp.textWidgets.handleWidgetAdded(a,e.ui.form),wp.mediaWidgets.handleWidgetAdded(a,e.ui.form),wp.customHtmlWidgets&&wp.customHtmlWidgets.handleWidgetAdded(a,e.ui.form)}qazana.hooks.doAction("panel/widgets/"+e.model.get("widget")+"/controls/wp_widget/loaded",e)}})}}),t.exports=n},{"qazana-controls/base-data":38}],68:[function(e,t,a){var n,i=e("qazana-controls/base-data");n=i.extend({editor:null,ui:function(){var e=i.prototype.ui.apply(this,arguments);return jQuery.extend(e,{inputWrapper:".qazana-control-input-wrapper"}),e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"keyup textarea.qazana-wp-editor":"onBaseInputChange"})},buttons:{addToBasic:{underline:"italic"},addToAdvanced:{},moveToAdvanced:{blockquote:"removeformat",alignleft:"blockquote",aligncenter:"alignleft",alignright:"aligncenter"},moveToBasic:{},removeFromBasic:["unlink","wp_more"],removeFromAdvanced:[]},initialize:function(){i.prototype.initialize.apply(this,arguments);var e=this;if(e.editorID="qazanawpeditor"+e.cid,_.defer(function(){quicktags({buttons:"strong,em,del,link,img,close",id:e.editorID}),qazana.config.rich_editing_enabled&&switchEditors.go(e.editorID,"tmce"),delete QTags.instances[0]}),qazana.config.rich_editing_enabled){var t={id:e.editorID,selector:"#"+e.editorID,setup:function(t){e.editor=t}};tinyMCEPreInit.mceInit[e.editorID]=_.extend(_.clone(tinyMCEPreInit.mceInit.qazanawpeditor),t),qazana.config.tinymceHasCustomConfig||e.rearrangeButtons()}else e.$el.addClass("qazana-rich-editing-disabled")},applySavedValue:function(){if(this.editor){var e=this.getControlValue();this.editor.setContent(e),jQuery("#"+this.editorID).val(e)}},saveEditor:function(){this.editor.save(),this.setValue(this.editor.getContent())},moveButtons:function(e,t,a){a||(a=t,t=null),_.each(e,function(e,n){var i=a.indexOf(e);if(t){var o=t.indexOf(n);if(-1===o)throw new ReferenceError("Trying to move non-existing button `"+n+"`");t.splice(o,1)}if(-1===i)throw new ReferenceError("Trying to move button after non-existing button `"+e+"`");a.splice(i+1,0,n)})},rearrangeButtons:function(){var e=tinyMCEPreInit.mceInit[this.editorID],t=e.toolbar1.split(","),a=e.toolbar2.split(",");t=_.difference(t,this.buttons.removeFromBasic),a=_.difference(a,this.buttons.removeFromAdvanced),this.moveButtons(this.buttons.moveToBasic,a,t),this.moveButtons(this.buttons.moveToAdvanced,t,a),this.moveButtons(this.buttons.addToBasic,t),this.moveButtons(this.buttons.addToAdvanced,a),e.toolbar1=t.join(","),e.toolbar2=a.join(",")},onReady:function(){var e=this,t=jQuery(qazana.config.wp_editor.replace(/qazanawpeditor/g,e.editorID).replace("%%EDITORCONTENT%%",e.getControlValue()));e.ui.inputWrapper.html(t),setTimeout(function(){e.editor.on("keyup change undo redo SetContent",e.saveEditor.bind(e))},100)},onBeforeDestroy:function(){delete QTags.instances[this.editorID],qazana.config.rich_editing_enabled&&(tinymce.EditorManager.execCommand("mceRemoveEditor",!0,this.editorID),delete tinyMCEPreInit.mceInit[this.editorID],delete tinyMCEPreInit.qtInit[this.editorID])}}),t.exports=n},{"qazana-controls/base-data":38}],69:[function(e,t,a){var n;Marionette.TemplateCache.prototype.compileTemplate=function(e,t){return t={evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g},_.template(e,t)},n=Marionette.Application.extend({previewLoadedOnce:!1,helpers:e("qazana-editor-utils/helpers"),heartbeat:e("qazana-editor-utils/heartbeat"),imagesManager:e("qazana-editor-utils/images-manager"),debug:e("qazana-editor-utils/debug"),schemes:e("qazana-editor-utils/schemes"),presetsFactory:e("qazana-editor-utils/presets-factory"),templates:e("qazana-templates/manager"),ajax:e("qazana-editor-utils/ajax"),conditions:e("qazana-editor-utils/conditions"),hotKeys:e("qazana-utils/hot-keys"),history:e("qazana-extensions/history/assets/js/module"),channels:{editor:Backbone.Radio.channel("QAZANA:editor"),data:Backbone.Radio.channel("QAZANA:data"),panelElements:Backbone.Radio.channel("QAZANA:panelElements"),dataEditMode:Backbone.Radio.channel("QAZANA:editmode"),deviceMode:Backbone.Radio.channel("QAZANA:deviceMode"),templates:Backbone.Radio.channel("QAZANA:templates")},modules:{Module:e("qazana-utils/module"),components:{templateLibrary:{views:{parts:{headerParts:{logo:e("qazana-templates/views/parts/header-parts/logo")}},BaseModalLayout:e("qazana-templates/views/base-modal-layout")}},saver:{behaviors:{HeaderSaver:e("./components/saver/behaviors/header-saver"),FooterSaver:e("./components/saver/behaviors/footer-saver")}}},controls:{Animation:e("qazana-controls/select2"),Base:e("qazana-controls/base"),BaseData:e("qazana-controls/base-data"),BaseMultiple:e("qazana-controls/base-multiple"),Box_shadow:e("qazana-controls/box-shadow"),Button:e("qazana-controls/button"),Choose:e("qazana-controls/choose"),Code:e("qazana-controls/code"),Color:e("qazana-controls/color"),Date_time:e("qazana-controls/date-time"),Dimensions:e("qazana-controls/dimensions"),Font:e("qazana-controls/font"),Gallery:e("qazana-controls/gallery"),Hover_animation:e("qazana-controls/select2"),Icon:e("qazana-controls/icon"),Image_dimensions:e("qazana-controls/image-dimensions"),Media:e("qazana-controls/media"),Number:e("qazana-controls/number"),Order:e("qazana-controls/order"),Popover_toggle:e("qazana-controls/popover-toggle"),Repeater:e("qazana-controls/repeater"),RepeaterRow:e("qazana-controls/repeater-row"),Section:e("qazana-controls/section"),Select:e("qazana-controls/select"),Select2:e("qazana-controls/select2"),Slider:e("qazana-controls/slider"),Structure:e("qazana-controls/structure"),Switcher:e("qazana-controls/switcher"),Tab:e("qazana-controls/tab"),Text_shadow:e("qazana-controls/box-shadow"),Url:e("qazana-controls/url"),Wp_widget:e("qazana-controls/wp_widget"),Wysiwyg:e("qazana-controls/wysiwyg")},elements:{models:{BaseSettings:e("qazana-elements/models/base-settings"),Element:e("qazana-elements/models/element")},views:{Widget:e("qazana-elements/views/widget")}},layouts:{panel:{pages:{elements:{views:{Global:e("qazana-panel/pages/elements/views/global"),Elements:e("qazana-panel/pages/elements/views/elements")}},menu:{Menu:e("qazana-panel/pages/menu/menu")}}}},views:{ControlsStack:e("qazana-views/controls-stack")}},backgroundClickListeners:{popover:{element:".qazana-controls-popover",ignore:".qazana-control-popover-toggle-toggle, .qazana-control-popover-toggle-toggle-label, .select2-container"},tagsList:{element:".qazana-tags-list",ignore:".qazana-control-dynamic-switcher"}},initModulesBC:function(){var e={ControlsStack:this.modules.views.ControlsStack,element:{Model:this.modules.elements.models.Element},RepeaterRowView:this.modules.controls.RepeaterRow,WidgetView:this.modules.elements.views.Widget,panel:{Menu:this.modules.layouts.panel.pages.menu.Menu},saver:{headerBehavior:this.modules.components.saver.behaviors.HeaderSaver,footerBehavior:this.modules.components.saver.behaviors.FooterSaver},SettingsModel:this.modules.elements.models.BaseSettings,templateLibrary:{ElementsCollectionView:this.modules.layouts.panel.pages.elements.views.Elements}};jQuery.extend(this.modules,e)},userCan:function(e){return-1===this.config.user.restrictions.indexOf(e)},_defaultDeviceMode:"desktop",addControlView:function(e,t){this.modules.controls[qazana.helpers.firstLetterUppercase(e)]=t},checkEnvCompatibility:function(){return this.envData.gecko||this.envData.webkit},getElementData:function(e){var t=e.get("elType");if("widget"===t){var a=e.get("widgetType");return!!this.config.widgets[a]&&this.config.widgets[a]}return!!this.config.elements[t]&&this.config.elements[t]},getElementControls:function(e){var t=this.getElementData(e);if(!t)return!1;var a=e.get("isInner"),n={};return _.each(t.controls,function(e,t){a&&e.hide_in_inner||!a&&e.hide_in_top||(n[t]=e)}),n},mergeControlsSettings:function(e){var t=this;return _.each(e,function(a,n){e[n]=jQuery.extend(!0,{},t.config.controls[a.type],a)}),e},getControlView:function(e){var t=qazana.helpers.firstLetterUppercase(e),a=this.modules.controls[t];if(!a){var n=-1!==this.config.controls[e].features.indexOf("ui");a=this.modules.controls[n?"Base":"BaseData"]}return a},getPanelView:function(){return this.panel.currentView},getPreviewView:function(){return this.sections.currentView},initEnvData:function(){this.envData=_.pick(tinymce.Env,["desktop","mac","webkit","gecko","ie","opera"])},initComponents:function(){var t=e("qazana-utils/hooks"),a=e("qazana-dynamic-tags/manager"),n=e("qazana-editor/components/settings/settings"),i=e("qazana-editor/components/saver/manager"),o=e("qazana-editor-utils/notifications");this.hooks=new t,this.saver=new i,this.settings=new n,this.dynamicTags=new a,this.templates.init(),this.initDialogsManager(),this.notifications=new o,this.ajax.init(),this.initHotKeys(),this.initEnvData()},initDialogsManager:function(){this.dialogsManager=new DialogsManager.Instance},initElements:function(){var t=e("qazana-elements/collections/elements"),a=this.config.data;this.elements&&(a=this.elements.toJSON()),this.elements=new t(a),this.elementsModel=new Backbone.Model({elements:this.elements})},initPreview:function(){var e=jQuery;this.$previewWrapper=e("#qazana-preview"),this.$previewResponsiveWrapper=e("#qazana-preview-responsive-wrapper");this.$preview||(this.$preview=e("<iframe>",{id:"qazana-preview-iframe",src:this.config.document.urls.preview,allowfullscreen:1}),this.$previewResponsiveWrapper.append(this.$preview)),this.$preview.on("load",this.onPreviewLoaded.bind(this))},initFrontend:function(){var e=this.$preview[0].contentWindow;window.qazanaFrontend=e.qazanaFrontend,e.qazana=this,qazanaFrontend.init(),qazanaFrontend.elementsHandler.initHandlers(),this.trigger("frontend:init")},initClearPageDialog:function(){var e,t=this;t.getClearPageDialog=function(){return e||(e=this.dialogsManager.createWidget("confirm",{id:"qazana-clear-page-dialog",headerMessage:qazana.translate("clear_page"),message:qazana.translate("dialog_confirm_clear_page"),position:{my:"center center",at:"center center"},strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},onConfirm:function(){t.elements.reset()}}))}},initHotKeys:function(){var e={c:67,d:68,del:46,l:76,m:77,p:80,s:83,v:86},t=jQuery,a={},n=this.hotKeys;a[e.del]={deleteElement:{isWorthHandling:function(e){if(!("editor"===qazana.getPanelView().getCurrentPageName()))return!1;var a=t(e.target);return!a.is(":input, .qazana-input")&&!a.closest('[contenteditable="true"]').length},handle:function(){qazana.getPanelView().getCurrentPageView().getOption("editedElementView").removeElement()}}},a[e.d]={duplicateElement:{isWorthHandling:function(e){return n.isControlEvent(e)},handle:function(){var e=qazana.getPanelView();"editor"===e.getCurrentPageName()&&e.getCurrentPageView().getOption("editedElementView").duplicate()}}},a[e.l]={showTemplateLibrary:{isWorthHandling:function(e){return n.isControlEvent(e)&&e.shiftKey},handle:function(){qazana.templates.startModal()}}},a[e.m]={changeDeviceMode:{devices:["desktop","tablet","mobile"],isWorthHandling:function(e){return n.isControlEvent(e)&&e.shiftKey},handle:function(){var e=qazana.channels.deviceMode.request("currentMode"),t=this.devices.indexOf(e);++t>=this.devices.length&&(t=0),qazana.changeDeviceMode(this.devices[t])}}},a[e.p]={changeEditMode:{isWorthHandling:function(e){return n.isControlEvent(e)},handle:function(){qazana.getPanelView().modeSwitcher.currentView.toggleMode()}}},a[e.s]={saveEditor:{isWorthHandling:function(e){return n.isControlEvent(e)},handle:function(){qazana.saver.saveDraft()}}},a[e.c]={copyElement:{isWorthHandling:function(e){if(!n.isControlEvent(e))return!1;if(!("editor"===qazana.getPanelView().getCurrentPageName()))return!1;var t=qazanaFrontend.getElements("window"),a=getSelection()+t.getSelection();return!a&&qazana.envData.gecko&&(a=[window,t].some(function(e){var t=e.document.activeElement;if(t&&-1!==["INPUT","TEXTAREA"].indexOf(t.tagName)){var a;"INPUT"===t.tagName&&(a=t.type,t.type="text");var n=t.value.substring(t.selectionStart,t.selectionEnd);return t.type=a,!!n}})),!a},handle:function(){qazana.getPanelView().getCurrentPageView().getOption("editedElementView").copy()}}},a[e.v]={pasteElement:{isWorthHandling:function(e){return!!n.isControlEvent(e)&&(-1!==["BODY","IFRAME"].indexOf(document.activeElement.tagName)&&"BODY"===qazanaFrontend.getElements("window").document.activeElement.tagName)},handle:function(){var e=qazana.channels.editor.request("contextMenu:targetView");if(!e){var t=qazana.getPanelView();"editor"===t.getCurrentPageName()&&(e=t.getCurrentPageView().getOption("editedElementView"))}e||(e=qazana.getPreviewView()),e.isPasteEnabled()&&e.paste()}}},_.each(a,function(e,t){_.each(e,function(e,a){n.addHotKeyHandler(t,a,e)})}),n.bindListener(this.$window)},initPanel:function(){this.addRegions({panel:e("qazana-layouts/panel/panel")})},initNavigator:function(){this.addRegions({navigator:e("qazana-layouts/navigator/navigator")})},preventClicksInsideEditor:function(){this.$previewContents.on("submit",function(e){e.preventDefault()}),this.$previewContents.on("click",function(e){var t=jQuery(e.target),a=qazana.channels.dataEditMode.request("activeMode"),n=!!t.closest("#qazana, .pen-menu").length,i=this.contains(t[0]);if((!n||"edit"!==a)&&i&&(t.closest("a:not(.qazana-clickable)").length&&e.preventDefault(),!n)){var o=qazana.getPanelView();"elements"!==o.getCurrentPageName()&&o.setPage("elements")}})},addBackgroundClickArea:function(e){e.addEventListener("click",this.onBackgroundClick.bind(this),!0)},addBackgroundClickListener:function(e,t){this.backgroundClickListeners[e]=t},removeBackgroundClickListener:function(e){delete this.backgroundClickListeners[e]},showFatalErrorDialog:function(e){var t={id:"qazana-fatal-error-dialog",headerMessage:"",message:"",position:{my:"center center",at:"center center"},strings:{confirm:qazana.translate("learn_more"),cancel:qazana.translate("go_back")},onConfirm:null,onCancel:function(){parent.history.go(-1)},hide:{onBackgroundClick:!1,onButtonClick:!1}};e=jQuery.extend(!0,t,e),this.dialogsManager.createWidget("confirm",e).show()},checkPageStatus:function(){qazana.config.current_revision_id!==qazana.config.document.id&&this.notifications.showToast({message:this.translate("working_on_draft_notification"),buttons:[{name:"view_revisions",text:qazana.translate("view_all_revisions"),callback:function(){var e=qazana.getPanelView();e.setPage("historyPage"),e.getCurrentPageView().activateTab("revisions")}}]})},getStorage:function(e){var t=localStorage.getItem("qazana");return t=t?JSON.parse(t):{},e?t[e]:t},setStorage:function(e,t){var a=this.getStorage();a[e]=t,localStorage.setItem("qazana",JSON.stringify(a))},openLibraryOnStart:function(){"#library"===location.hash&&(qazana.templates.startModal(),location.hash="")},enterPreviewMode:function(e){var t=qazanaFrontend.getElements("$body");e&&(t=t.add(this.$body)),t.removeClass("qazana-editor-active").addClass("qazana-editor-preview"),this.$previewQazanaEl.removeClass("qazana-edit-area-active").addClass("qazana-edit-area-preview"),e&&(this.$previewWrapper.css(this.config.is_rtl?"right":"left",""),this.panel.$el.css("width",""))},exitPreviewMode:function(){qazanaFrontend.getElements("$body").add(this.$body).removeClass("qazana-editor-preview").addClass("qazana-editor-active"),this.$previewQazanaEl.removeClass("qazana-edit-area-preview").addClass("qazana-edit-area-active")},changeEditMode:function(e){var t=qazana.channels.dataEditMode,a=t.request("activeMode");t.reply("activeMode",e),e!==a&&t.trigger("switch",e)},reloadPreview:function(){jQuery("#qazana-preview-loading").show(),this.$preview[0].contentWindow.location.reload(!0)},clearPage:function(){this.getClearPageDialog().show()},changeDeviceMode:function(e){var t=this.channels.deviceMode.request("currentMode");t!==e&&(this.$body.removeClass("qazana-device-"+t).addClass("qazana-device-"+e),this.channels.deviceMode.reply("previousMode",t).reply("currentMode",e).trigger("change"))},enqueueTypographyFonts:function(){var e=this,t=this.schemes.getScheme("typography");e.helpers.resetEnqueuedFontsCache(),_.each(t.items,function(t){e.helpers.enqueueFont(t.value.font_family)})},translate:function(e,t,a){a||(a=this.config.i18n);var n=a[e];return void 0===n&&(n=e),t&&(n=(n=n.replace(/{(\d+)}/g,function(e,a){return void 0!==t[a]?t[a]:e})).replace(/%(?:(\d+)\$)?s/g,function(e,a){return a||(a=1),a--,void 0!==t[a]?t[a]:e})),n},onStart:function(){this.$window=jQuery(window),this.$body=jQuery("body"),NProgress.start(),NProgress.inc(.2),this.config=QazanaConfig,Backbone.Radio.DEBUG=!1,Backbone.Radio.tuneIn("QAZANA"),this.initModulesBC(),this.initComponents(),this.checkEnvCompatibility()||this.onEnvNotCompatible(),this.channels.dataEditMode.reply("activeMode","edit"),this.listenTo(this.channels.dataEditMode,"switch",this.onEditModeSwitched),this.initClearPageDialog(),this.addBackgroundClickArea(document),this.$window.trigger("qazana:init"),this.initPreview()},onPreviewLoaded:function(){if(NProgress.done(),this.$preview[0].contentWindow.qazanaFrontend)if(this.$previewContents=this.$preview.contents(),this.$previewQazanaEl=this.$previewContents.find("#qazana"),this.$previewQazanaEl.length){this.initFrontend(),this.initElements();var t=new Marionette.Region({el:this.$previewQazanaEl[0]});this.schemes.init(),this.schemes.printSchemesStyle(),this.preventClicksInsideEditor(),this.addBackgroundClickArea(qazanaFrontend.getElements("$document")[0]),this.previewLoadedOnce?this.getPanelView().setPage("elements",null,{autoFocusSearch:!1}):this.onFirstPreviewLoaded(),this.initNavigator(),this.addRegions({sections:t});var a=e("qazana-views/preview");this.sections.show(new a({model:this.elementsModel})),this.$previewContents.children().addClass("qazana-html"),qazanaFrontend.getElements("$body").addClass("qazana-editor-active").addClass("qazana-page"),qazana.userCan("design")||qazanaFrontend.getElements("$body").addClass("qazana-editor-content-only"),this.changeDeviceMode(this._defaultDeviceMode),jQuery("#qazana-loading, #qazana-preview-loading").fadeOut(600),_.defer(function(){qazanaFrontend.getElements("window").jQuery.holdReady(!1)}),this.enqueueTypographyFonts(),this.onEditModeSwitched(),this.hotKeys.bindListener(qazanaFrontend.getElements("$window")),this.trigger("preview:loaded")}else this.onPreviewElNotFound();else this.onPreviewLoadingError()},onFirstPreviewLoaded:function(){this.initPanel(),this.heartbeat.init(),this.checkPageStatus(),this.openLibraryOnStart(),this.previewLoadedOnce=!0},onEditModeSwitched:function(){var e=this.channels.dataEditMode.request("activeMode");"edit"===e?this.exitPreviewMode():this.enterPreviewMode("preview"===e)},onEnvNotCompatible:function(){this.showFatalErrorDialog({headerMessage:this.translate("device_incompatible_header"),message:this.translate("device_incompatible_message"),strings:{confirm:qazana.translate("proceed_anyway")},hide:{onButtonClick:!0},onConfirm:function(){this.hide()}})},onPreviewLoadingError:function(){this.showFatalErrorDialog({headerMessage:this.translate("preview_not_loading_header"),message:this.translate("preview_not_loading_message"),onConfirm:function(){open(qazana.config.help_preview_error_url,"_blank")}})},onPreviewElNotFound:function(){var e=this.$preview[0].contentWindow.qazanaPreviewErrorArgs;e||(e={headerMessage:this.translate("preview_el_not_found_header"),message:this.translate("preview_el_not_found_message"),confirmURL:qazana.config.help_the_content_url}),e.onConfirm=function(){open(e.confirmURL,"_blank")},this.showFatalErrorDialog(e)},onBackgroundClick:function(e){jQuery.each(this.backgroundClickListeners,function(){var t=jQuery(e.target);if(t[0].control&&(t=t.add(t[0].control)),!this.ignore||!t.closest(this.ignore).length)if(this.callback)this.callback();else{var a=t.closest(this.element);jQuery(this.element).not(a).hide()}})}}),t.exports=(window.qazana=new n).start()},{"./components/saver/behaviors/footer-saver":7,"./components/saver/behaviors/header-saver":8,"qazana-controls/base":41,"qazana-controls/base-data":38,"qazana-controls/base-multiple":39,"qazana-controls/box-shadow":42,"qazana-controls/button":43,"qazana-controls/choose":44,"qazana-controls/code":45,"qazana-controls/color":46,"qazana-controls/date-time":47,"qazana-controls/dimensions":48,"qazana-controls/font":49,"qazana-controls/gallery":50,"qazana-controls/icon":51,"qazana-controls/image-dimensions":52,"qazana-controls/media":53,"qazana-controls/number":54,"qazana-controls/order":55,"qazana-controls/popover-toggle":56,"qazana-controls/repeater":58,"qazana-controls/repeater-row":57,"qazana-controls/section":59,"qazana-controls/select":60,"qazana-controls/select2":61,"qazana-controls/slider":62,"qazana-controls/structure":63,"qazana-controls/switcher":64,"qazana-controls/tab":65,"qazana-controls/url":66,"qazana-controls/wp_widget":67,"qazana-controls/wysiwyg":68,"qazana-dynamic-tags/manager":2,"qazana-editor-utils/ajax":116,"qazana-editor-utils/conditions":117,"qazana-editor-utils/debug":120,"qazana-editor-utils/heartbeat":121,"qazana-editor-utils/helpers":122,"qazana-editor-utils/images-manager":123,"qazana-editor-utils/notifications":126,"qazana-editor-utils/presets-factory":127,"qazana-editor-utils/schemes":128,"qazana-editor/components/saver/manager":9,"qazana-editor/components/settings/settings":14,"qazana-elements/collections/elements":70,"qazana-elements/models/base-settings":71,"qazana-elements/models/element":73,"qazana-elements/views/widget":83,"qazana-extensions/history/assets/js/module":149,"qazana-layouts/navigator/navigator":88,"qazana-layouts/panel/panel":115,"qazana-panel/pages/elements/views/elements":101,"qazana-panel/pages/elements/views/global":102,"qazana-panel/pages/menu/menu":104,"qazana-templates/manager":17,"qazana-templates/views/base-modal-layout":19,"qazana-templates/views/parts/header-parts/logo":23,"qazana-utils/hooks":137,"qazana-utils/hot-keys":138,"qazana-utils/module":140,"qazana-views/controls-stack":135,"qazana-views/preview":136}],70:[function(e,t,a){var n=e("qazana-elements/models/element"),i=Backbone.Collection.extend({add:function(e,t,a){if(!(t&&t.silent||a))throw"Call Error: Adding model to element collection is allowed only by the dedicated addChildModel() method.";return Backbone.Collection.prototype.add.call(this,e,t)},model:function(e,t){var a=Backbone.Model;return e.elType&&(a=qazana.hooks.applyFilters("element/model",n,e)),new a(e,t)},clone:function(){var e=Backbone.Collection.prototype.clone.apply(this,arguments),t=new i;return e.forEach(function(e){t.add(e.clone(),null,!0)}),t}});i.prototype.sync=i.prototype.fetch=i.prototype.save=_.noop,t.exports=i},{"qazana-elements/models/element":73}],71:[function(e,t,a){var n;n=Backbone.Model.extend({options:{},initialize:function(e,t){var a=this;if(a.options=t,a.controls=qazana.mergeControlsSettings(t.controls),a.validators={},a.controls){var n=e||{},i={};_.each(a.controls,function(e){if(!(-1!==e.features.indexOf("ui"))){var t=e.name;i[t]=e.default;var o=e.dynamic&&e.dynamic.active,s=o&&n.__dynamic__&&n.__dynamic__[t];o&&!s&&e.dynamic.default&&(n.__dynamic__||(n.__dynamic__={}),n.__dynamic__[t]=e.dynamic.default,s=!0);var r=jQuery.isPlainObject(e.default);void 0===n[t]||!r||_.isObject(n[t])||s||(qazana.debug.addCustomError(new TypeError("An invalid argument supplied as multiple control value"),"InvalidElementData","Element `"+(a.get("widgetType")||a.get("elType"))+"` got <"+n[t]+"> as `"+t+"` value. Expected array or object."),delete n[t]),void 0===n[t]&&(n[t]=i[t])}}),a.defaults=i,a.handleRepeaterData(n),a.set(n)}},handleRepeaterData:function(e){_.each(this.controls,function(t){t.is_repeater&&(e[t.name]instanceof Backbone.Collection||(e[t.name]=new Backbone.Collection(e[t.name],{model:function(e,a){return a=a||{},a.controls=t.fields,e._id||(e._id=qazana.helpers.getUniqueID()),new n(e,a)}})))})},getFontControls:function(){return _.filter(this.getActiveControls(),function(e){return"font"===e.type})},getStyleControls:function(e,t){var a=this;e=qazana.helpers.cloneObject(a.getActiveControls(e,t));var n=[];return jQuery.each(e,function(){var t=this,i=qazana.config.controls[t.type];if((t=jQuery.extend({},i,t)).fields){var o=[];a.attributes[t.name].each(function(e){o.push(a.getStyleControls(t.fields,e.attributes))}),t.styleFields=o}(t.fields||t.dynamic&&t.dynamic.active||a.isStyleControl(t.name,e))&&n.push(t)}),n},isStyleControl:function(e,t){t=t||this.controls;var a=_.find(t,function(t){return e===t.name});return a&&!_.isEmpty(a.selectors)},getClassControls:function(e){return e=e||this.controls,_.filter(e,function(e){return!_.isUndefined(e.prefix_class)})},isClassControl:function(e){var t=_.find(this.controls,function(t){return e===t.name});return t&&!_.isUndefined(t.prefix_class)},getControl:function(e){return _.find(this.controls,function(t){return e===t.name})},getActiveControls:function(e,t){var a={};return e||(e=this.controls),t||(t=this.attributes),_.each(e,function(e,n){qazana.helpers.isActiveControl(e,t)&&(a[n]=e)}),a},clone:function(){return new n(qazana.helpers.cloneObject(this.attributes),qazana.helpers.cloneObject(this.options))},setExternalChange:function(e,t){var a,n=this;"object"==typeof e?a=e:(a={})[e]=t,n.set(a),jQuery.each(a,function(e,t){n.trigger("change:external:"+e,t)})},parseDynamicSettings:function(e,t,a){var n=this;return e=qazana.helpers.cloneObject(e||n.attributes),t=t||{},a=a||this.controls,jQuery.each(a,function(){var a,i=this;if("repeater"!==i.type){if(a=e.__dynamic__&&e.__dynamic__[i.name]){var o=i.dynamic;if(void 0===o&&(o=qazana.config.controls[i.type].dynamic),o&&o.active){var s;try{s=qazana.dynamicTags.parseTagsText(a,o,qazana.dynamicTags.getTagDataContent)}catch(e){if(qazana.dynamicTags.CACHE_KEY_NOT_FOUND_ERROR!==e.message)throw e;s="",t.onServerRequestStart&&t.onServerRequestStart(),qazana.dynamicTags.refreshCacheFromServer(function(){t.onServerRequestEnd&&t.onServerRequestEnd()})}o.property?e[i.name][o.property]=s:e[i.name]=s}}}else(a=e[i.name]).forEach(function(e,o){a[o]=n.parseDynamicSettings(e,t,i.fields)})}),e},toJSON:function(e){var t=Backbone.Model.prototype.toJSON.call(this);if(e=e||{},delete t.widgetType,delete t.elType,delete t.isInner,_.each(t,function(e,a){e&&e.toJSON&&(t[a]=e.toJSON())}),e.removeDefault){var a=this.controls;_.each(t,function(e,n){var i=a[n];if(i){if(i.save_default||("text"===i.type||"textarea"===i.type)&&t[n])return;if(t[n]&&"object"==typeof t[n]){if(Object.keys(t[n]).length!==Object.keys(i.default).length)return;var o=!0;_.each(t[n],function(e,a){if(t[n][a]!==i.default[a])return o=!1}),o&&delete t[n]}else t[n]===i.default&&delete t[n]}})}return qazana.helpers.cloneObject(t)}}),t.exports=n},{}],72:[function(e,t,a){var n;n=e("qazana-elements/models/base-settings").extend({defaults:{_column_size:100}}),t.exports=n},{"qazana-elements/models/base-settings":71}],73:[function(e,t,a){var n,i=e("qazana-elements/models/base-settings"),o=e("qazana-elements/models/column-settings");(n=Backbone.Model.extend({defaults:{id:"",elType:"",isInner:!1,settings:{},defaultEditSettings:{}},remoteRender:!1,_htmlCache:null,_jqueryXhr:null,renderOnLeave:!1,initialize:function(t){var a=this.get("elType"),n=this.get("elements");if(void 0!==n){var i=e("qazana-elements/collections/elements");this.set("elements",new i(n))}"widget"===a&&(this.remoteRender=!0,this.setHtmlCache(t.htmlCache||"")),delete t.htmlCache,this.renderRemoteServer=_.throttle(this.renderRemoteServer,1e3),this.initSettings(),this.initEditSettings(),this.on({destroy:this.onDestroy,"editor:close":this.onCloseEditor})},initSettings:function(){var e=this.get("elType"),t=this.get("settings"),a={column:o}[e]||i;jQuery.isEmptyObject(t)&&(t=qazana.helpers.cloneObject(t)),"widget"===e&&(t.widgetType=this.get("widgetType")),t.elType=e,t.isInner=this.get("isInner"),t=new a(t,{controls:qazana.getElementControls(this)}),this.set("settings",t),qazanaFrontend.config.elements.data[this.cid]=t},initEditSettings:function(){var e=new Backbone.Model(this.get("defaultEditSettings"));this.set("editSettings",e),qazanaFrontend.config.elements.editSettings[this.cid]=e},setSetting:function(e,t){var a=this.get("settings");if("object"!=typeof e){var n=e.split("."),i=3===n.length;e=n[0],i&&(a=a.get(e).models[n[1]],e=n[2])}a.setExternalChange(e,t)},getSetting:function(e){var t=e.split("."),a=3===t.length,n=this.get("settings");e=t[0];var i=n.get(e);return void 0===i?"":(a&&(i=i.models[t[1]].get(t[2])),i)},setHtmlCache:function(e){this._htmlCache=e},getHtmlCache:function(){return this._htmlCache},getDefaultTitle:function(){return qazana.getElementData(this).title},getTitle:function(){var e=this.getSetting("_title");return e||(e=this.getDefaultTitle()),e},getIcon:function(){return qazana.getElementData(this).icon},createRemoteRenderRequest:function(){var e=this.toJSON();return qazana.ajax.addRequest("render_widget",{unique_id:this.cid,data:{data:e},success:this.onRemoteGetHtml.bind(this)},!0).jqXhr},renderRemoteServer:function(){this.remoteRender&&(this.renderOnLeave=!1,this.trigger("before:remote:render"),this.isRemoteRequestActive()&&this._jqueryXhr.abort(),this._jqueryXhr=this.createRemoteRenderRequest())},isRemoteRequestActive:function(){return this._jqueryXhr&&4!==this._jqueryXhr.readyState},onRemoteGetHtml:function(e){this.setHtmlCache(e.render),this.trigger("remote:render")},clone:function(){var e=new this.constructor(qazana.helpers.cloneObject(this.attributes));e.set("id",qazana.helpers.getUniqueID()),e.setHtmlCache(this.getHtmlCache());var t=this.get("elements");return _.isEmpty(t)||e.set("elements",t.clone()),e},toJSON:function(e){e=_.extend({copyHtmlCache:!1},e);var t=Backbone.Model.prototype.toJSON.call(this);return _.each(t,function(a,n){a&&a.toJSON&&(t[n]=a.toJSON(e))}),e.copyHtmlCache?t.htmlCache=this.getHtmlCache():delete t.htmlCache,t},onCloseEditor:function(){this.renderOnLeave&&this.renderRemoteServer()},onDestroy:function(){var e=this.get("settings"),t=this.get("elements");void 0!==t&&_.each(_.clone(t.models),function(e){e.destroy()}),e.destroy()}})).prototype.sync=n.prototype.fetch=n.prototype.save=_.noop,t.exports=n},{"qazana-elements/collections/elements":70,"qazana-elements/models/base-settings":71,"qazana-elements/models/column-settings":72}],74:[function(e,t,a){var n,i=e("qazana-elements/models/base-settings"),o=e("qazana-editor-utils/controls-css-parser"),s=e("qazana-validator/base"),r=e("qazana-views/base-container");n=r.extend({tagName:"div",controlsCSSParser:null,allowRender:!0,toggleEditTools:!1,renderAttributes:{},className:function(){var e="qazana-element qazana-element-edit-mode "+this.getElementUniqueID();return this.toggleEditTools&&(e+=" qazana-element--toggle-edit-tools"),e},attributes:function(){var e=this.model.get("elType");return"widget"===e&&(e=this.model.get("widgetType")),{"data-id":this.getID(),"data-element_type":e}},ui:function(){return{tools:"> .qazana-element-overlay > .qazana-editor-element-settings",editButton:"> .qazana-element-overlay .qazana-editor-element-edit",duplicateButton:"> .qazana-element-overlay .qazana-editor-element-duplicate",addButton:"> .qazana-element-overlay .qazana-editor-element-add",removeButton:"> .qazana-element-overlay .qazana-editor-element-remove"}},behaviors:function(){var t=qazana.hooks.applyFilters("elements/"+this.options.model.get("elType")+"/contextMenuGroups",this.getContextMenuGroups(),this),a={contextMenu:{behaviorClass:e("qazana-behaviors/context-menu"),groups:t}};return qazana.hooks.applyFilters("elements/base/behaviors",a,this)},getBehavior:function(e){return this._behaviors[Object.keys(this.behaviors()).indexOf(e)]},events:function(){return{mousedown:"onMouseDown","click @ui.editButton":"onEditButtonClick","click @ui.duplicateButton":"onDuplicateButtonClick","click @ui.addButton":"onAddButtonClick","click @ui.removeButton":"onRemoveButtonClick"}},getElementType:function(){return this.model.get("elType")},getIDInt:function(){return parseInt(this.getID(),16)},getChildType:function(){return qazana.helpers.getElementChildType(this.getElementType())},getChildView:function(t){var a,n=t.get("elType");return a="section"===n?e("qazana-elements/views/section"):"column"===n?e("qazana-elements/views/column"):qazana.modules.elements.views.Widget,qazana.hooks.applyFilters("element/view",a,t,this)},templateHelpers:function(){var e=r.prototype.templateHelpers.apply(this,arguments);return jQuery.extend(e,{editModel:this.getEditModel()})},getTemplateType:function(){return"js"},getEditModel:function(){return this.model},getContextMenuGroups:function(){var e=this.options.model.get("elType"),t=qazana.envData.mac?"":"^";return[{name:"general",actions:[{name:"edit",icon:"eicon-edit",title:qazana.translate("edit_element",[qazana.helpers.firstLetterUppercase(e)]),callback:this.options.model.trigger.bind(this.options.model,"request:edit")},{name:"duplicate",icon:"eicon-clone",title:qazana.translate("duplicate"),shortcut:t+"+D",callback:this.duplicate.bind(this)}]},{name:"transfer",actions:[{name:"copy",title:qazana.translate("copy"),shortcut:t+"+C",callback:this.copy.bind(this)},{name:"paste",title:qazana.translate("paste"),shortcut:t+"+V",callback:this.paste.bind(this),isEnabled:this.isPasteEnabled.bind(this)},{name:"pasteStyle",title:qazana.translate("paste_style"),callback:this.pasteStyle.bind(this),isEnabled:function(){return!!qazana.getStorage("transfer")}},{name:"resetStyle",title:qazana.translate("reset_style"),callback:this.resetStyle.bind(this)}]},{name:"delete",actions:[{name:"delete",icon:"eicon-trash",title:qazana.translate("delete"),shortcut:"",callback:this.removeElement.bind(this)}]}]},initialize:function(){r.prototype.initialize.apply(this,arguments),this.collection&&(this.listenTo(this.collection,"add remove reset",this.onCollectionChanged,this),this.listenTo(this.collection,"switch",this.handleElementHover,this));var e=this.getEditModel();this.listenTo(e.get("settings"),"change",this.onSettingsChanged).listenTo(e.get("editSettings"),"change",this.onEditSettingsChanged).listenTo(this.model,"request:edit",this.onEditRequest).listenTo(this.model,"request:toggleVisibility",this.toggleVisibility),this.initControlsCSSParser()},handleElementHover:function(){var e=this,t={class:"qazana-element-settings-active"},a={sensitivity:1,interval:10,timeout:500,over:function(){e.$el.addClass(t.class)},out:function(){e.$el.removeClass(t.class)}};e.$el.hoverIntent(a)},startTransport:function(e){qazana.setStorage("transfer",{type:e,elementsType:this.getElementType(),elements:[this.model.toJSON({copyHtmlCache:!0})]})},copy:function(){this.startTransport("copy")},cut:function(){this.startTransport("cut")},paste:function(){this.trigger("request:paste")},isPasteEnabled:function(){var e=qazana.getStorage("transfer");return!(!e||this.isCollectionFilled())&&this.getElementType()===e.elementsType},isStyleTransferControl:function(e){return void 0!==e.style_transfer?e.style_transfer:"content"!==e.tab||e.selectors||e.prefix_class},duplicate:function(){var e=qazana.getStorage("transfer");this.copy(),this.paste(),qazana.setStorage("transfer",e)},pasteStyle:function(){var e=this,t=qazana.getStorage("transfer").elements[0].settings,a=e.getEditModel(),n=a.get("settings"),i=n.attributes,o=n.controls,s={};jQuery.each(o,function(a,n){if(e.isStyleTransferControl(n)){var o=t[a],r=i[a];if(void 0!==o&&void 0!==r){if("object"==typeof o){if("object"!=typeof r)return;var l=!0;if(jQuery.each(o,function(e){if(o[e]!==r[e])return l=!1}),l)return}else if(o===r)return;qazana.getControlView(n.type).onPasteStyle(n,o)&&(s[a]=o)}}}),e.allowRender=!1,qazana.channels.data.trigger("element:before:paste:style",a),a.setSetting(s),qazana.channels.data.trigger("element:after:paste:style",a),e.allowRender=!0,e.renderOnChange()},resetStyle:function(){var e=this,t=e.getEditModel(),a=t.get("settings").controls,n={};e.allowRender=!1,qazana.channels.data.trigger("element:before:reset:style",t),jQuery.each(a,function(t,a){e.isStyleTransferControl(a)&&(n[t]=a.default)}),t.setSetting(n),qazana.channels.data.trigger("element:after:reset:style",t),e.allowRender=!0,e.renderOnChange()},toggleVisibility:function(){this.model.set("hidden",!this.model.get("hidden")),this.toggleVisibilityClass()},toggleVisibilityClass:function(){this.$el.toggleClass("qazana-edit-hidden",!!this.model.get("hidden"))},addElementFromPanel:function(e){e=e||{};var t=qazana.channels.panelElements.request("element:selected"),a={elType:t.model.get("elType")};if("widget"===a.elType)a.widgetType=t.model.get("widgetType");else{if("section"!==a.elType)return;a.isInner=!0}var n=t.model.get("custom");n&&jQuery.extend(a,n),e.trigger={beforeAdd:"element:before:add",afterAdd:"element:after:add"},e.onAfterAdd=function(e,t){"section"===t.getElementType()&&t.isInner()&&t.addChildElement()},this.addChildElement(a,e)},addControlValidator:function(e,t){t=t.bind(this);var a=new s({customValidationMethod:t}),n=this.getEditModel().get("settings").validators;n[e]||(n[e]=[]),n[e].push(a)},addRenderAttribute:function(e,t,a,n){var i=this;return"object"==typeof e?(jQuery.each(e,function(e){i.addRenderAttribute(e,this,null,n)}),i):"object"==typeof t?(jQuery.each(t,function(t){i.addRenderAttribute(e,t,this,n)}),i):(i.renderAttributes[e]||(i.renderAttributes[e]={}),i.renderAttributes[e][t]||(i.renderAttributes[e][t]=[]),Array.isArray(a)||(a=[a]),void(i.renderAttributes[e][t]=n?a:i.renderAttributes[e][t].concat(a)))},getRenderAttributeString:function(e){if(!this.renderAttributes[e])return"";var t=this.renderAttributes[e],a=[];return jQuery.each(t,function(e){a.push(e+'="'+_.escape(this.join(" "))+'"')}),a.join(" ")},isInner:function(){return!!this.model.get("isInner")},initControlsCSSParser:function(){this.controlsCSSParser=new o({id:this.model.cid,settingsModel:this.getEditModel().get("settings"),dynamicParsing:this.getDynamicParsingSettings()})},enqueueFonts:function(){var e=this.getEditModel(),t=e.get("settings");_.each(t.getFontControls(),function(t){var a=e.getSetting(t.name);_.isEmpty(a)||qazana.helpers.enqueueFont(a)})},renderStyles:function(e){e||(e=this.getEditModel().get("settings"));var t=this,a=e.get("custom_css"),n=qazana.hooks.applyFilters("editor/style/styleText","",this);t.controlsCSSParser.stylesheet.empty(),t.controlsCSSParser.addStyleRules(e.getStyleControls(),e.attributes,t.getEditModel().get("settings").controls,[/{{ID}}/g,/{{WRAPPER}}/g],[t.getID(),"#qazana ."+t.getElementUniqueID()]),t.controlsCSSParser.addStyleToDocument(),a&&t.controlsCSSParser.elements.$stylesheetElement.append(a.replace(/selector/g,"#qazana ."+t.getElementUniqueID())),n&&t.controlsCSSParser.elements.$stylesheetElement.append(n)},renderCustomClasses:function(){var e=this,t=e.getEditModel().get("settings"),a=t.getClassControls();_.each(a,function(a){var n=t.previous(a.name);a.classes_dictionary&&void 0!==a.classes_dictionary[n]&&(n=a.classes_dictionary[n]),e.$el.removeClass(a.prefix_class+n)}),_.each(a,function(a){var n=t.attributes[a.name],i=n;a.classes_dictionary&&void 0!==a.classes_dictionary[n]&&(i=a.classes_dictionary[n]),qazana.helpers.isActiveControl(a,t.attributes)&&(i||0===i)&&e.$el.addClass(a.prefix_class+i)}),e.$el.addClass(_.result(e,"className")),e.toggleVisibilityClass()},renderCustomElementID:function(){var e=this.getEditModel().get("settings").get("_element_id");this.$el.attr("id",e)},getModelForRender:function(){return qazana.hooks.applyFilters("element/templateHelpers/editModel",this.getEditModel(),this)},renderUIOnly:function(){var e=this.getModelForRender();this.renderStyles(e.get("settings")),this.renderCustomClasses(),this.renderCustomElementID(),this.enqueueFonts()},renderUI:function(){this.renderStyles(),this.renderCustomClasses(),this.renderCustomElementID(),this.enqueueFonts()},runReadyTrigger:function(){var e=this;_.defer(function(){qazanaFrontend.elementsHandler.runReadyTrigger(e.$el),qazanaFrontend.isEditMode()&&e.$el.find(".qazana-element.qazana-"+e.model.get("elType")+":not(.qazana-element-edit-mode)").each(function(){qazanaFrontend.elementsHandler.runReadyTrigger(jQuery(this))})})},getID:function(){return this.model.get("id")},getElementUniqueID:function(){return"qazana-element-"+this.getID()},renderOnChange:function(e){if(this.allowRender){if(e instanceof i){var t=e.hasChanged(),a=!t,n=!t;if(_.each(e.changedAttributes(),function(t,i){var o=e.getControl(i);if("_column_size"!==i){if(!o)return n=!0,void(a=!0);"none"!==o.render_type&&(n=!0),-1===["none","ui"].indexOf(o.render_type)&&("template"!==o.render_type&&(e.isStyleControl(i)||e.isClassControl(i)||"_element_id"===i)||(a=!0))}else n=!0}),!n)return;if(!a)return void this.renderUI()}var o=this.getTemplateType(),s=this.getEditModel();"js"===o?(this.getEditModel().setHtmlCache(),this.render(),s.renderOnLeave=!0):s.renderRemoteServer()}},getDynamicParsingSettings:function(){var e=this;return{onServerRequestStart:function(){e.$el.addClass("qazana-loading")},onServerRequestEnd:function(){e.render(),e.$el.removeClass("qazana-loading")}}},serializeData:function(){var e=r.prototype.serializeData.apply(this,arguments);return e.settings=this.getEditModel().get("settings").parseDynamicSettings(e.settings,this.getDynamicParsingSettings()),e},save:function(){var e=this.model;qazana.templates.startModal({onReady:function(){qazana.templates.getLayout().showSaveTemplateView(e)}})},removeElement:function(){qazana.channels.data.trigger("element:before:remove",this.model);var e=this._parent;e.isManualRemoving=!0,this.model.destroy(),e.isManualRemoving=!1,qazana.channels.data.trigger("element:after:remove",this.model)},onBeforeRender:function(){this.renderAttributes={}},onRender:function(){if(this.renderUI(),this.runReadyTrigger(),this.toggleEditTools){var e=this.ui.editButton;this.ui.tools.hoverIntent(function(){e.addClass("qazana-active")},function(){e.removeClass("qazana-active")},{timeout:500})}},onCollectionChanged:function(){qazana.saver.setFlagEditorChange(!0)},onEditSettingsChanged:function(e){qazana.channels.editor.trigger("change:editSettings",e,this)},onSettingsChanged:function(e){qazana.saver.setFlagEditorChange(!0),this.renderOnChange(e)},onEditButtonClick:function(){this.model.trigger("request:edit")},onEditRequest:function(){qazana.helpers.scrollToView(this.$el,200),"edit"===qazana.channels.dataEditMode.request("activeMode")&&qazana.getPanelView().openEditor(this.getEditModel(),this)},onDuplicateButtonClick:function(e){e.stopPropagation(),this.duplicate()},onRemoveButtonClick:function(e){e.stopPropagation(),this.removeElement()},onMouseDown:function(e){jQuery(e.target).closest(".qazana-inline-editing").length||qazanaFrontend.getElements("$document")[0].activeElement.blur()},onDestroy:function(){this.controlsCSSParser.removeStyleFromDocument(),qazana.channels.data.trigger("element:destroy",this.model)}}),t.exports=n},{"qazana-behaviors/context-menu":75,"qazana-editor-utils/controls-css-parser":119,"qazana-elements/models/base-settings":71,"qazana-elements/views/column":81,"qazana-elements/views/section":82,"qazana-validator/base":36,"qazana-views/base-container":133}],75:[function(e,t,a){var n=e("qazana-editor-utils/context-menu");t.exports=Marionette.Behavior.extend({defaults:{groups:[],eventTargets:["el"]},events:function(){var e={};return qazana.userCan("design")?(this.getOption("eventTargets").forEach(function(t){var a="contextmenu";"el"!==t&&(a+=" "+t),e[a]="onContextMenu"}),e):e},initialize:function(){this.listenTo(this.view.options.model,"request:contextmenu",this.onRequestContextMenu)},initContextMenu:function(){var e=this.getOption("groups"),t=_.findWhere(e,{name:"delete"}),a=e.indexOf(t);-1===a&&(a=e.length),e.splice(a,0,{name:"tools",actions:[{name:"navigator",title:qazana.translate("navigator"),callback:qazana.navigator.open.bind(qazana.navigator,this.view.model)}]}),this.contextMenu=new n({groups:e}),this.contextMenu.getModal().on("hide",this.onContextMenuHide)},getContextMenu:function(){return this.contextMenu||this.initContextMenu(),this.contextMenu},onContextMenu:function(e){qazana.hotKeys.isControlEvent(e)||"edit"===qazana.channels.dataEditMode.request("activeMode")&&(e.preventDefault(),e.stopPropagation(),this.getContextMenu().show(e),qazana.channels.editor.reply("contextMenu:targetView",this.view))},onRequestContextMenu:function(e){var t=this.getContextMenu().getModal(),a=t.getSettings("iframe"),n=_.findWhere(this.contextMenu.getSettings("groups"),{name:"tools"});n.isVisible=!1,t.setSettings("iframe",null),this.onContextMenu(e),n.isVisible=!0,t.setSettings("iframe",a)},onContextMenuHide:function(){qazana.channels.editor.reply("contextMenu:targetView",null)},onDestroy:function(){this.contextMenu&&this.contextMenu.destroy()}})},{"qazana-editor-utils/context-menu":118}],76:[function(e,t,a){var n;n=Marionette.Behavior.extend({editing:!1,$currentEditingArea:null,ui:function(){return{inlineEditingArea:"."+this.getOption("inlineEditingClass")}},events:function(){return{"click @ui.inlineEditingArea":"onInlineEditingClick","input @ui.inlineEditingArea":"onInlineEditingUpdate"}},getEditingSettingKey:function(){return this.$currentEditingArea.data().qazanaSettingKey},startEditing:function(e){var t=e.data().qazanaSettingKey,a=t,n=t.split("."),i=3===n.length,o=this.view.getEditModel().get("settings");i&&(o=o.get(n[0]).models[n[1]],a=n[2]);var s=o.get("__dynamic__"),r=s&&s[a];if(!(this.editing||r||"edit"!==qazana.channels.dataEditMode.request("activeMode")||this.view.model.isRemoteRequestActive())){this.$currentEditingArea=e;var l=this.$currentEditingArea.data().qazanaInlineEditingToolbar,c="advanced"===l?"advanced":"basic",d=this.view.getEditModel(),u=qazana.config.inlineEditing,h=d.getSetting(this.getEditingSettingKey());"advanced"===c&&(h=wp.editor.autop(h)),this.$currentEditingArea.html(h);var g=qazanaFrontend.getElements("window").QazanaInlineEditor;this.editing=!0,this.view.allowRender=!1,this.view.model.setHtmlCache(""),this.editor=new g({linksInNewWindow:!0,stay:!1,editor:this.$currentEditingArea[0],mode:c,list:"none"===l?[]:u.toolbar[l||"basic"],cleanAttrs:["id","class","name"],placeholder:qazana.translate("type_here")+"...",toolbarIconsPrefix:"eicon-editor-",toolbarIconsDictionary:{externalLink:{className:"eicon-editor-external-link"},list:{className:"eicon-editor-list-ul"},insertOrderedList:{className:"eicon-editor-list-ol"},insertUnorderedList:{className:"eicon-editor-list-ul"},createlink:{className:"eicon-editor-link"},unlink:{className:"eicon-editor-unlink"},blockquote:{className:"eicon-editor-quote"},p:{className:"eicon-editor-paragraph"},pre:{className:"eicon-editor-code"}}}),jQuery(this.editor._menu).children().on("mousedown",function(e){e.preventDefault()}),this.$currentEditingArea.on("blur",this.onInlineEditingBlur.bind(this))}},stopEditing:function(){this.editing=!1,this.editor.destroy(),this.view.allowRender=!0,"advanced"===this.$currentEditingArea.data().qazanaInlineEditingToolbar&&this.view.getEditModel().renderRemoteServer()},onInlineEditingClick:function(e){var t=this,a=jQuery(e.currentTarget);setTimeout(function(){t.startEditing(a)},30)},onInlineEditingBlur:function(){var e=this;setTimeout(function(){var t=qazanaFrontend.getElements("window").getSelection();jQuery(t.focusNode).closest(".pen-input-wrapper").length||e.stopEditing()},20)},onInlineEditingUpdate:function(){this.view.getEditModel().setSetting(this.getEditingSettingKey(),this.editor.getContent())}}),t.exports=n},{}],77:[function(e,t,a){var n;n=Marionette.Behavior.extend({onRenderCollection:function(){this.handleInnerTabs(this.view)},handleInnerTabs:function(e){var t=e.children.filter(function(e){return"tabs"===e.model.get("type")});_.each(t,function(t){t.$el.find(".qazana-control-content").remove();var a=t.model.get("name"),n=e.children.filter(function(e){return"tab"===e.model.get("type")&&e.model.get("tabs_wrapper")===a});_.each(n,function(a,n){t._addChildView(a);var i=a.model.get("name"),o=e.children.filter(function(e){return i===e.model.get("inner_tab")});0===n?a.$el.addClass("qazana-tab-active"):_.each(o,function(e){e.$el.addClass("qazana-tab-close")})})})},onChildviewControlTabClicked:function(e){var t=e.model.get("name"),a=this.view.children.filter(function(t){return"tab"!==t.model.get("type")&&e.model.get("tabs_wrapper")===t.model.get("tabs_wrapper")}),n=this.view.children.filter(function(t){return"tab"===t.model.get("type")&&e.model.get("tabs_wrapper")===t.model.get("tabs_wrapper")});_.each(n,function(e){e.$el.removeClass("qazana-tab-active")}),e.$el.addClass("qazana-tab-active"),_.each(a,function(e){e.model.get("inner_tab")===t?e.$el.removeClass("qazana-tab-close"):e.$el.addClass("qazana-tab-close")}),qazana.getPanelView().updateScrollbar()}}),t.exports=n},{}],78:[function(e,t,a){var n;n=Marionette.Behavior.extend({defaults:{handles:qazana.config.is_rtl?"w":"e"},events:{resizestart:"onResizeStart",resizestop:"onResizeStop",resize:"onResize"},initialize:function(){Marionette.Behavior.prototype.initialize.apply(this,arguments),this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeSwitched)},active:function(){if(qazana.userCan("design")){this.deactivate();var e=_.clone(this.options);delete e.behaviorClass;var t=this.getChildViewContainer(),a={},n=_.extend(a,e);t.resizable(n)}},deactivate:function(){this.getChildViewContainer().resizable("instance")&&this.getChildViewContainer().resizable("destroy")},onEditModeSwitched:function(e){"edit"===e?this.active():this.deactivate()},onRender:function(){var e=this;_.defer(function(){e.onEditModeSwitched(qazana.channels.dataEditMode.request("activeMode"))})},onDestroy:function(){this.deactivate()},onResizeStart:function(e){e.stopPropagation(),this.view.$el.data("originalWidth",this.view.el.getBoundingClientRect().width),this.view.triggerMethod("request:resize:start",e)},onResizeStop:function(e){e.stopPropagation(),this.view.triggerMethod("request:resize:stop")},onResize:function(e,t){e.stopPropagation(),this.view.triggerMethod("request:resize",t,e)},getChildViewContainer:function(){return this.$el}}),t.exports=n},{}],79:[function(e,t,a){var n;n=Marionette.Behavior.extend({defaults:{elChildType:"widget"},events:{sortstart:"onSortStart",sortreceive:"onSortReceive",sortupdate:"onSortUpdate",sortover:"onSortOver",sortout:"onSortOut"},initialize:function(){this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeSwitched).listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange).listenTo(this.view.options.model,"request:sort:start",this.startSort).listenTo(this.view.options.model,"request:sort:update",this.updateSort).listenTo(this.view.options.model,"request:sort:receive",this.receiveSort)},onEditModeSwitched:function(e){"edit"===e?this.activate():this.deactivate()},onDeviceModeChange:function(){"desktop"===qazana.channels.deviceMode.request("currentMode")?this.activate():this.deactivate()},onRender:function(){var e=this;_.defer(function(){e.onEditModeSwitched(qazana.channels.dataEditMode.request("activeMode"))})},onDestroy:function(){this.deactivate()},activate:function(){if(qazana.userCan("design")&&!this.getChildViewContainer().sortable("instance")){var e=this.getChildViewContainer(),t={connectWith:e.selector,placeholder:"qazana-sortable-placeholder qazana-"+this.getOption("elChildType")+"-placeholder",cursorAt:{top:20,left:25},helper:this._getSortableHelper.bind(this),cancel:"input, textarea, button, select, option, .qazana-inline-editing, .qazana-tab-title"},a=_.extend(t,this.view.getSortableOptions());e.sortable(a)}},_getSortableHelper:function(e,t){var a=this.view.collection.get({cid:t.data("model-cid")});return'<div style="height: 84px; width: 125px;" class="qazana-sortable-helper qazana-sortable-helper-'+a.get("elType")+'"><div class="icon"><i class="'+a.getIcon()+'"></i></div><div class="qazana-element-title-wrapper"><div class="title">'+a.getTitle()+"</div></div></div>"},getChildViewContainer:function(){return this.view.getChildViewContainer(this.view)},deactivate:function(){var e=this.getChildViewContainer();e.sortable("instance")&&e.sortable("destroy")},startSort:function(e,t){e.stopPropagation();var a=this.view.collection.get({cid:t.item.data("model-cid")});qazana.channels.data.reply("dragging:model",a).reply("dragging:parent:view",this.view).trigger("drag:start",a).trigger(a.get("elType")+":drag:start")},updateSort:function(e){var t=qazana.channels.data.request("dragging:model"),a=e.item,n=this.view.collection,i=a.parent().children().index(a),o=this.view.children.findByModelCid(t.cid);this.view.addChildElement(t,{at:i,trigger:{beforeAdd:"drag:before:update",afterAdd:"drag:after:update"},onBeforeAdd:function(){o._isRendering=!0,n.remove(t)}}),qazana.saver.setFlagEditorChange(!0)},receiveSort:function(e,t){if(e.stopPropagation(),this.view.isCollectionFilled())jQuery(t.sender).sortable("cancel");else{var a=qazana.channels.data.request("dragging:model"),n="section"===a.get("elType")&&a.get("isInner"),i="column"===this.view.getElementType()&&this.view.isInner();if(n&&i)jQuery(t.sender).sortable("cancel");else{var o=t.item.index(),s=a.toJSON({copyHtmlCache:!0});this.view.addChildElement(s,{at:o,trigger:{beforeAdd:"drag:before:update",afterAdd:"drag:after:update"},onAfterAdd:function(){var e=qazana.channels.data.request("dragging:parent:view");e.isManualRemoving=!0,a.destroy(),e.isManualRemoving=!1}})}}},onSortStart:function(e,t){if("column"===this.options.elChildType){var a=0;t.item.data("sortableItem").items.forEach(function(e){if(e.item[0]===t.item[0])return a=e.height,!1}),t.placeholder.height(a)}this.startSort(e,t)},onSortOver:function(e){e.stopPropagation();var t=qazana.channels.data.request("dragging:model");jQuery(e.target).addClass("qazana-draggable-over").attr({"data-dragged-element":t.get("elType"),"data-dragged-is-inner":t.get("isInner")}),this.$el.addClass("qazana-dragging-on-child")},onSortOut:function(e){e.stopPropagation(),jQuery(e.target).removeClass("qazana-draggable-over").removeAttr("data-dragged-element data-dragged-is-inner"),this.$el.removeClass("qazana-dragging-on-child")},onSortReceive:function(e,t){this.receiveSort(e,t)},onSortUpdate:function(e,t){e.stopPropagation(),this.el.contains(t.item[0])&&this.updateSort(t)},onAddChild:function(e){e.$el.attr("data-model-cid",e.model.cid)}}),t.exports=n},{}],80:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-empty-preview",className:"qazana-empty-view",events:{click:"onClickAdd"},behaviors:function(){return{contextMenu:{behaviorClass:e("qazana-behaviors/context-menu"),groups:this.getContextMenuGroups()}}},getContextMenuGroups:function(){return[{name:"general",actions:[{name:"paste",title:qazana.translate("paste"),callback:this.paste.bind(this),isEnabled:this.isPasteEnabled.bind(this)}]}]},paste:function(){var e=this,t=0;qazana.getStorage("transfer").elements.forEach(function(a){e._parent.addChildElement(a,{at:t,clone:!0}),t++})},isPasteEnabled:function(){var e=qazana.getStorage("transfer");return!!e&&("section"===e.elementsType?e.elements[0].isInner&&!this._parent.isInner():"widget"===e.elementsType)},onClickAdd:function(){qazana.getPanelView().setPage("elements")}})},{"qazana-behaviors/context-menu":75}],81:[function(e,t,a){var n,i=e("qazana-elements/views/base"),o=e("qazana-elements/views/column-empty");n=i.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-column-content"),emptyView:o,childViewContainer:"> .qazana-column-wrap > .qazana-widget-wrap",toggleEditTools:!0,behaviors:function(){var t=i.prototype.behaviors.apply(this,arguments);return _.extend(t,{Sortable:{behaviorClass:e("qazana-behaviors/sortable"),elChildType:"widget"},Resizable:{behaviorClass:e("qazana-behaviors/resizable")}}),qazana.hooks.applyFilters("elements/column/behaviors",t,this)},className:function(){return i.prototype.className.apply(this,arguments)+" qazana-column qazana-"+(this.isInner()?"inner":"top")+"-column"},tagName:function(){return this.model.getSetting("html_tag")||"div"},ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.columnInner="> .qazana-column-wrap",e.percentsTooltip="> .qazana-element-overlay .qazana-column-percents-tooltip",e},initialize:function(){i.prototype.initialize.apply(this,arguments),this.addControlValidator("_inline_size",this.onEditorInlineSizeInputChange)},getContextMenuGroups:function(){var e=i.prototype.getContextMenuGroups.apply(this,arguments),t=e.indexOf(_.findWhere(e,{name:"general"}));return e.splice(t+1,0,{name:"addNew",actions:[{name:"addNew",title:qazana.translate("new_column"),callback:this.addNewColumn.bind(this)}]}),e},isDroppingAllowed:function(){var e=qazana.channels.panelElements.request("element:selected");if(!e)return!1;var t=e.model.get("elType");return"section"===t?!this.isInner():"widget"===t},getPercentsForDisplay:function(){return(+this.model.getSetting("_inline_size")||this.getPercentSize()).toFixed(1)+"%"},changeSizeUI:function(){var e=this,t=e.model.getSetting("_column_size");e.$el.attr("data-col",t),_.defer(function(){e.ui.percentsTooltip&&e.ui.percentsTooltip.text(e.getPercentsForDisplay())})},getPercentSize:function(e){return e||(e=this.el.getBoundingClientRect().width),+(e/this.$el.parent().width()*100).toFixed(3)},getSortableOptions:function(){return{connectWith:".qazana-widget-wrap",items:"> .qazana-element"}},changeChildContainerClasses:function(){this.collection.isEmpty()?this.ui.columnInner.removeClass("qazana-element-populated").addClass("qazana-element-empty"):this.ui.columnInner.removeClass("qazana-element-empty").addClass("qazana-element-populated")},addNewColumn:function(){this.trigger("request:add:new")},onCollectionChanged:function(){i.prototype.onCollectionChanged.apply(this,arguments),this.changeChildContainerClasses()},onRender:function(){var e=this;i.prototype.onRender.apply(e,arguments),e.changeChildContainerClasses(),e.changeSizeUI(),e.$el.html5Droppable({items:" > .qazana-column-wrap > .qazana-widget-wrap > .qazana-element, >.qazana-column-wrap > .qazana-widget-wrap > .qazana-empty-view > .qazana-first-add",axis:["vertical"],groups:["qazana-element"],isDroppingAllowed:e.isDroppingAllowed.bind(e),currentElementClass:"qazana-html5dnd-current-element",placeholderClass:"qazana-sortable-placeholder qazana-widget-placeholder",hasDraggingOnChildClass:"qazana-dragging-on-child",onDropping:function(t,a){a.stopPropagation();var n=jQuery(this).index();"bottom"===t&&n++,e.addElementFromPanel({at:n})}})},onSettingsChanged:function(e){i.prototype.onSettingsChanged.apply(this,arguments);var t=e.changedAttributes();("_column_size"in t||"_inline_size"in t)&&this.changeSizeUI()},onEditorInlineSizeInputChange:function(e,t){var a=[],n=this.model.getSetting("_column_size");if(100===n)return a.push("Could not resize one column"),a;t||(t=n);try{this._parent.resizeChild(this,+t,+e)}catch(e){e.message===this._parent.errors.columnWidthTooLarge&&a.push(e.message)}return a},onAddButtonClick:function(e){e.stopPropagation(),this.addNewColumn()}}),t.exports=n},{"qazana-behaviors/resizable":78,"qazana-behaviors/sortable":79,"qazana-elements/views/base":74,"qazana-elements/views/column-empty":80}],82:[function(e,t,a){var n,i=e("qazana-elements/views/base"),o=e("qazana-views/add-section/inline");n=i.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-section-content"),addSectionView:null,className:function(){return i.prototype.className.apply(this,arguments)+" qazana-section qazana-"+(this.isInner()?"inner":"top")+"-section"},tagName:function(){return this.model.getSetting("html_tag")||"section"},childViewContainer:"> .qazana-container > .qazana-row",behaviors:function(){var t=i.prototype.behaviors.apply(this,arguments);return _.extend(t,{Sortable:{behaviorClass:e("qazana-behaviors/sortable"),elChildType:"column"}}),qazana.hooks.applyFilters("elements/section/behaviors",t,this)},errors:{columnWidthTooLarge:"New column width is too large",columnWidthTooSmall:"New column width is too small"},initialize:function(){i.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove reset",this._checkIsFull),this._checkIsEmpty()},getContextMenuGroups:function(){var e=i.prototype.getContextMenuGroups.apply(this,arguments),t=e.indexOf(_.findWhere(e,{name:"transfer"}));return e.splice(t+1,0,{name:"save",actions:[{name:"save",title:qazana.translate("save_as_block"),callback:this.save.bind(this)}]}),e},addChildModel:function(e,t){var a=e instanceof Backbone.Model,n=this.isInner();return a?e.set("isInner",n):e.isInner=n,i.prototype.addChildModel.apply(this,arguments)},getSortableOptions:function(){return{connectWith:(this.isInner()?".qazana-inner-section":".qazana-top-section")+" > .qazana-container > .qazana-row",handle:"> .qazana-element-overlay .qazana-editor-element-edit",items:"> .qazana-column",forcePlaceholderSize:!0,tolerance:"pointer"}},getColumnPercentSize:function(e,t){return+(t/e.parent().width()*100).toFixed(3)},getDefaultStructure:function(){return this.collection.length+"0"},getStructure:function(){return this.model.getSetting("structure")},setStructure:function(e){if(+qazana.presetsFactory.getParsedStructure(e).columnsCount!==this.collection.length)throw new TypeError("The provided structure doesn't match the columns count.");this.model.setSetting("structure",e)},redefineLayout:function(){var e=qazana.presetsFactory.getPresetByStructure(this.getStructure());this.collection.each(function(t,a){t.setSetting("_column_size",e.preset[a]),t.setSetting("_inline_size",null)})},resetLayout:function(){this.setStructure(this.getDefaultStructure())},resetColumnsCustomSize:function(){this.collection.each(function(e){e.setSetting("_inline_size",null)})},isCollectionFilled:function(){return 10<=this.collection.length},_checkIsFull:function(){this.$el.toggleClass("qazana-section-filled",this.isCollectionFilled())},_checkIsEmpty:function(){this.collection.length||this.model.get("allowEmpty")||this.addChildElement(null,{edit:!1})},getColumnAt:function(e){var t=this.collection.at(e);return t?this.children.findByModelCid(t.cid):null},getNextColumn:function(e){return this.getColumnAt(this.collection.indexOf(e.model)+1)},getPreviousColumn:function(e){return this.getColumnAt(this.collection.indexOf(e.model)-1)},showChildrenPercentsTooltip:function(e,t){e.ui.percentsTooltip.show(),e.ui.percentsTooltip.attr("data-side",qazana.config.is_rtl?"right":"left"),t.ui.percentsTooltip.show(),t.ui.percentsTooltip.attr("data-side",qazana.config.is_rtl?"left":"right")},hideChildrenPercentsTooltip:function(e,t){e.ui.percentsTooltip.hide(),t.ui.percentsTooltip.hide()},resizeChild:function(e,t,a){var n=this.getNextColumn(e)||this.getPreviousColumn(e);if(!n)throw new ReferenceError("There is not any next column");var i=n.$el,o=+(t+(+n.model.getSetting("_inline_size")||this.getColumnPercentSize(i,i[0].getBoundingClientRect().width))-a).toFixed(3);if(o<2)throw new RangeError(this.errors.columnWidthTooLarge);if(a<2)throw new RangeError(this.errors.columnWidthTooSmall);return n.model.setSetting("_inline_size",o),!0},destroyAddSectionView:function(){this.addSectionView&&!this.addSectionView.isDestroyed&&this.addSectionView.destroy()},onRender:function(){i.prototype.onRender.apply(this,arguments),this._checkIsFull()},onSettingsChanged:function(e){i.prototype.onSettingsChanged.apply(this,arguments),e.changed.structure&&this.redefineLayout()},onAddButtonClick:function(){if(!this.addSectionView||this.addSectionView.isDestroyed){var e=this.model.collection.indexOf(this.model),t=new o({at:e});t.render(),this.$el.before(t.$el),t.$el.hide(),setTimeout(function(){t.$el.slideDown()}),this.addSectionView=t}else this.addSectionView.fadeToDeath()},onAddChild:function(){this.isBuffering||this.model.get("allowEmpty")||this.resetLayout()},onRemoveChild:function(){this.isManualRemoving&&(this._checkIsEmpty(),this.resetLayout())},onChildviewRequestResizeStart:function(e){var t=this.getNextColumn(e);if(t){this.showChildrenPercentsTooltip(e,t);var a=e.$el.find("iframe").add(t.$el.find("iframe"));qazana.helpers.disableElementEvents(a)}},onChildviewRequestResizeStop:function(e){var t=this.getNextColumn(e);if(t){this.hideChildrenPercentsTooltip(e,t);var a=e.$el.find("iframe").add(t.$el.find("iframe"));qazana.helpers.enableElementEvents(a)}},onChildviewRequestResize:function(e,t){var a=+e.model.getSetting("_inline_size")||this.getColumnPercentSize(e.$el,e.$el.data("originalWidth"));t.element.css({width:"",left:"initial"});var n=this.getColumnPercentSize(t.element,t.size.width);try{this.resizeChild(e,a,n)}catch(e){return}e.model.setSetting("_inline_size",n)},onDestroy:function(){i.prototype.onDestroy.apply(this,arguments),this.destroyAddSectionView()}}),t.exports=n},{"qazana-behaviors/sortable":79,"qazana-elements/views/base":74,"qazana-views/add-section/inline":132}],83:[function(e,t,a){var n,i=e("qazana-elements/views/base");n=i.extend({_templateType:null,toggleEditTools:!0,getTemplate:function(){var e=this.getEditModel();return"remote"!==this.getTemplateType()?Marionette.TemplateCache.get("#tmpl-qazana-"+e.get("widgetType")+"-content"):_.template("")},className:function(){return i.prototype.className.apply(this,arguments)+" qazana-widget "+qazana.getElementData(this.getEditModel()).html_wrapper_class},events:function(){var e=i.prototype.events.apply(this,arguments);return e.click="onClickEdit",e},behaviors:function(){var t=i.prototype.behaviors.apply(this,arguments);return _.extend(t,{InlineEditing:{behaviorClass:e("qazana-behaviors/inline-editing"),inlineEditingClass:"qazana-inline-editing"}}),qazana.hooks.applyFilters("elements/widget/behaviors",t,this)},initialize:function(){i.prototype.initialize.apply(this,arguments);var e=this.getEditModel();e.on({"before:remote:render":this.onModelBeforeRemoteRender.bind(this),"remote:render":this.onModelRemoteRender.bind(this)}),"remote"!==this.getTemplateType()||this.getEditModel().getHtmlCache()||e.renderRemoteServer();var t=this.onRender;this.render=_.throttle(this.render,300),this.onRender=function(){_.defer(t.bind(this))}},getContextMenuGroups:function(){var e=i.prototype.getContextMenuGroups.apply(this,arguments),t=e.indexOf(_.findWhere(e,{name:"transfer"}));return e.splice(t+1,0,{name:"save",actions:[{name:"save",title:qazana.translate("save_as_global"),shortcut:jQuery("<i>",{class:"eicon-pro-icon"})}]}),e},render:function(){this.model.isRemoteRequestActive()?this.$el.addClass("qazana-element"):Marionette.CompositeView.prototype.render.apply(this,arguments)},getTemplateType:function(){if(null===this._templateType){var e=this.getEditModel(),t=jQuery("#tmpl-qazana-"+e.get("widgetType")+"-content");this._templateType=t.length?"js":"remote"}return this._templateType},getHTMLContent:function(e){return this.getEditModel().getHtmlCache()||e},attachElContent:function(e){var t=this,a=t.getHTMLContent(e);return _.defer(function(){qazanaFrontend.getElements("window").jQuery(t.el).html(a),t.bindUIElements()}),this},addInlineEditingAttributes:function(e,t){this.addRenderAttribute(e,{class:"qazana-inline-editing","data-qazana-setting-key":e}),t&&this.addRenderAttribute(e,{"data-qazana-inline-editing-toolbar":t})},getRepeaterSettingKey:function(e,t,a){return[t,a,e].join(".")},onModelBeforeRemoteRender:function(){this.$el.addClass("qazana-loading")},onBeforeDestroy:function(){qazana.$previewContents.find("#qazana-style-"+this.model.cid).remove()},onModelRemoteRender:function(){this.isDestroyed||(this.$el.removeClass("qazana-loading"),this.render())},alterClass:function(e,t,a){if(-1===t.indexOf("*"))return e.removeClass(t),a?e.addClass(a):e;var n=new RegExp("\\s"+t.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");return e.each(function(e,t){for(var a=" "+t.className+" ";n.test(a);)a=a.replace(n," ");t.className=$.trim(a)}),a?e.addClass(a):e},onRender:function(){var e=this;i.prototype.onRender.apply(e,arguments);var t=e.getEditModel(),a=t.getSetting("_skin")||"default";e.alterClass(e.$el,t.get("widgetType")+"-*",t.get("widgetType")+"-skin-"+a)},onClickEdit:function(){this.model.trigger("request:edit")}}),t.exports=n},{"qazana-behaviors/inline-editing":76,"qazana-elements/views/base":74}],84:[function(e,t,a){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-mode-switcher-content",id:"qazana-mode-switcher-inner",ui:{previewButton:"#qazana-mode-switcher-preview-input",previewLabel:"#qazana-mode-switcher-preview",previewLabelA11y:"#qazana-mode-switcher-preview .qazana-screen-only"},events:{"change @ui.previewButton":"onPreviewButtonChange"},initialize:function(){this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeChanged)},getCurrentMode:function(){return this.ui.previewButton.is(":checked")?"preview":"edit"},setMode:function(e){this.ui.previewButton.prop("checked","preview"===e).trigger("change")},toggleMode:function(){this.setMode(this.ui.previewButton.prop("checked")?"edit":"preview")},onRender:function(){this.onEditModeChanged()},onPreviewButtonChange:function(){qazana.changeEditMode(this.getCurrentMode())},onEditModeChanged:function(){var e=qazana.channels.dataEditMode.request("activeMode"),t=qazana.translate("preview"===e?"back_to_editor":"preview");this.ui.previewLabel.attr("title",t),this.ui.previewLabelA11y.text(t)}}),t.exports=n},{}],85:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-navigator__elements--empty",className:"qazana-empty-view",onRender:function(){this.$el.css("padding-"+(qazana.config.is_rtl?"right":"left"),this.getOption("indent"))}})},{}],86:[function(e,t,a){t.exports=Marionette.CompositeView.extend({template:"#tmpl-qazana-navigator__elements",childViewContainer:".qazana-navigator__elements",ui:{item:"> .qazana-navigator__item",title:"> .qazana-navigator__item .qazana-navigator__element__title",toggle:"> .qazana-navigator__item > .qazana-navigator__element__toggle",toggleList:"> .qazana-navigator__item > .qazana-navigator__element__list-toggle",elements:"> .qazana-navigator__elements"},events:{contextmenu:"onContextMenu","click @ui.item":"onItemClick","click @ui.toggle":"onToggleClick","click @ui.toggleList":"onToggleListClick","dblclick @ui.title":"onTitleDoubleClick","keydown @ui.title":"onTitleKeyDown","sortstart @ui.elements":"onSortStart","sortover @ui.elements":"onSortOver","sortout @ui.elements":"onSortOut","sortstop @ui.elements":"onSortStop","sortupdate @ui.elements":"onSortUpdate","sortreceive @ui.elements":"onSortReceive"},getEmptyView:function(){return this.isRoot()?e("qazana-layouts/navigator/root-empty"):this.hasChildren()?e("qazana-layouts/navigator/element-empty"):null},childViewOptions:function(){return{indent:this.getIndent()+10}},className:function(){var e="qazana-navigator__element",t=this.model.get("elType");return t&&(e+=" qazana-navigator__element-"+t),this.hasChildren()&&(e+=" qazana-navigator__element--has-children"),e},attributes:function(){return{"data-model-cid":this.model.cid}},templateHelpers:function(){var e={};return this.isRoot()||(e.title=this.model.getTitle(),e.icon="section"===this.model.get("elType")?"":this.model.getIcon()),e},initialize:function(){this.collection=this.model.get("elements"),this.listenTo(this.model,"request:edit",this.onEditRequest).listenTo(this.model,"change",this.onModelChange)},getIndent:function(){return this.getOption("indent")||0},isRoot:function(){return!this.model.get("elType")},hasChildren:function(){return"widget"!==this.model.get("elType")},toggleList:function(e,t){if(this.hasChildren()&&!this.isRoot()&&this.ui.item.hasClass("qazana-active")!==e){this.ui.item.toggleClass("qazana-active",e);var a="slideToggle";void 0!==e&&(a="slide"+(e?"Down":"Up")),this.ui.elements[a](300,t)}},toggleHiddenClass:function(){this.$el.toggleClass("qazana-navigator__element--hidden",!!this.model.get("hidden"))},recursiveChildInvoke:function(){var e=Array.prototype.slice.call(arguments),a=e.slice(0,1),n=e.slice(1);this[a].apply(this,n),this.children.each(function(a){a instanceof t.exports&&a.recursiveChildInvoke.apply(a,e)})},recursiveParentInvoke:function(){var e=Array.prototype.slice.call(arguments),a=e.slice(0,1),n=e.slice(1);this._parent instanceof t.exports&&(this._parent[a].apply(this._parent,n),this._parent.recursiveParentInvoke.apply(this._parent,e))},recursiveChildAgreement:function(){var e=Array.prototype.slice.call(arguments),a=e.slice(0,1),n=e.slice(1);if(!this[a].apply(this,n))return!1;var i=!0;return jQuery.each(this.children._views,function(){if(this instanceof t.exports)return this.recursiveChildAgreement.apply(this,e)?void 0:i=!1}),i},activateMouseInteraction:function(){this.$el.on({mouseenter:this.onMouseEnter.bind(this),mouseleave:this.onMouseLeave.bind(this)})},deactivateMouseInteraction:function(){this.$el.off("mouseenter mouseleave")},dragShouldBeIgnored:function(e){var t=qazana.helpers.getElementChildType(this.model.get("elType"));return"section"===e.get("elType")&&!e.get("isInner")||(!t||-1===t.indexOf(e.get("elType")))},addEditingClass:function(){this.ui.item.addClass("qazana-editing")},removeEditingClass:function(){this.ui.item.removeClass("qazana-editing")},enterTitleEditing:function(){this.ui.title.attr("contenteditable",!0).focus(),qazana.addBackgroundClickListener("navigator",{ignore:this.ui.title,callback:this.exitTitleEditing.bind(this)})},exitTitleEditing:function(){this.ui.title.attr("contenteditable",!1);var e=this.ui.title.text().trim(),t=this.model.get("settings");e?t.set("_title",e,{silent:!0}):(t.unset("_title",{silent:!0}),this.ui.title.text(this.model.getDefaultTitle())),qazana.saver.setFlagEditorChange(!0),qazana.removeBackgroundClickListener("navigator")},onRender:function(){var e=this;e.ui.elements.sortable({items:"> .qazana-navigator__element",placeholder:"ui-sortable-placeholder",axis:"y",forcePlaceholderSize:!0,connectWith:".qazana-navigator__element-"+e.model.get("elType")+" "+e.ui.elements.selector,cancel:'[contenteditable="true"]'}),this.ui.item.css("padding-"+(qazana.config.is_rtl?"right":"left"),this.getIndent()),this.toggleHiddenClass()},onModelChange:function(){void 0!==this.model.changed.hidden&&this.toggleHiddenClass()},onItemClick:function(){this.model.trigger("request:edit")},onToggleClick:function(e){e.stopPropagation(),this.model.trigger("request:toggleVisibility")},onTitleDoubleClick:function(){this.enterTitleEditing()},onTitleKeyDown:function(e){13===e.which&&(e.preventDefault(),this.exitTitleEditing())},onToggleListClick:function(e){e.stopPropagation(),this.toggleList()},onSortStart:function(e,t){this.model.trigger("request:sort:start",e,t),qazana.navigator.getLayout().activateElementsMouseInteraction()},onSortStop:function(){qazana.navigator.getLayout().deactivateElementsMouseInteraction()},onSortOver:function(e){e.stopPropagation(),this.$el.addClass("qazana-dragging-on-child")},onSortOut:function(e){e.stopPropagation(),this.$el.removeClass("qazana-dragging-on-child")},onSortUpdate:function(e,t){e.stopPropagation(),this.el.contains(t.item[0])&&this.model.trigger("request:sort:update",t)},onSortReceive:function(e,t){this.model.trigger("request:sort:receive",e,t)},onMouseEnter:function(e){e.stopPropagation();var t=this;this.recursiveChildAgreement("dragShouldBeIgnored",qazana.channels.data.request("dragging:model"))||(t.autoExpandTimeout=setTimeout(function(){t.toggleList(!0,function(){t.ui.elements.sortable("refreshPositions")})},500))},onMouseLeave:function(e){e.stopPropagation(),clearTimeout(this.autoExpandTimeout)},onContextMenu:function(e){this.model.trigger("request:contextmenu",e)},onEditRequest:function(){this.recursiveParentInvoke("toggleList",!0),qazana.navigator.getLayout().elements.currentView.recursiveChildInvoke("removeEditingClass"),this.addEditingClass(),qazana.helpers.scrollToView(this.$el,400,qazana.navigator.getLayout().elements.$el)}})},{"qazana-layouts/navigator/element-empty":85,"qazana-layouts/navigator/root-empty":89}],87:[function(e,t,a){t.exports=Marionette.LayoutView.extend({template:"#tmpl-qazana-navigator",id:"qazana-navigator__inner",ui:{toggleAll:"#qazana-navigator__toggle-all",close:"#qazana-navigator__close"},events:{"click @ui.toggleAll":"toggleAll","click @ui.close":"onCloseClick"},regions:{elements:"#qazana-navigator__elements"},toggleAll:function(){var e="expand"===this.ui.toggleAll.data("qazana-action"),t=["eicon-collapse","eicon-expand"];this.ui.toggleAll.data("qazana-action",e?"collapse":"expand").removeClass(t[+e]).addClass(t[+!e]),this.elements.currentView.recursiveChildInvoke("toggleList",e)},activateElementsMouseInteraction:function(){this.elements.currentView.recursiveChildInvoke("activateMouseInteraction")},deactivateElementsMouseInteraction:function(){this.elements.currentView.recursiveChildInvoke("deactivateMouseInteraction")},onShow:function(){var t=e("qazana-layouts/navigator/element");this.elements.show(new t({model:qazana.elementsModel}))},onCloseClick:function(){qazana.navigator.close()}})},{"qazana-layouts/navigator/element":86}],88:[function(e,t,a){t.exports=Marionette.Region.extend({el:"#qazana-navigator",isDocked:!1,isDraggingNeedsStop:!1,opened:!1,storage:{visible:!0,size:{width:"",height:"",top:"",bottom:"",right:"",left:""},dockedSize:{width:250}},constructor:function(){Marionette.Region.prototype.constructor.apply(this,arguments),this.ensurePosition=this.ensurePosition.bind(this);var e=qazana.getStorage("navigator");e&&(this.storage=e),this.storage.visible&&this.open()},getLayout:function(){return this.currentView},getDraggableOptions:function(){return{iframeFix:!0,handle:"#qazana-navigator__header",snap:"body",snapMode:"inner",snapTolerance:15,drag:this.onDrag.bind(this),stop:this.onDragStop.bind(this)}},getResizableOptions:function(){var e=this;return{handles:"all",containment:"document",minWidth:150,maxWidth:500,minHeight:210,start:function(){qazana.$previewWrapper.addClass("ui-resizable-resizing")},stop:function(){qazana.$previewWrapper.removeClass("ui-resizable-resizing"),e.isDocked?e.saveDockedSize():e.saveSize()}}},beforeFirstOpen:function(){var t=e("qazana-layouts/navigator/layout");this.show(new t),this.$el.draggable(this.getDraggableOptions()),this.$el.resizable(this.getResizableOptions())},open:function(e){this.opened||(this.beforeFirstOpen(),this.opened=!0),this.$el.show(),this.storage.docked?this.dock():this.setSize(),e&&e.trigger("request:edit"),this.saveStorage("visible",!0),this.ensurePosition(),qazana.$window.on("resize",this.ensurePosition)},close:function(){this.$el.hide(),this.isDocked&&this.undock(!0),this.saveStorage("visible",!1),qazana.$window.off("resize",this.ensurePosition)},isSnapping:function(){return this.$el.draggable("instance").snapElements.some(function(e){return e.snapping})},dock:function(){qazana.$body.addClass("qazana-navigator-docked");var e=qazana.config.is_rtl?"left":"right",t=this.storage.dockedSize.width,a=this.getResizableOptions();this.$el.css({width:t,height:"",top:"",bottom:"",left:"",right:""}),qazana.$previewWrapper.css(e,t),this.$el.resizable("destroy"),a.handles=qazana.config.is_rtl?"e":"w",a.resize=function(t,a){qazana.$previewWrapper.css(e,a.size.width)},this.$el.resizable(a),this.isDocked=!0,this.saveStorage("docked",!0)},undock:function(e){qazana.$body.removeClass("qazana-navigator-docked"),qazana.$previewWrapper.css(qazana.config.is_rtl?"left":"right",""),this.setSize(),this.$el.resizable("destroy"),this.$el.resizable(this.getResizableOptions()),this.isDocked=!1,e||this.saveStorage("docked",!1)},saveStorage:function(e,t){this.storage[e]=t,qazana.setStorage("navigator",this.storage)},saveSize:function(){this.saveStorage("size",qazana.helpers.getElementInlineStyle(this.$el,["width","height","top","bottom","right","left"]))},saveDockedSize:function(){this.saveStorage("dockedSize",qazana.helpers.getElementInlineStyle(this.$el,["width"]))},setSize:function(){this.storage.size&&this.$el.css(this.storage.size)},ensurePosition:function(){if(!this.isDocked){var e=this.$el.offset();e.left>innerWidth&&this.$el.css({left:"",right:""}),e.top>innerHeight&&this.$el.css({top:"",bottom:""})}},onDrag:function(e,t){if(this.isDraggingNeedsStop)return!1;{if(!this.isDocked)return 0>t.position.top&&(t.position.top=0),this.isSnapping()&&t.position.left+this.$el.outerWidth()>=innerWidth?(this.dock(),this.isDraggingNeedsStop=!0,!1):void 0;if(t.position.left===t.originalPosition.left){if(t.position.top!==t.originalPosition.top)return!1}else this.undock()}},onDragStop:function(){this.isDraggingNeedsStop=!1,this.isDocked||this.saveSize()}})},{"qazana-layouts/navigator/layout":87}],89:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-navigator__root--empty",className:"qazana-nerd-box"})},{}],90:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-footer-content",tagName:"nav",id:"qazana-panel-footer-tools",possibleRotateModes:["portrait","landscape"],ui:{menuButtons:".qazana-panel-footer-tool",settings:"#qazana-panel-footer-settings",deviceModeIcon:"#qazana-panel-footer-responsive > i",deviceModeButtons:"#qazana-panel-footer-responsive .qazana-panel-footer-sub-menu-item",saveTemplate:"#qazana-panel-saver-menu-save-template",history:"#qazana-panel-footer-history"},events:{"click @ui.settings":"onClickSettings","click @ui.deviceModeButtons":"onClickResponsiveButtons","click @ui.saveTemplate":"onClickSaveTemplate","click @ui.history":"onClickHistory"},behaviors:function(){var e={saver:{behaviorClass:qazana.modules.components.saver.behaviors.FooterSaver}};return qazana.hooks.applyFilters("panel/footer/behaviors",e,this)},initialize:function(){this.listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange)},getDeviceModeButton:function(e){return this.ui.deviceModeButtons.filter('[data-device-mode="'+e+'"]')},onPanelClick:function(e){var t=jQuery(e.target);if(!t.closest(".qazana-panel-footer-sub-menu-wrapper").length){var a=t.closest(".qazana-panel-footer-tool"),n=a.length&&!a.hasClass("qazana-open");this.ui.menuButtons.filter(":not(.qazana-leave-open)").removeClass("qazana-open"),n&&a.addClass("qazana-open")}},onClickSettings:function(){var e=this;"page_settings"!==qazana.getPanelView().getCurrentPageName()&&(qazana.getPanelView().setPage("page_settings"),qazana.getPanelView().getCurrentPageView().once("destroy",function(){e.ui.settings.removeClass("qazana-open")}))},onDeviceModeChange:function(){var e=qazana.channels.deviceMode.request("previousMode"),t=qazana.channels.deviceMode.request("currentMode");this.getDeviceModeButton(e).removeClass("active"),this.getDeviceModeButton(t).addClass("active"),this.ui.deviceModeIcon.removeClass("eicon-device-"+e).addClass("eicon-device-"+t)},onClickResponsiveButtons:function(e){var t=this.$(e.currentTarget).data("device-mode");qazana.changeDeviceMode(t)},onClickSaveTemplate:function(){qazana.templates.startModal({onReady:function(){qazana.templates.getLayout().showSaveTemplateView()}})},onClickHistory:function(){"historyPage"!==qazana.getPanelView().getCurrentPageName()&&qazana.getPanelView().setPage("historyPage")},onRender:function(){var e=this;_.defer(function(){qazana.getPanelView().$el.on("click",e.onPanelClick.bind(e))})}})},{}],91:[function(e,t,a){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-header-content",id:"qazana-panel-header",ui:{menuButton:"#qazana-panel-header-menu-button",menuButtons:".qazana-panel-header-tool",menuIcon:"#qazana-panel-header-menu-button i",title:"#qazana-panel-header-title",addButton:"#qazana-panel-header-add-button",saveTemplate:"#qazana-panel-header-saver-button-save-template"},events:{"click @ui.addButton":"onClickAdd","click @ui.menuButton":"onClickMenu","click @ui.saveTemplate":"onClickSaveTemplate"},behaviors:function(){var e={saver:{behaviorClass:qazana.modules.components.saver.behaviors.HeaderSaver}};return qazana.hooks.applyFilters("panel/header/behaviors",e,this)},onPanelClick:function(e){var t=jQuery(e.target);if(!t.closest(".qazana-panel-header-sub-menu-wrapper").length){var a=t.closest(".qazana-panel-header-tool"),n=a.length&&!a.hasClass("qazana-open");this.ui.menuButtons.filter(":not(.qazana-leave-open)").removeClass("qazana-open"),n&&a.addClass("qazana-open")}},onClickSettings:function(){var e=this;"page_settings"!==qazana.getPanelView().getCurrentPageName()&&(qazana.getPanelView().setPage("page_settings"),qazana.getPanelView().getCurrentPageView().once("destroy",function(){e.ui.settings.removeClass("qazana-open")}))},setTitle:function(e){this.ui.title.html(e)},onClickAdd:function(){qazana.getPanelView().setPage("elements")},onClickSaveTemplate:function(){qazana.templates.startModal({onReady:function(){qazana.templates.getLayout().showSaveTemplateView()}})},onClickMenu:function(){var e=qazana.getPanelView(),t="menu"===e.getCurrentPageName()?"elements":"menu";if("menu"===t){var a="eicon-arrow-"+(qazana.config.is_rtl?"right":"left");this.ui.menuIcon.removeClass("eicon-menu-bar").addClass(a)}e.setPage(t)},onRender:function(){var e=this;_.defer(function(){qazana.getPanelView().$el.on("click",e.onPanelClick.bind(e))})}}),t.exports=n},{}],92:[function(e,t,a){var n,i=e("qazana-layouts/edit-mode");n=Marionette.LayoutView.extend({template:"#tmpl-qazana-panel",id:"qazana-panel-inner",regions:{content:"#qazana-panel-content-wrapper",header:"#qazana-panel-header-wrapper",footer:"#qazana-panel-footer",modeSwitcher:"#qazana-mode-switcher"},pages:{},childEvents:{"click:add":function(){this.setPage("elements")},"editor:destroy":function(){this.setPage("elements",null,{autoFocusSearch:!1})}},currentPageName:null,currentPageView:null,_isScrollbarInitialized:!1,initialize:function(){this.initPages()},buildPages:function(){var t={elements:{view:e("qazana-panel/pages/elements/elements"),title:'<img src="'+qazana.config.assets_url+'images/logo-panel.svg">'},editor:{view:e("qazana-panel/pages/editor")},menu:{view:qazana.modules.layouts.panel.pages.menu.Menu,title:'<img src="'+qazana.config.assets_url+'images/logo-panel.svg">'},colorScheme:{view:e("qazana-panel/pages/schemes/colors")},typographyScheme:{view:e("qazana-panel/pages/schemes/typography")},colorPickerScheme:{view:e("qazana-panel/pages/schemes/color-picker")}},a=Object.keys(qazana.schemes.getSchemes()),n=_.difference(a,qazana.schemes.getEnabledSchemesTypes());return _.each(n,function(a){var n=qazana.schemes.getScheme(a);t[a+"Scheme"].view=e("qazana-panel/pages/schemes/disabled").extend({disabledTitle:n.disabled_title})}),t},initPages:function(){var e;this.getPages=function(t){return e||(e=this.buildPages()),t?e[t]:e},this.addPage=function(t,a){e||(e=this.buildPages()),e[t]=a}},getHeaderView:function(){return this.getChildView("header")},getFooterView:function(){return this.getChildView("footer")},getCurrentPageName:function(){return this.currentPageName},getCurrentPageView:function(){return this.currentPageView},setPage:function(e,t,a){"elements"!==e||qazana.userCan("design")||this.getPages().hasOwnProperty("page_settings")&&(e="page_settings");var n=this.getPages(e);if(!n)throw new ReferenceError("Qazana panel doesn't have page named '"+e+"'");n.options&&(a=_.extend(n.options,a));var i=n.view;n.getView&&(i=n.getView()),this.currentPageName=e,this.currentPageView=new i(a),this.showChildView("content",this.currentPageView),this.getHeaderView().setTitle(t||n.title),this.trigger("set:page",this.currentPageView).trigger("set:page:"+e,this.currentPageView)},openEditor:function(e,t){if("editor"!==this.getCurrentPageName()||this.getCurrentPageView().model!==e){var a=qazana.getElementData(e);this.setPage("editor",qazana.translate("edit_element",[a.title]),{model:e,controls:qazana.getElementControls(e),editedElementView:t});var n="panel/open_editor/"+e.get("elType");qazana.hooks.doAction(n,this,e,t),qazana.hooks.doAction(n+"/"+e.get("widgetType"),this,e,t)}},onBeforeShow:function(){var t=e("qazana-layouts/panel/footer"),a=e("qazana-layouts/panel/header");this.showChildView("modeSwitcher",new i),this.showChildView("header",new a),this.showChildView("footer",new t),this.updateScrollbar=_.throttle(this.updateScrollbar,100),this.getRegion("content").on("before:show",this.onEditorBeforeShow.bind(this)).on("empty",this.onEditorEmpty.bind(this)).on("show",this.updateScrollbar.bind(this)),this.setPage("elements")},onEditorBeforeShow:function(){_.defer(this.updateScrollbar.bind(this))},onEditorEmpty:function(){this.updateScrollbar()},updateScrollbar:function(){var e=this.content.$el;if(!this._isScrollbarInitialized)return e.perfectScrollbar(),void(this._isScrollbarInitialized=!0);e.perfectScrollbar("update")}}),t.exports=n},{"qazana-layouts/edit-mode":84,"qazana-layouts/panel/footer":90,"qazana-layouts/panel/header":91,"qazana-panel/pages/editor":93,"qazana-panel/pages/elements/elements":96,"qazana-panel/pages/schemes/color-picker":108,"qazana-panel/pages/schemes/colors":109,"qazana-panel/pages/schemes/disabled":110,"qazana-panel/pages/schemes/typography":114}],93:[function(e,t,a){var n,i=e("qazana-views/controls-stack");n=i.extend({template:Marionette.TemplateCache.get("#tmpl-editor-content"),id:"qazana-panel-page-editor",childViewContainer:"#qazana-controls",childViewOptions:function(){return{elementSettingsModel:this.model.get("settings"),elementEditSettings:this.model.get("editSettings")}},openActiveSection:function(){i.prototype.openActiveSection.apply(this,arguments),qazana.channels.editor.trigger("section:activated",this.activeSection,this)},isVisibleSectionControl:function(e){return i.prototype.isVisibleSectionControl.apply(this,arguments)&&qazana.helpers.isActiveControl(e,this.model.get("settings").attributes)},scrollToEditedElement:function(){qazana.helpers.scrollToView(this.getOption("editedElementView").$el)},getControlView:function(e){return this.children.findByModelCid(this.getControlModel(e).cid)},getControlModel:function(e){return this.collection.findWhere({name:e})},onDestroy:function(){var e=this.getOption("editedElementView");e&&e.$el.removeClass("qazana-element-editable"),this.model.trigger("editor:close"),this.triggerMethod("editor:destroy")},onRender:function(){var e=this.getOption("editedElementView");e&&e.$el.addClass("qazana-element-editable")},onDeviceModeChange:function(){i.prototype.onDeviceModeChange.apply(this,arguments),this.scrollToEditedElement()},onChildviewSettingsChange:function(e){var t=this.getOption("editedElementView"),a=t.model.get("elType");"widget"===a&&(a=t.model.get("widgetType")),qazana.channels.editor.trigger("change",e,t).trigger("change:"+a,e,t).trigger("change:"+a+":"+e.model.get("name"),e,t)}}),t.exports=n},{"qazana-views/controls-stack":135}],94:[function(e,t,a){var n,i=e("../models/element");n=Backbone.Collection.extend({model:i}),t.exports=n},{"../models/element":97}],95:[function(e,t,a){var n,i=e("../models/element");n=Backbone.Collection.extend({model:i}),t.exports=n},{"../models/element":97}],96:[function(e,t,a){var n,i=e("./collections/categories"),o=e("./collections/elements"),s=e("./views/categories"),r=qazana.modules.layouts.panel.pages.elements.views.Elements,l=e("./views/search"),c=e("./views/global");n=Marionette.LayoutView.extend({template:"#tmpl-qazana-panel-elements",options:{autoFocusSearch:!0},regions:{elements:"#qazana-panel-elements-wrapper",search:"#qazana-panel-elements-search-area"},ui:{tabs:".qazana-panel-navigation-tab"},events:{"click @ui.tabs":"onTabClick"},regionViews:{},elementsCollection:null,categoriesCollection:null,initialize:function(){this.listenTo(qazana.channels.panelElements,"element:selected",this.destroy),this.initElementsCollection(),this.initCategoriesCollection(),this.initRegionViews()},initRegionViews:function(){var e={elements:{region:this.elements,view:r,options:{collection:this.elementsCollection}},categories:{region:this.elements,view:s,options:{collection:this.categoriesCollection}},search:{region:this.search,view:l},global:{region:this.elements,view:c}};this.regionViews=qazana.hooks.applyFilters("panel/elements/regionViews",e)},initElementsCollection:function(){var e=new o,t=qazana.config.elements.section;e.add({title:qazana.translate("inner_section"),elType:"section",categories:["basic"],icon:t.icon}),_.each(qazana.config.widgets,function(t){t.show_in_panel&&e.add({title:t.title,elType:t.elType,categories:t.categories,keywords:t.keywords,icon:t.icon,widgetType:t.widget_type,custom:t.custom})}),this.elementsCollection=e},initCategoriesCollection:function(){var e={};this.elementsCollection.each(function(t){_.each(t.get("categories"),function(a){e[a]||(e[a]=[]),e[a].push(t)})});var t=new i;_.each(qazana.config.document.panel.elements_categories,function(a,n){e[n]&&(void 0===a.active&&(a.active=!0),void 0===a.icon&&(a.icon="font"),t.add({name:n,title:a.title,icon:a.icon,defaultActive:a.active,items:e[n]}))}),this.categoriesCollection=t},activateTab:function(e){this.ui.tabs.removeClass("qazana-active").filter('[data-view="'+e+'"]').addClass("qazana-active"),this.showView(e)},showView:function(e){var t=this.regionViews[e],a=t.options||{};t.region.show(new t.view(a))},clearSearchInput:function(){this.getChildView("search").clearInput()},changeFilter:function(e){qazana.channels.panelElements.reply("filter:value",e).trigger("filter:change")},clearFilters:function(){this.changeFilter(null),this.clearSearchInput()},focusSearch:function(){this.search.currentView.ui.input.focus()},onChildviewChildrenRender:function(){qazana.getPanelView().updateScrollbar()},onChildviewSearchChangeInput:function(e){this.changeFilter(e.ui.input.val(),"search")},onDestroy:function(){qazana.channels.panelElements.reply("filter:value",null)},onShow:function(){this.showView("categories"),this.showView("search"),this.options.autoFocusSearch&&setTimeout(this.focusSearch.bind(this))},onTabClick:function(e){this.activateTab(e.currentTarget.dataset.view)}}),t.exports=n},{"./collections/categories":94,"./collections/elements":95,"./views/categories":98,"./views/global":102,"./views/search":103}],97:[function(e,t,a){var n;n=Backbone.Model.extend({defaults:{title:"",categories:[],keywords:[],icon:"",elType:"widget",widgetType:""}}),t.exports=n},{}],98:[function(e,t,a){var n,i=e("./category");n=Marionette.CompositeView.extend({template:"#tmpl-qazana-panel-categories",childView:i,childViewContainer:"#qazana-panel-categories",id:"qazana-panel-elements-categories",initialize:function(){this.listenTo(qazana.channels.panelElements,"filter:change",this.onPanelElementsFilterChange)},onPanelElementsFilterChange:function(){qazana.channels.panelElements.request("filter:value")&&qazana.getPanelView().getCurrentPageView().showView("elements")}}),t.exports=n},{"./category":99}],99:[function(e,t,a){var n,i=e("../collections/elements");n=Marionette.CompositeView.extend({template:"#tmpl-qazana-panel-elements-category",className:"qazana-panel-category",ui:{title:".qazana-panel-category-title",items:".qazana-panel-category-items"},events:{"click @ui.title":"onTitleClick"},id:function(){return"qazana-panel-category-"+this.model.get("name")},childView:e("qazana-panel/pages/elements/views/element"),childViewContainer:".qazana-panel-category-items",initialize:function(){this.collection=new i(this.model.get("items"))},onRender:function(){var e=qazana.channels.panelElements.request("category:"+this.model.get("name")+":active");void 0===e&&(e=this.model.get("defaultActive")),e&&(this.$el.addClass("qazana-active"),this.ui.items.show())},onTitleClick:function(){var e=this.ui.items,t=this.$el.hasClass("qazana-active"),a=t?"slideUp":"slideDown";qazana.channels.panelElements.reply("category:"+this.model.get("name")+":active",!t),this.$el.toggleClass("qazana-active",!t),e[a](300,function(){qazana.getPanelView().updateScrollbar()})}}),t.exports=n},{"../collections/elements":95,"qazana-panel/pages/elements/views/element":100}],100:[function(e,t,a){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-element-library-element",className:"qazana-element-wrapper",onRender:function(){var e=this;qazana.userCan("design")&&this.$el.html5Draggable({onDragStart:function(){qazana.channels.panelElements.reply("element:selected",e).trigger("element:drag:start")},onDragEnd:function(){qazana.channels.panelElements.trigger("element:drag:end")},groups:["qazana-element"]})}}),t.exports=n},{}],101:[function(e,t,a){var n;n=Marionette.CollectionView.extend({childView:e("qazana-panel/pages/elements/views/element"),id:"qazana-panel-elements",initialize:function(){this.listenTo(qazana.channels.panelElements,"filter:change",this.onFilterChanged)},filter:function(e){var t=qazana.channels.panelElements.request("filter:value");return!t||(-1!==e.get("title").toLowerCase().indexOf(t.toLowerCase())||_.any(e.get("keywords"),function(e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}))},onFilterChanged:function(){qazana.channels.panelElements.request("filter:value")||this.onFilterEmpty(),this._renderChildren(),this.triggerMethod("children:render")},onFilterEmpty:function(){qazana.getPanelView().getCurrentPageView().showView("categories")}}),t.exports=n},{"qazana-panel/pages/elements/views/element":100}],102:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-global",id:"qazana-panel-global",initialize:function(){qazana.getPanelView().getCurrentPageView().search.reset()},onDestroy:function(){var e=qazana.getPanelView();"elements"===e.getCurrentPageName()&&setTimeout(function(){var t=e.getCurrentPageView();t.search.currentView||t.showView("search")})}})},{}],103:[function(e,t,a){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-element-search",id:"qazana-panel-elements-search-wrapper",ui:{input:"input"},events:{"input @ui.input":"onInputChanged"},clearInput:function(){this.ui.input.val("")},onInputChanged:function(e){27===e.keyCode&&this.clearInput(),this.triggerMethod("search:change:input")}}),t.exports=n},{}],104:[function(e,t,a){var n,i=e("qazana-panel/pages/menu/views/group");n=Marionette.CompositeView.extend({id:"qazana-panel-page-menu",template:"#tmpl-qazana-panel-menu",childView:i,childViewContainer:"#qazana-panel-page-menu-content",initialize:function(){this.collection=n.getGroups()},onDestroy:function(){var e="eicon-arrow-"+(qazana.config.is_rtl?"right":"left");qazana.panel.currentView.getHeaderView().ui.menuIcon.removeClass(e).addClass("eicon-menu-bar")}},{groups:null,initGroups:function(){var e=[];qazana.config.user.is_administrator&&(e=[{name:"style",title:qazana.translate("global_style"),items:[{name:"global-colors",icon:"fa fa-paint-brush",title:qazana.translate("global_colors"),type:"page",pageName:"colorScheme"},{name:"global-fonts",icon:"fa fa-font",title:qazana.translate("global_fonts"),type:"page",pageName:"typographyScheme"},{name:"color-picker",icon:"fa fa-eyedropper",title:qazana.translate("color_picker"),type:"page",pageName:"colorPickerScheme"},{name:"clear-page",icon:"fa fa-eraser",title:qazana.translate("clear_page"),callback:function(){qazana.clearPage()}}]},{name:"settings",title:qazana.translate("settings"),items:[{name:"qazana-settings",icon:"fa fa-cogs",title:qazana.translate("qazana_settings"),type:"link",link:qazana.config.settings_page_link,newTab:!0},{name:"about-qazana",icon:"fa fa-info-circle",title:qazana.translate("about_qazana"),type:"link",link:qazana.config.qazana_site,newTab:!0}]}]),this.groups=new Backbone.Collection(e)},getGroups:function(){return this.groups||this.initGroups(),this.groups},addItem:function(e,t,a){var n=this.getGroups().findWhere({name:t});if(n){var i,o=n.get("items");a&&(i=_.findWhere(o,{name:a})),i?o.splice(o.indexOf(i),0,e):o.push(e)}}}),t.exports=n},{"qazana-panel/pages/menu/views/group":105}],105:[function(e,t,a){var n=e("qazana-panel/pages/menu/views/item");t.exports=Marionette.CompositeView.extend({template:"#tmpl-qazana-panel-menu-group",className:"qazana-panel-menu-group",childView:n,childViewContainer:".qazana-panel-menu-items",initialize:function(){this.collection=new Backbone.Collection(this.model.get("items"))},onChildviewClick:function(e){switch(e.model.get("type")){case"page":var t=e.model.get("pageName"),a=e.model.get("title");qazana.getPanelView().setPage(t,a);break;case"link":var n=e.model.get("link");e.model.get("newTab")?open(n,"_blank"):location.href=e.model.get("link");break;default:var i=e.model.get("callback");_.isFunction(i)&&i.call(e)}}})},{"qazana-panel/pages/menu/views/item":106}],106:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-menu-item",className:"qazana-panel-menu-item",triggers:{click:"click"}})},{}],107:[function(e,t,a){var n,i={color:e("qazana-panel/pages/schemes/items/color"),typography:e("qazana-panel/pages/schemes/items/typography")};n=Marionette.CompositeView.extend({id:function(){return"qazana-panel-scheme-"+this.getType()},className:function(){return"qazana-panel-scheme qazana-panel-scheme-"+this.getUIType()},childViewContainer:".qazana-panel-scheme-items",getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-panel-schemes-"+this.getType())},getChildView:function(){return i[this.getUIType()]},getUIType:function(){return this.getType()},ui:function(){return{saveButton:".qazana-panel-scheme-save .qazana-button",discardButton:".qazana-panel-scheme-discard .qazana-button",resetButton:".qazana-panel-scheme-reset .qazana-button"}},events:function(){return{"click @ui.saveButton":"saveScheme","click @ui.discardButton":"discardScheme","click @ui.resetButton":"setDefaultScheme"}},initialize:function(){this.model=new Backbone.Model,this.resetScheme()},getType:function(){},getScheme:function(){return qazana.schemes.getScheme(this.getType())},changeChildrenUIValues:function(e){var t=this;_.each(e,function(e,a){var n=t.collection.findWhere({key:a});t.children.findByModelCid(n.cid).changeUIValue(e)})},discardScheme:function(){qazana.schemes.resetSchemes(this.getType()),this.onSchemeChange(),this.ui.saveButton.prop("disabled",!0),this._renderChildren()},setSchemeValue:function(e,t){qazana.schemes.setSchemeValue(this.getType(),e,t),this.onSchemeChange()},saveScheme:function(){qazana.schemes.saveScheme(this.getType()),this.ui.saveButton.prop("disabled",!0),this.resetScheme(),this._renderChildren()},setDefaultScheme:function(){var e=qazana.config.default_schemes[this.getType()].items;this.changeChildrenUIValues(e)},resetItems:function(){this.model.set("items",this.getScheme().items)},resetCollection:function(){var e=this,t=e.model.get("items");e.collection=new Backbone.Collection,_.each(t,function(t,a){t.type=e.getType(),t.key=a,e.collection.add(t)})},resetScheme:function(){this.resetItems(),this.resetCollection()},onSchemeChange:function(){qazana.schemes.printSchemesStyle()},onChildviewValueChange:function(e,t){this.ui.saveButton.removeProp("disabled"),this.setSchemeValue(e.model.get("key"),t)}}),t.exports=n},{"qazana-panel/pages/schemes/items/color":112,"qazana-panel/pages/schemes/items/typography":113}],108:[function(e,t,a){var n;n=e("qazana-panel/pages/schemes/colors").extend({getType:function(){return"color-picker"},getUIType:function(){return"color"},onSchemeChange:function(){},getViewComparator:function(){return this.orderView},orderView:function(e){return qazana.helpers.getColorPickerPaletteIndex(e.get("key"))}}),t.exports=n},{"qazana-panel/pages/schemes/colors":109}],109:[function(e,t,a){var n,i=e("qazana-panel/pages/schemes/base");n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.systemSchemes=".qazana-panel-scheme-color-system-scheme",e},events:function(){var e=i.prototype.events.apply(this,arguments);return e["click @ui.systemSchemes"]="onSystemSchemeClick",e},getType:function(){return"color"},onSystemSchemeClick:function(e){var t=jQuery(e.currentTarget).data("schemeName"),a=qazana.config.system_schemes[this.getType()][t].items;this.changeChildrenUIValues(a)}}),t.exports=n},{"qazana-panel/pages/schemes/base":107}],110:[function(e,t,a){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-schemes-disabled",id:"qazana-panel-schemes-disabled",className:"qazana-nerd-box",disabledTitle:"",templateHelpers:function(){return{disabledTitle:this.disabledTitle}}}),t.exports=n},{}],111:[function(e,t,a){var n;n=Marionette.ItemView.extend({getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-panel-scheme-"+this.getUIType()+"-item")},className:function(){return"qazana-panel-scheme-item"}}),t.exports=n},{}],112:[function(e,t,a){var n;n=e("qazana-panel/pages/schemes/items/base").extend({getUIType:function(){return"color"},ui:{input:".qazana-panel-scheme-color-value"},changeUIValue:function(e){this.ui.input.wpColorPicker("color",e)},onBeforeDestroy:function(){this.ui.input.wpColorPicker("instance")&&this.ui.input.wpColorPicker("close")},onRender:function(){var e=this;qazana.helpers.wpColorPicker(e.ui.input,{change:function(t,a){e.triggerMethod("value:change",a.color.toString())}})}}),t.exports=n},{"qazana-panel/pages/schemes/items/base":111}],113:[function(e,t,a){var n,i=e("qazana-panel/pages/schemes/items/base");n=i.extend({getUIType:function(){return"typography"},className:function(){return i.prototype.className.apply(this,arguments)+" qazana-panel-box"},ui:{heading:".qazana-panel-heading",allFields:".qazana-panel-scheme-typography-item-field",inputFields:"input.qazana-panel-scheme-typography-item-field",selectFields:"select.qazana-panel-scheme-typography-item-field",selectFamilyFields:'select.qazana-panel-scheme-typography-item-field[name="font_family"]'},events:{"input @ui.inputFields":"onFieldChange","change @ui.selectFields":"onFieldChange","click @ui.heading":"toggleVisibility"},onRender:function(){var e=this;this.ui.inputFields.add(this.ui.selectFields).each(function(){var t=jQuery(this),a=t.attr("name"),n=e.model.get("value")[a];t.val(n)}),this.ui.selectFamilyFields.select2({dir:qazana.config.is_rtl?"rtl":"ltr"})},toggleVisibility:function(){this.$el.toggleClass("qazana-open")},changeUIValue:function(e){this.ui.allFields.each(function(){var t=jQuery(this),a=t.attr("name"),n=e[a];t.val(n).trigger("change")})},onFieldChange:function(e){var t=this.$(e.currentTarget),a=qazana.schemes.getSchemeValue("typography",this.model.get("key")).value,n=t.attr("name");a[n]=t.val(),"font_family"!==n||_.isEmpty(a[n])||qazana.helpers.enqueueFont(a[n]),this.triggerMethod("value:change",a)}}),t.exports=n},{"qazana-panel/pages/schemes/items/base":111}],114:[function(e,t,a){var n;n=e("qazana-panel/pages/schemes/base").extend({getType:function(){return"typography"}}),t.exports=n},{"qazana-panel/pages/schemes/base":107}],115:[function(e,t,a){t.exports=Marionette.Region.extend({el:"#qazana-panel",constructor:function(){Marionette.Region.prototype.constructor.apply(this,arguments);var t=e("qazana-layouts/panel/layout");this.show(new t),this.resizable()},resizable:function(){var e=qazana.config.is_rtl?"right":"left";this.$el.resizable({handles:qazana.config.is_rtl?"w":"e",minWidth:200,maxWidth:680,start:function(){qazana.$previewWrapper.addClass("ui-resizable-resizing")},stop:function(){qazana.$previewWrapper.removeClass("ui-resizable-resizing"),qazana.getPanelView().updateScrollbar()},resize:function(t,a){qazana.$previewWrapper.css(e,a.size.width)}})}})},{"qazana-layouts/panel/layout":92}],116:[function(e,t,a){var n;n={config:{},requests:{},cache:{},initConfig:function(){this.config={ajaxParams:{type:"POST",url:qazana.config.ajaxurl,data:{}},actionPrefix:"qazana_"}},init:function(){this.initConfig(),this.debounceSendBatch=_.debounce(this.sendBatch.bind(this),500)},getCacheKey:function(e){return JSON.stringify({unique_id:e.unique_id,data:e.data})},loadObjects:function(e){var t=this,a={},n=[];e.before&&e.before(),e.ids.forEach(function(i){n.push(t.load({action:e.action,unique_id:e.data.unique_id+i,data:jQuery.extend({id:i},e.data)}).done(function(e){a=jQuery.extend(a,e)}))}),jQuery.when.apply(jQuery,n).done(function(){e.success(a)})},load:function(e){var t=this;e.unique_id||(e.unique_id=e.action),e.before&&e.before();var a=t.getCacheKey(e);return _.has(t.cache,a)?jQuery.Deferred().done(e.success).resolve(t.cache[a]):t.addRequest(e.action,{data:e.data,unique_id:e.unique_id,success:function(e){t.cache[a]=e}}).done(e.success)},addRequest:function(e,t,a){(t=t||{}).unique_id||(t.unique_id=e),t.deferred=jQuery.Deferred().done(t.success).fail(t.error).always(t.complete);var n={action:e,options:t};if(a){var i={};i[t.unique_id]=n,t.deferred.jqXhr=this.sendBatch(i)}else this.requests[t.unique_id]=n,this.debounceSendBatch();return t.deferred},sendBatch:function(e){var t={};return e||(e=this.requests,this.requests={}),_(e).each(function(e,a){t[a]={action:e.action,data:e.options.data}}),this.send("ajax",{data:{actions:JSON.stringify(t)},success:function(t){_.each(t.responses,function(t,a){var n=e[a].options;n&&(t.success?n.deferred.resolve(t.data):t.success||n.deferred.reject(t.data))})},error:function(t){_.each(e,function(e){e.options&&e.options.deferred.reject(t)})}})},send:function(e,t){var a=this,n=qazana.helpers.cloneObject(this.config.ajaxParams);t=t||{},e=this.config.actionPrefix+e,jQuery.extend(n,t),n.data instanceof FormData?(n.data.append("action",e),n.data.append("_nonce",qazana.config.nonce),n.data.append("editor_post_id",qazana.config.document.id)):(n.data.action=e,n.data._nonce=qazana.config.nonce,n.data.editor_post_id=qazana.config.document.id);var i=n.success,o=n.error;return(i||o)&&(n.success=function(e){e.success&&i&&i(e.data),!e.success&&o&&o(e.data)},n.error=o?function(e){o(e)}:function(e){if(0!==e.readyState||"abort"!==e.statusText){var t=a.createErrorMessage(e);qazana.notifications.showToast({message:t})}}),jQuery.ajax(n)},createErrorMessage:function(e){var t;return 4===e.readyState?(t=qazana.translate("server_error"),200!==e.status&&(t+=" ("+e.status+" "+e.statusText+")")):t=0===e.readyState?qazana.translate("server_connection_lost"):qazana.translate("unknown_error"),t+"."}},t.exports=n},{}],117:[function(e,t,a){var n;n=function(){var e=this;this.compare=function(e,t,a){switch(a){case"==":return e==t;case"!=":return e!=t;case"!==":return e!==t;case"in":return-1!==t.indexOf(e);case"!in":return-1===t.indexOf(e);case"contains":return-1!==e.indexOf(t);case"!contains":return-1===e.indexOf(t);case"<":return e<t;case"<=":return e<=t;case">":return e>t;case">=":return e>=t;default:return e===t}},this.check=function(t,a){var n="or"===t.relation,i=!n;return jQuery.each(t.terms,function(){var t,o=this;if(o.terms)t=e.check(o,a);else{var s=o.name.match(/(\w+)(?:\[(\w+)])?/),r=a[s[1]];s[2]&&(r=r[s[2]]),t=e.compare(r,o.value,o.operator)}return n?(t&&(i=!0),!t):t?void 0:i=!1}),i}},t.exports=new n},{}],118:[function(e,t,a){var n;n=e("qazana-utils/module").extend({getDefaultSettings:function(){return{actions:{},classes:{list:"qazana-context-menu-list",group:"qazana-context-menu-list__group",groupPrefix:"qazana-context-menu-list__group-",item:"qazana-context-menu-list__item",itemTypePrefix:"qazana-context-menu-list__item-",itemTitle:"qazana-context-menu-list__item__title",itemShortcut:"qazana-context-menu-list__item__shortcut",iconShortcut:"qazana-context-menu-list__item__icon",itemDisabled:"qazana-context-menu-list__item--disabled",divider:"qazana-context-menu-list__divider",hidden:"qazana-hidden"}}},buildActionItem:function(e){var t=this,a=t.getSettings("classes"),n=jQuery("<div>",{class:a.item+" "+a.itemTypePrefix+e.name}),i=jQuery("<div>",{class:a.itemTitle}).text(e.title),o=jQuery("<div>",{class:a.iconShortcut});if(e.icon&&o.html(jQuery("<i>",{class:e.icon})),n.append(o,i),e.shortcut){var s=jQuery("<div>",{class:a.itemShortcut}).html(e.shortcut);n.append(s)}return e.callback&&n.on("click",function(){t.runAction(e)}),e.$item=n,n},buildActionsList:function(){var e=this,t=e.getSettings("classes"),a=e.getSettings("groups"),n=jQuery("<div>",{class:t.list});return a.forEach(function(a){var i=jQuery("<div>",{class:t.group+" "+t.groupPrefix+a.name});a.actions.forEach(function(t){i.append(e.buildActionItem(t))}),n.append(i),a.$item=i}),n},toggleGroupVisibility:function(e,t){e.$item.toggleClass(this.getSettings("classes.hidden"),!t)},toggleActionVisibility:function(e,t){e.$item.toggleClass(this.getSettings("classes.hidden"),!t)},toggleActionUsability:function(e,t){e.$item.toggleClass(this.getSettings("classes.itemDisabled"),!t)},isActionEnabled:function(e){return!(!e.callback&&!e.groups)&&(!e.isEnabled||e.isEnabled())},runAction:function(e){this.isActionEnabled(e)&&(e.callback(),this.getModal().hide())},initModal:function(){var e;this.getModal=function(){return e||(e=qazana.dialogsManager.createWidget("simple",{className:"qazana-context-menu",message:this.buildActionsList(),iframe:qazana.$preview,effects:{hide:"hide",show:"show"},hide:{onOutsideContextMenu:!0},position:{my:(qazana.config.is_rtl?"right":"left")+" top",collision:"fit"}})),e}},show:function(e){var t=this,a=t.getModal();a.setSettings("position",{of:e}),t.getSettings("groups").forEach(function(e){var a=!1!==e.isVisible;t.toggleGroupVisibility(e,a),a&&e.actions.forEach(function(e){var a=!1!==e.isVisible;t.toggleActionVisibility(e,a),a&&t.toggleActionUsability(e,t.isActionEnabled(e))})}),a.show()},destroy:function(){this.getModal().destroy()},onInit:function(){this.initModal()}}),t.exports=n},{"qazana-utils/module":140}],119:[function(e,t,a){var n,i=e("qazana-utils/view-module"),o=e("qazana-editor-utils/stylesheet");(n=i.extend({stylesheet:null,getDefaultSettings:function(){return{id:0,settingsModel:null,dynamicParsing:{}}},getDefaultElements:function(){return{$stylesheetElement:jQuery("<style>",{id:"qazana-style-"+this.getSettings("id")})}},initStylesheet:function(){var e=qazanaFrontend.config.breakpoints;this.stylesheet=new o,this.stylesheet.addDevice("mobile",0).addDevice("tablet",e.md).addDevice("desktop",e.lg)},addStyleRules:function(e,t,a,n,i){var o=this,s=o.getSettings("settingsModel").parseDynamicSettings(t,o.getSettings("dynamicParsing"),e);_.each(e,function(e){e.styleFields&&e.styleFields.length&&o.addRepeaterControlsStyleRules(t[e.name],e.styleFields,a,n,i),e.dynamic&&e.dynamic.active&&t.__dynamic__&&t.__dynamic__[e.name]&&o.addDynamicControlStyleRules(t.__dynamic__[e.name],e),e.selectors&&o.addControlStyleRules(e,s,a,n,i)})},addControlStyleRules:function(e,t,a,i,o){var s=this;n.addControlStyleRules(s.stylesheet,e,a,function(e){return s.getStyleControlValue(e,t)},i,o)},getStyleControlValue:function(e,t){var a=t[e.name];if(e.selectors_dictionary&&(a=e.selectors_dictionary[a]||a),_.isNumber(a)||!_.isEmpty(a))return a},addRepeaterControlsStyleRules:function(e,t,a,n,i){var o=this;t.forEach(function(t,s){var r=e.models[s];o.addStyleRules(t,r.attributes,a,n.concat(["{{CURRENT_ITEM}}"]),i.concat([".qazana-repeater-item-"+r.get("_id")]))})},addDynamicControlStyleRules:function(e,t){var a=this;qazana.dynamicTags.parseTagsText(e,t.dynamic,function(e,t,n){var i=qazana.dynamicTags.createTag(e,t,n);if(i){var o=i.model;o.getStyleControls().length&&a.addStyleRules(o.getStyleControls(),o.attributes,o.controls,["{{WRAPPER}}"],["#qazana-tag-"+e])}})},addStyleToDocument:function(){qazana.$previewContents.find("head").append(this.elements.$stylesheetElement),this.elements.$stylesheetElement.text(this.stylesheet)},removeStyleFromDocument:function(){this.elements.$stylesheetElement.remove()},onInit:function(){i.prototype.onInit.apply(this,arguments),this.initStylesheet()}})).addControlStyleRules=function(e,t,a,n,i,o){var s=n(t);void 0!==s&&_.each(t.selectors,function(r,l){var c;try{c=r.replace(/{{(?:([^.}]+)\.)?([^}]*)}}/g,function(e,i,o){var r=t,l=s;if(i){if(!(r=_.findWhere(a,{name:i})))return"";l=n(r)}var c=qazana.getControlView(r.type).getStyleValue(o.toLowerCase(),l);if(""===c)throw"";return c})}catch(e){return}if(!_.isEmpty(c)){var d=/^(?:\([^)]+\)){1,2}/,u=l.match(d),h={};if(u){u=u[0],l=l.replace(d,"");for(var g,p=/\(([^)]+)\)/g,m=[];g=p.exec(u);)m.push(g[1]);_.each(m,function(e){if("desktop"!==e){var t=e.replace(/\+$/,"");h[t===e?"max":"min"]=t}})}_.each(i,function(e,t){var a=e.source?e.source:e,n=new RegExp(a,"g");l=l.replace(n,o[t])}),!Object.keys(h).length&&t.responsive&&"desktop"===(h=_.pick(qazana.helpers.cloneObject(t.responsive),["min","max"])).max&&delete h.max,e.addRules(l,c,h)}})},t.exports=n},{"qazana-editor-utils/stylesheet":129,"qazana-utils/view-module":141}],120:[function(e,t,a){t.exports=new function(){var e=this,t=[],a={},n={},i=function(){a={debounceDelay:500,urlsToWatch:["qazana/assets"]}},o=function(){n.$window=jQuery(window)},s=function(t){var n=t.originalEvent,i=n.error;if(i){var o=!1,s=a.urlsToWatch;jQuery.each(s,function(){if(-1!==i.stack.indexOf(this))return o=!0,!1}),o&&e.addError({type:i.name,message:i.message,url:n.filename,line:n.lineno,column:n.colno})}},r=function(){n.$window.on("error",s)};this.addURLToWatch=function(e){a.urlsToWatch.push(e)},this.addCustomError=function(e,t,a){var n={type:e.name,message:e.message,url:e.fileName||e.sourceURL,line:e.lineNumber||e.line,column:e.columnNumber||e.column,customFields:{category:t||"general",tag:a}};if(!n.url){var i=e.stack.match(/\n {4}at (.*?(?=:(\d+):(\d+)))/);i&&(n.url=i[1],n.line=i[2],n.column=i[3])}this.addError(n)},this.addError=function(a){var n={type:"Error",timestamp:Math.floor((new Date).getTime()/1e3),message:null,url:null,line:null,column:null,customFields:{}};t.push(jQuery.extend(!0,n,a)),e.sendErrors()},this.sendErrors=function(){n.$window.off("error",s),jQuery.ajax({url:QazanaConfig.ajaxurl,method:"POST",data:{action:"qazana_debug_log",data:t},success:function(){t=[],n.$window.on("error",s)}})},i(),o(),r(),e.sendErrors=_.debounce(e.sendErrors,a.debounceDelay)}},{}],121:[function(e,t,a){var n;n={init:function(){var e;this.getModal=function(){return e||(e=this.initModal()),e},jQuery(document).on({"heartbeat-send":function(e,t){t.qazana_post_lock={post_ID:qazana.config.document.id}},"heartbeat-tick":function(e,t){t.locked_user?(qazana.saver.isEditorChanged()&&qazana.saver.saveEditor({status:"autosave"}),n.showLockMessage(t.locked_user)):n.getModal().hide(),qazana.config.nonce=t.qazanaNonce},"heartbeat-tick.wp-refresh-nonces":function(e,t){var a=t["qazana-refresh-nonces"];a&&(a.heartbeatNonce&&(qazana.config.nonce=a.qazanaNonce),a.heartbeatNonce&&(window.heartbeatSettings.nonce=a.heartbeatNonce))}}),qazana.config.locked_user&&n.showLockMessage(qazana.config.locked_user)},initModal:function(){var e=qazana.dialogsManager.createWidget("lightbox",{headerMessage:qazana.translate("take_over")});return e.addButton({name:"go_back",text:qazana.translate("go_back"),callback:function(){parent.history.go(-1)}}),e.addButton({name:"take_over",text:qazana.translate("take_over"),callback:function(){wp.heartbeat.enqueue("qazana_force_post_lock",!0),wp.heartbeat.connectNow()}}),e},showLockMessage:function(e){n.getModal().setMessage(qazana.translate("dialog_user_taken_over",[e])).show()}},t.exports=n},{}],122:[function(e,t,a){var n;n={_enqueuedFonts:[],elementsHierarchy:{section:{column:{widget:null,section:null}}},enqueueFont:function(e){if(-1===this._enqueuedFonts.indexOf(e)){var t,a=qazana.config.controls.font.options[e],n={ru_RU:"cyrillic",uk:"cyrillic",bg_BG:"cyrillic",vi:"vietnamese",el:"greek",he_IL:"hebrew"};switch(a){case"googlefonts":t="https://fonts.googleapis.com/css?family="+e+":100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic",n[qazana.config.locale]&&(t+="&subset="+n[qazana.config.locale]);break;case"earlyaccess":t="https://fonts.googleapis.com/earlyaccess/"+e.replace(/\s+/g,"").toLowerCase()+".css"}_.isEmpty(t)||qazana.$previewContents.find("link:last").after('<link href="'+t+'" rel="stylesheet" type="text/css">'),this._enqueuedFonts.push(e),qazana.channels.editor.trigger("font:insertion",a,e)}},resetEnqueuedFontsCache:function(){this._enqueuedFonts=[]},getElementChildType:function(e,t){if(t||(t=this.elementsHierarchy),void 0!==t[e])return jQuery.isPlainObject(t[e])?Object.keys(t[e]):null;for(var a in t)if(t.hasOwnProperty(a)&&jQuery.isPlainObject(t[a])){var n=this.getElementChildType(e,t[a]);if(n)return n}return null},getUniqueID:function(){return Math.random().toString(16).substr(2,7)},stringReplaceAll:function(e,t){var a=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(a,function(e){return t[e]})},getYoutubeIDFromURL:function(e){var t=e.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);return t&&t[1]},ytVidId:function(e){var t=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return!!e.match(t)&&RegExp.$1},isActiveControl:function(e,t){var a,n;if(_.isFunction(e.get)?(a=e.get("condition"),n=e.get("conditions")):(a=e.condition,n=e.conditions),n)return qazana.conditions.check(n,t);if(_.isEmpty(a))return!0;var i=_.filter(a,function(e,a){var n=a.match(/([a-z_0-9]+)(?:\[([a-z_]+)])?(!?)$/i),i=n[1],o=n[2],s=!!n[3],r=t[i];if(t.__dynamic__&&t.__dynamic__[i]&&(r=t.__dynamic__[i]),void 0===r)return!0;o&&"object"==typeof r&&(r=r[o]);var l;return l=_.isArray(e)&&!_.isEmpty(e)?_.contains(e,r):_.isArray(r)&&!_.isEmpty(r)?_.contains(r,e):_.isEqual(e,r),s?l:!l});return _.isEmpty(i)},cloneObject:function(e){return JSON.parse(JSON.stringify(e))},firstLetterUppercase:function(e){return e[0].toUpperCase()+e.slice(1)},disableElementEvents:function(e){e.each(function(){var e=this.style.pointerEvents;"none"!==e&&jQuery(this).data("backup-pointer-events",e).css("pointer-events","none")})},enableElementEvents:function(e){e.each(function(){var e=jQuery(this),t=e.data("backup-pointer-events");void 0!==t&&e.removeData("backup-pointer-events").css("pointer-events",t)})},getColorPickerPaletteIndex:function(e){return["7","8","1","5","2","3","6","4"].indexOf(e)},wpColorPicker:function(e,t){var a=this,n=qazana.schemes.getScheme("color-picker"),i=_.sortBy(n.items,function(e){return a.getColorPickerPaletteIndex(e.key)}),o={width:window.innerWidth>=1440?271:251,palettes:_.pluck(i,"value")};return t&&_.extend(o,t),e.wpColorPicker(o)},isInViewport:function(e,t){var a=e.getBoundingClientRect();return t=t||document.documentElement,a.top>=0&&a.left>=0&&a.bottom<=(window.innerHeight||t.clientHeight)&&a.right<=(window.innerWidth||t.clientWidth)},scrollToView:function(e,t,a){void 0===t&&(t=500);var n=a,i=qazanaFrontend.getElements("$window");a||(a=i,n=qazana.$previewContents.find("html, body")),setTimeout(function(){var t=a.height(),o=a.scrollTop(),s=a===i?e.offset().top:e[0].offsetTop,r=s-o;if(!(r>0&&r<t)){var l=s-t/2;n.stop(!0).animate({scrollTop:l},1e3)}},t)},getElementInlineStyle:function(e,t){var a={},n=e[0].style;return t.forEach(function(e){a[e]=void 0!==n[e]?n[e]:""}),a},cssWithBackup:function(e,t,a){var n=this.getElementInlineStyle(e,Object.keys(a));e.data("css-backup-"+t,n).css(a)},recoverCSSBackup:function(e,t){var a="css-backup-"+t;e.css(e.data(a)),e.removeData(a)},compareVersions:function(e,t,a){var n=function(e){return(e+="").replace(/[^\d.]+/,".-1.")};if(e=n(e),t=n(t),e===t)return!a||/^={2,3}$/.test(a);for(var i=e.split(".").map(Number),o=t.split(".").map(Number),s=Math.max(i.length,o.length),r=0;r<s;r++){var l=i[r]||0,c=o[r]||0;if(l!==c)return this.conditions.compare(l,c,a)}}},t.exports=n},{}],123:[function(e,t,a){var n;n=function(){var e=this,t={},a=[],n=function(e){var t,a=e.size;if("custom"===a){var n=e.dimension;if(!n.width&&!n.height)return"full";t="custom_"+n.width+"x"+n.height}else t=a;return t};e.onceTriggerChange=_.once(function(e){setTimeout(function(){e.get("settings").trigger("change",e.get("settings"))},700)}),e.getImageUrl=function(t){e.registerItem(t);var a=e.getItem(t);if(!a){if("custom"===t.size)return void(qazana.getPanelView()&&"editor"===qazana.getPanelView().getCurrentPageName()&&t.model&&e.onceTriggerChange(t.model));a=t.url}return a},e.getItem=function(e){var a=n(e),i=e.id;return!!a&&(!(!t[i]||!t[i][a])&&t[i][a])},e.registerItem=function(t){""!==t.id&&(e.getItem(t)||(a.push(t),e.debounceGetRemoteItems()))},e.getRemoteItems=function(){var e,i,o=[],s=Object.keys(a).length;if(0!==s)if(1===s&&(e=a[Object.keys(a)[0]])&&e.model)e.model.renderRemoteServer();else{for(i in a){e=a[i];var r=n(e),l=e.id,c=!t[l]||0===Object.keys(t[l]).length;o.push({id:l,size:r,is_first_time:c})}qazana.ajax.send("get_images_details",{data:{items:o},success:function(e){var n,i;for(n in e){t[n]||(t[n]={});for(i in e[n])t[n][i]=e[n][i]}a=[]}})}},e.debounceGetRemoteItems=_.debounce(e.getRemoteItems,300)},t.exports=new n},{}],124:[function(e,t,a){!function(e){var t=function(e){try{return e.originalEvent.dataTransfer.setData("test","test"),e.originalEvent.dataTransfer.clearData("test"),!0}catch(e){return!1}},a={html5Draggable:function(a){var n=this,i={},o={},s={element:"",groups:null,onDragStart:null,onDragEnd:null},r=function(){e.extend(!0,i,s,a)},l=function(){o.$element=e(i.element)},c=function(){o.$element.attr("draggable",!0)},d=function(t){e.isFunction(i.onDragEnd)&&i.onDragEnd.call(o.$element,t,n)},u=function(a){var s={groups:i.groups||[]};t(a)&&a.originalEvent.dataTransfer.setData(JSON.stringify(s),!0),e.isFunction(i.onDragStart)&&i.onDragStart.call(o.$element,a,n)},h=function(){o.$element.on("dragstart",u).on("dragend",d)};this.destroy=function(){o.$element.off("dragstart",u),o.$element.removeAttr("draggable")},r(),l(),c(),h()},html5Droppable:function(a){var n,i,o=this,s={},r={},l={element:"",items:">",horizontalSensitivity:"10%",axis:["vertical","horizontal"],placeholder:!0,currentElementClass:"html5dnd-current-element",placeholderClass:"html5dnd-placeholder",hasDraggingOnChildClass:"html5dnd-has-dragging-on-child",groups:null,isDroppingAllowed:null,onDragEnter:null,onDragging:null,onDropping:null,onDragLeave:null},c=function(){e.extend(s,l,a)},d=function(){r.$element=e(s.element),r.$placeholder=e("<div>",{class:s.placeholderClass})},u=function(){return-1!==s.axis.indexOf("horizontal")},h=function(){return-1!==s.axis.indexOf("vertical")},g=function(e,t){var a;return!!u()&&(h()?!!(a=s.horizontalSensitivity.match(/\d+/))&&(a=a[0],/%$/.test(s.horizontalSensitivity)&&(a=t/a),e>t-a?"right":e<a&&"left"):e>t/2?"right":"left")},p=function(t){var a=e(n),o=a.outerHeight()-r.$placeholder.outerHeight(),s=a.outerWidth();if(t=t.originalEvent,!(i=g(t.offsetX,s)))if(h()){var l=n.getBoundingClientRect();i=t.clientY>l.top+o/2?"bottom":"top"}else i=null},m=function(){if(s.placeholder){var e="top"===i?"prependTo":"appendTo";r.$placeholder[e](n)}},f=function(a){var r,l,c;return!(s.groups&&t(a)&&(r=a.originalEvent.dataTransfer.types,c=!1,(r=Array.prototype.slice.apply(r)).forEach(function(e){try{if(!(l=JSON.parse(e)).groups.slice)return;s.groups.forEach(function(e){if(-1!==l.groups.indexOf(e))return c=!0,!1})}catch(e){}}),!c))&&!(e.isFunction(s.isDroppingAllowed)&&!s.isDroppingAllowed.call(n,i,a,o))},v=function(t){t.stopPropagation(),n||(n=this,r.$element.parents().each(function(){var t=e(this).data("html5Droppable");t&&t.doDragLeave()}),p(t),f(t)&&(m(),r.$element.addClass(s.hasDraggingOnChildClass),e(n).addClass(s.currentElementClass),e.isFunction(s.onDragEnter)&&s.onDragEnter.call(n,i,t,o)))},z=function(t){t.stopPropagation(),n||v.call(this,t);var a=i;p(t),f(t)&&(t.preventDefault(),a!==i&&m(),e.isFunction(s.onDragging)&&s.onDragging.call(this,i,t,o))},q=function(t){var a=this.getBoundingClientRect();("dragleave"!==t.type||t.clientX<a.left||t.clientX>=a.right||t.clientY<a.top||t.clientY>=a.bottom)&&(e(n).removeClass(s.currentElementClass),o.doDragLeave())},y=function(t){p(t),f(t)&&(t.preventDefault(),e.isFunction(s.onDropping)&&s.onDropping.call(this,i,t,o))},w=function(){r.$element.on("dragenter",s.items,v).on("dragover",s.items,z).on("drop",s.items,y).on("dragleave drop",s.items,q)};this.doDragLeave=function(){s.placeholder&&r.$placeholder.remove(),r.$element.removeClass(s.hasDraggingOnChildClass),e.isFunction(s.onDragLeave)&&s.onDragLeave.call(n,event,o),n=i=null},this.destroy=function(){r.$element.off("dragenter",s.items,v).off("dragover",s.items,z).off("drop",s.items,y).off("dragleave drop",s.items,q)},c(),d(),w()}};e.each(a,function(t,a){e.fn[t]=function(n){return n=n||{},this.each(function(){var i=e.data(this,t);i instanceof a?"destroy"===n&&(i.destroy(),e.removeData(this,t)):(n.element=this,e.data(this,t,new a(n)))}),this}})}(jQuery)},{}],125:[function(e,t,a){!function(e){e.fn.qazanaSerializeObject=function(){var t=this.serializeArray(),a={},n=function(e,t,a){var i=/^[^\[\]]+\[]/.test(t),o=/^[^\[\]]+\[[^\[\]]+]/.test(t),s=t.replace(/\[.*/,"");if(i)e[s]||(e[s]=[]);else{if(!o)return void(e.push?e.push(a):e[s]=a);e[s]||(e[s]={})}var r=t.match(/\[[^\[\]]*]/g);return r[0]=r[0].replace(/\[|]/g,""),n(e[s],r.join(""),a)};return e.each(t,function(){n(a,this.name,this.value)}),a}}(jQuery)},{}],126:[function(e,t,a){var n=e("qazana-utils/module");t.exports=n.extend({initToast:function(){var e=qazana.dialogsManager.createWidget("buttons",{id:"qazana-toast",position:{my:"center bottom",at:"center bottom-10",of:"#qazana-panel-content-wrapper",autoRefresh:!0},hide:{onClick:!0,auto:!0,autoDelay:1e4},effects:{show:function(){var t=e.getElements("widget");t.show(),e.refreshPosition();var a=parseInt(t.css("top"),10);t.hide().css("top",a+100),t.animate({opacity:"show",height:"show",paddingBottom:"show",paddingTop:"show",top:a},{easing:"linear",duration:300})},hide:function(){var t=e.getElements("widget"),a=parseInt(t.css("top"),10);t.animate({opacity:"hide",height:"hide",paddingBottom:"hide",paddingTop:"hide",top:a+100},{easing:"linear",duration:300})}},button:{tag:"div"}});this.getToast=function(){return e}},showToast:function(e){var t=this.getToast();t.setMessage(e.message),t.getElements("buttonsWrapper").empty(),e.buttons&&e.buttons.forEach(function(e){t.addButton(e)}),t.show()},onInit:function(){this.initToast()}})},{"qazana-utils/module":140}],127:[function(e,t,a){var n;n={getPresetsDictionary:function(){return{11:100/9,12:12.5,14:100/7,16:100/6,33:100/3,66:2/3*100,83:5/6*100}},getAbsolutePresetValues:function(e){var t=qazana.helpers.cloneObject(e),a=this.getPresetsDictionary();return _.each(t,function(e,n){a[e]&&(t[n]=a[e])}),t},getPresets:function(e,t){var a=qazana.helpers.cloneObject(qazana.config.elements.section.presets);return e&&(a=a[e]),t&&(a=a[t]),a},getPresetByStructure:function(e){var t=this.getParsedStructure(e);return this.getPresets(t.columnsCount,t.presetIndex)},getParsedStructure:function(e){return e+="",{columnsCount:e.slice(0,-1),presetIndex:e.substr(-1)}},getPresetSVG:function(e,t,a,n){t=t||100,a=a||50,n=n||2;var i=this.getAbsolutePresetValues(e),o=this._generatePresetSVGPath(i,t,a,n);return this._createSVGPreset(o,t,a)},_createSVGPreset:function(e,t,a){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewBox","0 0 "+t+" "+a);var i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",e),n.appendChild(i),n},_generatePresetSVGPath:function(e,t,a,n){for(var i=t-n*(e.length-1),o=0,s="",r=0;r<e.length;r++){r&&(s+=" ");var l=e[r]/100*i;s+="M"+ +(o+=l).toFixed(4)+",0",s+="V"+a,s+="H"+ +(o-l).toFixed(4),s+="V0Z",o+=n}return s}},t.exports=n},{}],128:[function(e,t,a){var n,i=e("qazana-editor-utils/stylesheet"),o=e("qazana-editor-utils/controls-css-parser");n=function(){var e=this,t=new i,a={},n={selectorWrapperPrefix:".qazana-widget-"},s={},r=function(){s.$previewHead.append(s.$style)},l=function(){s.$style=jQuery("<style>",{id:"qazana-style-scheme"}),s.$previewHead=qazana.$previewContents.find("head")},c=function(){a=qazana.helpers.cloneObject(qazana.config.schemes.items)},d=function(a,i,s){o.addControlStyleRules(t,a,i,function(t){return e.getSchemeValue(t.scheme.type,t.scheme.value,t.scheme.key).value},["{{WRAPPER}}"],[n.selectorWrapperPrefix+s])},u=function(t){var a=e.getWidgetSchemeControls(t);_.each(a,function(e){d(e,a,t.widget_type)})},h=function(){_.each(qazana.config.widgets,function(e){u(e)})};this.init=function(){return l(),r(),c(),e},this.getWidgetSchemeControls=function(e){return _.filter(e.controls,function(e){return _.isObject(e.scheme)})},this.getSchemes=function(){return a},this.getEnabledSchemesTypes=function(){return qazana.config.schemes.enabled_schemes},this.getScheme=function(e){return a[e]},this.getSchemeValue=function(t,a,n){if(this.getEnabledSchemesTypes().indexOf(t)<0)return!1;var i=e.getScheme(t).items[a];if(n&&_.isObject(i)){var o=qazana.helpers.cloneObject(i);return o.value=i.value[n],o}return i},this.printSchemesStyle=function(){t.empty(),h(),s.$style.text(t)},this.resetSchemes=function(e){a[e]=qazana.helpers.cloneObject(qazana.config.schemes.items[e])},this.saveScheme=function(e){qazana.config.schemes.items[e].items=qazana.helpers.cloneObject(a[e].items);var t={};_.each(a[e].items,function(e,a){t[a]=e.value}),NProgress.start(),qazana.ajax.send("apply_scheme",{data:{scheme_name:e,data:JSON.stringify(t)},success:function(){NProgress.done()}})},this.setSchemeValue=function(e,t,n){a[e].items[t].value=n}},t.exports=new n},{"qazana-editor-utils/controls-css-parser":119,"qazana-editor-utils/stylesheet":129}],129:[function(e,t,a){!function(e){var a=function(){var t=this,n={},i={},o={},s=function(e){var t=Object.keys(o),a=t.indexOf(e)+1;if(a>=t.length)throw new RangeError("Max value for this device is out of range.");return o[t[a]]-1},r=function(t){var a=[];return e.each(t,function(e){a.push(e+"_"+this)}),a.join("-")},l=function(e){var t={};return(e=e.split("-").filter(String)).forEach(function(e){var a=e.split("_"),n=a[0],i=a[1];t[n]="max"===n?s(i):o[i]}),t},c=function(e){n[e]={};var t=Object.keys(n);if(!(t.length<2)){t.sort(function(e,t){if("all"===e)return-1;if("all"===t)return 1;var a=l(e);return l(t).max-a.max});var a={};t.forEach(function(e){a[e]=n[e]}),n=a}},d=function(t){var a=l(t),n=[];return e.each(a,function(e){n.push("("+e+"-width:"+this+"px)")}),"@media"+n.join(" and ")};this.addDevice=function(e,a){o[e]=a;var n=Object.keys(o);if(n.length<2)return t;n.sort(function(e,t){return o[e]-o[t]});var i={};return n.forEach(function(e){i[e]=o[e]}),o=i,t},this.addRawCSS=function(e,t){i[e]=t},this.addRules=function(a,i,o){var s="all";if(_.isEmpty(o)||(s=r(o)),n[s]||c(s),i){if(n[s][a]||(n[s][a]={}),"string"==typeof i){i=i.split(";").filter(String);var l={};try{e.each(i,function(){var e=this.split(/:(.*)?/);l[e[0].trim()]=e[1].trim().replace(";","")})}catch(e){return}i=l}return e.extend(n[s][a],i),t}var d=a.match(/[^{]+\{[^}]+}/g);e.each(d,function(){var e=this.match(/([^{]+)\{([^}]+)}/);e&&t.addRules(e[1].trim(),e[2].trim(),o)})},this.getRules=function(){return n},this.empty=function(){n={},i={}},this.toString=function(){var t="";return e.each(n,function(e){var n=a.parseRules(this);"all"!==e&&(n=d(e)+"{"+n+"}"),t+=n}),e.each(i,function(){t+=this}),t}};a.parseRules=function(t){var n="";return e.each(t,function(e){var t=a.parseProperties(this);t&&(n+=e+"{"+t+"}")}),n},a.parseProperties=function(t){var a="";return e.each(t,function(e){this&&(a+=e+":"+this+";")}),a},t.exports=a}(jQuery)},{}],130:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-add-section"),attributes:{"data-view":"choose-action"},ui:{addNewSection:".qazana-add-new-section",closeButton:".qazana-add-section-close",addSectionButton:".qazana-add-section-button",addTemplateButton:".qazana-add-template-button",selectPreset:".qazana-select-preset",presets:".qazana-preset"},events:{"click @ui.addSectionButton":"onAddSectionButtonClick","click @ui.addTemplateButton":"onAddTemplateButtonClick","click @ui.closeButton":"onCloseButtonClick","click @ui.presets":"onPresetSelected"},behaviors:function(){return{contextMenu:{behaviorClass:e("qazana-behaviors/context-menu"),groups:this.getContextMenuGroups()}}},className:function(){return"qazana-add-section qazana-visible-desktop"},addSection:function(e,t){return qazana.getPreviewView().addChildElement(e,jQuery.extend({},this.options,t))},setView:function(e){this.$el.attr("data-view",e)},showSelectPresets:function(){this.setView("select-preset")},closeSelectPresets:function(){this.setView("choose-action")},getTemplatesModalOptions:function(){return{importOptions:{at:this.getOption("at")}}},getContextMenuGroups:function(){var e=function(){return qazana.elements.length>0};return[{name:"paste",actions:[{name:"paste",title:qazana.translate("paste"),callback:this.paste.bind(this),isEnabled:this.isPasteEnabled.bind(this)}]},{name:"content",actions:[{name:"copy_all_content",title:qazana.translate("copy_all_content"),callback:this.copy.bind(this),isEnabled:e},{name:"delete_all_content",title:qazana.translate("delete_all_content"),callback:qazana.clearPage.bind(qazana),isEnabled:e}]}]},copy:function(){qazana.getPreviewView().copy()},paste:function(){qazana.getPreviewView().paste(this.getOption("at"))},isPasteEnabled:function(){return qazana.getStorage("transfer")},onAddSectionButtonClick:function(){this.showSelectPresets()},onAddTemplateButtonClick:function(){qazana.templates.startModal(this.getTemplatesModalOptions())},onRender:function(){this.$el.html5Droppable({axis:["vertical"],groups:["qazana-element"],placeholder:!1,currentElementClass:"qazana-html5dnd-current-element",hasDraggingOnChildClass:"qazana-dragging-on-child",onDropping:this.onDropping.bind(this)})},onPresetSelected:function(e){this.closeSelectPresets();var t,a=e.currentTarget.dataset.structure,n=qazana.presetsFactory.getParsedStructure(a),i=[];for(t=0;t<n.columnsCount;t++)i.push({id:qazana.helpers.getUniqueID(),elType:"column",settings:{},elements:[]});qazana.channels.data.trigger("element:before:add",{elType:"section"}),this.addSection({elements:i}).setStructure(a),qazana.channels.data.trigger("element:after:add")},onDropping:function(){qazana.channels.data.trigger("section:before:drop"),this.addSection().addElementFromPanel(),qazana.channels.data.trigger("section:after:drop")}})},{"qazana-behaviors/context-menu":75}],131:[function(e,t,a){var n=e("qazana-views/add-section/base");t.exports=n.extend({id:"qazana-add-new-section",onCloseButtonClick:function(){this.closeSelectPresets()}})},{"qazana-views/add-section/base":130}],132:[function(e,t,a){var n=e("qazana-views/add-section/base");t.exports=n.extend({className:function(){return n.prototype.className.apply(this,arguments)+" qazana-add-section-inline"},fadeToDeath:function(){var e=this;e.$el.slideUp(function(){e.destroy()})},paste:function(){n.prototype.paste.apply(this,arguments),this.destroy()},onCloseButtonClick:function(){this.fadeToDeath()},onPresetSelected:function(){n.prototype.onPresetSelected.apply(this,arguments),this.destroy()},onAddTemplateButtonClick:function(){n.prototype.onAddTemplateButtonClick.apply(this,arguments),this.destroy()},onDropping:function(){n.prototype.onDropping.apply(this,arguments),this.destroy()}})},{"qazana-views/add-section/base":130}],133:[function(e,t,a){t.exports=Marionette.CompositeView.extend({templateHelpers:function(){return{view:this}},getBehavior:function(e){return this._behaviors[Object.keys(this.behaviors()).indexOf(e)]},initialize:function(){this.collection=this.model.get("elements")},addChildModel:function(e,t){return this.collection.add(e,t,!0)},addChildElement:function(e,t){if(!this.isCollectionFilled()){t=jQuery.extend({trigger:!1,edit:!0,onBeforeAdd:null,onAfterAdd:null},t);var a,n,i=this.getChildType();if(e instanceof Backbone.Model?n=(a=e).get("elType"):(a={id:qazana.helpers.getUniqueID(),elType:i[0],settings:{},elements:[]},e&&jQuery.extend(a,e),n=a.elType),-1===i.indexOf(n))return this.children.last().addChildElement(a,t);t.clone&&(a=this.cloneItem(a)),t.trigger&&qazana.channels.data.trigger(t.trigger.beforeAdd,a),t.onBeforeAdd&&t.onBeforeAdd();var o=this.addChildModel(a,{at:t.at}),s=this.children.findByModel(o);return t.onAfterAdd&&t.onAfterAdd(o,s),t.trigger&&qazana.channels.data.trigger(t.trigger.afterAdd,a),t.edit&&o.trigger("request:edit"),s}},cloneItem:function(e){var t=this;return e instanceof Backbone.Model?e.clone():(e.id=qazana.helpers.getUniqueID(),e.elements.forEach(function(a,n){e.elements[n]=t.cloneItem(a)}),e)},isCollectionFilled:function(){return!1},onChildviewRequestAddNew:function(e){this.addChildElement({},{at:e.$el.index()+1,trigger:{beforeAdd:"element:before:add",afterAdd:"element:after:add"}})},onChildviewRequestPaste:function(e){var t=this;if(!t.isCollectionFilled()){var a=qazana.getStorage("transfer").elements,n=t.collection.indexOf(e.model);qazana.channels.data.trigger("element:before:add",a[0]),a.forEach(function(e){n++,t.addChildElement(e,{at:n,clone:!0})}),qazana.channels.data.trigger("element:after:add",a[0])}}})},{}],134:[function(e,t,a){var n,i=e("qazana-elements/views/section"),o=e("qazana-views/base-container");n=o.extend({childView:i,behaviors:function(){var t={Sortable:{behaviorClass:e("qazana-behaviors/sortable"),elChildType:"section"}};return qazana.hooks.applyFilters("elements/base-section-container/behaviors",t,this)},getSortableOptions:function(){return{handle:"> .qazana-element-overlay .qazana-editor-element-edit",items:"> .qazana-section"}},getChildType:function(){return["section"]},initialize:function(){o.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove reset",this.onCollectionChanged).listenTo(qazana.channels.panelElements,"element:drag:start",this.onPanelElementDragStart).listenTo(qazana.channels.panelElements,"element:drag:end",this.onPanelElementDragEnd)},onCollectionChanged:function(){qazana.saver.setFlagEditorChange(!0)},onPanelElementDragStart:function(){qazana.helpers.disableElementEvents(this.$el.find("iframe"))},onPanelElementDragEnd:function(){qazana.helpers.enableElementEvents(this.$el.find("iframe"))}}),t.exports=n},{"qazana-behaviors/sortable":79,"qazana-elements/views/section":82,"qazana-views/base-container":133}],135:[function(e,t,a){var n;n=Marionette.CompositeView.extend({className:"qazana-panel-controls-stack",classes:{popover:"qazana-controls-popover"},activeTab:null,activeSection:null,templateHelpers:function(){return{elementData:qazana.getElementData(this.model)}},ui:function(){return{tabs:".qazana-panel-navigation-tab",reloadButton:".qazana-update-preview-button"}},events:function(){return{"click @ui.tabs":"onClickTabControl","click @ui.reloadButton":"onReloadButtonClick"}},modelEvents:{destroy:"onModelDestroy"},behaviors:{HandleInnerTabs:{behaviorClass:e("qazana-behaviors/inner-tabs")}},initialize:function(){this.initCollection(),this.listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange)},initCollection:function(){this.collection=new Backbone.Collection(_.values(qazana.mergeControlsSettings(this.getOption("controls"))))},filter:function(e){if(e.get("tab")!==this.activeTab)return!1;if("section"===e.get("type"))return!0;var t=e.get("section");return!t||t===this.activeSection},isVisibleSectionControl:function(e){return this.activeTab===e.get("tab")},activateTab:function(e){this.activeTab=e,this.ui.tabs.removeClass("qazana-active").filter('[data-tab="'+e+'"]').addClass("qazana-active"),this.activateFirstSection()},activateSection:function(e){this.activeSection=e},activateFirstSection:function(){var e=this,t=e.collection.filter(function(t){return"section"===t.get("type")&&e.isVisibleSectionControl(t)});t[0]&&(t.filter(function(t){return e.activeSection===t.get("name")})[0]||e.activateSection(t[0].get("name")))},getChildView:function(e){var t=e.get("type");return qazana.getControlView(t)},handlePopovers:function(){var e,t=this,a=!1;t.removePopovers(),t.children.each(function(n){a&&e.append(n.$el);var i=n.model.get("popover");i&&(i.start&&(a=!0,e=jQuery("<div>",{class:t.classes.popover}),n.$el.before(e),e.append(n.$el)),i.end&&(a=!1))})},removePopovers:function(){this.$el.find("."+this.classes.popover).remove()},openActiveSection:function(){var e=this.activeSection,t=this.children.filter(function(t){return e===t.model.get("name")});t[0]&&t[0].$el.addClass("qazana-open")},onRenderCollection:function(){this.openActiveSection(),this.handlePopovers()},onRenderTemplate:function(){this.activateTab(this.activeTab||this.ui.tabs.eq(0).data("tab"))},onModelDestroy:function(){this.destroy()},onClickTabControl:function(e){e.preventDefault();var t=this.$(e.currentTarget).data("tab");this.activeTab!==t&&(this.activateTab(t),this._renderChildren())},onReloadButtonClick:function(){qazana.reloadPreview()},onDeviceModeChange:function(){this.$el.removeClass("qazana-responsive-switchers-open")},onChildviewControlSectionClicked:function(e){var t=e.$el.hasClass("qazana-open");this.activateSection(t?null:e.model.get("name")),this._renderChildren()},onChildviewResponsiveSwitcherClick:function(e,t){"desktop"===t&&this.$el.toggleClass("qazana-responsive-switchers-open")}}),t.exports=n},{"qazana-behaviors/inner-tabs":77}],136:[function(e,t,a){var n,i=e("qazana-views/base-sections-container"),o=e("qazana-views/add-section/independent");n=i.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-preview"),className:"qazana-inner",childViewContainer:".qazana-section-wrap",behaviors:function(){var t=i.prototype.behaviors.apply(this,arguments),a={contextMenu:{behaviorClass:e("qazana-behaviors/context-menu"),groups:this.getContextMenuGroups()}};return jQuery.extend(t,a)},getContextMenuGroups:function(){var e=function(){return qazana.elements.length>0};return[{name:"paste",actions:[{name:"paste",title:qazana.translate("paste"),callback:this.paste.bind(this),isEnabled:this.isPasteEnabled.bind(this)}]},{name:"content",actions:[{name:"copy_all_content",title:qazana.translate("copy_all_content"),callback:this.copy.bind(this),isEnabled:e},{name:"delete_all_content",title:qazana.translate("delete_all_content"),callback:qazana.clearPage.bind(qazana),isEnabled:e}]}]},copy:function(){qazana.setStorage("transfer",{type:"copy",elementsType:"section",elements:qazana.elements.toJSON({copyHtmlCache:!0})})},paste:function(e){var t,a=this,n=qazana.getStorage("transfer"),i=void 0!==e?e:this.collection.length;qazana.channels.data.trigger("element:before:add",n.elements[0]),"section"===n.elementsType?n.elements.forEach(function(e){a.addChildElement(e,{at:i,edit:!1,clone:!0}),i++}):"column"===n.elementsType?((t=a.addChildElement({allowEmpty:!0},{at:e})).model.unset("allowEmpty"),i=0,n.elements.forEach(function(e){t.addChildElement(e,{at:i,clone:!0}),i++}),t.redefineLayout()):(t=a.addChildElement(null,{at:e}),i=0,n.elements.forEach(function(e){t.addChildElement(e,{at:i,clone:!0}),i++})),qazana.channels.data.trigger("element:after:add",n.elements[0])},isPasteEnabled:function(){return qazana.getStorage("transfer")},onRender:function(){if(qazana.userCan("design")){var e=new o;e.render(),this.$el.append(e.$el)}}}),t.exports=n},{"qazana-behaviors/context-menu":75,"qazana-views/add-section/independent":131,"qazana-views/base-sections-container":134}],137:[function(e,t,a){"use strict";t.exports=function(){function e(e,t,a,n){var i,o,r;if(s[e][t])if(a)if(i=s[e][t],n)for(r=i.length;r--;)(o=i[r]).callback===a&&o.context===n&&i.splice(r,1);else for(r=i.length;r--;)i[r].callback===a&&i.splice(r,1);else s[e][t]=[]}function t(e){for(var t,a,n,i=1,o=e.length;i<o;i++){for(t=e[i],a=i;(n=e[a-1])&&n.priority>t.priority;)e[a]=e[a-1],--a;e[a]=t}return e}function a(e,a,n,i,o){var r={callback:n,priority:i,context:o},l=s[e][a];if(l){var c=!1;if(jQuery.each(l,function(){if(this.callback===n)return c=!0,!1}),c)return;l.push(r),l=t(l)}else l=[r];s[e][a]=l}function n(e,t,a){var n,i,o=s[e][t];if(!o)return"filters"===e&&a[0];if(i=o.length,"filters"===e)for(n=0;n<i;n++)a[0]=o[n].callback.apply(o[n].context,a);else for(n=0;n<i;n++)o[n].callback.apply(o[n].context,a);return"filters"!==e||a[0]}var i,o=Array.prototype.slice,s={actions:{},filters:{}};return i={removeFilter:function(t,a){return"string"==typeof t&&e("filters",t,a),i},applyFilters:function(){var e=o.call(arguments),t=e.shift();return"string"==typeof t?n("filters",t,e):i},addFilter:function(e,t,n,o){return"string"==typeof e&&"function"==typeof t&&a("filters",e,t,n=parseInt(n||10,10),o),i},removeAction:function(t,a){return"string"==typeof t&&e("actions",t,a),i},doAction:function(){var e=o.call(arguments),t=e.shift();return"string"==typeof t&&n("actions",t,e),i},addAction:function(e,t,n,o){return"string"==typeof e&&"function"==typeof t&&a("actions",e,t,n=parseInt(n||10,10),o),i}}}},{}],138:[function(e,t,a){t.exports=new function(){var e={},t=function(t){var a=e[t.which];a&&jQuery.each(a,function(){var e=this;e.isWorthHandling&&!e.isWorthHandling(t)||!e.allowAltKey&&t.altKey||(t.preventDefault(),e.handle(t))})};this.isControlEvent=function(e){return e[qazana.envData.mac?"metaKey":"ctrlKey"]},this.addHotKeyHandler=function(t,a,n){e[t]||(e[t]={}),e[t][a]=n},this.bindListener=function(e){e.on("keydown",t)}}},{}],139:[function(e,t,a){var n=e("./view-module");t.exports=n.extend({getDefaultSettings:function(){return{container:null,items:null,columnsCount:3,verticalSpaceBetween:30}},getDefaultElements:function(){return{$container:jQuery(this.getSettings("container")),$items:jQuery(this.getSettings("items"))}},run:function(){var e=[],t=this.elements.$container.position().top,a=this.getSettings(),n=a.columnsCount;t+=parseInt(this.elements.$container.css("margin-top"),10),this.elements.$items.each(function(i){var o=Math.floor(i/n),s=jQuery(this),r=s[0].getBoundingClientRect().height+a.verticalSpaceBetween;if(o){var l=s.position(),c=i%n,d=l.top-t-e[c];d-=parseInt(s.css("margin-top"),10),d*=-1,s.css("margin-top",d+"px"),e[c]+=r}else e.push(r)})}})},{"./view-module":141}],140:[function(e,t,a){var n=function(){var e,t=jQuery,a=arguments,n=this,i={},o=function(){t.each(n,function(e){var t=n[e];"function"==typeof t&&(n[e]=function(){return t.apply(n,arguments)})})},s=function(){e=n.getDefaultSettings();var i=a[0];i&&t.extend(e,i)};this.getItems=function(e,t){if(t){var a=t.split("."),n=a.splice(0,1);if(!a.length)return e[n];if(!e[n])return;return this.getItems(e[n],a.join("."))}return e},this.getSettings=function(t){return this.getItems(e,t)},this.setSettings=function(a,i,o){if(o||(o=e),"object"==typeof a)return t.extend(o,a),n;var s=a.split("."),r=s.splice(0,1);return s.length?(o[r]||(o[r]={}),n.setSettings(s.join("."),i,o[r])):(o[r]=i,n)},this.forceMethodImplementation=function(e){var t=e.callee.name;throw new ReferenceError("The method "+t+" must to be implemented in the inheritor child.")},this.on=function(e,a){return"object"==typeof e?(t.each(e,function(e){n.on(e,this)}),n):(e.split(" ").forEach(function(e){i[e]||(i[e]=[]),i[e].push(a)}),n)},this.off=function(e,t){if(!i[e])return n;if(!t)return delete i[e],n;var a=i[e].indexOf(t);return-1!==a&&delete i[e][a],n},this.trigger=function(e){var a="on"+e[0].toUpperCase()+e.slice(1),o=Array.prototype.slice.call(arguments,1);n[a]&&n[a].apply(n,o);var s=i[e];return s?(t.each(s,function(e,t){t.apply(n,o)}),n):n},this.getDeviceName=function(){return jQuery("body").hasClass("mobile")?"mobile":jQuery("body").hasClass("tablet")?"tablet":""},n.__construct.apply(n,a),o(),s(),n.trigger("init")};n.prototype.__construct=function(){},n.prototype.getDefaultSettings=function(){return{}},n.extendsCount=0,n.extend=function(e){var t=jQuery,a=this,i=function(){return a.apply(this,arguments)};t.extend(i,a),(i.prototype=Object.create(t.extend({},a.prototype,e))).constructor=i;var o=++n.extendsCount;return i.prototype.getConstructorID=function(){return o},i.__super__=a.prototype,i},t.exports=n},{}],141:[function(e,t,a){var n;n=e("qazana-utils/module").extend({elements:null,getDefaultElements:function(){return{}},bindEvents:function(){},onInit:function(){this.initElements(),this.bindEvents()},initElements:function(){this.elements=this.getDefaultElements()}}),t.exports=n},{"qazana-utils/module":140}],142:[function(e,t,a){t.exports=Marionette.Behavior.extend({listenerAttached:!1,onBeforeRender:function(){this.view.collection&&!this.listenerAttached&&(this.view.collection.on("update",this.saveCollectionHistory,this).on("reset",this.onDeleteAllContent,this),this.listenerAttached=!0)},onDeleteAllContent:function(e,t){if(qazana.history.history.getActive()){var a=[];_.each(t.previousModels,function(e){a.push(e.toJSON({copyHtmlCache:!0}))});var n={type:"remove",elementType:"section",title:qazana.translate("all_content"),history:{behavior:this,collection:t.previousModels,event:t,models:a}};qazana.history.history.addItem(n)}},saveCollectionHistory:function(e,t){if(qazana.history.history.getActive()){var a,n,i,o;t.add?(i=(n=t.changes.added)[0],o="add"):(i=(n=t.changes.removed)[0],o="remove");var s=qazana.history.history.getModelLabel(i);if(s){var r=[];_.each(n,function(e){r.push(e.toJSON({copyHtmlCache:!0}))}),a={type:o,elementType:i.get("elType"),elementID:i.get("id"),title:s,history:{behavior:this,collection:e,event:t,models:r}},qazana.history.history.addItem(a)}}},add:function(e,t,a){"section"===e[0].elType&&_.each(e,function(e){e.allowEmpty=!0}),t.addChildModel(e,{at:a,silent:0})},remove:function(e,t){t.remove(e,{silent:0})},restore:function(e,t){var a,n=e.get("type"),i=e.get("history"),o=!1;if(i.behavior.view.model){var s=i.behavior.view.model.get("id"),r=qazana.history.history.findView(s);r&&(a=r.getBehavior("CollectionHistory"))}switch(a||(a=i.behavior),a.view.collection.off("update",a.saveCollectionHistory),n){case"add":t?this.add(i.models,a.view,i.event.index):this.remove(i.models,a.view.collection),o=!0;break;case"remove":t?this.remove(i.models,a.view.collection):this.add(i.models,a.view,i.event.index),o=!0}return a.view.collection.on("update",a.saveCollectionHistory,i.behavior),o}})},{}],143:[function(e,t,a){var n=e("./item");t.exports=Backbone.Collection.extend({model:n})},{"./item":146}],144:[function(e,t,a){t.exports=Marionette.Behavior.extend({oldValues:[],listenerAttached:!1,initialize:function(){this.lazySaveTextHistory=_.debounce(this.saveTextHistory.bind(this),800)},onBeforeRender:function(){this.listenerAttached||(this.listenTo(this.view.getEditModel().get("settings"),"change",this.saveHistory),this.listenerAttached=!0)},saveTextHistory:function(e,t,a){var n,i={},o=e.get(a.name);n=o instanceof Backbone.Collection?o.toJSON():o,i[a.name]={old:this.oldValues[a.name],new:n};var s={type:"change",elementType:"control",title:qazana.history.history.getModelLabel(e),subTitle:a.label,history:{behavior:this,changed:i,model:this.view.getEditModel().toJSON()}};qazana.history.history.addItem(s),delete this.oldValues[a.name]},saveHistory:function(e,t){if(qazana.history.history.getActive()){var a=this,n=Object.keys(e.changed),i=e.controls[n[0]];if(!i&&t&&t.control&&(i=t.control),n.length&&i){if(1===n.length)return _.isUndefined(a.oldValues[i.name])&&(a.oldValues[i.name]=e.previous(i.name)),void(qazana.history.history.isItemStarted()?a.saveTextHistory(e,n,i):a.lazySaveTextHistory(e,n,i));var o={};_.each(n,function(t){o[t]={old:e.previous(t),new:e.get(t)}});var s={type:"change",elementType:"control",title:qazana.history.history.getModelLabel(e),history:{behavior:this,changed:o,model:this.view.getEditModel().toJSON()}};1===n.length&&(s.subTitle=i.label),qazana.history.history.addItem(s)}}},restore:function(e,t){var a=e.get("history"),n=a.model.id,i=qazana.history.history.findView(n);if(i){var o=(i.getEditModel?i.getEditModel():i.model).get("settings"),s=i.getBehavior("ElementHistory");s.stopListening(o,"change",this.saveHistory);var r={};_.each(a.changed,function(e,a){r[a]=t?e.new:e.old}),o.setExternalChange(r),e.set("status",t?"not_applied":"applied"),s.listenTo(o,"change",this.saveHistory)}}})},{}],145:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-history-no-items",id:"qazana-panel-history-no-items",className:"qazana-panel-nerd-box"})},{}],146:[function(e,t,a){t.exports=Backbone.Model.extend({defaults:{id:0,type:"",elementType:"",status:"not_applied",title:"",subTitle:"",action:"",history:{}},initialize:function(){this.set("items",new Backbone.Collection)}})},{}],147:[function(e,t,a){var n=e("./collection"),i=e("./item"),o=e("./element-behavior"),s=e("./collection-behavior");t.exports=new function(){var e=this,t=null,a=new n,r=!1,l=!0,c={add:qazana.translate("added"),remove:qazana.translate("removed"),change:qazana.translate("edited"),move:qazana.translate("moved"),paste_style:qazana.translate("style_pasted"),reset_style:qazana.translate("style_reset")},d=function(e){return e.ElementHistory={behaviorClass:o},e.CollectionHistory={behaviorClass:s},e},u=function(e){return e.CollectionHistory={behaviorClass:s},e},h=function(e){return c[e.type]?c[e.type]:e.type},g=function(t){var n=a.find(function(e){return"not_applied"===e.get("status")}),i=a.indexOf(n),o=t?i-1:i+1;!t&&!n||o<0||o>=a.length||e.doItem(o)},p=function(){qazana.hotKeys.addHotKeyHandler(72,"showHistoryPage",{isWorthHandling:function(e){return qazana.hotKeys.isControlEvent(e)&&e.shiftKey},handle:function(){qazana.getPanelView().setPage("historyPage")}});var e=function(e){return a.length&&qazana.hotKeys.isControlEvent(e)&&!jQuery(e.target).is("input, textarea, [contenteditable=true]")};qazana.hotKeys.addHotKeyHandler(89,"historyNavigationRedo",{isWorthHandling:e,handle:function(e){g(!0)}}),qazana.hotKeys.addHotKeyHandler(90,"historyNavigation",{isWorthHandling:e,handle:function(e){g(e.shiftKey)}})},m=function(){if(a.length>=2){var e=a.at(a.length-2);r="not_applied"===e.get("status")}};this.setActive=function(e){l=e},this.getActive=function(){return l},this.getItems=function(){return a},this.startItem=function(e){t=this.addItem(e)},this.endItem=function(){t=null},this.isItemStarted=function(){return null!==t},this.addItem=function(n){if(this.getActive()){for(a.length||a.add({status:"not_applied",title:qazana.translate("editing_started"),subTitle:"",action:"",editing_started:!0});a.length&&"applied"===a.first().get("status");)a.shift();var o=t||(new Date).getTime(),s=a.findWhere({id:o});s||(s=new i({id:o,title:n.title,subTitle:n.subTitle,action:h(n),type:n.type,elementType:n.elementType}),e.startItemTitle="",e.startItemAction="");var r=0;"column"===n.elementType&&"remove"===n.type&&"column"===s.get("elementType")&&(r=1),s.get("items").add(n,{at:r}),a.add(s,{at:0});var l=qazana.getPanelView();return"historyPage"===l.getCurrentPageName()&&l.getCurrentPageView().render(),o}},this.doItem=function(t){this.setActive(!1);var n=a.at(t);"not_applied"===n.get("status")?this.undoItem(t):this.redoItem(t),this.setActive(!0);var i,o=qazana.getPanelView(),s=o.getCurrentPageView();if("editor"===o.getCurrentPageName())s.getOption("editedElementView").isDestroyed?o.setPage("historyPage"):i=s.getOption("editedElementView");else if("historyPage"===o.getCurrentPageName()&&s.render(),n instanceof Backbone.Model&&n.get("items").length){var l=n.get("items").first().get("history").behavior.view;l.model&&(i=e.findView(l.model.get("id")))}i&&!qazana.helpers.isInViewport(i.$el[0],qazana.$previewContents.find("html")[0])&&qazana.helpers.scrollToView(i),n.get("editing_started")&&(r||qazana.saver.setFlagEditorChange(!1))},this.undoItem=function(e){for(var t,n=0;n<e;n++)"not_applied"===(t=a.at(n)).get("status")&&(t.get("items").each(function(e){var t=e.get("history");t&&t.behavior.restore(e)}),t.set("status","applied"))},this.redoItem=function(e){for(var t=a.length-1;t>=e;t--){var n=a.at(t);if("applied"===n.get("status")){var i=_.toArray(n.get("items").models).reverse();_(i).each(function(e){var t=e.get("history");t&&t.behavior.restore(e,!0)}),n.set("status","not_applied")}}},this.getModelLabel=function(e){return e instanceof Backbone.Model||(e=new Backbone.Model(e)),qazana.getElementData(e).title},this.findView=function(e,t){var a=this,n=!1;return t||(t=qazana.getPreviewView().children),_.each(t._views,function(t){if(!n){var i=t.getEditModel?t.getEditModel():t.model;e===i.get("id")?n=t:t.children&&t.children.length&&(n=a.findView(e,t.children))}}),n},this.startMovingItem=function(t){qazana.history.history.startItem({type:"move",title:e.getModelLabel(t),elementType:t.elType||t.get("elType")})},this.startInsertTemplate=function(e){qazana.history.history.startItem({type:"add",title:qazana.translate("template"),subTitle:e.get("title"),elementType:"template"})},this.startDropElement=function(){var t=qazana.channels.panelElements.request("element:selected");qazana.history.history.startItem({type:"add",title:e.getModelLabel(t.model),elementType:t.model.get("widgetType")||t.model.get("elType")})},this.startAddElement=function(t){qazana.history.history.startItem({type:"add",title:e.getModelLabel(t),elementType:t.elType})},this.startPasteStyle=function(t){qazana.history.history.startItem({type:"paste_style",title:e.getModelLabel(t),elementType:t.get("elType")})},this.startResetStyle=function(t){qazana.history.history.startItem({type:"reset_style",title:e.getModelLabel(t),elementType:t.get("elType")})},this.startRemoveElement=function(t){qazana.history.history.startItem({type:"remove",title:e.getModelLabel(t),elementType:t.get("elType")})},p(),qazana.hooks.addFilter("elements/base/behaviors",d),qazana.hooks.addFilter("elements/base-section-container/behaviors",u),qazana.channels.data.on("drag:before:update",e.startMovingItem).on("drag:after:update",e.endItem).on("element:before:add",e.startAddElement).on("element:after:add",e.endItem).on("element:before:remove",e.startRemoveElement).on("element:after:remove",e.endItem).on("element:before:paste:style",e.startPasteStyle).on("element:after:paste:style",e.endItem).on("element:before:reset:style",e.startResetStyle).on("element:after:reset:style",e.endItem).on("section:before:drop",e.startDropElement).on("section:after:drop",e.endItem).on("template:before:insert",e.startInsertTemplate).on("template:after:insert",e.endItem),qazana.channels.editor.on("saved",m)}},{"./collection":143,"./collection-behavior":142,"./element-behavior":144,"./item":146}],148:[function(e,t,a){t.exports=Marionette.CompositeView.extend({id:"qazana-panel-history",template:"#tmpl-qazana-panel-history-tab",childView:Marionette.ItemView.extend({template:"#tmpl-qazana-panel-history-item",ui:{item:".qazana-history-item"},triggers:{"click @ui.item":"item:click"}}),childViewContainer:"#qazana-history-list",currentItem:null,onRender:function(){var e=this;_.defer(function(){if(e.children.length){var t=e.collection.find(function(e){return"not_applied"===e.get("status")}),a=e.children.findByModel(t);e.updateCurrentItem(a.$el)}})},updateCurrentItem:function(e){this.currentItem&&this.currentItem.removeClass("qazana-history-item-current"),this.currentItem=e,this.currentItem.addClass("qazana-history-item-current")},onChildviewItemClick:function(e,t){if(e.$el!==this.currentItem){var a=t.model.collection.findIndex(t.model);qazana.history.history.doItem(a),this.updateCurrentItem(e.$el),this.isDestroyed||this.render()}}})},{}],149:[function(e,t,a){var n,i=e("./panel-page");n=function(){var t=this,a=function(){qazana.getPanelView().addPage("historyPage",{view:i,title:qazana.translate("history")})};jQuery(window).on("qazana:init",function(){qazana.on("preview:loaded",a),t.history=e("./history/manager"),t.revisions=e("./revisions/manager"),t.revisions.init()})},t.exports=new n},{"./history/manager":147,"./panel-page":150,"./revisions/manager":153}],150:[function(e,t,a){var n=e("./history/panel-tab"),i=e("./history/empty"),o=e("./revisions/panel-tab"),s=e("./revisions/empty");t.exports=Marionette.LayoutView.extend({template:"#tmpl-qazana-panel-history-page",regions:{content:"#qazana-panel-history-content"},ui:{tabs:".qazana-panel-navigation-tab"},events:{"click @ui.tabs":"onTabClick"},regionViews:{},currentTab:null,initialize:function(){this.initRegionViews()},initRegionViews:function(){var e=qazana.history.history.getItems(),t=qazana.history.revisions.getItems();this.regionViews={history:{region:this.content,view:function(){return e.length?n:i},options:{collection:e}},revisions:{region:this.content,view:function(){return t.length?o:s},options:{collection:t}}}},activateTab:function(e){this.ui.tabs.removeClass("qazana-active").filter('[data-view="'+e+'"]').addClass("qazana-active"),this.showView(e)},getCurrentTab:function(){return this.currentTab},showView:function(e){var t=this.regionViews[e],a=t.options||{},n=t.view;"function"==typeof n&&(n=t.view()),a.viewName=e,this.currentTab=new n(a),t.region.show(this.currentTab)},onRender:function(){this.showView("history")},onTabClick:function(e){this.activateTab(e.currentTarget.dataset.view)},onDestroy:function(){qazana.getPanelView().getFooterView().ui.history.removeClass("qazana-open")}})},{"./history/empty":145,"./history/panel-tab":148,"./revisions/empty":152,"./revisions/panel-tab":155}],151:[function(e,t,a){var n=e("./model");t.exports=Backbone.Collection.extend({model:n,comparator:function(e){return-e.get("timestamp")}})},{"./model":154}],152:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-revisions-no-revisions",id:"qazana-panel-revisions-no-revisions",className:"qazana-panel-nerd-box"})},{}],153:[function(e,t,a){var n,i=e("./collection");n=function(){var e,t=this;this.getItems=function(){return e};var a=function(a){if(a.latest_revisions&&t.addRevisions(a.latest_revisions),a.revisions_ids){var n=e.filter(function(e){return-1!==a.revisions_ids.indexOf(e.get("id"))});e.reset(n)}},n=function(){qazana.channels.editor.on("saved",a)},o=function(){var e={isWorthHandling:function(){var e=qazana.getPanelView();if("historyPage"!==e.getCurrentPageName())return!1;var t=e.getCurrentPageView().getCurrentTab();return t.currentPreviewId&&t.currentPreviewItem&&t.children.length>1},handle:function(e){qazana.getPanelView().getCurrentPageView().getCurrentTab().navigate(38===e.which)}};qazana.hotKeys.addHotKeyHandler(38,"revisionNavigation",e),qazana.hotKeys.addHotKeyHandler(40,"revisionNavigation",e)};this.setEditorData=function(e){var t=qazana.getRegion("sections").currentView.collection;qazana.history.history.setActive(!1),t.reset(e),qazana.history.history.setActive(!0)},this.getRevisionDataAsync=function(e,t){return _.extend(t,{data:{id:e}}),qazana.ajax.send("get_revision_data",t)},this.addRevisions=function(t){t.forEach(function(t){var a=e.findWhere({id:t.id});a&&e.remove(a),e.add(t)})},this.deleteRevision=function(t,a){var n={data:{id:t.get("id")},success:function(){if(a.success&&a.success(),t.destroy(),!e.length){var n=qazana.getPanelView();"historyPage"===n.getCurrentPageName()&&n.getCurrentPageView().activateTab("revisions")}}};a.error&&(n.error=a.error),qazana.ajax.send("delete_revision",n)},this.init=function(){e=new i(qazana.config.revisions),n(),o()}},t.exports=new n},{"./collection":151}],154:[function(e,t,a){var n;(n=Backbone.Model.extend()).prototype.sync=function(){return null},t.exports=n},{}],155:[function(e,t,a){t.exports=Marionette.CompositeView.extend({id:"qazana-panel-revisions",template:"#tmpl-qazana-panel-revisions",childView:e("./view"),childViewContainer:"#qazana-revisions-list",ui:{discard:".qazana-panel-scheme-discard .qazana-button",apply:".qazana-panel-scheme-save .qazana-button"},events:{"click @ui.discard":"onDiscardClick","click @ui.apply":"onApplyClick"},isRevisionApplied:!1,jqueryXhr:null,currentPreviewId:null,currentPreviewItem:null,initialize:function(){this.listenTo(qazana.channels.editor,"saved",this.onEditorSaved),this.currentPreviewId=qazana.config.current_revision_id},getRevisionViewData:function(e){var t=this;this.jqueryXhr=qazana.history.revisions.getRevisionDataAsync(e.model.get("id"),{success:function(a){qazana.history.revisions.setEditorData(a.elements),qazana.settings.page.model.set(a.settings),t.setRevisionsButtonsActive(!0),t.jqueryXhr=null,e.$el.removeClass("qazana-revision-item-loading"),t.enterReviewMode()},error:function(){e.$el.removeClass("qazana-revision-item-loading"),"abort"!==t.jqueryXhr.statusText&&(t.currentPreviewItem=null,t.currentPreviewId=null,alert("An error occurred"))}})},setRevisionsButtonsActive:function(e){this.ui.apply.add(this.ui.discard).prop("disabled",!e)},deleteRevision:function(e){var t=this;e.$el.addClass("qazana-revision-item-loading"),qazana.history.revisions.deleteRevision(e.model,{success:function(){e.model.get("id")===t.currentPreviewId&&t.onDiscardClick(),t.currentPreviewId=null},error:function(){e.$el.removeClass("qazana-revision-item-loading"),alert("An error occurred")}})},enterReviewMode:function(){qazana.changeEditMode("review")},exitReviewMode:function(){qazana.changeEditMode("edit")},navigate:function(e){var t=this.collection.indexOf(this.currentPreviewItem.model),a=e?t-1:t+1;a<0&&(a=this.collection.length-1),a>=this.collection.length&&(a=0),this.children.findByIndex(a).ui.detailsArea.trigger("click")},onEditorSaved:function(){this.exitReviewMode(),this.setRevisionsButtonsActive(!1),this.currentPreviewId=qazana.config.current_revision_id},onApplyClick:function(){qazana.saver.setFlagEditorChange(!0),qazana.saver.saveAutoSave(),this.isRevisionApplied=!0,this.currentPreviewId=null,qazana.history.history.getItems().reset()},onDiscardClick:function(){qazana.history.revisions.setEditorData(qazana.config.data),qazana.saver.setFlagEditorChange(this.isRevisionApplied),this.isRevisionApplied=!1,this.setRevisionsButtonsActive(!1),this.currentPreviewId=null,this.exitReviewMode(),this.currentPreviewItem&&this.currentPreviewItem.$el.removeClass("qazana-revision-current-preview")},onDestroy:function(){this.currentPreviewId&&this.currentPreviewId!==qazana.config.current_revision_id&&this.onDiscardClick()},onRenderCollection:function(){if(this.currentPreviewId){var e=this.collection.findWhere({id:this.currentPreviewId});e&&(this.currentPreviewItem=this.children.findByModelCid(e.cid),this.currentPreviewItem.$el.addClass("qazana-revision-current-preview"))}},onChildviewDetailsAreaClick:function(e){var t=this,a=e.model.get("id");a!==t.currentPreviewId&&(this.jqueryXhr&&this.jqueryXhr.abort(),t.currentPreviewItem&&t.currentPreviewItem.$el.removeClass("qazana-revision-current-preview"),e.$el.addClass("qazana-revision-current-preview qazana-revision-item-loading"),qazana.saver.isEditorChanged()&&null===t.currentPreviewId?qazana.saver.saveEditor({status:"autosave",onSuccess:function(){t.getRevisionViewData(e)}}):t.getRevisionViewData(e),t.currentPreviewItem=e,t.currentPreviewId=a)},onChildviewDeleteClick:function(e){var t=this,a=e.model.get("type");qazana.dialogsManager.createWidget("confirm",{message:qazana.translate("dialog_confirm_delete",[a]),headerMessage:qazana.translate("delete_element",[a]),strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},defaultOption:"confirm",onConfirm:function(){t.deleteRevision(e)}}).show()}})},{"./view":156}],156:[function(e,t,a){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-revisions-revision-item",className:"qazana-revision-item",ui:{detailsArea:".qazana-revision-item__details",deleteButton:".qazana-revision-item__tools-delete"},triggers:{"click @ui.detailsArea":"detailsArea:click","click @ui.deleteButton":"delete:click"}})},{}]},{},[124,125,69]);