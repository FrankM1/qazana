!function(n){var i={};function a(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=n,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=205)}([function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";var i=n(35),a=n(83)(5),o="find",r=!0;o in[]&&Array(1)[o](function(){r=!1}),i(i.P+i.F*r,"Array",{find:function(e,t){return a(this,e,1<arguments.length?t:void 0)}}),n(72)(o)},function(e,t){e=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(e,t){e=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=e)},function(e,t,n){var i=n(33)("wks"),a=n(34),o=n(2).Symbol,r="function"==typeof o;(e.exports=function(e){return i[e]||(i[e]=r&&o[e]||(r?o:a)("Symbol."+e))}).store=i},function(e,t){e=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(10)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(6);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var i=n(23),a=n(65);e.exports=n(7)?function(e,t,n){return i.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){e.exports=!n(20)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(110),a=n(38);e.exports=function(e){return i(a(e))}},function(e,t,n){var f=n(5),m=n(3),v=n(98),y=n(16),z=n(9),q="prototype",w=function(e,t,n){var i,a,o,r=e&w.F,s=e&w.G,l=e&w.S,c=e&w.P,u=e&w.B,d=e&w.W,h=s?m:m[t]||(m[t]={}),p=h[q],g=s?f:l?f[t]:(f[t]||{})[q];for(i in s&&(n=t),n)(a=!r&&g&&void 0!==g[i])&&z(h,i)||(o=(a?g:n)[i],h[i]=s&&"function"!=typeof g[i]?n[i]:u&&a?v(o,f):d&&g[i]==o?function(i){function e(e,t,n){if(this instanceof i){switch(arguments.length){case 0:return new i;case 1:return new i(e);case 2:return new i(e,t)}return new i(e,t,n)}return i.apply(this,arguments)}return e[q]=i[q],e}(o):c&&"function"==typeof o?v(Function.call,o):o,c&&((h.virtual||(h.virtual={}))[i]=o,e&w.R&&p&&!p[i]&&y(p,i,o)))};w.F=1,w.G=2,w.S=4,w.P=8,w.B=16,w.W=32,w.U=64,w.R=128,e.exports=w},function(e,t,n){var i=n(22),a=n(73),o=n(50),r=Object.defineProperty;t.f=n(12)?Object.defineProperty:function(e,t,n){if(i(e),t=o(t,!0),i(n),a)try{return r(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var i=n(15),a=n(30);e.exports=n(12)?function(e,t,n){return i.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var i=n(53)("wks"),a=n(32),o=n(5).Symbol,r="function"==typeof o;(e.exports=function(e){return i[e]||(i[e]=r&&o[e]||(r?o:a)("Symbol."+e))}).store=i},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=e)},function(e,t,n){var i=n(17);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var i=n(8),a=n(67),o=n(62),r=Object.defineProperty;t.f=n(7)?Object.defineProperty:function(e,t,n){if(i(e),t=o(t,!0),i(n),a)try{return r(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var o=n(2),r=n(11),s=n(42),l=n(34)("src"),i=n(71),a="toString",c=(""+i).split(a);n(21).inspectSource=function(e){return i.call(e)},(e.exports=function(e,t,n,i){var a="function"==typeof n;a&&(s(n,"name")||r(n,"name",t)),e[t]!==n&&(a&&(s(n,l)||r(n,l,e[t]?""+e[t]:c.join(String(t)))),e===o?e[t]=n:i?e[t]?e[t]=n:r(e,t,n):(delete e[t],r(e,t,n)))})(Function.prototype,a,function(){return"function"==typeof this&&this[l]||i.call(this)})},function(e,t,n){var i=n(29),a=Math.min;e.exports=function(e){return 0<e?a(i(e),9007199254740991):0}},function(e,t,n){"use strict";var b=n(8),C=n(66),_=n(26),S=n(29),x=n(69),k=n(63),T=Math.max,E=Math.min,P=Math.floor,M=/\$([$&`']|\d\d?|<[^>]*>)/g,V=/\$([$&`']|\d\d?)/g;n(64)("replace",2,function(a,o,q,w){return[function(e,t){var n=a(this),i=null==e?void 0:e[o];return void 0!==i?i.call(e,n,t):q.call(String(n),e,t)},function(e,t){var n=w(q,e,this,t);if(n.done)return n.value;var i=b(e),a=String(this),o="function"==typeof t;o||(t=String(t));var r,s=i.global;s&&(r=i.unicode,i.lastIndex=0);for(var l=[];;){var c=k(i,a);if(null===c)break;if(l.push(c),!s)break;""===String(c[0])&&(i.lastIndex=x(a,_(i.lastIndex),r))}for(var u,d="",h=0,p=0;p<l.length;p++){c=l[p];for(var g=String(c[0]),f=T(E(S(c.index),a.length),0),m=[],v=1;v<c.length;v++)m.push(void 0===(u=c[v])?u:String(u));var y,z=c.groups,z=o?(y=[g].concat(m,f,a),void 0!==z&&y.push(z),String(t.apply(void 0,y))):function(o,r,s,l,c,e){var u=s+o.length,d=l.length,t=V;void 0!==c&&(c=C(c),t=M);return q.call(e,t,function(e,t){var n;switch(t.charAt(0)){case"$":return"$";case"&":return o;case"`":return r.slice(0,s);case"'":return r.slice(u);case"<":n=c[t.slice(1,-1)];break;default:var i=+t;if(0==i)return e;if(d<i){var a=P(i/10);return 0===a?e:a<=d?void 0===l[a-1]?t.charAt(1):l[a-1]+t.charAt(1):e}n=l[i-1]}return void 0===n?"":n})}(g,a,f,m,z,t);h<=f&&(d+=a.slice(h,f)+z,h=f+g.length)}return d+a.slice(h)}]})},function(e,t,n){var i=n(23).f,a=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in a||n(7)&&i(a,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?i:n)(e)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=!0},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,n){var i=n(21),a=n(2),o="__core-js_shared__",r=a[o]||(a[o]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:i.version,mode:n(70)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,n){var g=n(2),f=n(21),m=n(11),v=n(25),y=n(37),z="prototype",q=function(e,t,n){var i,a,o,r=e&q.F,s=e&q.G,l=e&q.S,c=e&q.P,u=e&q.B,d=s?g:l?g[t]||(g[t]={}):(g[t]||{})[z],h=s?f:f[t]||(f[t]={}),p=h[z]||(h[z]={});for(i in s&&(n=t),n)a=((o=!r&&d&&void 0!==d[i])?d:n)[i],o=u&&o?y(a,g):c&&"function"==typeof a?y(Function.call,a):a,d&&v(d,i,a,e&q.U),h[i]!=a&&m(h,i,o),c&&p[i]!=a&&(p[i]=a)};g.core=f,q.F=1,q.G=2,q.S=4,q.P=8,q.B=16,q.W=32,q.U=64,q.R=128,e.exports=q},function(e,t,n){var i=n(76),a=n(54);e.exports=Object.keys||function(e){return i(e,a)}},function(e,t,n){var o=n(49);e.exports=function(i,a,e){if(o(i),void 0===a)return i;switch(e){case 1:return function(e){return i.call(a,e)};case 2:return function(e,t){return i.call(a,e,t)};case 3:return function(e,t,n){return i.call(a,e,t,n)}}return function(){return i.apply(a,arguments)}}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){e.exports=n(148)},function(e,t,n){"use strict";n=n(46).extend({elements:null,getDefaultElements:function(){return{}},bindEvents:function(){},onInit:function(){this.initElements(),this.bindEvents()},initElements:function(){this.elements=this.getDefaultElements()}});e.exports=n},function(e,t,n){"use strict";var i=n(140),a=n(295),o=n(162),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return _.extend(e,{input:'input[data-setting][type!="checkbox"][type!="radio"]',checkbox:'input[data-setting][type="checkbox"]',radio:'input[data-setting][type="radio"]',select:"select[data-setting]",textarea:"textarea[data-setting]",responsiveSwitchers:".qazana-responsive-switcher",contentEditable:'[contenteditable="true"]',tooltipTarget:".tooltip-target"}),e},templateHelpers:function(){var e=i.prototype.templateHelpers.apply(this,arguments);return e.data.controlValue=this.getControlValue(),e},events:function(){return{"input @ui.input":"onBaseInputChange","change @ui.checkbox":"onBaseInputChange","change @ui.radio":"onBaseInputChange","input @ui.textarea":"onBaseInputChange","change @ui.select":"onBaseInputChange","input @ui.contentEditable":"onBaseInputChange","click @ui.responsiveSwitchers":"onResponsiveSwitchersClick"}},behaviors:function(){var e,t={},n=this.options.model.get("dynamic");return n&&n.active&&((e=_.filter(qazana.dynamicTags.getConfig("tags"),function(e){return _.intersection(e.categories,n.categories).length})).length&&(t.tags={behaviorClass:a,tags:e,dynamicSettings:n})),t},initialize:function(){i.prototype.initialize.apply(this,arguments),this.registerValidators(),this.listenTo(this.elementSettingsModel,"change:external:"+this.model.get("name"),this.onAfterExternalChange)},getControlValue:function(){return this.elementSettingsModel.get(this.model.get("name"))},setValue:function(e){this.setSettingsModel(e)},setSettingsModel:function(e){this.elementSettingsModel.set(this.model.get("name"),e),this.triggerMethod("settings:change")},applySavedValue:function(){this.setInputValue('[data-setting="'+this.model.get("name")+'"]',this.getControlValue())},getEditSettings:function(e){var t=this.getOption("elementEditSettings").toJSON();return e?t[e]:t},setEditSetting:function(e,t){this.getOption("elementEditSettings").set(e,t)},getInputValue:function(e){var t=this.$(e);if(t.is('[contenteditable="true"]'))return t.html();var n=t.val(),i=t.attr("type");return-1!==["radio","checkbox"].indexOf(i)?t.prop("checked")?n:"":"number"===i&&_.isFinite(n)?+n:("SELECT"===e.tagName&&t.prop("multiple")&&null===n&&(n=[]),n)},setInputValue:function(e,t){var n=this.$(e),e=n.attr("type");"checkbox"===e?n.prop("checked",!!t):"radio"===e?n.filter('[value="'+t+'"]').prop("checked",!0):n.val(t)},addValidator:function(e){this.validators.push(e)},registerValidators:function(){this.validators=[];var e={};this.model.get("required")&&(e.required=!0),jQuery.isEmptyObject(e)||this.addValidator(new o({validationTerms:e}))},onRender:function(){i.prototype.onRender.apply(this,arguments),this.model.get("responsive")&&this.renderResponsiveSwitchers(),this.applySavedValue(),this.triggerMethod("ready"),this.toggleControlVisibility(),this.addTooltip()},onBaseInputChange:function(e){clearTimeout(this.correctionTimeout);var t=e.currentTarget,n=this.getInputValue(t),i=this.validators.slice(0),a=this.elementSettingsModel.validators[this.model.get("name")];if(a&&(i=i.concat(a)),i){var o=this.getControlValue(t.dataset.setting);if(!i.every(function(e){return e.isValid(n,o)}))return void(this.correctionTimeout=setTimeout(this.setInputValue.bind(this,t,o),1200))}this.updateElementModel(n,t),this.triggerMethod("input:change",e)},onResponsiveSwitchersClick:function(e){e=jQuery(e.currentTarget).data("device");qazana.changeDeviceMode(e),this.triggerMethod("responsive:switcher:click",e)},renderResponsiveSwitchers:function(){var e=Marionette.Renderer.render("#tmpl-qazana-control-responsive-switchers",this.model.attributes);this.ui.controlTitle.after(e)},onAfterExternalChange:function(){this.hideTooltip(),this.applySavedValue()},addTooltip:function(){this.ui.tooltipTarget&&this.ui.tooltipTarget.tipsy({gravity:function(){var e=jQuery(this).data("tooltip-pos");return void 0!==e?e:"n"},title:function(){return this.getAttribute("data-tooltip")}})},hideTooltip:function(){this.ui.tooltipTarget&&this.ui.tooltipTarget.tipsy("hide")},updateElementModel:function(e){this.setValue(e)}},{getStyleValue:function(e,t){return t},onPasteStyle:function(){return!0}});e.exports=n},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){function i(){}var a=n(22),o=n(109),r=n(54),s=n(52)("IE_PROTO"),l="prototype",c=function(){var e=n(74)("iframe"),t=r.length;for(e.style.display="none",n(114).appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;t--;)delete c[l][r[t]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(i[l]=a(e),n=new i,i[l]=null,n[s]=e):n=c(),void 0===t?n:o(n,t)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){"use strict";var d=n(103),v=n(8),y=n(135),z=n(69),q=n(26),w=n(63),h=n(48),i=n(10),b=Math.min,p=[].push,r="split",C="length",_="lastIndex",S=4294967295,x=!i(function(){RegExp(S,"y")});n(64)("split",2,function(a,o,g,f){var m="c"=="abbc"[r](/(b)*/)[1]||4!="test"[r](/(?:)/,-1)[C]||2!="ab"[r](/(?:ab)*/)[C]||4!="."[r](/(.?)(.?)/)[C]||1<"."[r](/()()/)[C]||""[r](/.?/)[C]?function(e,t){var n=String(this);if(void 0===e&&0===t)return[];if(!d(e))return g.call(n,e,t);for(var i,a,o,r=[],s=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,c=void 0===t?S:t>>>0,u=new RegExp(e.source,s+"g");(i=h.call(u,n))&&!(l<(a=u[_])&&(r.push(n.slice(l,i.index)),1<i[C]&&i.index<n[C]&&p.apply(r,i.slice(1)),o=i[0][C],l=a,r[C]>=c));)u[_]===i.index&&u[_]++;return l===n[C]?!o&&u.test("")||r.push(""):r.push(n.slice(l)),r[C]>c?r.slice(0,c):r}:"0"[r](void 0,0)[C]?function(e,t){return void 0===e&&0===t?[]:g.call(this,e,t)}:g;return[function(e,t){var n=a(this),i=null==e?void 0:e[o];return void 0!==i?i.call(e,n,t):m.call(String(n),e,t)},function(e,t){var n=f(m,e,this,t,m!==g);if(n.done)return n.value;var i=v(e),a=String(this),n=y(i,RegExp),o=i.unicode,e=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(x?"y":"g"),r=new n(x?i:"^(?:"+i.source+")",e),s=void 0===t?S:t>>>0;if(0==s)return[];if(0===a.length)return null===w(r,a)?[a]:[];for(var l=0,c=0,u=[];c<a.length;){r.lastIndex=x?c:0;var d,h=w(r,x?a:a.slice(c));if(null===h||(d=b(q(r.lastIndex+(x?0:c)),a.length))===l)c=z(a,c,o);else{if(u.push(a.slice(l,c)),u.length===s)return u;for(var p=1;p<=h.length-1;p++)if(u.push(h[p]),u.length===s)return u;c=l=d}}return u.push(a.slice(l)),u}]})},function(e,t,n){"use strict";var i=n(0),o=i(n(94));n(28);var s=i(n(60));n(45);function r(){var a,o=jQuery,t=arguments,r=this,i={};this.getItems=function(e,t){if(t){var n=t.split("."),t=n.splice(0,1);return n.length?e[t]?this.getItems(e[t],n.join(".")):void 0:e[t]}return e},this.getSettings=function(e){return this.getItems(a,e)},this.setSettings=function(e,t,n){if(n=n||a,"object"===(0,s.default)(e))return o.extend(n,e),r;var i=e.split("."),e=i.splice(0,1);return i.length?(n[e]||(n[e]={}),r.setSettings(i.join("."),t,n[e])):(n[e]=t,r)},this.forceMethodImplementation=function(e){e=e.callee.name;throw new ReferenceError("The method "+e+" must to be implemented in the inheritor child.")},this.on=function(e,t){return"object"===(0,s.default)(e)?o.each(e,function(e){r.on(e,this)}):e.split(" ").forEach(function(e){i[e]||(i[e]=[]),i[e].push(t)}),r},this.off=function(e,t){if(!i[e])return r;if(!t)return delete i[e],r;t=i[e].indexOf(t);return-1!==t&&delete i[e][t],r},this.trigger=function(e){var t="on"+e[0].toUpperCase()+e.slice(1),n=Array.prototype.slice.call(arguments,1);r[t]&&r[t].apply(r,n);e=i[e];return e&&o.each(e,function(e,t){t.apply(r,n)}),r},this.getDeviceName=function(){return jQuery("body").data("qazana-device-mode")},r.__construct.apply(r,t),o.each(r,function(e){var t=r[e];"function"==typeof t&&(r[e]=function(){return t.apply(r,arguments)})}),function(){a=r.getDefaultSettings();var e=t[0];e&&o.extend(a,e)}(),r.trigger("init")}r.prototype.__construct=function(){},r.prototype.getDefaultSettings=function(){return{}},r.extendsCount=0,r.extend=function(e){function t(){return i.apply(this,arguments)}var n=jQuery,i=this;n.extend(t,i),(t.prototype=(0,o.default)(n.extend({},i.prototype,e))).constructor=t;var a=++r.extendsCount;return t.prototype.getConstructorID=function(){return a},t.__super__=i.prototype,t},e.exports=r},function(e,t,n){"use strict";var u=n(8),d=n(26),h=n(69),p=n(63);n(64)("match",1,function(i,a,l,c){return[function(e){var t=i(this),n=null==e?void 0:e[a];return void 0!==n?n.call(e,t):new RegExp(e)[a](String(t))},function(e){var t=c(l,e,this);if(t.done)return t.value;var n=u(e),i=String(this);if(!n.global)return p(n,i);for(var a=n.unicode,o=[],r=n.lastIndex=0;null!==(s=p(n,i));){var s=String(s[0]);""===(o[r]=s)&&(n.lastIndex=h(i,d(n.lastIndex),a)),r++}return 0===r?null:o}]})},function(e,t,n){"use strict";var i,r=n(82),s=RegExp.prototype.exec,l=String.prototype.replace,a=s,c="lastIndex",u=(i=/a/,n=/b*/g,s.call(i,"a"),s.call(n,"a"),0!==i[c]||0!==n[c]),d=void 0!==/()??/.exec("")[1];(u||d)&&(a=function(e){var t,n,i,a,o=this;return d&&(n=new RegExp("^"+o.source+"$(?!\\s)",r.call(o))),u&&(t=o[c]),i=s.call(o,e),u&&i&&(o[c]=o.global?i.index+i[0].length:t),d&&i&&1<i.length&&l.call(i[0],n,function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)}),i}),e.exports=a},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var a=n(17);e.exports=function(e,t){if(!a(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!a(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!a(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!a(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?i:n)(e)}},function(e,t,n){var i=n(53)("keys"),a=n(32);e.exports=function(e){return i[e]||(i[e]=a(e))}},function(e,t,n){var i=n(3),a=n(5),o="__core-js_shared__",r=a[o]||(a[o]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:i.version,mode:n(31)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){e.exports={}},function(e,t,n){var i=n(15).f,a=n(9),o=n(18)("toStringTag");e.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,o)&&i(e,o,{configurable:!0,value:t})}},function(e,t,n){t.f=n(18)},function(e,t,n){var i=n(5),a=n(3),o=n(31),r=n(57),s=n(15).f;e.exports=function(e){var t=a.Symbol||(a.Symbol=!o&&i.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:r.f(e)})}},function(e,t,n){"use strict";var i=n(97),a={};a[n(4)("toStringTag")]="z",a+""!="[object z]"&&n(25)(Object.prototype,"toString",function(){return"[object "+i(this)+"]"},!0)},function(t,e,n){var i=n(117),a=n(126);function o(e){return t.exports=o="function"==typeof a&&"symbol"==typeof i?function(e){return typeof e}:function(e){return e&&"function"==typeof a&&e.constructor===a&&e!==a.prototype?"symbol":typeof e},o(e)}t.exports=o},function(e,t,n){var i=n(38);e.exports=function(e){return Object(i(e))}},function(e,t,n){var a=n(6);e.exports=function(e,t){if(!a(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!a(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!a(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!a(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){"use strict";var i=n(97),a=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){n=n.call(e,t);if("object"!=typeof n)throw new TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==i(e))throw new TypeError("RegExp#exec called on incompatible receiver");return a.call(e,t)}},function(e,t,n){"use strict";n(107);var l=n(25),c=n(11),u=n(10),d=n(24),h=n(4),p=n(48),g=h("species"),f=!u(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),m=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};e="ab".split(e);return 2===e.length&&"a"===e[0]&&"b"===e[1]}();e.exports=function(n,e,t){var o,i,a=h(n),r=!u(function(){var e={};return e[a]=function(){return 7},7!=""[n](e)}),s=r?!u(function(){var e=!1,t=/a/;return t.exec=function(){return e=!0,null},"split"===n&&(t.constructor={},t.constructor[g]=function(){return t}),t[a](""),!e}):void 0;r&&s&&("replace"!==n||f)&&("split"!==n||m)||(o=/./[a],t=(s=t(d,a,""[n],function(e,t,n,i,a){return t.exec===p?r&&!a?{done:!0,value:o.call(t,n,i)}:{done:!0,value:e.call(n,t,i)}:{done:!1}}))[0],i=s[1],l(String.prototype,n,t),c(RegExp.prototype,a,2==e?function(e,t){return i.call(e,this,t)}:function(e){return i.call(e,this)}))}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var i=n(24);e.exports=function(e){return Object(i(e))}},function(e,t,n){e.exports=!n(7)&&!n(10)(function(){return 7!=Object.defineProperty(n(68)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(6),a=n(2).document,o=i(a)&&i(a.createElement);e.exports=function(e){return o?a.createElement(e):{}}},function(e,t,n){"use strict";var i=n(106)(!0);e.exports=function(e,t,n){return t+(n?i(e,t).length:1)}},function(e,t){e.exports=!1},function(e,t,n){e.exports=n(33)("native-function-to-string",Function.toString)},function(e,t,n){var i=n(4)("unscopables"),a=Array.prototype;null==a[i]&&n(11)(a,i,{}),e.exports=function(e){a[i][e]=!0}},function(e,t,n){e.exports=!n(12)&&!n(20)(function(){return 7!=Object.defineProperty(n(74)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(17),a=n(5).document,o=i(a)&&i(a.createElement);e.exports=function(e){return o?a.createElement(e):{}}},function(e,t,n){"use strict";n(214);function i(e){n(25)(RegExp.prototype,s,e,!0)}var a=n(8),o=n(82),r=n(7),s="toString",l=/./[s];n(10)(function(){return"/a/b"!=l.call({source:"a",flags:"b"})})?i(function(){var e=a(this);return"/".concat(e.source,"/","flags"in e?e.flags:!r&&e instanceof RegExp?o.call(e):void 0)}):l.name!=s&&i(function(){return l.call(this)})},function(e,t,n){var r=n(9),s=n(13),l=n(111)(!1),c=n(52)("IE_PROTO");e.exports=function(e,t){var n,i=s(e),a=0,o=[];for(n in i)n!=c&&r(i,n)&&o.push(n);for(;t.length>a;)r(i,n=t[a++])&&(~l(o,n)||o.push(n));return o}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){"use strict";function y(){return this}var z=n(31),q=n(14),w=n(79),b=n(16),C=n(55),_=n(121),S=n(56),x=n(95),k=n(18)("iterator"),T=!([].keys&&"next"in[].keys()),E="values";e.exports=function(e,t,n,i,a,o,r){_(n,t,i);function s(e){if(!T&&e in g)return g[e];switch(e){case"keys":case E:return function(){return new n(this,e)}}return function(){return new n(this,e)}}var l,c,u,d=t+" Iterator",h=a==E,p=!1,g=e.prototype,f=g[k]||g["@@iterator"]||a&&g[a],m=f||s(a),v=a?h?s("entries"):m:void 0,i="Array"==t&&g.entries||f;if(i&&(u=x(i.call(new e)))!==Object.prototype&&u.next&&(S(u,d,!0),z||"function"==typeof u[k]||b(u,k,y)),h&&f&&f.name!==E&&(p=!0,m=function(){return f.call(this)}),z&&!r||!T&&!p&&g[k]||b(g,k,m),C[t]=m,C[d]=y,a)if(l={values:h?m:s(E),keys:o?m:s("keys"),entries:v},r)for(c in l)c in g||w(g,c,l[c]);else q(q.P+q.F*(T||p),t,l);return l}},function(e,t,n){e.exports=n(16)},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var i=n(76),a=n(54).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,a)}},function(e,t,n){"use strict";var i=n(8);e.exports=function(){var e=i(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var z=n(37),q=n(84),w=n(66),b=n(26),i=n(88);e.exports=function(d,e){var h=1==d,p=2==d,g=3==d,f=4==d,m=6==d,v=5==d||m,y=e||i;return function(e,t,n){for(var i,a,o=w(e),r=q(o),s=z(t,n,3),l=b(r.length),c=0,u=h?y(e,l):p?y(e,0):void 0;c<l;c++)if((v||c in r)&&(a=s(i=r[c],c,o),d))if(h)u[c]=a;else if(a)switch(d){case 3:return!0;case 5:return i;case 6:return c;case 2:u.push(i)}else if(f)return!1;return m?-1:g||f?f:u}}},function(e,t,n){var i=n(19);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t,n){e.exports=n(211)},function(e,t,n){var i=n(44),a=n(30),o=n(13),r=n(50),s=n(9),l=n(73),c=Object.getOwnPropertyDescriptor;t.f=n(12)?c:function(e,t){if(e=o(e),t=r(t,!0),l)try{return c(e,t)}catch(e){}if(s(e,t))return a(!i.f.call(e,t),e[t])}},,function(e,t,n){var i=n(89);e.exports=function(e,t){return new(i(e))(t)}},function(e,t,n){var i=n(6),a=n(90),o=n(4)("species");e.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),i(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var i=n(19);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){var a=n(85);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),a(e,i.key,i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}},function(e,t,n){e.exports=n(115)},function(e,t,n){var i=n(9),a=n(61),o=n(52)("IE_PROTO"),r=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),i(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?r:null}},function(t,e,n){var i=n(171),a=n(170);function o(e){return t.exports=o=a?i:function(e){return e.__proto__||i(e)},o(e)}t.exports=o},function(e,t,n){var i=n(19),a=n(4)("toStringTag"),o="Arguments"==i(function(){return arguments}());e.exports=function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(e=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?e:o?i(t):"Object"==(e=i(t))&&"function"==typeof t.callee?"Arguments":e}},function(e,t,n){var o=n(91);e.exports=function(i,a,e){if(o(i),void 0===a)return i;switch(e){case 1:return function(e){return i.call(a,e)};case 2:return function(e,t){return i.call(a,e,t)};case 3:return function(e,t,n){return i.call(a,e,t,n)}}return function(){return i.apply(a,arguments)}}},function(e,t,n){e.exports=n(215)},function(e,t,n){var i=n(94),a=n(219);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=i(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}},function(e,t,n){var i=n(60),a=n(169);e.exports=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?a(e):t}},function(e,t,n){var i=n(77);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t,n){var i=n(6),a=n(19),o=n(4)("match");e.exports=function(e){var t;return i(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==a(e))}},function(e,t,n){e.exports=n(157)},function(e,t,n){"use strict";var i,a=n(0),r=a(n(39)),s=a(n(60));n(1),n(28),i=Backbone.Model.extend({options:{},initialize:function(e,t){var a,o,r=this;r.options=t,r.controls=qazana.mergeControlsSettings(t.controls),r.validators={},r.controls&&(a=e||{},o={},_.each(r.controls,function(e){var t,n,i;-1!==e.features.indexOf("ui")||(t=e.name,o[t]=e.default,i=(n=e.dynamic&&e.dynamic.active)&&a.__dynamic__&&a.__dynamic__[t],n&&!i&&e.dynamic.default&&(a.__dynamic__||(a.__dynamic__={}),a.__dynamic__[t]=e.dynamic.default,i=!0),e=jQuery.isPlainObject(e.default),void 0===a[t]||!e||_.isObject(a[t])||i||(qazana.debug.addCustomError(new TypeError("An invalid argument supplied as multiple control value"),"InvalidElementData","Element `"+(r.get("widgetType")||r.get("elType"))+"` got <"+a[t]+"> as `"+t+"` value. Expected array or object."),delete a[t]),void 0===a[t]&&(a[t]=o[t]))}),r.defaults=o,r.handleRepeaterData(a),r.set(a))},handleRepeaterData:function(e){_.each(this.controls,function(n){n.is_repeater&&(e[n.name]instanceof Backbone.Collection||(e[n.name]=new Backbone.Collection(e[n.name],{model:function(e,t){return(t=t||{}).controls=n.fields,e._id||(e._id=qazana.helpers.getUniqueID()),new i(e,t)}})))})},getFontControls:function(){return _.filter(this.getActiveControls(),function(e){return"font"===e.type})},getStyleControls:function(i,e){var a=this;i=qazana.helpers.cloneObject(a.getActiveControls(i,e));var o=[];return jQuery.each(i,function(){var t,n=this,e=qazana.config.controls[n.type];(n=jQuery.extend({},e,n)).fields&&(t=[],a.attributes[n.name].each(function(e){t.push(a.getStyleControls(n.fields,e.attributes))}),n.styleFields=t),(n.fields||n.dynamic&&n.dynamic.active||a.isStyleControl(n.name,i))&&o.push(n)}),o},isStyleControl:function(t,e){e=e||this.controls;e=_.find(e,function(e){return t===e.name});return e&&!_.isEmpty(e.selectors)},getClassControls:function(e){return e=e||this.controls,_.filter(e,function(e){return!_.isUndefined(e.prefix_class)})},isClassControl:function(t){var e=_.find(this.controls,function(e){return t===e.name});return e&&!_.isUndefined(e.prefix_class)},getControl:function(t){return _.find(this.controls,function(e){return t===e.name})},getActiveControls:function(e,n){var i={};return e=e||this.controls,n=n||this.attributes,_.each(e,function(e,t){qazana.helpers.isActiveControl(e,n)&&(i[t]=e)}),i},clone:function(){return new i(qazana.helpers.cloneObject(this.attributes),qazana.helpers.cloneObject(this.options))},setExternalChange:function(e,t){var n,i=this;"object"===(0,s.default)(e)?n=e:(n={})[e]=t,i.set(n),jQuery.each(n,function(e,t){i.trigger("change:external:"+e,t)})},parseDynamicSettings:function(a,o,e){var r=this;return a=qazana.helpers.cloneObject(a||r.attributes),o=o||{},e=e||this.controls,jQuery.each(e,function(){var n,i=this;if("repeater"!==i.type){if(n=a.__dynamic__&&a.__dynamic__[i.name]){var t,e=i.dynamic;if(void 0===e&&(e=qazana.config.controls[i.type].dynamic),e&&e.active){try{t=qazana.dynamicTags.parseTagsText(n,e,qazana.dynamicTags.getTagDataContent)}catch(e){if(qazana.dynamicTags.CACHE_KEY_NOT_FOUND_ERROR!==e.message)throw e;t="",o.onServerRequestStart&&o.onServerRequestStart(),qazana.dynamicTags.refreshCacheFromServer(function(){o.onServerRequestEnd&&o.onServerRequestEnd()})}e.property?a[i.name][e.property]=t:a[i.name]=t}}}else(n=a[i.name]).forEach(function(e,t){n[t]=r.parseDynamicSettings(e,o,i.fields)})}),a},toJSON:function(e){var t,o=Backbone.Model.prototype.toJSON.call(this);return e=e||{},delete o.widgetType,delete o.elType,delete o.isInner,_.each(o,function(e,t){e&&e.toJSON&&(o[t]=e.toJSON())}),e.removeDefault&&(t=this.controls,_.each(o,function(e,n){var i=t[n];if(i&&!i.save_default&&("text"!==i.type&&"textarea"!==i.type||!o[n])){if(o[n]&&"object"===(0,s.default)(o[n])){if((0,r.default)(o[n]).length!==(0,r.default)(i.default).length)return;var a=!0;_.each(o[n],function(e,t){if(o[n][t]!==i.default[t])return a=!1}),a&&delete o[n]}o[n]===i.default&&delete o[n]}})),qazana.helpers.cloneObject(o)}}),e.exports=i},function(e,t,n){var r=n(29),s=n(24);e.exports=function(o){return function(e,t){var n,i=String(s(e)),a=r(t),e=i.length;return a<0||e<=a?o?"":void 0:(t=i.charCodeAt(a))<55296||56319<t||a+1===e||(n=i.charCodeAt(a+1))<56320||57343<n?o?i.charAt(a):t:o?i.slice(a,a+2):n-56320+(t-55296<<10)+65536}}},function(e,t,n){"use strict";var i=n(48);n(35)({target:"RegExp",proto:!0,forced:i!==/./.exec},{exec:i})},function(e,t,n){e.exports=n(208)},function(e,t,n){var r=n(15),s=n(22),l=n(36);e.exports=n(12)?Object.defineProperties:function(e,t){s(e);for(var n,i=l(t),a=i.length,o=0;o<a;)r.f(e,n=i[o++],t[n]);return e}},function(e,t,n){var i=n(77);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t,n){var l=n(13),c=n(112),u=n(113);e.exports=function(s){return function(e,t,n){var i,a=l(e),o=c(a.length),r=u(n,o);if(s&&t!=t){for(;r<o;)if((i=a[r++])!=i)return!0}else for(;r<o;r++)if((s||r in a)&&a[r]===t)return s||r||0;return!s&&-1}}},function(e,t,n){var i=n(51),a=Math.min;e.exports=function(e){return 0<e?a(i(e),9007199254740991):0}},function(e,t,n){var i=n(51),a=Math.max,o=Math.min;e.exports=function(e,t){return(e=i(e))<0?a(e+t,0):o(e,t)}},function(e,t,n){n=n(5).document;e.exports=n&&n.documentElement},function(e,t,n){n(116);var i=n(3).Object;e.exports=function(e,t){return i.create(e,t)}},function(e,t,n){var i=n(14);i(i.S,"Object",{create:n(43)})},function(e,t,n){e.exports=n(118)},function(e,t,n){n(119),n(122),e.exports=n(57).f("iterator")},function(e,t,n){"use strict";var i=n(120)(!0);n(78)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e=this._t,t=this._i;return t>=e.length?{value:void 0,done:!0}:(t=i(e,t),this._i+=t.length,{value:t,done:!1})})},function(e,t,n){var r=n(51),s=n(38);e.exports=function(o){return function(e,t){var n,i=String(s(e)),a=r(t),e=i.length;return a<0||e<=a?o?"":void 0:(t=i.charCodeAt(a))<55296||56319<t||a+1===e||(n=i.charCodeAt(a+1))<56320||57343<n?o?i.charAt(a):t:o?i.slice(a,a+2):n-56320+(t-55296<<10)+65536}}},function(e,t,n){"use strict";var i=n(43),a=n(30),o=n(56),r={};n(16)(r,n(18)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=i(r,{next:a(1,n)}),o(e,t+" Iterator")}},function(e,t,n){n(123);for(var i=n(5),a=n(16),o=n(55),r=n(18)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<s.length;l++){var c=s[l],u=i[c],u=u&&u.prototype;u&&!u[r]&&a(u,r,c),o[c]=o.Array}},function(e,t,n){"use strict";var i=n(124),a=n(125),o=n(55),r=n(13);e.exports=n(78)(Array,"Array",function(e,t){this._t=r(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){e.exports=n(127)},function(e,t,n){n(128),n(132),n(133),n(134),e.exports=n(3).Symbol},function(e,t,n){"use strict";function i(e){var t=Q[e]=T(A[B]);return t._k=e,t}function a(e,t){b(e);for(var n,i=q(t=S(t)),a=0,o=i.length;a<o;)Z(e,n=i[a++],t[n]);return e}function o(e){var t=N.call(this,e=x(e,!0));return!(this===U&&l(Q,e)&&!l(H,e))&&(!(t||!l(this,e)||!l(Q,e)||l(this,$)&&this[$][e])||t)}function r(e,t){if(e=S(e),t=x(t,!0),e!==U||!l(Q,t)||l(H,t)){var n=D(e,t);return!n||!l(Q,t)||l(e,$)&&e[$][t]||(n.enumerable=!0),n}}var s=n(5),l=n(9),c=n(12),u=n(14),d=n(79),h=n(129).KEY,p=n(20),g=n(53),f=n(56),m=n(32),v=n(18),y=n(57),z=n(58),q=n(130),w=n(102),b=n(22),C=n(17),_=n(61),S=n(13),x=n(50),k=n(30),T=n(43),E=n(131),P=n(86),M=n(80),V=n(15),I=n(36),D=P.f,R=V.f,O=E.f,A=s.Symbol,j=s.JSON,F=j&&j.stringify,B="prototype",$=v("_hidden"),L=v("toPrimitive"),N={}.propertyIsEnumerable,W=g("symbol-registry"),Q=g("symbols"),H=g("op-symbols"),U=Object[B],G="function"==typeof A&&!!M.f,K=s.QObject,J=!K||!K[B]||!K[B].findChild,X=c&&p(function(){return 7!=T(R({},"a",{get:function(){return R(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=D(U,t);i&&delete U[t],R(e,t,n),i&&e!==U&&R(U,t,i)}:R,Y=G&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},Z=function(e,t,n){return e===U&&Z(H,t,n),b(e),t=x(t,!0),b(n),l(Q,t)?(n.enumerable?(l(e,$)&&e[$][t]&&(e[$][t]=!1),n=T(n,{enumerable:k(0,!1)})):(l(e,$)||R(e,$,k(1,{})),e[$][t]=!0),X(e,t,n)):R(e,t,n)},g=function(e){for(var t,n=O(S(e)),i=[],a=0;n.length>a;)l(Q,t=n[a++])||t==$||t==h||i.push(t);return i},K=function(e){for(var t,n=e===U,i=O(n?H:S(e)),a=[],o=0;i.length>o;)!l(Q,t=i[o++])||n&&!l(U,t)||a.push(Q[t]);return a};G||(d((A=function(e){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var t=m(0<arguments.length?e:void 0),n=function(e){this===U&&n.call(H,e),l(this,$)&&l(this[$],t)&&(this[$][t]=!1),X(this,t,k(1,e))};return c&&J&&X(U,t,{configurable:!0,set:n}),i(t)})[B],"toString",function(){return this._k}),P.f=r,V.f=Z,n(81).f=E.f=g,n(44).f=o,M.f=K,c&&!n(31)&&d(U,"propertyIsEnumerable",o,!0),y.f=function(e){return i(v(e))}),u(u.G+u.W+u.F*!G,{Symbol:A});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)v(ee[te++]);for(var ne=I(v.store),ie=0;ne.length>ie;)z(ne[ie++]);u(u.S+u.F*!G,"Symbol",{for:function(e){return l(W,e+="")?W[e]:W[e]=A(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in W)if(W[t]===e)return t},useSetter:function(){J=!0},useSimple:function(){J=!1}}),u(u.S+u.F*!G,"Object",{create:function(e,t){return void 0===t?T(e):a(T(e),t)},defineProperty:Z,defineProperties:a,getOwnPropertyDescriptor:r,getOwnPropertyNames:g,getOwnPropertySymbols:K});K=p(function(){M.f(1)});u(u.S+u.F*K,"Object",{getOwnPropertySymbols:function(e){return M.f(_(e))}}),j&&u(u.S+u.F*(!G||p(function(){var e=A();return"[null]"!=F([e])||"{}"!=F({a:e})||"{}"!=F(Object(e))})),"JSON",{stringify:function(e){for(var t,n,i=[e],a=1;a<arguments.length;)i.push(arguments[a++]);if(n=t=i[1],(C(t)||void 0!==e)&&!Y(e))return w(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!Y(t))return t}),i[1]=t,F.apply(j,i)}}),A[B][L]||n(16)(A[B],L,A[B].valueOf),f(A,"Symbol"),f(Math,"Math",!0),f(s.JSON,"JSON",!0)},function(e,t,n){function i(e){s(e,a,{value:{i:"O"+ ++l,w:{}}})}var a=n(32)("meta"),o=n(17),r=n(9),s=n(15).f,l=0,c=Object.isExtensible||function(){return!0},u=!n(20)(function(){return c(Object.preventExtensions({}))}),d=e.exports={KEY:a,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!r(e,a)){if(!c(e))return"F";if(!t)return"E";i(e)}return e[a].i},getWeak:function(e,t){if(!r(e,a)){if(!c(e))return!0;if(!t)return!1;i(e)}return e[a].w},onFreeze:function(e){return u&&d.NEED&&c(e)&&!r(e,a)&&i(e),e}}},function(e,t,n){var s=n(36),l=n(80),c=n(44);e.exports=function(e){var t=s(e),n=l.f;if(n)for(var i,a=n(e),o=c.f,r=0;a.length>r;)o.call(e,i=a[r++])&&t.push(i);return t}},function(e,t,n){var i=n(13),a=n(81).f,o={}.toString,r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return r&&"[object Window]"==o.call(e)?function(e){try{return a(e)}catch(e){return r.slice()}}(e):a(i(e))}},function(e,t){},function(e,t,n){n(58)("asyncIterator")},function(e,t,n){n(58)("observable")},function(e,t,n){var i=n(8),a=n(49),o=n(4)("species");e.exports=function(e,t){var n,e=i(e).constructor;return void 0===e||null==(n=i(e)[o])?t:a(n)}},function(e,t,n){"use strict";var i=n(0)(n(60)),n=n(41).extend({applySavedValue:function(){var e=this.getControlValue(),i=this.$("[data-setting]"),a=this;_.each(e,function(e,t){var n=i.filter(function(){return t===this.dataset.setting});a.setInputValue(n,e)})},getControlValue:function(e){var t=this.elementSettingsModel.get(this.model.get("name"));if(!jQuery.isPlainObject(t))return{};if(e){e=t[e];return void 0===e&&(e=""),e}return qazana.helpers.cloneObject(t)},setValue:function(e,t){var n=this.getControlValue();"object"===(0,i.default)(e)?_.each(e,function(e,t){n[t]=e}):n[e]=t,this.setSettingsModel(n)},updateElementModel:function(e,t){t=t.dataset.setting;this.setValue(t,e)}},{getStyleValue:function(e,t){return _.isObject(t)?t[e]:""}});e.exports=n},function(e,t,n){var a=n(14),o=n(3),r=n(20);e.exports=function(e,t){var n=(o.Object||{})[e]||Object[e],i={};i[e]=t(n),a(a.S+a.F*r(function(){n(1)}),"Object",i)}},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,n){"use strict";n=n(41).extend({getSelect2Placeholder:function(){return this.ui.select.children('option:first[value=""]').text()},getSelect2DefaultOptions:function(){return{allowClear:!0,placeholder:this.getSelect2Placeholder(),dir:qazana.config.is_rtl?"rtl":"ltr"}},getSelect2Options:function(){return jQuery.extend(this.getSelect2DefaultOptions(),this.model.get("select2options"))},onReady:function(){this.ui.select.select2(this.getSelect2Options())},onBeforeDestroy:function(){this.ui.select.data("select2")&&this.ui.select.select2("destroy"),this.$el.remove()}});e.exports=n},function(e,t,n){"use strict";var i=n(0)(n(39)),n=Marionette.CompositeView.extend({ui:function(){return{controlTitle:".qazana-control-title"}},behaviors:function(){var e={};return qazana.hooks.applyFilters("controls/base/behaviors",e,this)},getBehavior:function(e){return this._behaviors[(0,i.default)(this.behaviors()).indexOf(e)]},className:function(){var e="qazana-control qazana-control-"+this.model.get("name")+" qazana-control-type-"+this.model.get("type"),t=this.model.get("classes"),n=this.model.get("responsive");return _.isEmpty(t)||(e+=" "+t),_.isEmpty(n)||(e+=" qazana-control-responsive-"+n.max),e},templateHelpers:function(){var e={_cid:this.model.cid};return{data:_.extend({},this.model.toJSON(),e)}},getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-control-"+this.model.get("type")+"-content")},initialize:function(e){this.elementSettingsModel=e.elementSettingsModel;e=this.model.get("type"),e=jQuery.extend(!0,{},qazana.config.controls[e],this.model.attributes);this.model.set(e),this.listenTo(this.elementSettingsModel,"change",this.toggleControlVisibility)},toggleControlVisibility:function(){var e=qazana.helpers.isActiveControl(this.model,this.elementSettingsModel.attributes);this.$el.toggleClass("qazana-hidden-control",!e),qazana.getPanelView().updateScrollbar()},onRender:function(){var e=this.model.get("label_block")?"block":"inline",t=this.model.get("show_label"),n=this.model.get("custom_class"),e="qazana-label-"+e;e+=" qazana-control-separator-"+this.model.get("separator"),t||(e+=" qazana-control-hidden-label"),n&&(e+=" qazana-control-custom-class-"+n),this.$el.addClass(e),this.toggleControlVisibility()}});e.exports=n},function(e,t,n){var i=n(84),a=n(24);e.exports=function(e){return i(a(e))}},function(e,t,n){"use strict";var i=n(154),a=n(143),o=n(155);e.exports=Marionette.LayoutView.extend({el:function(){return this.modal.getElements("widget")},modal:null,regions:function(){return{modalHeader:".dialog-header",modalContent:".dialog-lightbox-content",modalLoading:".dialog-lightbox-loading"}},constructor:function(){this.initModal(),Marionette.LayoutView.prototype.constructor.apply(this,arguments)},initialize:function(){this.modalHeader.show(new i(this.getHeaderOptions()))},initModal:function(){var e={className:"qazana-templates-modal",closeButton:!1,hide:{onOutsideClick:!1}};jQuery.extend(!0,e,this.getModalOptions()),this.modal=this.getDialogsManager().createWidget("lightbox",e),this.modal.getElements("message").append(this.modal.addElement("content"),this.modal.addElement("loading"))},getDialogsManager:function(){return qazana.dialogsManager},showModal:function(){this.modal.show()},hideModal:function(){this.modal.hide()},getModalOptions:function(){return{}},getLogoOptions:function(){return{}},getHeaderOptions:function(){return{}},getHeaderView:function(){return this.modalHeader.currentView},showLoadingView:function(){this.modalLoading.show(new o),this.modalLoading.$el.show(),this.modalContent.$el.hide()},hideLoadingView:function(){this.modalContent.$el.show(),this.modalLoading.$el.hide()},showLogo:function(){this.getHeaderView().logoArea.show(new a(this.getLogoOptions()))}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-templates-modal__header__logo",className:"qazana-templates-modal__header__logo",events:{click:"onClick"},templateHelpers:function(){return{title:this.getOption("title")}},onClick:function(){var e=this.getOption("click");e&&e()}})},function(e,t,n){"use strict";var i=n(0);n(1),n(27),n(28);var o=i(n(275)),c=i(n(60)),a=i(n(104)),r=i(n(39)),s=n(105),l=n(153),u=n(162),d=n(185),i=d.extend({tagName:"div",controlsCSSParser:null,allowRender:!0,toggleEditTools:!1,renderAttributes:{},className:function(){var e="qazana-element qazana-element-edit-mode "+this.getElementUniqueID();return this.toggleEditTools&&(e+=" qazana-element--toggle-edit-tools"),e},attributes:function(){var e=this.model.get("elType");return"widget"===e&&(e=this.model.get("widgetType")),{"data-id":this.getID(),"data-element_type":e}},ui:function(){return{tools:"> .qazana-element-overlay > .qazana-editor-element-settings",editButton:"> .qazana-element-overlay .qazana-editor-element-edit",duplicateButton:"> .qazana-element-overlay .qazana-editor-element-duplicate",addButton:"> .qazana-element-overlay .qazana-editor-element-add",removeButton:"> .qazana-element-overlay .qazana-editor-element-remove"}},behaviors:function(){var e=qazana.hooks.applyFilters("elements/"+this.options.model.get("elType")+"/contextMenuGroups",this.getContextMenuGroups(),this),t={contextMenu:{behaviorClass:n(145),groups:e}};return qazana.hooks.applyFilters("elements/base/behaviors",t,this)},getBehavior:function(e){return this._behaviors[(0,r.default)(this.behaviors()).indexOf(e)]},events:function(){return{mousedown:"onMouseDown","click @ui.editButton":"onEditButtonClick","click @ui.duplicateButton":"onDuplicateButtonClick","click @ui.addButton":"onAddButtonClick","click @ui.removeButton":"onRemoveButtonClick"}},getElementType:function(){return this.model.get("elType")},getIDInt:function(){return(0,a.default)(this.getID(),16)},getChildType:function(){return qazana.helpers.getElementChildType(this.getElementType())},getChildView:function(e){var t=e.get("elType"),t="section"===t?n(186):"column"===t?n(288):qazana.modules.elements.views.Widget;return qazana.hooks.applyFilters("element/view",t,e,this)},templateHelpers:function(){var e=d.prototype.templateHelpers.apply(this,arguments);return jQuery.extend(e,{editModel:this.getEditModel()})},getTemplateType:function(){return"js"},getEditModel:function(){return this.model},getContextMenuGroups:function(){var e=this.options.model.get("elType"),t=qazana.envData.mac?"⌘":"^";return[{name:"general",actions:[{name:"edit",icon:"eicon-edit",title:qazana.translate("edit_element",[qazana.helpers.firstLetterUppercase(e)]),callback:this.options.model.trigger.bind(this.options.model,"request:edit")},{name:"duplicate",icon:"eicon-clone",title:qazana.translate("duplicate"),shortcut:t+"+D",callback:this.duplicate.bind(this)}]},{name:"transfer",actions:[{name:"copy",title:qazana.translate("copy"),shortcut:t+"+C",callback:this.copy.bind(this)},{name:"paste",title:qazana.translate("paste"),shortcut:t+"+V",callback:this.paste.bind(this),isEnabled:this.isPasteEnabled.bind(this)},{name:"pasteStyle",title:qazana.translate("paste_style"),shortcut:t+"+⇧+V",callback:this.pasteStyle.bind(this),isEnabled:function(){return!!qazana.getStorage("transfer")}},{name:"resetStyle",title:qazana.translate("reset_style"),callback:this.resetStyle.bind(this)}]},{name:"delete",actions:[{name:"delete",icon:"eicon-trash",title:qazana.translate("delete"),shortcut:"⌦",callback:this.removeElement.bind(this)}]}]},initialize:function(){d.prototype.initialize.apply(this,arguments),this.collection&&this.listenTo(this.collection,"add remove reset",this.onCollectionChanged,this);var e=this.getEditModel();this.listenTo(e.get("settings"),"change",this.onSettingsChanged).listenTo(e.get("editSettings"),"change",this.onEditSettingsChanged).listenTo(this.model,"request:edit",this.onEditRequest).listenTo(this.model,"request:toggleVisibility",this.toggleVisibility),this.initControlsCSSParser()},startTransport:function(e){qazana.setStorage("transfer",{type:e,elementsType:this.getElementType(),elements:[this.model.toJSON({copyHtmlCache:!0})]})},copy:function(){this.startTransport("copy")},cut:function(){this.startTransport("cut")},paste:function(){this.trigger("request:paste")},isPasteEnabled:function(){var e=qazana.getStorage("transfer");return!(!e||this.isCollectionFilled())&&this.getElementType()===e.elementsType},isStyleTransferControl:function(e){return void 0!==e.style_transfer?e.style_transfer:"content"!==e.tab||e.selectors||e.prefix_class},duplicate:function(){var e=qazana.getStorage("transfer");this.copy(),this.paste(),qazana.setStorage("transfer",e)},pasteStyle:function(){var o=this,r=qazana.getStorage("transfer").elements[0].settings,e=o.getEditModel(),t=e.get("settings"),s=t.attributes,t=t.controls,l={};jQuery.each(t,function(e,t){if(o.isStyleTransferControl(t)){var n=r[e],i=s[e];if(void 0!==n&&void 0!==i){if("object"===(0,c.default)(n)){if("object"!==(0,c.default)(i))return;var a=!0;if(jQuery.each(n,function(e){if(n[e]!==i[e])return a=!1}),a)return}n!==i&&qazana.getControlView(t.type).onPasteStyle(t,n)&&(l[e]=n)}}}),o.allowRender=!1,qazana.channels.data.trigger("element:before:paste:style",e),e.setSetting(l),qazana.channels.data.trigger("element:after:paste:style",e),o.allowRender=!0,o.renderOnChange()},resetStyle:function(){var n=this,e=n.getEditModel(),t=e.get("settings").controls,i={};n.allowRender=!1,qazana.channels.data.trigger("element:before:reset:style",e),jQuery.each(t,function(e,t){n.isStyleTransferControl(t)&&(i[e]=t.default)}),e.setSetting(i),qazana.channels.data.trigger("element:after:reset:style",e),n.allowRender=!0,n.renderOnChange()},toggleVisibility:function(){this.model.set("hidden",!this.model.get("hidden")),this.toggleVisibilityClass()},toggleVisibilityClass:function(){this.$el.toggleClass("qazana-edit-hidden",!!this.model.get("hidden"))},addElementFromPanel:function(e){e=e||{};var t=qazana.channels.panelElements.request("element:selected"),n={elType:t.model.get("elType")};if("widget"===n.elType)n.widgetType=t.model.get("widgetType");else{if("section"!==n.elType)return;n.isInner=!0}t=t.model.get("custom");t&&jQuery.extend(n,t),e.trigger={beforeAdd:"element:before:add",afterAdd:"element:after:add"},e.onAfterAdd=function(e,t){"section"===t.getElementType()&&t.isInner()&&t.addChildElement()},this.addChildElement(n,e)},addControlValidator:function(e,t){t=t.bind(this);var n=new u({customValidationMethod:t}),t=this.getEditModel().get("settings").validators;t[e]||(t[e]=[]),t[e].push(n)},addRenderAttribute:function(t,e,n,i){var a=this;return"object"===(0,c.default)(t)?(jQuery.each(t,function(e){a.addRenderAttribute(e,this,null,i)}),a):"object"===(0,c.default)(e)?(jQuery.each(e,function(e){a.addRenderAttribute(t,e,this,i)}),a):(a.renderAttributes[t]||(a.renderAttributes[t]={}),a.renderAttributes[t][e]||(a.renderAttributes[t][e]=[]),(0,o.default)(n)||(n=[n]),void(a.renderAttributes[t][e]=i?n:a.renderAttributes[t][e].concat(n)))},getRenderAttributeString:function(e){if(!this.renderAttributes[e])return"";var e=this.renderAttributes[e],t=[];return jQuery.each(e,function(e){t.push(e+'="'+_.escape(this.join(" "))+'"')}),t.join(" ")},isInner:function(){return!!this.model.get("isInner")},initControlsCSSParser:function(){this.controlsCSSParser=new l({id:this.model.cid,settingsModel:this.getEditModel().get("settings"),dynamicParsing:this.getDynamicParsingSettings()})},enqueueFonts:function(){var t=this.getEditModel(),e=t.get("settings");_.each(e.getFontControls(),function(e){e=t.getSetting(e.name);_.isEmpty(e)||qazana.helpers.enqueueFont(e)})},renderStyles:function(e){e=e||this.getEditModel().get("settings");var t=this,n=e.get("custom_css"),i=qazana.hooks.applyFilters("editor/style/styleText","",this);t.controlsCSSParser.stylesheet.empty(),t.controlsCSSParser.addStyleRules(e.getStyleControls(),e.attributes,t.getEditModel().get("settings").controls,[/{{ID}}/g,/{{WRAPPER}}/g],[t.getID(),"#qazana ."+t.getElementUniqueID()]),t.controlsCSSParser.addStyleToDocument(),n&&t.controlsCSSParser.elements.$stylesheetElement.append(n.replace(/selector/g,"#qazana ."+t.getElementUniqueID())),i&&t.controlsCSSParser.elements.$stylesheetElement.append(i)},renderCustomClasses:function(){var i=this,a=i.getEditModel().get("settings"),e=a.getClassControls();_.each(e,function(e){var t=a.previous(e.name);e.classes_dictionary&&void 0!==e.classes_dictionary[t]&&(t=e.classes_dictionary[t]),i.$el.removeClass(e.prefix_class+t)}),_.each(e,function(e){var t=a.attributes[e.name],n=t;e.classes_dictionary&&void 0!==e.classes_dictionary[t]&&(n=e.classes_dictionary[t]),qazana.helpers.isActiveControl(e,a.attributes)&&(n||0===n)&&i.$el.addClass(e.prefix_class+n)}),i.$el.addClass(_.result(i,"className")),i.toggleVisibilityClass()},renderCustomElementID:function(){var e=this.getEditModel().get("settings").get("_element_id");this.$el.attr("id",e)},getModelForRender:function(){return qazana.hooks.applyFilters("element/templateHelpers/editModel",this.getEditModel(),this)},renderUIOnly:function(){var e=this.getModelForRender();this.renderStyles(e.get("settings")),this.renderCustomClasses(),this.renderCustomElementID(),this.enqueueFonts()},renderUI:function(){var e=this.getModelForRender();this.renderStyles(e.get("settings")),this.renderCustomClasses(),this.renderCustomElementID(),this.enqueueFonts()},runReadyTrigger:function(){var e=this;_.defer(function(){qazanaFrontend.elementsHandler.runReadyTrigger(e.$el),qazanaFrontend.isEditMode()&&e.$el.find(".qazana-element.qazana-"+e.model.get("elType")+":not(.qazana-element-edit-mode)").each(function(){qazanaFrontend.elementsHandler.runReadyTrigger(jQuery(this))})})},getID:function(){return this.model.get("id")},getElementUniqueID:function(){return"qazana-element-"+this.getID()},renderOnChange:function(i){if(this.allowRender){if(i instanceof s){var e=i.hasChanged(),a=!e,o=!e;if(_.each(i.changedAttributes(),function(e,t){var n=i.getControl(t);"_column_size"!==t?n?("none"!==n.render_type&&(o=!0),-1===["none","ui"].indexOf(n.render_type)&&("template"!==n.render_type&&(i.isStyleControl(t)||i.isClassControl(t)||"_element_id"===t)||(a=!0))):a=o=!0:o=!0}),!o)return;if(!a)return void this.renderUI()}var t=this.getTemplateType(),e=this.getEditModel();"js"===t?(this.getEditModel().setHtmlCache(),this.render(),e.renderOnLeave=!0):e.renderRemoteServer()}},getDynamicParsingSettings:function(){var e=this;return{onServerRequestStart:function(){e.$el.addClass("qazana-loading")},onServerRequestEnd:function(){e.render(),e.$el.removeClass("qazana-loading")}}},serializeData:function(){var e=d.prototype.serializeData.apply(this,arguments);return e.settings=this.getEditModel().get("settings").parseDynamicSettings(e.settings,this.getDynamicParsingSettings()),e},save:function(){var e=this.model;qazana.templates.startModal({onReady:function(){qazana.templates.getLayout().showSaveTemplateView(e)}})},removeElement:function(){qazana.channels.data.trigger("element:before:remove",this.model);var e=this._parent;e.isManualRemoving=!0,this.model.destroy(),e.isManualRemoving=!1,qazana.channels.data.trigger("element:after:remove",this.model)},onBeforeRender:function(){this.renderAttributes={}},onRender:function(){var e;this.renderUI(),this.runReadyTrigger(),this.toggleEditTools&&(e=this.ui.editButton,this.ui.tools.hoverIntent(function(){e.addClass("qazana-active")},function(){e.removeClass("qazana-active")},{timeout:500}))},onCollectionChanged:function(){qazana.saver.setFlagEditorChange(!0)},onEditSettingsChanged:function(e){qazana.channels.editor.trigger("change:editSettings",e,this)},onSettingsChanged:function(e){qazana.saver.setFlagEditorChange(!0),this.renderOnChange(e)},onEditButtonClick:function(){this.model.trigger("request:edit")},onEditRequest:function(e){var t,n=0<arguments.length&&void 0!==e?e:{};"edit"===qazana.channels.dataEditMode.request("activeMode")&&(t=this.getEditModel(),"editor"===(e=qazana.getPanelView()).getCurrentPageName()&&e.getCurrentPageView().model===t||(n.scrollIntoView&&qazana.helpers.scrollToView(this.$el,200),e.openEditor(t,this)))},onDuplicateButtonClick:function(e){e.stopPropagation(),this.duplicate()},onRemoveButtonClick:function(e){e.stopPropagation(),this.removeElement()},onMouseDown:function(e){jQuery(e.target).closest(".qazana-inline-editing").length||qazanaFrontend.getElements("$document")[0].activeElement.blur()},onDestroy:function(){this.controlsCSSParser.removeStyleFromDocument(),qazana.channels.data.trigger("element:destroy",this.model)}});e.exports=i},function(e,t,n){"use strict";var i=n(278);e.exports=Marionette.Behavior.extend({defaults:{groups:[],eventTargets:["el"]},events:function(){var n={};return this.getOption("eventTargets").forEach(function(e){var t="contextmenu";"el"!==e&&(t+=" "+e),n[t]="onContextMenu"}),n},initialize:function(){this.listenTo(this.view.options.model,"request:contextmenu",this.onRequestContextMenu)},initContextMenu:function(){var e=this.getOption("groups"),t=_.findWhere(e,{name:"delete"}),t=e.indexOf(t);-1===t&&(t=e.length),e.splice(t,0,{name:"tools",actions:[{name:"navigator",title:qazana.translate("navigator"),callback:qazana.navigator.open.bind(qazana.navigator,this.view.model)}]}),this.contextMenu=new i({groups:e}),this.contextMenu.getModal().on("hide",this.onContextMenuHide)},getContextMenu:function(){return this.contextMenu||this.initContextMenu(),this.contextMenu},onContextMenu:function(e){!qazana.hotKeys.isControlEvent(e)&&qazana.userCan("design")&&"edit"===qazana.channels.dataEditMode.request("activeMode")&&(e.preventDefault(),e.stopPropagation(),this.getContextMenu().show(e),qazana.channels.editor.reply("contextMenu:targetView",this.view))},onRequestContextMenu:function(e){var t=this.getContextMenu().getModal(),n=t.getSettings("iframe"),i=_.findWhere(this.contextMenu.getSettings("groups"),{name:"tools"});i.isVisible=!1,t.setSettings("iframe",null),this.onContextMenu(e),i.isVisible=!0,t.setSettings("iframe",n)},onContextMenuHide:function(){qazana.channels.editor.reply("contextMenu:targetView",null)},onDestroy:function(){this.contextMenu&&this.contextMenu.destroy()}})},function(e,t,n){"use strict";n(1),n(164),n(147),n(59),n=Marionette.CompositeView.extend({className:"qazana-panel-controls-stack",classes:{popover:"qazana-controls-popover"},activeTab:null,activeSection:null,templateHelpers:function(){return{elementData:qazana.getElementData(this.model)}},ui:function(){return{tabs:".qazana-panel-navigation-tab",reloadButton:".qazana-update-preview-button"}},events:function(){return{"click @ui.tabs":"onClickTabControl","click @ui.reloadButton":"onReloadButtonClick"}},modelEvents:{destroy:"onModelDestroy"},behaviors:{HandleInnerTabs:{behaviorClass:n(190)}},initialize:function(){this.initCollection(),this.listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange)},initCollection:function(){this.collection=new Backbone.Collection(_.values(qazana.mergeControlsSettings(this.getOption("controls"))))},filter:function(e){if(e.get("tab")!==this.activeTab)return!1;if("section"===e.get("type"))return!0;e=e.get("section");return!e||e===this.activeSection},isVisibleSectionControl:function(e){return this.activeTab===e.get("tab")},activateTab:function(e){this.activeTab=e,this.ui.tabs.removeClass("qazana-active").filter('[data-tab="'+e+'"]').addClass("qazana-active"),this.activateFirstSection()},activateSection:function(e){this.activeSection=e},activateFirstSection:function(){var t=this,e=t.collection.filter(function(e){return"section"===e.get("type")&&t.isVisibleSectionControl(e)});e[0]&&(e.filter(function(e){return t.activeSection===e.get("name")})[0]||t.activateSection(e[0].get("name")))},getChildView:function(e){e=e.get("type");return qazana.getControlView(e)},handlePopovers:function(){var n,i=this,a=!1;i.removePopovers(),i.children.each(function(e){a&&n.append(e.$el);var t=e.model.get("popover");t&&(t.start&&(a=!0,n=jQuery("<div>",{class:i.classes.popover}),e.$el.before(n),n.append(e.$el)),t.end&&(a=!1))})},removePopovers:function(){this.$el.find("."+this.classes.popover).remove()},openActiveSection:function(){var t=this.activeSection,e=this.children.filter(function(e){return t===e.model.get("name")});e[0]&&e[0].$el.addClass("qazana-open")},onRenderCollection:function(){this.openActiveSection(),this.handlePopovers()},onRenderTemplate:function(){this.activateTab(this.activeTab||this.ui.tabs.eq(0).data("tab"))},onModelDestroy:function(){this.destroy()},onClickTabControl:function(e){e.preventDefault();e=this.$(e.currentTarget).data("tab");this.activeTab!==e&&(this.activateTab(e),this._renderChildren())},onReloadButtonClick:function(){qazana.reloadPreview()},onDeviceModeChange:function(){this.$el.removeClass("qazana-responsive-switchers-open")},onChildviewControlSectionClicked:function(e){var t=e.$el.hasClass("qazana-open");this.activateSection(t?null:e.model.get("name")),this._renderChildren()},onChildviewResponsiveSwitcherClick:function(e,t){"desktop"===t&&this.$el.toggleClass("qazana-responsive-switchers-open")}}),e.exports=n},function(e,t,n){"use strict";var i=n(72),a=n(298),o=n(165),r=n(141);e.exports=n(299)(Array,"Array",function(e,t){this._t=r(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t,n){n(149),e.exports=n(3).Object.keys},function(e,t,n){var i=n(61),a=n(36);n(137)("keys",function(){return function(e){return a(i(e))}})},function(e,t,n){var i=n(33)("keys"),a=n(34);e.exports=function(e){return i[e]||(i[e]=a(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var i=n(2),o=n(174),a=n(23).f,r=n(176).f,s=n(103),l=n(82),c=i.RegExp,u=c,d=c.prototype,h=/a/g,p=/a/g,g=new c(h)!==h;if(n(7)&&(!g||n(10)(function(){return p[n(4)("match")]=!1,c(h)!=h||c(p)==p||"/a/i"!=c(h,"i")}))){c=function(e,t){var n=this instanceof c,i=s(e),a=void 0===t;return!n&&i&&e.constructor===c&&a?e:o(g?new u(i&&!a?e.source:e,t):u((i=e instanceof c)?e.source:e,i&&a?l.call(e):t),n?this:d,c)};for(var f=r(u),m=0;f.length>m;)!function(t){t in c||a(c,t,{configurable:!0,get:function(){return u[t]},set:function(e){u[t]=e}})}(f[m++]);(d.constructor=c).prototype=d,n(25)(i,"RegExp",c)}n(242)("RegExp")},function(e,t,n){"use strict";var m=n(0)(n(39));n(152),n(47),n(27),n(1),n(28);var i=n(40),a=n(180),r=i.extend({stylesheet:null,getDefaultSettings:function(){return{id:0,settingsModel:null,dynamicParsing:{}}},getDefaultElements:function(){return{$stylesheetElement:jQuery("<style>",{id:"qazana-style-"+this.getSettings("id")})}},initStylesheet:function(){var e=qazanaFrontend.config.breakpoints;this.stylesheet=new a,this.stylesheet.addDevice("mobile",0).addDevice("tablet",e.md).addDevice("desktop",e.lg)},addStyleRules:function(e,t,n,i,a){var o=this,r=o.getSettings("settingsModel").parseDynamicSettings(t,o.getSettings("dynamicParsing"),e);_.each(e,function(e){e.styleFields&&e.styleFields.length&&o.addRepeaterControlsStyleRules(t[e.name],e.styleFields,n,i,a),e.dynamic&&e.dynamic.active&&t.__dynamic__&&t.__dynamic__[e.name]&&o.addDynamicControlStyleRules(t.__dynamic__[e.name],e),e.selectors&&o.addControlStyleRules(e,r,n,i,a)})},addControlStyleRules:function(e,t,n,i,a){var o=this;r.addControlStyleRules(this.stylesheet,e,n,function(e){return o.getStyleControlValue(e,t)},i,a)},getStyleControlValue:function(e,t){t=t[e.name];if(e.selectors_dictionary&&(t=e.selectors_dictionary[t]||t),_.isNumber(t)||!_.isEmpty(t))return t},addRepeaterControlsStyleRules:function(n,e,i,a,o){var r=this;e.forEach(function(e,t){t=n.models[t];r.addStyleRules(e,t.attributes,i,a.concat(["{{CURRENT_ITEM}}"]),o.concat([".qazana-repeater-item-"+t.get("_id")]))})},addDynamicControlStyleRules:function(e,t){var i=this;qazana.dynamicTags.parseTagsText(e,t.dynamic,function(e,t,n){n=qazana.dynamicTags.createTag(e,t,n);!n||(n=n.model).getStyleControls().length&&i.addStyleRules(n.getStyleControls(),n.attributes,n.controls,["{{WRAPPER}}"],["#qazana-tag-"+e])})},addStyleToDocument:function(){qazana.$previewContents.find("head").append(this.elements.$stylesheetElement),this.elements.$stylesheetElement.text(this.stylesheet)},removeStyleFromDocument:function(){this.elements.$stylesheetElement.remove()},onInit:function(){i.prototype.onInit.apply(this,arguments),this.initStylesheet()}});r.addControlStyleRules=function(c,u,d,h,p,g){var f=h(u);void 0!==f&&_.each(u.selectors,function(e,n){var t;try{t=e.replace(/{{(?:([^.}]+)\.)?([^}]*)}}/g,function(e,t,n){var i=u,a=f;if(t){if(!(i=_.findWhere(d,{name:t})))return"";a=h(i)}a=qazana.getControlView(i.type).getStyleValue(n.toLowerCase(),a);if(""===a)throw"";return a})}catch(e){return}if(!_.isEmpty(t)){var i=/^(?:\([^)]+\)){1,2}/,a=n.match(i),o={};if(a){a=a[0],n=n.replace(i,"");for(var r=/\(([^)]+)\)/g,s=[],l=r.exec(a);l;)s.push(l[1]),l=r.exec(a);_.each(s,function(e){var t;"desktop"!==e&&(t=e.replace(/\+$/,""),o[t===e?"max":"min"]=t)})}_.each(p,function(e,t){e=e.source||e,e=new RegExp(e,"g");n=n.replace(e,g[t])}),!(0,m.default)(o).length&&u.responsive&&"desktop"===(o=_.pick(qazana.helpers.cloneObject(u.responsive),["min","max"])).max&&delete o.max,c.addRules(n,t,o)}})},e.exports=r},function(e,t,n){"use strict";var i=Marionette.LayoutView.extend({className:"qazana-templates-modal__header",template:"#tmpl-qazana-templates-modal__header",regions:{logoArea:".qazana-templates-modal__header__logo-area",tools:"#qazana-template-library-header-tools",menuArea:".qazana-templates-modal__header__menu-area"},ui:{closeModal:".qazana-templates-modal__header__close"},events:{"click @ui.closeModal":"onCloseModalClick"},templateHelpers:function(){return{closeType:this.getOption("closeType")}},onCloseModalClick:function(){this._parent._parent._parent.hideModal()}});e.exports=i},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({id:"qazana-template-library-loading",template:"#tmpl-qazana-template-library-loading"});e.exports=i},function(e,t,n){"use strict";var l=n(0)(n(104)),n=n(40);e.exports=n.extend({getDefaultSettings:function(){return{container:null,items:null,columnsCount:3,verticalSpaceBetween:30}},getDefaultElements:function(){return{$container:jQuery(this.getSettings("container")),$items:jQuery(this.getSettings("items"))}},run:function(){var a=[],o=this.elements.$container.position().top,r=this.getSettings(),s=r.columnsCount;o+=(0,l.default)(this.elements.$container.css("margin-top"),10),this.elements.$items.each(function(e){var t=Math.floor(e/s),n=jQuery(this),i=n[0].getBoundingClientRect().height+r.verticalSpaceBetween;t?(t=n.position(),e=e%s,t=t.top-o-a[e],t-=(0,l.default)(n.css("margin-top"),10),t*=-1,n.css("margin-top",t+"px"),a[e]+=i):a.push(i)})}})},function(e,t,n){n(158),e.exports=n(3).parseInt},function(e,t,n){var i=n(14),n=n(159);i(i.G+i.F*(parseInt!=n),{parseInt:n})},function(e,t,n){var i=n(5).parseInt,a=n(160).trim,n=n(138),o=/^[-+]?0[xX]/;e.exports=8!==i(n+"08")||22!==i(n+"0x16")?function(e,t){e=a(String(e),3);return i(e,t>>>0||(o.test(e)?16:10))}:i},function(e,t,n){var o=n(14),i=n(38),r=n(20),s=n(138),n="["+s+"]",a=RegExp("^"+n+n+"*"),l=RegExp(n+n+"*$"),n=function(e,t,n){var i={},a=r(function(){return!!s[e]()||"​"!="​"[e]()}),t=i[e]=a?t(c):s[e];n&&(i[n]=t),o(o.P+o.F*a,"String",i)},c=n.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(a,"")),2&t&&(e=e.replace(l,"")),e};e.exports=n},function(e,t,n){"use strict";e.exports=new function(){function t(e){var t=i[e.which];t&&jQuery.each(t,function(){this.isWorthHandling&&!this.isWorthHandling(e)||!this.allowAltKey&&e.altKey||(e.preventDefault(),this.handle(e))})}var i={};this.isControlEvent=function(e){return e[qazana.envData.mac?"metaKey":"ctrlKey"]},this.addHotKeyHandler=function(e,t,n){i[e]||(i[e]={}),i[e][t]=n},this.bindListener=function(e){e.on("keydown",t)}}},function(e,t,n){"use strict";n=n(46).extend({errors:[],__construct:function(e){e=e.customValidationMethod;e&&(this.validationMethod=e)},getDefaultSettings:function(){return{validationTerms:{}}},isValid:function(){var e=this.validationMethod.apply(this,arguments);return!e.length||(this.errors=e,!1)},validationMethod:function(e){var t=[];return this.getSettings("validationTerms").required&&((""+e).length||t.push("Required value is empty")),t}});e.exports=n},function(e,t,n){"use strict";var i=Marionette.Behavior.extend({defaults:{elChildType:"widget"},events:{sortstart:"onSortStart",sortreceive:"onSortReceive",sortupdate:"onSortUpdate",sortover:"onSortOver",sortout:"onSortOut"},initialize:function(){this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeSwitched).listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange).listenTo(this.view.options.model,"request:sort:start",this.startSort).listenTo(this.view.options.model,"request:sort:update",this.updateSort).listenTo(this.view.options.model,"request:sort:receive",this.receiveSort)},onEditModeSwitched:function(e){"edit"===e?this.activate():this.deactivate()},onDeviceModeChange:function(){"desktop"===qazana.channels.deviceMode.request("currentMode")?this.activate():this.deactivate()},onRender:function(){var e=this;_.defer(function(){e.onEditModeSwitched(qazana.channels.dataEditMode.request("activeMode"))})},onDestroy:function(){this.deactivate()},activate:function(){var e,t;qazana.userCan("design")&&(this.getChildViewContainer().sortable("instance")||(t={connectWith:(e=this.getChildViewContainer()).selector,placeholder:"qazana-sortable-placeholder qazana-"+this.getOption("elChildType")+"-placeholder",cursorAt:{top:20,left:25},helper:this._getSortableHelper.bind(this),cancel:"input, textarea, button, select, option, .qazana-inline-editing, .qazana-tab-title"},t=_.extend(t,this.view.getSortableOptions()),e.sortable(t)))},_getSortableHelper:function(e,t){t=this.view.collection.get({cid:t.data("model-cid")});return'<div style="height: 84px; width: 125px;" class="qazana-sortable-helper qazana-sortable-helper-'+t.get("elType")+'"><div class="icon"><i class="'+t.getIcon()+'"></i></div><div class="qazana-element-title-wrapper"><div class="title">'+t.getTitle()+"</div></div></div>"},getChildViewContainer:function(){return this.view.getChildViewContainer(this.view)},deactivate:function(){var e=this.getChildViewContainer();e.sortable("instance")&&e.sortable("destroy")},startSort:function(e,t){e.stopPropagation();t=this.view.collection.get({cid:t.item.data("model-cid")});qazana.channels.data.reply("dragging:model",t).reply("dragging:parent:view",this.view).trigger("drag:start",t).trigger(t.get("elType")+":drag:start")},updateSort:function(e){var t=qazana.channels.data.request("dragging:model"),e=e.item,n=this.view.collection,e=e.parent().children().index(e),i=this.view.children.findByModelCid(t.cid);this.view.addChildElement(t.clone(),{at:e,trigger:{beforeAdd:"drag:before:update",afterAdd:"drag:after:update"},onBeforeAdd:function(){i._isRendering=!0,n.remove(t)}}),qazana.saver.setFlagEditorChange(!0)},receiveSort:function(e,t){var n,i;e.stopPropagation(),this.view.isCollectionFilled()?jQuery(t.sender).sortable("cancel"):(i="section"===(n=qazana.channels.data.request("dragging:model")).get("elType")&&n.get("isInner"),e="column"===this.view.getElementType()&&this.view.isInner(),i&&e?jQuery(t.sender).sortable("cancel"):(e=t.item.index(),t=n.toJSON({copyHtmlCache:!0}),this.view.addChildElement(t,{at:e,trigger:{beforeAdd:"drag:before:update",afterAdd:"drag:after:update"},onAfterAdd:function(){var e=qazana.channels.data.request("dragging:parent:view");e.isManualRemoving=!0,n.destroy(),e.isManualRemoving=!1}})))},onSortStart:function(e,t){var n,i;"column"===this.options.elChildType&&(n=t.item.data("sortableItem").items,i=0,n.forEach(function(e){if(e.item[0]===t.item[0])return i=e.height,!1}),t.placeholder.height(i)),this.startSort(e,t)},onSortOver:function(e){e.stopPropagation();var t=qazana.channels.data.request("dragging:model");jQuery(e.target).addClass("qazana-draggable-over").attr({"data-dragged-element":t.get("elType"),"data-dragged-is-inner":t.get("isInner")}),this.$el.addClass("qazana-dragging-on-child")},onSortOut:function(e){e.stopPropagation(),jQuery(e.target).removeClass("qazana-draggable-over").removeAttr("data-dragged-element data-dragged-is-inner"),this.$el.removeClass("qazana-dragging-on-child")},onSortReceive:function(e,t){this.receiveSort(e,t)},onSortUpdate:function(e,t){e.stopPropagation(),this.getChildViewContainer()[0]===t.item.parent()[0]&&this.updateSort(t)},onAddChild:function(e){e.$el.attr("data-model-cid",e.model.cid)}});e.exports=i},function(e,t,n){for(var i=n(147),a=n(179),o=n(25),r=n(2),s=n(11),l=n(165),n=n(4),c=n("iterator"),u=n("toStringTag"),d=l.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=a(h),g=0;g<p.length;g++){var f,m=p[g],v=h[m],y=r[m],z=y&&y.prototype;if(z&&(z[c]||s(z,c,d),z[u]||s(z,u,m),l[m]=d,v))for(f in i)z[f]||o(z,f,i[f],!0)}},function(e,t){e.exports={}},function(e,t,n){"use strict";var l=n(0)(n(104));e.exports=function(){var a,n=Array.prototype.slice,s={actions:{},filters:{}};function i(e,t,n,i){var a,o,r;if(s[e][t])if(n)if(a=s[e][t],i)for(r=a.length;r--;)(o=a[r]).callback===n&&o.context===i&&a.splice(r,1);else for(r=a.length;r--;)a[r].callback===n&&a.splice(r,1);else s[e][t]=[]}function o(e,t,n,i,a){i={callback:n,priority:i,context:a},a=s[e][t];if(a){var o=!1;if(jQuery.each(a,function(){if(this.callback===n)return!(o=!0)}),o)return;a.push(i),a=function(e){for(var t,n,i,a=1,o=e.length;a<o;a++){for(t=e[a],n=a;(i=e[n-1])&&i.priority>t.priority;)e[n]=e[n-1],--n;e[n]=t}return e}(a)}else a=[i];s[e][t]=a}function r(e,t,n){var i,a,o=s[e][t];if(!o)return"filters"===e&&n[0];if(a=o.length,"filters"===e)for(i=0;i<a;i++)n[0]=o[i].callback.apply(o[i].context,n);else for(i=0;i<a;i++)o[i].callback.apply(o[i].context,n);return"filters"!==e||n[0]}return a={removeFilter:function(e,t){return"string"==typeof e&&i("filters",e,t),a},applyFilters:function(){var e=n.call(arguments),t=e.shift();return"string"==typeof t?r("filters",t,e):a},addFilter:function(e,t,n,i){return"string"==typeof e&&"function"==typeof t&&o("filters",e,t,n=(0,l.default)(n||10,10),i),a},removeAction:function(e,t){return"string"==typeof e&&i("actions",e,t),a},doAction:function(){var e=n.call(arguments),t=e.shift();return"string"==typeof t&&r("actions",t,e),a},addAction:function(e,t,n,i){return"string"==typeof e&&"function"==typeof t&&o("actions",e,t,n=(0,l.default)(n||10,10),i),a}}}},function(e,t,n){"use strict";var i=n(40),a=n(105),o=n(153);e.exports=i.extend({model:null,hasChange:!1,reloadPreviewFlag:!1,changeCallbacks:{},addChangeCallback:function(e,t){this.changeCallbacks[e]=t},bindEvents:function(){qazana.on("preview:loaded",this.onQazanaPreviewLoaded),this.model.on("change",this.onModelChange)},addPanelPage:function(){var e=this.getSettings("name");qazana.getPanelView().addPage(e+"_settings",{view:qazana.settings.panelPages[e]||qazana.settings.panelPages.base,title:this.getSettings("panelPage.title"),options:{model:this.model,controls:this.model.controls,name:e}})},updateStylesheet:function(e){var t=this.getControlsCSS();e||t.stylesheet.empty(),t.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/{{WRAPPER}}/g],[this.getSettings("cssWrapperSelector")]),t.addStyleToDocument()},initModel:function(){this.model=new a(this.getSettings("settings"),{controls:this.getSettings("controls")})},initControlsCSSParser:function(){var e;this.getControlsCSS=function(){return e||(e=new o({id:this.getSettings("name"),settingsModel:this.model}),this.controlsCSS=e),e}},getDataToSave:function(e){return e},save:function(e){var t,n,i=this;i.hasChange&&(t=this.model.toJSON({removeDefault:!0}),n=this.getDataToSave({data:t}),NProgress.start(),qazana.ajax.addRequest("save_"+this.getSettings("name")+"_settings",{data:n,success:function(){NProgress.done(),i.setSettings("settings",t),i.hasChange=!1,i.reloadPreviewFlag&&(i.reloadPreviewFlag=!1,i.reloadPreview()),e&&e.apply(i,arguments)},error:function(){alert("An error occurred")}}))},addPanelMenuItem:function(){var e,t=this.getSettings("panelPage.menu");t&&(e={icon:t.icon,title:this.getSettings("panelPage.title"),type:"page",pageName:this.getSettings("name")+"_settings"},qazana.modules.layouts.panel.pages.menu.Menu.addItem(e,"settings",t.beforeItem))},onInit:function(){this.initModel(),this.initControlsCSSParser(),this.addPanelMenuItem(),this.debounceSave=_.debounce(this.save,3e3),i.prototype.onInit.apply(this,arguments)},onModelChange:function(e){var n=this;n.hasChange=!0,this.getControlsCSS().stylesheet.empty(),_.each(e.changed,function(e,t){n.changeCallbacks[t]&&n.changeCallbacks[t].call(n,e),n.model.controls[t]&&"preview"===n.model.controls[t].render_type&&(n.reloadPreviewFlag=!0)}),n.updateStylesheet(!0),n.debounceSave()},onQazanaPreviewLoaded:function(){this.updateStylesheet(),this.addPanelPage(),qazana.userCan("design")||qazana.panel.currentView.setPage("page_settings")}})},,function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){e.exports=n(220)},function(e,t,n){e.exports=n(223)},function(e,t,n){e.exports=n(227)},function(e,t,n){"use strict";var i=n(0)(n(39));e.exports=Marionette.Region.extend({storage:null,storageSizeKeys:null,constructor:function(){Marionette.Region.prototype.constructor.apply(this,arguments);var e=qazana.getStorage(this.getStorageKey());this.storage=e||this.getDefaultStorage(),this.storageSizeKeys=(0,i.default)(this.storage.size)},saveStorage:function(e,t){this.storage[e]=t,qazana.setStorage(this.getStorageKey(),this.storage)},saveSize:function(){this.saveStorage("size",qazana.helpers.getElementInlineStyle(this.$el,this.storageSizeKeys))}})},function(e,t,n){var a=n(6),o=n(234).set;e.exports=function(e,t,n){var i,t=t.constructor;return t!==n&&"function"==typeof t&&(i=t.prototype)!==n.prototype&&a(i)&&o&&o(e,i),e}},function(e,t,n){var i=n(235),a=n(65),o=n(141),r=n(62),s=n(42),l=n(67),c=Object.getOwnPropertyDescriptor;t.f=n(7)?c:function(e,t){if(e=o(e),t=r(t,!0),l)try{return c(e,t)}catch(e){}if(s(e,t))return a(!i.f.call(e,t),e[t])}},function(e,t,n){var i=n(177),a=n(151).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,a)}},function(e,t,n){var r=n(42),s=n(141),l=n(236)(!1),c=n(150)("IE_PROTO");e.exports=function(e,t){var n,i=s(e),a=0,o=[];for(n in i)n!=c&&r(i,n)&&o.push(n);for(;t.length>a;)r(i,n=t[a++])&&(~l(o,n)||o.push(n));return o}},function(e,t,n){function i(){}var a=n(8),o=n(240),r=n(151),s=n(150)("IE_PROTO"),l="prototype",c=function(){var e=n(68)("iframe"),t=r.length;for(e.style.display="none",n(241).appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;t--;)delete c[l][r[t]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(i[l]=a(e),n=new i,i[l]=null,n[s]=e):n=c(),void 0===t?n:o(n,t)}},function(e,t,n){var i=n(177),a=n(151);e.exports=Object.keys||function(e){return i(e,a)}},function(e,t,n){"use strict";var i=n(0);n(75),n(59),n(27),n(47),n(45);var u,d=i(n(39));function a(){function s(e){var n={};return(e=e.split("-").filter(String)).forEach(function(e){var t=e.split("_"),e=t[0],t=t[1];n[e]="max"===e?function(e){var t=(0,d.default)(i),e=t.indexOf(e)+1;if(e>=t.length)throw new RangeError("Max value for this device is out of range.");return i[t[e]]-1}(t):i[t]}),n}var l=this,c={},n={},i={};this.addDevice=function(e,t){i[e]=t;t=(0,d.default)(i);if(t.length<2)return l;t.sort(function(e,t){return i[e]-i[t]});var n={};return t.forEach(function(e){n[e]=i[e]}),i=n,l},this.addRawCSS=function(e,t){n[e]=t},this.addRules=function(e,t,n){var i,a,o="all";if(_.isEmpty(n)||(i=n,a=[],u.each(i,function(e){a.push(e+"_"+this)}),o=a.join("-")),c[o]||function(e){c[e]={};var t,e=(0,d.default)(c);e.length<2||(e.sort(function(e,t){if("all"===e)return-1;if("all"===t)return 1;e=s(e);return s(t).max-e.max}),t={},e.forEach(function(e){t[e]=c[e]}),c=t)}(o),t){if(c[o][e]||(c[o][e]={}),"string"==typeof t){t=t.split(";").filter(String);var r={};try{u.each(t,function(){var e=this.split(/:(.*)?/);r[e[0].trim()]=e[1].trim().replace(";","")})}catch(e){return}t=r}return u.extend(c[o][e],t),l}e=e.match(/[^{]+\{[^}]+}/g);u.each(e,function(){var e=this.match(/([^{]+)\{([^}]+)}/);e&&l.addRules(e[1].trim(),e[2].trim(),n)})},this.getRules=function(){return c},this.empty=function(){c={},n={}},this.toString=function(){var i="";return u.each(c,function(e){var t,n=a.parseRules(this);"all"!==e&&(e=s(e=e),t=[],u.each(e,function(e){t.push("("+e+"-width:"+this+"px)")}),n="@media"+t.join(" and ")+"{"+n+"}"),i+=n}),u.each(n,function(){i+=this}),i}}u=jQuery,a.parseRules=function(e){var n="";return u.each(e,function(e){var t=a.parseProperties(this);t&&(n+=e+"{"+t+"}")}),n},a.parseProperties=function(e){var t="";return u.each(e,function(e){this&&(t+=e+":"+this+";")}),t},e.exports=a},function(e,t,n){"use strict";var i=Marionette.Behavior.extend({ui:{insertButton:".qazana-template-library-template-insert"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){this.view.model.get("hasPageSettings")?i.showImportDialog(this.view.model):qazana.templates.importTemplate(this.view.model)}},{dialog:null,showImportDialog:function(e){var t=i.getDialog();t.onConfirm=function(){qazana.templates.importTemplate(e,{withPageSettings:!0})},t.onCancel=function(){qazana.templates.importTemplate(e)},t.show()},initDialog:function(){i.dialog=qazana.dialogsManager.createWidget("confirm",{id:"qazana-insert-template-settings-dialog",headerMessage:qazana.translate("import_template_dialog_header"),message:qazana.translate("import_template_dialog_message")+"<br>"+qazana.translate("import_template_dialog_message_attention"),strings:{confirm:qazana.translate("yes"),cancel:qazana.translate("no")}})},getDialog:function(){return i.dialog||i.initDialog(),i.dialog}});e.exports=i},function(e,t,n){"use strict";n=n(181),n=Marionette.ItemView.extend({className:function(){var e="qazana-template-library-template",t=this.model.get("source");return e+=" qazana-template-library-template-"+t,"remote"===t&&(e+=" qazana-template-library-template-"+this.model.get("type")),e},ui:function(){return{insertButton:".qazana-template-library-template-insert",previewButton:".qazana-template-library-template-preview"}},events:function(){return{"click @ui.insertButton":"onInsertButtonClick","click @ui.previewButton":"onPreviewButtonClick"}},behaviors:{insertTemplate:{behaviorClass:n}}});e.exports=n},function(e,t,n){"use strict";var i=n(35),a=n(83)(6),o="findIndex",r=!0;o in[]&&Array(1)[o](function(){r=!1}),i(i.P+i.F*r,"Array",{findIndex:function(e,t){return a(this,e,1<arguments.length?t:void 0)}}),n(72)(o)},function(e,t,n){"use strict";e.exports=Backbone.Model.extend({defaults:{id:0,type:"",elementType:"",status:"not_applied",title:"",subTitle:"",action:"",history:{}},initialize:function(){this.set("items",new Backbone.Collection)}})},function(e,t,n){"use strict";var i=n(0)(n(39));e.exports=Marionette.CompositeView.extend({templateHelpers:function(){return{view:this}},getBehavior:function(e){return this._behaviors[(0,i.default)(this.behaviors()).indexOf(e)]},initialize:function(){this.collection=this.model.get("elements")},addChildModel:function(e,t){return this.collection.add(e,t,!0)},addChildElement:function(e,t){if(!this.isCollectionFilled()){t=jQuery.extend({trigger:!1,edit:!0,onBeforeAdd:null,onAfterAdd:null},t);var n,i=this.getChildType(),e=e instanceof Backbone.Model?(n=e).get("elType"):(n={id:qazana.helpers.getUniqueID(),elType:i[0],settings:{},elements:[]},e&&jQuery.extend(n,e),n.elType);if(-1===i.indexOf(e))return this.children.last().addChildElement(n,t);t.clone&&(n=this.cloneItem(n)),t.trigger&&qazana.channels.data.trigger(t.trigger.beforeAdd,n),t.onBeforeAdd&&t.onBeforeAdd();i=this.addChildModel(n,{at:t.at}),e=this.children.findByModel(i);return t.onAfterAdd&&t.onAfterAdd(i,e),t.trigger&&qazana.channels.data.trigger(t.trigger.afterAdd,n),t.edit&&i.trigger("request:edit"),e}},cloneItem:function(n){var i=this;return n instanceof Backbone.Model?n.clone():(n.id=qazana.helpers.getUniqueID(),n.settings._element_id="",n.elements.forEach(function(e,t){n.elements[t]=i.cloneItem(e)}),n)},isCollectionFilled:function(){return!1},onChildviewRequestAddNew:function(e){this.addChildElement({},{at:e.$el.index()+1,trigger:{beforeAdd:"element:before:add",afterAdd:"element:after:add"}})},onChildviewRequestPaste:function(e){var t,n,i=this;i.isCollectionFilled()||(t=qazana.getStorage("transfer").elements,n=i.collection.indexOf(e.model),qazana.channels.data.trigger("element:before:add",t[0]),t.forEach(function(e){n++,i.addChildElement(e,{at:n,clone:!0})}),qazana.channels.data.trigger("element:after:add",t[0]))}})},function(e,t,n){"use strict";var i=n(0);n(1);var a=i(n(279)),o=n(144),i=o.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-section-content"),addSectionView:null,className:function(){return o.prototype.className.apply(this,arguments)+" qazana-section qazana-"+(this.isInner()?"inner":"top")+"-section"},tagName:function(){return this.model.getSetting("html_tag")||"section"},childViewContainer:"> .qazana-container > .qazana-row",behaviors:function(){var e=o.prototype.behaviors.apply(this,arguments);return _.extend(e,{Sortable:{behaviorClass:n(163),elChildType:"column"}}),qazana.hooks.applyFilters("elements/section/behaviors",e,this)},errors:{columnWidthTooLarge:"New column width is too large",columnWidthTooSmall:"New column width is too small"},initialize:function(){o.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove reset",this._checkIsFull),this._checkIsEmpty()},getContextMenuGroups:function(){var e=o.prototype.getContextMenuGroups.apply(this,arguments),t=e.indexOf(_.findWhere(e,{name:"transfer"}));return e.splice(t+1,0,{name:"save",actions:[{name:"save",title:qazana.translate("save_as_block"),callback:this.save.bind(this)}]}),e},addChildModel:function(e){var t=e instanceof Backbone.Model,n=this.isInner();return t?e.set("isInner",n):e.isInner=n,o.prototype.addChildModel.apply(this,arguments)},getSortableOptions:function(){return{connectWith:(this.isInner()?".qazana-inner-section":".qazana-top-section")+" > .qazana-container > .qazana-row",handle:"> .qazana-element-overlay .qazana-editor-element-edit",items:"> .qazana-column",forcePlaceholderSize:!0,tolerance:"pointer"}},getColumnPercentSize:function(e,t){return+(t/e.parent().width()*100).toFixed(3)},getDefaultStructure:function(){return this.collection.length+"0"},getStructure:function(){return this.model.getSetting("structure")},setStructure:function(e){if(+qazana.presetsFactory.getParsedStructure(e).columnsCount!==this.collection.length)throw new TypeError("The provided structure doesn't match the columns count.");this.model.setSetting("structure",e)},redefineLayout:function(){var n=qazana.presetsFactory.getPresetByStructure(this.getStructure());this.collection.each(function(e,t){e.setSetting("_column_size",n.preset[t]),e.setSetting("_inline_size",null)})},resetLayout:function(){this.setStructure(this.getDefaultStructure())},resetColumnsCustomSize:function(){this.collection.each(function(e){e.setSetting("_inline_size",null)})},isCollectionFilled:function(){return 10<=this.collection.length},_checkIsFull:function(){this.$el.toggleClass("qazana-section-filled",this.isCollectionFilled())},_checkIsEmpty:function(){this.collection.length||this.model.get("allowEmpty")||this.addChildElement(null,{edit:!1})},getColumnAt:function(e){e=this.collection.at(e);return e?this.children.findByModelCid(e.cid):null},getNextColumn:function(e){return this.getColumnAt(this.collection.indexOf(e.model)+1)},getPreviousColumn:function(e){return this.getColumnAt(this.collection.indexOf(e.model)-1)},showChildrenPercentsTooltip:function(e,t){e.ui.percentsTooltip.show(),e.ui.percentsTooltip.attr("data-side",qazana.config.is_rtl?"right":"left"),t.ui.percentsTooltip.show(),t.ui.percentsTooltip.attr("data-side",qazana.config.is_rtl?"left":"right")},hideChildrenPercentsTooltip:function(e,t){e.ui.percentsTooltip.hide(),t.ui.percentsTooltip.hide()},resizeChild:function(e,t,n){var i=this.getNextColumn(e)||this.getPreviousColumn(e);if(!i)throw new ReferenceError("There is not any next column");e=i.$el,e=+(t+(+i.model.getSetting("_inline_size")||this.getColumnPercentSize(e,e[0].getBoundingClientRect().width))-n).toFixed(3);if(e<2)throw new RangeError(this.errors.columnWidthTooLarge);if(n<2)throw new RangeError(this.errors.columnWidthTooSmall);return i.model.setSetting("_inline_size",e),!0},destroyAddSectionView:function(){this.addSectionView&&!this.addSectionView.isDestroyed&&this.addSectionView.destroy()},onRender:function(){o.prototype.onRender.apply(this,arguments),this._checkIsFull()},onSettingsChanged:function(e){o.prototype.onSettingsChanged.apply(this,arguments),e.changed.structure&&this.redefineLayout()},onAddButtonClick:function(){var e,t;!this.addSectionView||this.addSectionView.isDestroyed?(e=this.model.collection.indexOf(this.model),(t=new a.default({at:e})).render(),this.$el.before(t.$el),t.$el.hide(),setTimeout(function(){t.$el.slideDown()}),this.addSectionView=t):this.addSectionView.fadeToDeath()},onAddChild:function(){this.isBuffering||this.model.get("allowEmpty")||this.resetLayout()},onRemoveChild:function(){this.isManualRemoving&&(this._checkIsEmpty(),this.resetLayout())},onChildviewRequestResizeStart:function(e){var t=this.getNextColumn(e);t&&(this.showChildrenPercentsTooltip(e,t),t=e.$el.find("iframe").add(t.$el.find("iframe")),qazana.helpers.disableElementEvents(t))},onChildviewRequestResizeStop:function(e){var t=this.getNextColumn(e);t&&(this.hideChildrenPercentsTooltip(e,t),t=e.$el.find("iframe").add(t.$el.find("iframe")),qazana.helpers.enableElementEvents(t))},onChildviewRequestResize:function(e,t){var n=+e.model.getSetting("_inline_size")||this.getColumnPercentSize(e.$el,e.$el.data("originalWidth"));t.element.css({width:"",left:"initial"});var i=this.getColumnPercentSize(t.element,t.size.width);try{this.resizeChild(e,n,i)}catch(e){return}e.model.setSetting("_inline_size",i)},onDestroy:function(){o.prototype.onDestroy.apply(this,arguments),this.destroyAddSectionView()}});e.exports=i},function(e,t,i){"use strict";var n=i(0);i(85)(t,"__esModule",{value:!0}),t.default=void 0,i(75),i(59);var a=n(i(99)),o=n(i(92)),r=n(i(93)),s=n(i(100)),l=n(i(101)),c=n(i(96));function u(n){var i=function(){if("undefined"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(n);return t=i?(e=(0,c.default)(this).constructor,(0,a.default)(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,t)}}n=function(e){(0,s.default)(n,e);var t=u(n);function n(){return(0,o.default)(this,n),t.apply(this,arguments)}return(0,r.default)(n,[{key:"template",value:function(){return Marionette.TemplateCache.get("#tmpl-qazana-add-section")}},{key:"attributes",value:function(){return{"data-view":"choose-action"}}},{key:"ui",value:function(){return{addNewSection:".qazana-add-new-section",closeButton:".qazana-add-section-close",addSectionButton:".qazana-add-section-button",addTemplateButton:".qazana-add-template-button",selectPreset:".qazana-select-preset",presets:".qazana-preset"}}},{key:"events",value:function(){return{"click @ui.addSectionButton":"onAddSectionButtonClick","click @ui.addTemplateButton":"onAddTemplateButtonClick","click @ui.closeButton":"onCloseButtonClick","click @ui.presets":"onPresetSelected"}}},{key:"behaviors",value:function(){return{contextMenu:{behaviorClass:i(145),groups:this.getContextMenuGroups()}}}},{key:"className",value:function(){return"qazana-add-section qazana-visible-desktop"}},{key:"addSection",value:function(e,t){return qazana.getPreviewView().addChildElement(e,jQuery.extend({},this.options,t))}},{key:"setView",value:function(e){this.$el.attr("data-view",e)}},{key:"showSelectPresets",value:function(){this.setView("select-preset")}},{key:"closeSelectPresets",value:function(){this.setView("choose-action")}},{key:"getTemplatesModalOptions",value:function(){return{importOptions:{at:this.getOption("at")}}}},{key:"getContextMenuGroups",value:function(){function e(){return 0<qazana.elements.length}return[{name:"paste",actions:[{name:"paste",title:qazana.translate("paste"),callback:this.paste.bind(this),isEnabled:this.isPasteEnabled.bind(this)}]},{name:"content",actions:[{name:"copy_all_content",title:qazana.translate("copy_all_content"),callback:this.copy.bind(this),isEnabled:e},{name:"delete_all_content",title:qazana.translate("delete_all_content"),callback:qazana.clearPage.bind(qazana),isEnabled:e}]}]}},{key:"copy",value:function(){qazana.getPreviewView().copy()}},{key:"paste",value:function(){qazana.getPreviewView().paste(this.getOption("at"))}},{key:"isPasteEnabled",value:function(){return qazana.getStorage("transfer")}},{key:"onAddSectionButtonClick",value:function(){this.showSelectPresets()}},{key:"onAddTemplateButtonClick",value:function(){qazana.templates.startModal(this.getTemplatesModalOptions())}},{key:"onRender",value:function(){this.$el.html5Droppable({axis:["vertical"],groups:["qazana-element"],placeholder:!1,currentElementClass:"qazana-html5dnd-current-element",hasDraggingOnChildClass:"qazana-dragging-on-child",onDropping:this.onDropping.bind(this)})}},{key:"onPresetSelected",value:function(e){this.closeSelectPresets();for(var t=e.currentTarget.dataset.structure,n=qazana.presetsFactory.getParsedStructure(t),i=[],a=0;a<n.columnsCount;a++)i.push({id:qazana.helpers.getUniqueID(),elType:"column",settings:{},elements:[]});qazana.channels.data.trigger("element:before:add",{elType:"section"});e=this.addSection({elements:i});e.setStructure(t),e.getEditModel().trigger("request:edit"),qazana.channels.data.trigger("element:after:add")}},{key:"onDropping",value:function(){qazana.channels.data.trigger("section:before:drop"),this.addSection().addElementFromPanel(),qazana.channels.data.trigger("section:after:drop")}}]),n}(Marionette.ItemView);t.default=n},function(e,t,n){"use strict";n(1),e.exports=Marionette.Behavior.extend({previewWindow:null,ui:function(){return{buttonPreview:"#qazana-panel-footer-saver-button-preview",buttonPublish:"#qazana-panel-footer-saver-button-publish",buttonSaveOptions:"#qazana-panel-footer-saver-button-save-options",buttonPublishLabel:"#qazana-panel-footer-saver-button-publish-label",menuSaveDraft:"#qazana-panel-footer-saver-menu-save-draft",lastEditedWrapper:".qazana-last-edited-wrapper"}},events:function(){return{"click @ui.buttonPreview":"onClickButtonPreview","click @ui.buttonPublish":"onClickButtonPublish","click @ui.menuSaveDraft":"onClickMenuSaveDraft"}},initialize:function(){qazana.saver.on("before:save",this.onBeforeSave.bind(this)).on("after:save",this.onAfterSave.bind(this)).on("after:saveError",this.onAfterSaveError.bind(this)).on("page:status:change",this.onPageStatusChange),qazana.settings.page.model.on("change",this.onPageSettingsChange.bind(this)),qazana.channels.editor.on("status:change",this.activateSaveButtons.bind(this))},activateSaveButtons:function(e){e=e||"draft"===qazana.settings.page.model.get("post_status"),this.ui.buttonPublish.add(this.ui.menuSaveDraft).toggleClass("qazana-saver-disabled",!e),this.ui.buttonSaveOptions.toggleClass("qazana-saver-disabled",!e)},onRender:function(){this.setMenuItems(qazana.settings.page.model.get("post_status")),this.addTooltip()},onPageSettingsChange:function(e){e=e.changed;_.isUndefined(e.post_status)||(this.setMenuItems(e.post_status),this.refreshWpPreview(),"page_settings"===qazana.getPanelView().getCurrentPageName()&&qazana.getPanelView().getCurrentPageView().render())},onPageStatusChange:function(e){"publish"===e&&qazana.notifications.showToast({message:qazana.config.document.panel.messages.publish_notification,buttons:[{name:"view_page",text:qazana.translate("have_a_look"),callback:function(){open(qazana.config.document.urls.permalink)}}]})},onBeforeSave:function(e){NProgress.start(),"autosave"===e.status?this.ui.lastEditedWrapper.addClass("qazana-state-active"):this.ui.buttonPublish.addClass("qazana-button-state")},onAfterSave:function(e){NProgress.done(),this.ui.buttonPublish.removeClass("qazana-button-state"),this.ui.lastEditedWrapper.removeClass("qazana-state-active"),this.refreshWpPreview(),this.setLastEdited(e)},setLastEdited:function(e){this.ui.lastEditedWrapper.removeClass("qazana-button-state").find(".qazana-last-edited").html(e.config.last_edited)},onAfterSaveError:function(){NProgress.done(),this.ui.buttonPublish.removeClass("qazana-button-state")},onClickButtonPreview:function(){this.previewWindow=open(qazana.config.document.urls.wp_preview,"wp-preview-"+qazana.config.document.id),qazana.saver.isEditorChanged()&&(qazana.saver.isSaving&&(qazana.saver.isSaving=!1),qazana.saver.doAutoSave())},onClickButtonPublish:function(){var e=qazana.settings.page.model.get("post_status");if(!this.ui.buttonPublish.hasClass("qazana-saver-disabled"))switch(e){case"publish":case"private":qazana.saver.update();break;case"draft":qazana.config.current_user_can_publish?qazana.saver.publish():qazana.saver.savePending();break;case"pending":case void 0:qazana.config.current_user_can_publish?qazana.saver.publish():qazana.saver.update()}},onClickMenuSaveDraft:function(){qazana.saver.saveDraft()},setMenuItems:function(e){var t="publish";switch(e){case"publish":case"private":t="update",qazana.config.current_revision_id!==qazana.config.document.id&&this.activateSaveButtons(!0);break;case"draft":qazana.config.current_user_can_publish||(t="submit"),this.activateSaveButtons(!0);break;case"pending":case void 0:qazana.config.current_user_can_publish||(t="update")}this.ui.buttonPublishLabel.html(qazana.translate(t))},addTooltip:function(){this.$el.find(".tooltip-target").tipsy({gravity:"s",title:function(){return this.getAttribute("data-tooltip")}})},refreshWpPreview:function(){if(this.previewWindow)try{this.previewWindow.location.href=qazana.config.document.urls.wp_preview}catch(e){}}})},function(e,t,n){var i=n(23).f,a=n(42),o=n(4)("toStringTag");e.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,o)&&i(e,o,{configurable:!0,value:t})}},function(e,t,n){"use strict";n(1),n=Marionette.Behavior.extend({onRenderCollection:function(){this.handleInnerTabs(this.view)},handleInnerTabs:function(o){var e=o.children.filter(function(e){return"tabs"===e.model.get("type")});_.each(e,function(a){a.$el.find(".qazana-control-content").remove();var t=a.model.get("name"),e=o.children.filter(function(e){return"tab"===e.model.get("type")&&e.model.get("tabs_wrapper")===t});_.each(e,function(e,t){a._addChildView(e);var n=e.model.get("name"),i=o.children.filter(function(e){return n===e.model.get("inner_tab")});0===t?e.$el.addClass("qazana-tab-active"):_.each(i,function(e){e.$el.addClass("qazana-tab-close")})})})},onChildviewControlTabClicked:function(t){var n="qazana-tab-close",i="qazana-tab-active",a=t.model.get("name"),e=this.view.children.filter(function(e){return"tab"!==e.model.get("type")&&t.model.get("tabs_wrapper")===e.model.get("tabs_wrapper")}),o=this.view.children.filter(function(e){return"tab"===e.model.get("type")&&t.model.get("tabs_wrapper")===e.model.get("tabs_wrapper")});_.each(o,function(e){e.$el.removeClass(i)}),t.$el.addClass(i),_.each(e,function(e){e.model.get("inner_tab")===a?e.$el.removeClass(n):e.$el.addClass(n)}),qazana.getPanelView().updateScrollbar()}}),e.exports=n},function(e,t,n){"use strict";n(1);var i=n(136),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.sliders=".qazana-slider",e.colors=".qazana-shadow-color-picker",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"slide @ui.sliders":"onSlideChange"})},initSliders:function(){var n=this.getControlValue();this.ui.sliders.each(function(){var e=jQuery(this),t=e.next(".qazana-slider-input").find("input");e.slider({value:n[this.dataset.input],min:+t.attr("min"),max:+t.attr("max")})})},initColors:function(){var n=this;qazana.helpers.wpColorPicker(this.ui.colors,{change:function(){var e=jQuery(this),t=e.data("setting");n.setValue(t,e.wpColorPicker("color"))},clear:function(){n.setValue(this.dataset.setting,"")}})},onInputChange:function(e){e=e.currentTarget.dataset.setting;this.ui.sliders.filter('[data-input="'+e+'"]').slider("value",this.getControlValue(e))},onReady:function(){this.initSliders(),this.initColors()},onSlideChange:function(e,t){e=e.currentTarget.dataset.input;this.ui.input.filter('[data-setting="'+e+'"]').val(t.value),this.setValue(e,t.value)},onBeforeDestroy:function(){this.ui.colors.each(function(){var e=jQuery(this);e.wpColorPicker("instance")&&e.wpColorPicker("close")}),this.$el.remove()}});e.exports=n},function(e,t,n){"use strict";var i=n(41),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.inputs='[type="radio"]',e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"mousedown label":"onMouseDownLabel","click @ui.inputs":"onClickInput","change @ui.inputs":"onBaseInputChange"})},onMouseDownLabel:function(e){e=this.$(e.currentTarget),e=this.$("#"+e.attr("for"));e.data("checked",e.prop("checked"))},onClickInput:function(e){!this.model.get("toggle")||(e=this.$(e.currentTarget)).data("checked")&&e.prop("checked",!1).trigger("change")},onRender:function(){i.prototype.onRender.apply(this,arguments);var e=this.getControlValue();e&&this.ui.inputs.filter('[value="'+e+'"]').prop("checked",!0)}},{onPasteStyle:function(e,t){return""===t||void 0!==e.options[t]}});e.exports=n},function(e,t,n){"use strict";n=n(136).extend({getCurrentRange:function(){return this.getUnitRange(this.getControlValue("unit"))},getUnitRange:function(e){var t=this.model.get("range");return!(!t||!t[e])&&t[e]}});e.exports=n},function(e,t,n){"use strict";n(164),n(147),n(59);var i=n(41),n=Marionette.CompositeView.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-repeater-row"),className:"qazana-repeater-fields",ui:{duplicateButton:".qazana-repeater-tool-duplicate",editButton:".qazana-repeater-tool-edit",removeButton:".qazana-repeater-tool-remove",itemTitle:".qazana-repeater-row-item-title"},behaviors:{HandleInnerTabs:{behaviorClass:n(190)}},triggers:{"click @ui.removeButton":"click:remove","click @ui.duplicateButton":"click:duplicate","click @ui.itemTitle":"click:edit"},modelEvents:{change:"onModelChange"},templateHelpers:function(){return{itemIndex:this.getOption("itemIndex")}},childViewContainer:".qazana-repeater-row-controls",getChildView:function(e){e=e.get("type");return qazana.getControlView(e)},childViewOptions:function(){return{elementSettingsModel:this.model}},updateIndex:function(e){this.itemIndex=e},setTitle:function(){var t,e=this.getOption("titleField"),n="";e&&(t={},this.children.each(function(e){e instanceof i&&(t[e.model.get("name")]=e.getControlValue())}),n=Marionette.TemplateCache.prototype.compileTemplate(e)(this.model.parseDynamicSettings())),n=n||qazana.translate("Item #{0}",[this.getOption("itemIndex")]),this.ui.itemTitle.html(n)},initialize:function(e){this.itemIndex=0,this.collection=new Backbone.Collection(_.values(qazana.mergeControlsSettings(e.controlFields)))},onRender:function(){this.setTitle()},onModelChange:function(){this.getOption("titleField")&&this.setTitle()},onChildviewResponsiveSwitcherClick:function(e,t){"desktop"===t&&qazana.getPanelView().getCurrentPageView().$el.toggleClass("qazana-responsive-switchers-open")}});e.exports=n},function(e,t,a){"use strict";var n=a(0);a(45);var o=n(a(60)),i=a(105),r=a(330),n=Backbone.Model.extend({defaults:{id:"",elType:"",isInner:!1,settings:{},defaultEditSettings:{}},remoteRender:!1,_htmlCache:null,_jqueryXhr:null,renderOnLeave:!1,initialize:function(e){var t,n=this.get("elType"),i=this.get("elements");void 0!==i&&(t=a(196),this.set("elements",new t(i))),"widget"===n&&(this.remoteRender=!0,this.setHtmlCache(e.htmlCache||"")),delete e.htmlCache,this.renderRemoteServer=_.throttle(this.renderRemoteServer,1e3),this.initSettings(),this.initEditSettings(),this.on({destroy:this.onDestroy,"editor:close":this.onCloseEditor})},initSettings:function(){var e=this.get("elType"),t=this.get("settings"),n={column:r}[e]||i;jQuery.isEmptyObject(t)&&(t=qazana.helpers.cloneObject(t)),"widget"===e&&(t.widgetType=this.get("widgetType")),t.elType=e,t.isInner=this.get("isInner"),t=new n(t,{controls:qazana.getElementControls(this)}),this.set("settings",t),qazanaFrontend.config.elements.data[this.cid]=t},initEditSettings:function(){var e=new Backbone.Model(this.get("defaultEditSettings"));this.set("editSettings",e),qazanaFrontend.config.elements.editSettings[this.cid]=e},setSetting:function(e,t){var n,i,a=this.get("settings");"object"!==(0,o.default)(e)&&(i=3===(n=e.split(".")).length,e=n[0],i&&(a=a.get(e).models[n[1]],e=n[2])),a.setExternalChange(e,t)},getSetting:function(e){var t=e.split("."),n=3===t.length,i=this.get("settings");e=t[0];e=i.get(e);return void 0===e?"":(n&&(e=e.models[t[1]].get(t[2])),e)},setHtmlCache:function(e){this._htmlCache=e},getHtmlCache:function(){return this._htmlCache},getDefaultTitle:function(){return qazana.getElementData(this).title},getTitle:function(){return this.getSetting("_title")||this.getDefaultTitle()},getIcon:function(){return qazana.getElementData(this).icon},createRemoteRenderRequest:function(){var e=this.toJSON();return qazana.ajax.addRequest("render_widget",{unique_id:this.cid,data:{data:e},success:this.onRemoteGetHtml.bind(this)},!0).jqXhr},renderRemoteServer:function(){this.remoteRender&&(this.renderOnLeave=!1,this.trigger("before:remote:render"),this.isRemoteRequestActive()&&this._jqueryXhr.abort(),this._jqueryXhr=this.createRemoteRenderRequest())},isRemoteRequestActive:function(){return this._jqueryXhr&&4!==this._jqueryXhr.readyState},onRemoteGetHtml:function(e){this.setHtmlCache(e.render),this.trigger("remote:render")},clone:function(){var e=new this.constructor(qazana.helpers.cloneObject(this.attributes));e.set("id",qazana.helpers.getUniqueID()),e.setHtmlCache(this.getHtmlCache());var t=this.get("elements");return _.isEmpty(t)||e.set("elements",t.clone()),e},toJSON:function(n){n=_.extend({copyHtmlCache:!1},n);var i=Backbone.Model.prototype.toJSON.call(this);return _.each(i,function(e,t){e&&e.toJSON&&(i[t]=e.toJSON(n))}),n.copyHtmlCache?i.htmlCache=this.getHtmlCache():delete i.htmlCache,i},onCloseEditor:function(){this.renderOnLeave&&this.renderRemoteServer()},onDestroy:function(){var e=this.get("settings"),t=this.get("elements");void 0!==t&&_.each(_.clone(t.models),function(e){e.destroy()}),e.destroy()}});n.prototype.sync=n.prototype.fetch=n.prototype.save=_.noop,e.exports=n},function(e,t,n){"use strict";var i=n(195),a=Backbone.Collection.extend({add:function(e,t,n){if(!(t&&t.silent||n))throw"Call Error: Adding model to element collection is allowed only by the dedicated addChildModel() method.";return Backbone.Collection.prototype.add.call(this,e,t)},model:function(e,t){var n=Backbone.Model;return e.elType&&(n=qazana.hooks.applyFilters("element/model",i,e)),new n(e,t)},clone:function(){var e=Backbone.Collection.prototype.clone.apply(this,arguments),t=new a;return e.forEach(function(e){t.add(e.clone(),null,!0)}),t}});a.prototype.sync=a.prototype.fetch=a.prototype.save=_.noop,e.exports=a},function(e,t,n){"use strict";n(198),e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-global",id:"qazana-panel-global",initialize:function(){qazana.getPanelView().getCurrentPageView().search.reset()},onDestroy:function(){var t=qazana.getPanelView();"elements"===t.getCurrentPageName()&&setTimeout(function(){var e=t.getCurrentPageView();e.search.currentView||e.showView("search")})}})},function(e,t,n){"use strict";var s=n(8),l=n(333),c=n(63);n(64)("search",1,function(i,a,o,r){return[function(e){var t=i(this),n=null==e?void 0:e[a];return void 0!==n?n.call(e,t):new RegExp(e)[a](String(t))},function(e){var t=r(o,e,this);if(t.done)return t.value;var n=s(e),t=String(this),e=n.lastIndex;l(e,0)||(n.lastIndex=0);t=c(n,t);return l(n.lastIndex,e)||(n.lastIndex=e),null===t?-1:t.index}]})},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({template:"#tmpl-qazana-element-library-element",className:"qazana-element-wrapper",onRender:function(){var e=this;qazana.userCan("design")&&this.$el.html5Draggable({onDragStart:function(){qazana.channels.panelElements.reply("element:selected",e).trigger("element:drag:start")},onDragEnd:function(){qazana.channels.panelElements.trigger("element:drag:end")},groups:["qazana-element"]})}});e.exports=i},function(e,t,n){"use strict";var i=Backbone.Model.extend({defaults:{title:"",categories:[],keywords:[],icon:"",elType:"widget",widgetType:""}});e.exports=i},function(e,t,n){"use strict";n=n(200),n=Backbone.Collection.extend({model:n});e.exports=n},function(e,t,n){"use strict";var i=n(203),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.systemSchemes=".qazana-panel-scheme-color-system-scheme",e},events:function(){var e=i.prototype.events.apply(this,arguments);return e["click @ui.systemSchemes"]="onSystemSchemeClick",e},getType:function(){return"color"},onSystemSchemeClick:function(e){e=jQuery(e.currentTarget).data("schemeName"),e=qazana.config.system_schemes[this.getType()][e].items;this.changeChildrenUIValues(e)}});e.exports=n},function(e,t,n){"use strict";var i={color:n(363),typography:n(364)},n=Marionette.CompositeView.extend({id:function(){return"qazana-panel-scheme-"+this.getType()},className:function(){return"qazana-panel-scheme qazana-panel-scheme-"+this.getUIType()},childViewContainer:".qazana-panel-scheme-items",getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-panel-schemes-"+this.getType())},getChildView:function(){return i[this.getUIType()]},getUIType:function(){return this.getType()},ui:function(){return{saveButton:".qazana-panel-scheme-save .qazana-button",discardButton:".qazana-panel-scheme-discard .qazana-button",resetButton:".qazana-panel-scheme-reset .qazana-button"}},events:function(){return{"click @ui.saveButton":"saveScheme","click @ui.discardButton":"discardScheme","click @ui.resetButton":"setDefaultScheme"}},initialize:function(){this.model=new Backbone.Model,this.resetScheme()},getType:function(){},getScheme:function(){return qazana.schemes.getScheme(this.getType())},changeChildrenUIValues:function(e){var n=this;_.each(e,function(e,t){t=n.collection.findWhere({key:t});n.children.findByModelCid(t.cid).changeUIValue(e)})},discardScheme:function(){qazana.schemes.resetSchemes(this.getType()),this.onSchemeChange(),this.ui.saveButton.prop("disabled",!0),this._renderChildren()},setSchemeValue:function(e,t){qazana.schemes.setSchemeValue(this.getType(),e,t),this.onSchemeChange()},saveScheme:function(){qazana.schemes.saveScheme(this.getType()),this.ui.saveButton.prop("disabled",!0),this.resetScheme(),this._renderChildren()},setDefaultScheme:function(){var e=qazana.config.default_schemes[this.getType()].items;this.changeChildrenUIValues(e)},resetItems:function(){this.model.set("items",this.getScheme().items)},resetCollection:function(){var n=this,e=n.model.get("items");n.collection=new Backbone.Collection,_.each(e,function(e,t){e.type=n.getType(),e.key=t,n.collection.add(e)})},resetScheme:function(){this.resetItems(),this.resetCollection()},onSchemeChange:function(){qazana.schemes.printSchemesStyle()},onChildviewValueChange:function(e,t){this.ui.saveButton.removeProp("disabled"),this.setSchemeValue(e.model.get("key"),t)}});e.exports=n},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-panel-scheme-"+this.getUIType()+"-item")},className:function(){return"qazana-panel-scheme-item"}});e.exports=i},function(e,t,n){n(206),n(207),e.exports=n(209)},function(e,t,n){"use strict";var i;n(28),n(47),n(27),(i=jQuery).fn.qazanaSerializeObject=function(){function r(e,t,n){var i=/^[^\[\]]+\[]/.test(t),a=/^[^\[\]]+\[[^\[\]]+]/.test(t),o=t.replace(/\[.*/,"");if(i)e[o]||(e[o]=[]);else{if(!a)return void(e.push?e.push(n):e[o]=n);e[o]||(e[o]={})}return(t=t.match(/\[[^\[\]]*]/g))[0]=t[0].replace(/\[|]/g,""),r(e[o],t.join(""),n)}var e=this.serializeArray(),t={};return i.each(e,function(){r(t,this.name,this.value)}),t}},function(e,t,n){"use strict";var i=n(0);n(47);var m,s=i(n(108));function v(e){try{return e.originalEvent.dataTransfer.setData("test","test"),e.originalEvent.dataTransfer.clearData("test"),1}catch(e){return}}m=jQuery,n={html5Draggable:function(e){function t(e){m.isFunction(a.onDragEnd)&&a.onDragEnd.call(o.$element,e,i)}function n(e){var t={groups:a.groups||[]};v(e)&&e.originalEvent.dataTransfer.setData((0,s.default)(t),!0),m.isFunction(a.onDragStart)&&a.onDragStart.call(o.$element,e,i)}var i=this,a={},o={},r={element:"",groups:null,onDragStart:null,onDragEnd:null};this.destroy=function(){o.$element.off("dragstart",n),o.$element.removeAttr("draggable")},m.extend(!0,a,r,e),o.$element=m(a.element),o.$element.attr("draggable",!0),o.$element.on("dragstart",n).on("dragend",t)},html5Droppable:function(e){function i(){return-1!==p.axis.indexOf("vertical")}function a(e,t){var n;return-1!==p.axis.indexOf("horizontal")&&(i()?!!(n=p.horizontalSensitivity.match(/\d+/))&&(n=n[0],/%$/.test(p.horizontalSensitivity)&&(n=t/n),t-n<e?"right":e<n&&"left"):t/2<e?"right":"left")}function n(e){var t=(n=m(u)).outerHeight()-g.$placeholder.outerHeight(),n=n.outerWidth();e=e.originalEvent,d=(d=a(e.offsetX,n))||(i()?(n=u.getBoundingClientRect(),e.clientY>n.top+t/2?"bottom":"top"):null)}function o(){var e;p.placeholder&&(e="top"===d?"prependTo":"appendTo",g.$placeholder[e](u))}function r(e){var t,n,i;return!(p.groups&&v(e)&&(t=e.originalEvent.dataTransfer.types,i=!1,(t=Array.prototype.slice.apply(t)).forEach(function(e){try{if(!(n=JSON.parse(e)).groups.slice)return;p.groups.forEach(function(e){if(-1!==n.groups.indexOf(e))return!(i=!0)})}catch(e){}}),!i))&&!(m.isFunction(p.isDroppingAllowed)&&!p.isDroppingAllowed.call(u,d,e,h))}function s(e){e.stopPropagation(),u||(u=this,g.$element.parents().each(function(){var e=m(this).data("html5Droppable");e&&e.doDragLeave()}),n(e),r(e)&&(o(),g.$element.addClass(p.hasDraggingOnChildClass),m(u).addClass(p.currentElementClass),m.isFunction(p.onDragEnter)&&p.onDragEnter.call(u,d,e,h)))}function t(e){e.stopPropagation(),u||s.call(this,e);var t=d;n(e),r(e)&&(e.preventDefault(),t!==d&&o(),m.isFunction(p.onDragging)&&p.onDragging.call(this,d,e,h))}function l(e){var t=this.getBoundingClientRect();("dragleave"!==e.type||e.clientX<t.left||e.clientX>=t.right||e.clientY<t.top||e.clientY>=t.bottom)&&(m(u).removeClass(p.currentElementClass),h.doDragLeave())}function c(e){n(e),r(e)&&(e.preventDefault(),m.isFunction(p.onDropping)&&p.onDropping.call(this,d,e,h))}var u,d,h=this,p={},g={},f={element:"",items:">",horizontalSensitivity:"10%",axis:["vertical","horizontal"],placeholder:!0,currentElementClass:"html5dnd-current-element",placeholderClass:"html5dnd-placeholder",hasDraggingOnChildClass:"html5dnd-has-dragging-on-child",groups:null,isDroppingAllowed:null,onDragEnter:null,onDragging:null,onDropping:null,onDragLeave:null};this.doDragLeave=function(){p.placeholder&&g.$placeholder.remove(),g.$element.removeClass(p.hasDraggingOnChildClass),m.isFunction(p.onDragLeave)&&p.onDragLeave.call(u,event,h),u=d=null},this.destroy=function(){g.$element.off("dragenter",p.items,s).off("dragover",p.items,t).off("drop",p.items,c).off("dragleave drop",p.items,l)},m.extend(p,f,e),g.$element=m(p.element),g.$placeholder=m("<div>",{class:p.placeholderClass}),g.$element.on("dragenter",p.items,s).on("dragover",p.items,t).on("drop",p.items,c).on("dragleave drop",p.items,l)}},m.each(n,function(n,i){m.fn[n]=function(t){return t=t||{},this.each(function(){var e=m.data(this,n);e instanceof i?"destroy"===t&&(e.destroy(),m.removeData(this,n)):(t.element=this,m.data(this,n,new i(t)))}),this}})},function(e,t,n){var n=n(3),i=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,r){"use strict";var n=r(0);r(1),r(27);var i=n(r(108)),a=n(r(210)),o=n(r(213));Marionette.TemplateCache.prototype.compileTemplate=function(e,t){return t={evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g},_.template(e,t)};n=Marionette.Application.extend({previewLoadedOnce:!1,helpers:r(232),imagesManager:r(243),debug:r(244),schemes:r(245),presetsFactory:r(246),templates:r(247),ajax:r(262),conditions:r(263),hotKeys:r(161),history:r(264),channels:{editor:Backbone.Radio.channel("QAZANA:editor"),data:Backbone.Radio.channel("QAZANA:data"),panelElements:Backbone.Radio.channel("QAZANA:panelElements"),dataEditMode:Backbone.Radio.channel("QAZANA:editmode"),deviceMode:Backbone.Radio.channel("QAZANA:deviceMode"),templates:Backbone.Radio.channel("QAZANA:templates")},modules:{Module:r(46),components:{templateLibrary:{views:{parts:{headerParts:{logo:r(143)}},BaseModalLayout:r(142)}},saver:{behaviors:{HeaderSaver:r(294),FooterSaver:r(188)}}},controls:{Animation:r(139),Base:r(140),BaseData:r(41),BaseMultiple:r(136),Box_shadow:r(191),Button:r(303),Choose:r(192),Code:r(304),Color:r(305),Date_time:r(306),Dimensions:r(307),Font:r(310),Gallery:r(311),Hover_animation:r(139),Icon:r(312),Image_dimensions:r(313),Media:r(314),Number:r(315),Order:r(317),Query:r(318),Popover_toggle:r(319),Repeater:r(320),RepeaterRow:r(194),Section:r(321),Select:r(322),Select2:r(139),Slider:r(323),Structure:r(324),Switcher:r(325),Tab:r(326),Text_shadow:r(191),Url:r(327),Wp_widget:r(328),Wysiwyg:r(329)},elements:{models:{BaseSettings:r(105),Element:r(195)},views:{Widget:r(331)}},layouts:{panel:{pages:{elements:{views:{Global:r(197),Elements:r(334)}},menu:{Menu:r(335)}}}},views:{ControlsStack:r(146)}},backgroundClickListeners:{popover:{element:".qazana-controls-popover",ignore:".qazana-control-popover-toggle-toggle, .qazana-control-popover-toggle-toggle-label, .select2-container"},tagsList:{element:".qazana-tags-list",ignore:".qazana-control-dynamic-switcher"}},userCan:function(e){return-1===this.config.user.restrictions.indexOf(e)},_defaultDeviceMode:"desktop",addControlView:function(e,t){this.modules.controls[qazana.helpers.firstLetterUppercase(e)]=t},checkEnvCompatibility:function(){return this.envData.gecko||this.envData.webkit},getElementData:function(e){var t=e.get("elType");if("widget"===t){var n=e.get("widgetType");return this.config.widgets[n]?this.config.widgets[n]:!1}if(!this.config.elements[t])return!1;n=this.helpers.cloneObject(this.config.elements[t]);return"section"===t&&e.get("isInner")&&(n.title=qazana.translate("inner_section")),n},getElementControls:function(e){var t=this.getElementData(e);if(!t)return!1;var n=e.get("isInner"),i={};return _.each(t.controls,function(e,t){n&&e.hide_in_inner||!n&&e.hide_in_top||(i[t]=e)}),i},mergeControlsSettings:function(n){var i=this;return _.each(n,function(e,t){n[t]=jQuery.extend(!0,{},i.config.controls[e.type],e)}),n},getControlView:function(e){var t=qazana.helpers.firstLetterUppercase(e),t=this.modules.controls[t];return t||(e=-1!==this.config.controls[e].features.indexOf("ui"),t=this.modules.controls[e?"Base":"BaseData"]),t},getPanelView:function(){return this.panel.currentView},getPreviewView:function(){return this.sections.currentView},initEnvData:function(){this.envData=_.pick(tinymce.Env,["desktop","mac","webkit","gecko","ie","opera"])},initComponents:function(){var e=r(166),t=r(338),n=r(340),i=r(344),a=r(345),o=r(346);this.hooks=new e,this.saver=new i,this.settings=new n,this.dynamicTags=new t,this.templates.init(),this.initDialogsManager(),this.documentConditions=new o,this.notifications=new a,this.ajax.init(),this.initHotKeys(),this.initEnvData()},initDialogsManager:function(){this.dialogsManager=new DialogsManager.Instance},initElements:function(){var e=r(196),t=this.config.data;this.elements&&(t=this.elements.toJSON()),this.elements=new e(t),this.elementsModel=new Backbone.Model({elements:this.elements})},initPreview:function(){var e=jQuery;this.$previewWrapper=e("#qazana-preview"),this.$previewResponsiveWrapper=e("#qazana-preview-responsive-wrapper");this.$preview||(this.$preview=e("<iframe>",{id:"qazana-preview-iframe",src:this.config.document.urls.preview,allowfullscreen:1}),this.$previewResponsiveWrapper.append(this.$preview)),this.$preview.on("load",this.onPreviewLoaded.bind(this))},initFrontend:function(){var e=this.$preview[0].contentWindow;window.qazanaFrontend=e.qazanaFrontend,e.qazana=this,qazanaFrontend.init(),qazanaFrontend.elementsHandler.initHandlers(),this.trigger("frontend:init")},initClearPageDialog:function(){var e,t=this;t.getClearPageDialog=function(){return e=e||this.dialogsManager.createWidget("confirm",{id:"qazana-clear-page-dialog",headerMessage:qazana.translate("clear_page"),message:qazana.translate("dialog_confirm_clear_page"),position:{my:"center center",at:"center center"},strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},onConfirm:function(){t.elements.reset()}})}},initHotKeys:function(){var e=67,t=68,n=73,i=76,a=77,o=80,r=83,s=86,l=46,c=jQuery,u={},d=this.hotKeys;u[e]={copyElement:{isWorthHandling:function(e){if(!d.isControlEvent(e))return!1;if(!("editor"===qazana.getPanelView().getCurrentPageName()))return!1;var t=qazanaFrontend.getElements("window"),e=getSelection()+t.getSelection();return!e&&qazana.envData.gecko&&(e=[window,t].some(function(e){var t,n=e.document.activeElement;if(n&&-1!==["INPUT","TEXTAREA"].indexOf(n.tagName)){"INPUT"===n.tagName&&(t=n.type,n.type="text");e=n.value.substring(n.selectionStart,n.selectionEnd);return n.type=t,!!e}})),!e},handle:function(){qazana.getPanelView().getCurrentPageView().getOption("editedElementView").copy()}}},u[t]={duplicateElement:{isWorthHandling:function(e){return d.isControlEvent(e)},handle:function(){var e=qazana.getPanelView();"editor"===e.getCurrentPageName()&&e.getCurrentPageView().getOption("editedElementView").duplicate()}}},u[n]={navigator:{isWorthHandling:function(e){return d.isControlEvent(e)&&"edit"===qazana.channels.dataEditMode.request("activeMode")},handle:function(){qazana.navigator.storage.visible?qazana.navigator.close():qazana.navigator.open()}}},u[i]={showTemplateLibrary:{isWorthHandling:function(e){return d.isControlEvent(e)&&e.shiftKey},handle:function(){qazana.templates.startModal()}}},u[a]={changeDeviceMode:{devices:["desktop","tablet","mobile"],isWorthHandling:function(e){return d.isControlEvent(e)&&e.shiftKey},handle:function(){var e=qazana.channels.deviceMode.request("currentMode"),e=this.devices.indexOf(e);++e>=this.devices.length&&(e=0),qazana.changeDeviceMode(this.devices[e])}}},u[o]={changeEditMode:{isWorthHandling:function(e){return d.isControlEvent(e)},handle:function(){qazana.getPanelView().modeSwitcher.currentView.toggleMode()}}},u[r]={saveEditor:{isWorthHandling:function(e){return d.isControlEvent(e)},handle:function(){qazana.saver.saveDraft()}}},u[s]={pasteElement:{isWorthHandling:function(e){return!!d.isControlEvent(e)&&(-1!==["BODY","IFRAME"].indexOf(document.activeElement.tagName)&&"BODY"===qazanaFrontend.getElements("window").document.activeElement.tagName)},handle:function(e){var t,n=qazana.channels.editor.request("contextMenu:targetView");n||"editor"===(t=qazana.getPanelView()).getCurrentPageName()&&(n=t.getCurrentPageView().getOption("editedElementView")),e.shiftKey?n&&n.pasteStyle&&qazana.getStorage("transfer")&&n.pasteStyle():(n=n||qazana.getPreviewView()).isPasteEnabled()&&n.paste()}}},u[l]={deleteElement:{isWorthHandling:function(e){if(!("editor"===qazana.getPanelView().getCurrentPageName()))return!1;e=c(e.target);return!e.is(":input, .qazana-input")&&!e.closest('[contenteditable="true"]').length},handle:function(){qazana.getPanelView().getCurrentPageView().getOption("editedElementView").removeElement()}}},_.each(u,function(e,n){_.each(e,function(e,t){d.addHotKeyHandler(n,t,e)})}),d.bindListener(this.$window)},initPanel:function(){this.addRegions({panel:r(354)})},initNavigator:function(){this.addRegions({navigator:{el:"#qazana-navigator",regionClass:o.default}})},preventClicksInsideEditor:function(){this.$previewContents.on("submit",function(e){e.preventDefault()}),this.$previewContents.on("click",function(e){var t=jQuery(e.target),n=qazana.channels.dataEditMode.request("activeMode"),i=!!t.closest("#qazana, .pen-menu").length,a=this.contains(t[0]);i&&"edit"===n||!a||(t.closest("a:not(.qazana-clickable)").length&&e.preventDefault(),i||"elements"!==(i=qazana.getPanelView()).getCurrentPageName()&&i.setPage("elements"))})},addBackgroundClickArea:function(e){e.addEventListener("click",this.onBackgroundClick.bind(this),!0)},addBackgroundClickListener:function(e,t){this.backgroundClickListeners[e]=t},removeBackgroundClickListener:function(e){delete this.backgroundClickListeners[e]},showFatalErrorDialog:function(e){var t={id:"qazana-fatal-error-dialog",headerMessage:"",message:"",position:{my:"center center",at:"center center"},strings:{confirm:qazana.translate("learn_more"),cancel:qazana.translate("go_back")},onConfirm:null,onCancel:function(){parent.history.go(-1)},hide:{onBackgroundClick:!1,onButtonClick:!1}};e=jQuery.extend(!0,t,e),this.dialogsManager.createWidget("confirm",e).show()},checkPageStatus:function(){qazana.config.current_revision_id!==qazana.config.document.id&&this.notifications.showToast({message:this.translate("working_on_draft_notification"),buttons:[{name:"view_revisions",text:qazana.translate("view_all_revisions"),callback:function(){var e=qazana.getPanelView();e.setPage("historyPage"),e.getCurrentPageView().activateTab("revisions")}}]})},getStorage:function(e){var t=(t=localStorage.getItem("qazana"))?JSON.parse(t):{};return e?t[e]:t},setStorage:function(e,t){var n=this.getStorage();n[e]=t,localStorage.setItem("qazana",(0,i.default)(n))},openLibraryOnStart:function(){"#library"===location.hash&&(qazana.templates.startModal(),location.hash="")},enterPreviewMode:function(e){var t=qazanaFrontend.getElements("$body");e&&(t=t.add(this.$body)),t.removeClass("qazana-editor-active").addClass("qazana-editor-preview"),this.$previewQazanaEl.removeClass("qazana-edit-area-active").addClass("qazana-edit-area-preview"),e&&(this.$previewWrapper.css(this.config.is_rtl?"right":"left",""),this.panel.$el.css("width",""))},exitPreviewMode:function(){qazanaFrontend.getElements("$body").add(this.$body).removeClass("qazana-editor-preview").addClass("qazana-editor-active"),this.$previewQazanaEl.removeClass("qazana-edit-area-preview").addClass("qazana-edit-area-active")},changeEditMode:function(e){var t=qazana.channels.dataEditMode,n=t.request("activeMode");t.reply("activeMode",e),e!==n&&t.trigger("switch",e)},reloadPreview:function(){jQuery("#qazana-preview-loading").show(),this.$preview[0].contentWindow.location.reload(!0)},clearPage:function(){this.getClearPageDialog().show()},changeDeviceMode:function(e){var t=this.channels.deviceMode.request("currentMode");t!==e&&(this.$body.removeClass("qazana-device-"+t).addClass("qazana-device-"+e),this.channels.deviceMode.reply("previousMode",t).reply("currentMode",e).trigger("change"))},enqueueTypographyFonts:function(){var t=this,e=this.schemes.getScheme("typography");t.helpers.resetEnqueuedFontsCache(),_.each(e.items,function(e){t.helpers.enqueueFont(e.value.font_family)})},translate:function(e,n,t){t=(t=t||this.config.i18n)[e];return void 0===t&&(t=e),n&&(t=(t=t.replace(/{(\d+)}/g,function(e,t){return void 0!==n[t]?n[t]:e})).replace(/%(?:(\d+)\$)?s/g,function(e,t){return t=t||1,void 0!==n[--t]?n[t]:e})),t},onStart:function(){this.$window=jQuery(window),this.$body=jQuery("body"),NProgress.start(),NProgress.inc(.2),this.config=QazanaConfig,Backbone.Radio.DEBUG=!1,Backbone.Radio.tuneIn("QAZANA"),this.initComponents(),this.checkEnvCompatibility()||this.onEnvNotCompatible(),this.channels.dataEditMode.reply("activeMode","edit"),this.listenTo(this.channels.dataEditMode,"switch",this.onEditModeSwitched),this.initClearPageDialog(),this.addBackgroundClickArea(document),this.$window.trigger("qazana:init"),this.initPreview()},onPreviewLoaded:function(){var e;NProgress.done(),this.$preview[0].contentWindow.qazanaFrontend?(this.$previewContents=this.$preview.contents(),this.$previewQazanaEl=this.$previewContents.find("#qazana"),this.$previewQazanaEl.length?(this.initFrontend(),this.initElements(),e=new Marionette.Region({el:this.$previewQazanaEl[0]}),this.schemes.init(),this.schemes.printSchemesStyle(),this.preventClicksInsideEditor(),this.addBackgroundClickArea(qazanaFrontend.getElements("$document")[0]),this.previewLoadedOnce?this.getPanelView().setPage("elements",null,{autoFocusSearch:!1}):this.onFirstPreviewLoaded(),this.initNavigator(),this.addRegions({sections:e}),e=r(370),this.sections.show(new e({model:this.elementsModel})),this.$previewContents.children().addClass("qazana-html"),qazanaFrontend.getElements("$body").addClass("qazana-editor-active").addClass("qazana-page"),qazana.userCan("design")||qazanaFrontend.getElements("$body").addClass("qazana-editor-content-only"),this.changeDeviceMode(this._defaultDeviceMode),jQuery("#qazana-loading, #qazana-preview-loading").fadeOut(600),_.defer(function(){qazanaFrontend.getElements("window").jQuery.holdReady(!1)}),this.enqueueTypographyFonts(),this.onEditModeSwitched(),this.hotKeys.bindListener(qazanaFrontend.getElements("$window")),this.trigger("preview:loaded")):this.onPreviewElNotFound()):this.onPreviewLoadingError()},onFirstPreviewLoaded:function(){this.initPanel(),this.heartbeat=new a.default,this.checkPageStatus(),this.openLibraryOnStart(),this.previewLoadedOnce=!0},onEditModeSwitched:function(){var e=this.channels.dataEditMode.request("activeMode");"edit"===e?this.exitPreviewMode():this.enterPreviewMode("preview"===e)},onEnvNotCompatible:function(){this.showFatalErrorDialog({headerMessage:this.translate("device_incompatible_header"),message:this.translate("device_incompatible_message"),strings:{confirm:qazana.translate("proceed_anyway")},hide:{onButtonClick:!0},onConfirm:function(){this.hide()}})},onPreviewLoadingError:function(){this.showFatalErrorDialog({headerMessage:this.translate("preview_not_loading_header"),message:this.translate("preview_not_loading_message"),onConfirm:function(){open(qazana.config.help_preview_error_url,"_blank")}})},onPreviewElNotFound:function(){var e=this.$preview[0].contentWindow.qazanaPreviewErrorArgs;(e=e||{headerMessage:this.translate("preview_el_not_found_header"),message:this.translate("preview_el_not_found_message"),confirmURL:qazana.config.help_the_content_url}).onConfirm=function(){open(e.confirmURL,"_blank")},this.showFatalErrorDialog(e)},onBackgroundClick:function(t){jQuery.each(this.backgroundClickListeners,function(){var e=jQuery(t.target);e[0].control&&(e=e.add(e[0].control)),this.ignore&&e.closest(this.ignore).length||(this.callback?this.callback():(e=e.closest(this.element),jQuery(this.element).not(e).hide()))})}});e.exports=(window.qazana=new n).start()},function(e,t,n){"use strict";var i=n(0);n(85)(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(92)),o=i(n(93)),n=function(){function t(){var e,n=this;(0,a.default)(this,t),this.getModal=function(){return e=e||n.initModal()},jQuery(document).on({"heartbeat-send":function(e,t){t.qazana_post_lock={post_ID:qazana.config.document.id}},"heartbeat-tick":function(e,t){t.locked_user?(qazana.saver.isEditorChanged()&&qazana.saver.saveEditor({status:"autosave"}),n.showLockMessage(t.locked_user)):n.getModal().hide(),qazana.config.nonce=t.qazanaNonce},"heartbeat-tick.wp-refresh-nonces":function(e,t){t=t["qazana-refresh-nonces"];t&&(t.heartbeatNonce&&(qazana.config.nonce=t.qazanaNonce),t.heartbeatNonce&&(window.heartbeatSettings.nonce=t.heartbeatNonce))}}),qazana.config.locked_user&&this.showLockMessage(qazana.config.locked_user)}return(0,o.default)(t,[{key:"initModal",value:function(){var e=qazana.dialogsManager.createWidget("lightbox",{headerMessage:qazana.translate("take_over")});return e.addButton({name:"go_back",text:qazana.translate("go_back"),callback:function(){parent.history.go(-1)}}),e.addButton({name:"take_over",text:qazana.translate("take_over"),callback:function(){wp.heartbeat.enqueue("qazana_force_post_lock",!0),wp.heartbeat.connectNow()}}),e}},{key:"showLockMessage",value:function(e){this.getModal().setMessage(qazana.translate("dialog_user_taken_over",[e])).show()}}]),t}();t.default=n},function(e,t,n){n(212);var i=n(3).Object;e.exports=function(e,t,n){return i.defineProperty(e,t,n)}},function(e,t,n){var i=n(14);i(i.S+i.F*!n(12),"Object",{defineProperty:n(15).f})},function(e,t,n){"use strict";var i=n(0);n(85)(t,"__esModule",{value:!0}),t.default=void 0,n(75),n(59);var a=i(n(99)),o=i(n(92)),r=i(n(93)),s=i(n(169)),l=i(n(100)),c=i(n(101)),u=i(n(96)),d=i(n(225));function h(n){var i=function(){if("undefined"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,u.default)(n);return t=i?(e=(0,u.default)(this).constructor,(0,a.default)(t,arguments,e)):t.apply(this,arguments),(0,c.default)(this,t)}}var p=n(173),n=function(){(0,l.default)(n,p);var t=h(n);function n(e){return(0,o.default)(this,n),(e=t.call(this,e)).isDocked=!1,e.opened=!1,e.ensurePosition=e.ensurePosition.bind((0,s.default)(e)),e.listenTo(qazana.channels.dataEditMode,"switch",e.onEditModeSwitched),e.storage.visible&&e.open(),e}return(0,r.default)(n,[{key:"getStorageKey",value:function(){return"navigator"}},{key:"getDefaultStorage",value:function(){return{visible:!1,size:{width:"",height:"",top:"",bottom:"",right:"",left:""}}}},{key:"getLayout",value:function(){return this.currentView}},{key:"getDraggableOptions",value:function(){return{iframeFix:!0,handle:"#qazana-navigator__header",drag:this.onDrag.bind(this),stop:this.onDragStop.bind(this)}}},{key:"getResizableOptions",value:function(){var e=this;return{handles:"all",containment:"document",minWidth:150,maxWidth:500,minHeight:240,start:function(){qazana.$previewWrapper.addClass("ui-resizable-resizing")},stop:function(){qazana.$previewWrapper.removeClass("ui-resizable-resizing"),e.isDocked?(e.storage.size.width=qazana.helpers.getElementInlineStyle(e.$el,["width"]).width,qazana.setStorage("navigator",e.storage)):e.saveSize()}}}},{key:"beforeFirstOpen",value:function(){this.show(new d.default),this.$el.draggable(this.getDraggableOptions()),this.$el.resizable(this.getResizableOptions())}},{key:"open",value:function(e){this.opened||(this.beforeFirstOpen(),this.opened=!0),this.$el.show(),this.storage.docked?(this.dock(),this.setDockedSize()):this.setSize(),e&&e.trigger("request:edit"),this.saveStorage("visible",!0),this.ensurePosition(),qazana.$window.on("resize",this.ensurePosition)}},{key:"close",value:function(e){this.$el.hide(),this.isDocked&&this.undock(!0),e||this.saveStorage("visible",!1),qazana.$window.off("resize",this.ensurePosition)}},{key:"isOpen",value:function(){return this.$el.is(":visible")}},{key:"dock",value:function(){qazana.$body.addClass("qazana-navigator-docked");var n=qazana.config.is_rtl?"left":"right",e=this.getResizableOptions();this.$el.css({height:"",top:"",bottom:"",left:"",right:""}),qazana.$previewWrapper.css(n,this.storage.size.width),this.$el.resizable("destroy"),e.handles=qazana.config.is_rtl?"e":"w",e.resize=function(e,t){qazana.$previewWrapper.css(n,t.size.width)},this.$el.resizable(e),this.isDocked=!0,this.saveStorage("docked",!0)}},{key:"undock",value:function(e){qazana.$body.removeClass("qazana-navigator-docked"),qazana.$previewWrapper.css(qazana.config.is_rtl?"left":"right",""),this.setSize(),this.$el.resizable("destroy"),this.$el.resizable(this.getResizableOptions()),this.isDocked=!1,e||this.saveStorage("docked",!1)}},{key:"setSize",value:function(){this.storage.size&&this.$el.css(this.storage.size)}},{key:"setDockedSize",value:function(){this.$el.css("width",this.storage.size.width)}},{key:"ensurePosition",value:function(){var e;this.isDocked||((e=this.$el.offset()).left>innerWidth&&this.$el.css({left:"",right:""}),e.top>innerHeight&&this.$el.css({top:"",bottom:""}))}},{key:"onDrag",value:function(e,t){if(this.isDocked)if(t.position.left===t.originalPosition.left){if(t.position.top!==t.originalPosition.top)return!1}else this.undock();else{t.position.top<0&&(t.position.top=0);var n=t.position.left<0,i=t.position.left+this.el.offsetWidth>innerWidth;qazana.config.is_rtl?i&&(t.position.left=innerWidth-this.el.offsetWidth):n&&(t.position.left=0),qazana.$body.toggleClass("qazana-navigator--dock-hint",qazana.config.is_rtl?n:i)}}},{key:"onDragStop",value:function(e,t){var n;this.isDocked||(this.saveSize(),n=t.position.left+this.el.offsetWidth,(t.position.left<0||n>innerWidth)&&this.dock(),qazana.$body.removeClass("qazana-navigator--dock-hint"))}},{key:"onEditModeSwitched",value:function(e){"edit"===e&&this.storage.visible?this.open():this.close(!0)}}]),n}();t.default=n},function(e,t,n){n(7)&&"g"!=/./g.flags&&n(23).f(RegExp.prototype,"flags",{configurable:!0,get:n(82)})},function(e,t,n){n(216),e.exports=n(3).Reflect.construct},function(e,t,n){var i=n(14),o=n(43),r=n(91),s=n(22),l=n(17),a=n(20),c=n(217),u=(n(5).Reflect||{}).construct,d=a(function(){function e(){}return!(u(function(){},[],e)instanceof e)}),h=!a(function(){u(function(){})});i(i.S+i.F*(d||h),"Reflect",{construct:function(e,t,n){r(e),s(t);var i=arguments.length<3?e:r(n);if(h&&!d)return u(e,t,i);if(e==i){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var a=[null];return a.push.apply(a,t),new(c.apply(e,a))}a=i.prototype,i=o(l(a)?a:Object.prototype),a=Function.apply.call(e,i,t);return l(a)?a:i}})},function(e,t,n){"use strict";var o=n(91),r=n(17),s=n(218),l=[].slice,c={};e.exports=Function.bind||function(t){var n=o(this),i=l.call(arguments,1),a=function(){var e=i.concat(l.call(arguments));return this instanceof a?function(e,t,n){if(!(t in c)){for(var i=[],a=0;a<t;a++)i[a]="a["+a+"]";c[t]=Function("F,a","return new F("+i.join(",")+")")}return c[t](e,n)}(n,e.length,e):s(n,e,t)};return r(n.prototype)&&(a.prototype=n.prototype),a}},function(e,t){e.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(n,e,t){var i=t(170);function a(e,t){return n.exports=a=i||function(e,t){return e.__proto__=t,e},a(e,t)}n.exports=a},function(e,t,n){n(221),e.exports=n(3).Object.setPrototypeOf},function(e,t,n){var i=n(14);i(i.S,"Object",{setPrototypeOf:n(222).set})},function(e,t,a){function o(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")}var n=a(17),i=a(22);e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,n,i){try{(i=a(98)(Function.call,a(86).f(Object.prototype,"__proto__").set,2))(e,[]),n=!(e instanceof Array)}catch(e){n=!0}return function(e,t){return o(e,t),n?e.__proto__=t:i(e,t),e}}({},!1):void 0),check:o}},function(e,t,n){n(224),e.exports=n(3).Object.getPrototypeOf},function(e,t,n){var i=n(61),a=n(95);n(137)("getPrototypeOf",function(){return function(e){return a(i(e))}})},function(e,t,n){"use strict";var i=n(0);n(85)(t,"__esModule",{value:!0}),t.default=void 0,n(75),n(59);var a=i(n(99)),o=i(n(92)),r=i(n(93)),s=i(n(100)),l=i(n(101)),c=i(n(96)),u=i(n(226));function d(n){var i=function(){if("undefined"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(n);return t=i?(e=(0,c.default)(this).constructor,(0,a.default)(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,t)}}n=function(e){(0,s.default)(n,e);var t=d(n);function n(){return(0,o.default)(this,n),t.apply(this,arguments)}return(0,r.default)(n,[{key:"getTemplate",value:function(){return"#tmpl-qazana-navigator"}},{key:"id",value:function(){return"qazana-navigator__inner"}},{key:"ui",value:function(){return{toggleAll:"#qazana-navigator__toggle-all",close:"#qazana-navigator__close"}}},{key:"events",value:function(){return{"click @ui.toggleAll":"toggleAll","click @ui.close":"onCloseClick"}}},{key:"regions",value:function(){return{elements:"#qazana-navigator__elements"}}},{key:"toggleAll",value:function(){var e="expand"===this.ui.toggleAll.data("qazana-action"),t=["eicon-collapse","eicon-expand"];this.ui.toggleAll.data("qazana-action",e?"collapse":"expand").removeClass(t[+e]).addClass(t[+!e]),this.elements.currentView.recursiveChildInvoke("toggleList",e)}},{key:"activateElementsMouseInteraction",value:function(){this.elements.currentView.recursiveChildInvoke("activateMouseInteraction")}},{key:"deactivateElementsMouseInteraction",value:function(){this.elements.currentView.recursiveChildInvoke("deactivateMouseInteraction")}},{key:"onShow",value:function(){this.elements.show(new u.default({model:qazana.elementsModel}))}},{key:"onCloseClick",value:function(){qazana.navigator.close()}}]),n}(Marionette.LayoutView);t.default=n},function(e,t,n){"use strict";var i=n(0);n(85)(t,"__esModule",{value:!0}),t.default=void 0,n(75),n(59);var a=i(n(99)),l=i(n(172)),o=i(n(92)),r=i(n(93)),s=i(n(100)),c=i(n(101)),u=i(n(96)),d=i(n(230)),h=i(n(231));function p(n){var i=function(){if("undefined"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,u.default)(n);return t=i?(e=(0,u.default)(this).constructor,(0,a.default)(t,arguments,e)):t.apply(this,arguments),(0,c.default)(this,t)}}n=function(e){(0,s.default)(n,e);var t=p(n);function n(){return(0,o.default)(this,n),t.apply(this,arguments)}return(0,r.default)(n,[{key:"getTemplate",value:function(){return"#tmpl-qazana-navigator__elements"}},{key:"ui",value:function(){return{item:"> .qazana-navigator__item",title:"> .qazana-navigator__item .qazana-navigator__element__title__text",toggle:"> .qazana-navigator__item > .qazana-navigator__element__toggle",toggleList:"> .qazana-navigator__item > .qazana-navigator__element__list-toggle",elements:"> .qazana-navigator__elements"}}},{key:"events",value:function(){return{contextmenu:"onContextMenu","click @ui.item":"onItemClick","click @ui.toggle":"onToggleClick","click @ui.toggleList":"onToggleListClick","dblclick @ui.title":"onTitleDoubleClick","keydown @ui.title":"onTitleKeyDown","paste @ui.title":"onTitlePaste","sortstart @ui.elements":"onSortStart","sortover @ui.elements":"onSortOver","sortout @ui.elements":"onSortOut","sortstop @ui.elements":"onSortStop","sortupdate @ui.elements":"onSortUpdate","sortreceive @ui.elements":"onSortReceive"}}},{key:"getEmptyView",value:function(){return this.isRoot()?h.default:this.hasChildren()?d.default:null}},{key:"childViewOptions",value:function(){return{indent:this.getIndent()+10}}},{key:"className",value:function(){var e=this.model.get("elType"),t="qazana-navigator__element";return e&&(t+=" qazana-navigator__element-"+e),this.hasChildren()&&(t+=" qazana-navigator__element--has-children"),t}},{key:"attributes",value:function(){return{"data-model-cid":this.model.cid}}},{key:"templateHelpers",value:function(){var e={};return this.isRoot()||(e.title=this.model.getTitle(),e.icon="section"===this.model.get("elType")?"":this.model.getIcon()),e}},{key:"initialize",value:function(){this.collection=this.model.get("elements"),this.childViewContainer=".qazana-navigator__elements",this.listenTo(this.model,"request:edit",this.onEditRequest).listenTo(this.model,"change",this.onModelChange).listenTo(this.model.get("settings"),"change",this.onModelSettingsChange)}},{key:"getIndent",value:function(){return this.getOption("indent")||0}},{key:"isRoot",value:function(){return!this.model.get("elType")}},{key:"hasChildren",value:function(){return"widget"!==this.model.get("elType")}},{key:"toggleList",value:function(e,t){this.hasChildren()&&!this.isRoot()&&this.ui.item.hasClass("qazana-active")!==e&&(this.ui.item.toggleClass("qazana-active",e),e=void 0!==e?"slide"+(e?"Down":"Up"):"slideToggle",this.ui.elements[e](300,t))}},{key:"toggleHiddenClass",value:function(){this.$el.toggleClass("qazana-navigator__element--hidden",!!this.model.get("hidden"))}},{key:"recursiveChildInvoke",value:function(e){for(var t=arguments,n=this,i=arguments.length,a=new Array(1<i?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];this[e].apply(this,a),this.children.each(function(e){e instanceof n.constructor&&e.recursiveChildInvoke.apply(e,t)})}},{key:"recursiveParentInvoke",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this._parent instanceof this.constructor&&(this._parent[e].apply(this._parent,n),this._parent.recursiveParentInvoke.apply(this._parent,arguments))}},{key:"recursiveChildAgreement",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(!this[e].apply(this,n))return!1;for(var a=!0,o=0,r=(0,l.default)(this.children._views);o<r.length;o++){var s=r[o];if(s instanceof this.constructor&&!s.recursiveChildAgreement.apply(s,arguments)){a=!1;break}}return a}},{key:"activateMouseInteraction",value:function(){this.$el.on({mouseenter:this.onMouseEnter.bind(this),mouseleave:this.onMouseLeave.bind(this)})}},{key:"deactivateMouseInteraction",value:function(){this.$el.off("mouseenter mouseleave")}},{key:"dragShouldBeIgnored",value:function(e){var t=qazana.helpers.getElementChildType(this.model.get("elType"));return"section"===e.get("elType")&&!e.get("isInner")||(!t||-1===t.indexOf(e.get("elType")))}},{key:"addEditingClass",value:function(){this.ui.item.addClass("qazana-editing")}},{key:"removeEditingClass",value:function(){this.ui.item.removeClass("qazana-editing")}},{key:"enterTitleEditing",value:function(){this.ui.title.attr("contenteditable",!0).focus(),document.execCommand("selectAll"),qazana.addBackgroundClickListener("navigator",{ignore:this.ui.title,callback:this.exitTitleEditing.bind(this)})}},{key:"exitTitleEditing",value:function(){this.ui.title.attr("contenteditable",!1);var e=this.model.get("settings"),t=e.get("_title"),n=this.ui.title.text().trim();t||e.unset("_title",{silent:!0}),e.set("_title",n),qazana.removeBackgroundClickListener("navigator")}},{key:"activateSortable",value:function(){qazana.userCan("design")&&this.ui.elements.sortable({items:"> .qazana-navigator__element",placeholder:"ui-sortable-placeholder",axis:"y",forcePlaceholderSize:!0,connectWith:".qazana-navigator__element-"+this.model.get("elType")+" "+this.ui.elements.selector,cancel:'[contenteditable="true"]'})}},{key:"onRender",value:function(){this.activateSortable(),this.ui.item.css("padding-"+(qazana.config.is_rtl?"right":"left"),this.getIndent()),this.toggleHiddenClass()}},{key:"onModelChange",value:function(){void 0!==this.model.changed.hidden&&this.toggleHiddenClass()}},{key:"onModelSettingsChange",value:function(e){void 0!==e.changed._title&&this.ui.title.text(this.model.getTitle())}},{key:"onItemClick",value:function(){this.model.trigger("request:edit",{scrollIntoView:!0})}},{key:"onToggleClick",value:function(e){e.stopPropagation(),this.model.trigger("request:toggleVisibility")}},{key:"onTitleDoubleClick",value:function(){this.enterTitleEditing()}},{key:"onTitleKeyDown",value:function(e){13===e.which&&(e.preventDefault(),this.exitTitleEditing())}},{key:"onTitlePaste",value:function(e){e.preventDefault(),document.execCommand("insertHTML",!1,e.originalEvent.clipboardData.getData("text/plain"))}},{key:"onToggleListClick",value:function(e){e.stopPropagation(),this.toggleList()}},{key:"onSortStart",value:function(e,t){this.model.trigger("request:sort:start",e,t),jQuery(t.item).children(".qazana-navigator__item").trigger("click"),qazana.navigator.getLayout().activateElementsMouseInteraction()}},{key:"onSortStop",value:function(){qazana.navigator.getLayout().deactivateElementsMouseInteraction()}},{key:"onSortOver",value:function(e){e.stopPropagation(),this.$el.addClass("qazana-dragging-on-child")}},{key:"onSortOut",value:function(e){e.stopPropagation(),this.$el.removeClass("qazana-dragging-on-child")}},{key:"onSortUpdate",value:function(e,t){e.stopPropagation(),this.ui.elements.is(t.item.parent())&&this.model.trigger("request:sort:update",t)}},{key:"onSortReceive",value:function(e,t){this.model.trigger("request:sort:receive",e,t)}},{key:"onMouseEnter",value:function(e){var t=this;e.stopPropagation(),this.recursiveChildAgreement("dragShouldBeIgnored",qazana.channels.data.request("dragging:model"))||(this.autoExpandTimeout=setTimeout(function(){t.toggleList(!0,function(){t.ui.elements.sortable("refreshPositions")})},500))}},{key:"onMouseLeave",value:function(e){e.stopPropagation(),clearTimeout(this.autoExpandTimeout)}},{key:"onContextMenu",value:function(e){this.model.trigger("request:contextmenu",e)}},{key:"onEditRequest",value:function(){this.recursiveParentInvoke("toggleList",!0),qazana.navigator.getLayout().elements.currentView.recursiveChildInvoke("removeEditingClass"),this.addEditingClass(),qazana.helpers.scrollToView(this.$el,400,qazana.navigator.getLayout().elements.$el)}}]),n}(Marionette.CompositeView);t.default=n},function(e,t,n){n(228),e.exports=n(3).Object.values},function(e,t,n){var i=n(14),a=n(229)(!1);i(i.S,"Object",{values:function(e){return a(e)}})},function(e,t,n){var l=n(12),c=n(36),u=n(13),d=n(44).f;e.exports=function(s){return function(e){for(var t,n=u(e),i=c(n),a=i.length,o=0,r=[];o<a;)t=i[o++],l&&!d.call(n,t)||r.push(s?[t,n[t]]:n[t]);return r}}},function(e,t,n){"use strict";var i=n(0);n(85)(t,"__esModule",{value:!0}),t.default=void 0,n(75),n(59);var a=i(n(99)),o=i(n(92)),r=i(n(93)),s=i(n(100)),l=i(n(101)),c=i(n(96));function u(n){var i=function(){if("undefined"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(n);return t=i?(e=(0,c.default)(this).constructor,(0,a.default)(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,t)}}n=function(e){(0,s.default)(n,e);var t=u(n);function n(){return(0,o.default)(this,n),t.apply(this,arguments)}return(0,r.default)(n,[{key:"getTemplate",value:function(){return"#tmpl-qazana-navigator__elements--empty"}},{key:"className",value:function(){return"qazana-empty-view"}},{key:"onRendr",value:function(){this.$el.css("padding-"+(qazana.config.is_rtl?"right":"left"),this.getOption("indent"))}}]),n}(Marionette.ItemView);t.default=n},function(e,t,n){"use strict";var i=n(0);n(85)(t,"__esModule",{value:!0}),t.default=void 0,n(75),n(59);var a=i(n(99)),o=i(n(92)),r=i(n(93)),s=i(n(100)),l=i(n(101)),c=i(n(96));function u(n){var i=function(){if("undefined"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(n);return t=i?(e=(0,c.default)(this).constructor,(0,a.default)(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,t)}}n=function(e){(0,s.default)(n,e);var t=u(n);function n(){return(0,o.default)(this,n),t.apply(this,arguments)}return(0,r.default)(n,[{key:"getTemplate",value:function(){return"#tmpl-qazana-navigator__root--empty"}},{key:"className",value:function(){return"qazana-nerd-box"}}]),n}(Marionette.ItemView);t.default=n},function(e,t,n){"use strict";var i=n(0);n(233),n(45);var a=i(n(108)),r=i(n(60));n(47),n(152),n(75),n(59);var o=i(n(39));n(1),n(27),n={_enqueuedFonts:[],elementsHierarchy:{section:{column:{widget:null,section:null}}},enqueueFont:function(e){if(-1===this._enqueuedFonts.indexOf(e)){var t=qazana.config.controls.font.options[e],n={ru_RU:"cyrillic",uk:"cyrillic",bg_BG:"cyrillic",vi:"vietnamese",el:"greek",he_IL:"hebrew"};switch(t){case"googlefonts":i="https://fonts.googleapis.com/css?family="+e+":100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic",n[qazana.config.locale]&&(i+="&subset="+n[qazana.config.locale]);break;case"earlyaccess":var i="https://fonts.googleapis.com/earlyaccess/"+e.replace(/\s+/g,"").toLowerCase()+".css"}_.isEmpty(i)||qazana.$previewContents.find("link:last").after('<link href="'+i+'" rel="stylesheet" type="text/css">'),this._enqueuedFonts.push(e),qazana.channels.editor.trigger("font:insertion",t,e)}},resetEnqueuedFontsCache:function(){this._enqueuedFonts=[]},getElementChildType:function(e,t){if(void 0!==(t=t||this.elementsHierarchy)[e])return jQuery.isPlainObject(t[e])?(0,o.default)(t[e]):null;for(var n in t)if(t.hasOwnProperty(n)&&jQuery.isPlainObject(t[n])){var i=this.getElementChildType(e,t[n]);if(i)return i}return null},getUniqueID:function(){return Math.random().toString(16).substr(2,7)},stringReplaceAll:function(e,t){var n=new RegExp((0,o.default)(t).join("|"),"gi");return e.replace(n,function(e){return t[e]})},getYoutubeIDFromURL:function(e){e=e.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);return e&&e[1]},ytVidId:function(e){return!!e.match(/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/)&&RegExp.$1},isActiveControl:function(e,o){e=_.isFunction(e.get)?(t=e.get("condition"),e.get("conditions")):(t=e.condition,e.conditions);if(e)return qazana.conditions.check(e,o);if(_.isEmpty(t))return!0;var t=_.filter(t,function(e,t){var n=t.match(/([a-z_0-9]+)(?:\[([a-z_]+)])?(!?)$/i),i=n[1],a=n[2],t=!!n[3],n=o[i];return o.__dynamic__&&o.__dynamic__[i]&&(n=o.__dynamic__[i]),void 0===n||(a&&"object"===(0,r.default)(n)&&(n=n[a]),n=_.isArray(e)&&!_.isEmpty(e)?_.contains(e,n):_.isArray(n)&&!_.isEmpty(n)?_.contains(n,e):_.isEqual(e,n),t?n:!n)});return _.isEmpty(t)},cloneObject:function(e){return JSON.parse((0,a.default)(e))},firstLetterUppercase:function(e){return e[0].toUpperCase()+e.slice(1)},disableElementEvents:function(e){e.each(function(){var e=this.style.pointerEvents;"none"!==e&&jQuery(this).data("backup-pointer-events",e).css("pointer-events","none")})},enableElementEvents:function(e){e.each(function(){var e=jQuery(this),t=e.data("backup-pointer-events");void 0!==t&&e.removeData("backup-pointer-events").css("pointer-events",t)})},getColorPickerPaletteIndex:function(e){return["7","8","1","5","2","3","6","4"].indexOf(e)},wpColorPicker:function(e,t){var n=this,i=qazana.schemes.getScheme("color-picker"),i=_.sortBy(i.items,function(e){return n.getColorPickerPaletteIndex(e.key)}),i={width:1440<=window.innerWidth?271:251,palettes:_.pluck(i,"value")};return t&&_.extend(i,t),e.wpColorPicker(i)},isInViewport:function(e,t){e=e.getBoundingClientRect();return t=t||document.documentElement,0<=e.top&&0<=e.left&&e.bottom<=(window.innerHeight||t.clientHeight)&&e.right<=(window.innerWidth||t.clientWidth)},scrollToView:function(i,e,a){void 0===e&&(e=500);var o=a,r=qazanaFrontend.getElements("$window");a||(a=r,o=qazana.$previewContents.find("html, body")),setTimeout(function(){var e=a.height(),t=a.scrollTop(),n=a===r?i.offset().top:i[0].offsetTop,t=n-t;0<t&&t<e||(e=n-e/2,o.stop(!0).animate({scrollTop:e},1e3))},e)},getElementInlineStyle:function(e,t){var n={},i=e[0].style;return t.forEach(function(e){n[e]=void 0!==i[e]?i[e]:""}),n},cssWithBackup:function(e,t,n){var i=this.getElementInlineStyle(e,(0,o.default)(n));e.data("css-backup-"+t,i).css(n)},recoverCSSBackup:function(e,t){t="css-backup-"+t;e.css(e.data(t)),e.removeData(t)},compareVersions:function(e,t,n){function i(e){return(e+="").replace(/[^\d.]+/,".-1.")}if((e=i(e))===(t=i(t)))return!n||/^={2,3}$/.test(n);for(var a=e.split(".").map(Number),o=t.split(".").map(Number),r=Math.max(a.length,o.length),s=0;s<r;s++){var l=a[s]||0,c=o[s]||0;if(l!==c)return this.conditions.compare(l,c,n)}}},e.exports=n},function(e,t,n){"use strict";function i(e){var t=c(e,!1);if("string"==typeof t&&2<t.length){var n,i,a=(t=z?t.trim():p(t,3)).charCodeAt(0);if(43===a||45===a){if(88===(e=t.charCodeAt(2))||120===e)return NaN}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+t}for(var o,r=t.slice(2),s=0,l=r.length;s<l;s++)if((o=r.charCodeAt(s))<48||i<o)return NaN;return parseInt(r,n)}}return+t}var a=n(2),o=n(42),r=n(19),s=n(174),c=n(62),l=n(10),u=n(176).f,d=n(175).f,h=n(23).f,p=n(238).trim,g="Number",f=a[g],m=f,v=f.prototype,y=r(n(178)(v))==g,z="trim"in String.prototype;if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(e){var e=arguments.length<1?0:e,t=this;return t instanceof f&&(y?l(function(){v.valueOf.call(t)}):r(t)!=g)?s(new m(i(e)),t,f):i(e)};for(var q,w=n(7)?u(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),b=0;w.length>b;b++)o(m,q=w[b])&&!o(f,q)&&h(f,q,d(m,q));(f.prototype=v).constructor=f,n(25)(a,g,f)}},function(e,t,a){function o(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")}var n=a(6),i=a(8);e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,n,i){try{(i=a(37)(Function.call,a(175).f(Object.prototype,"__proto__").set,2))(e,[]),n=!(e instanceof Array)}catch(e){n=!0}return function(e,t){return o(e,t),n?e.__proto__=t:i(e,t),e}}({},!1):void 0),check:o}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var l=n(141),c=n(26),u=n(237);e.exports=function(s){return function(e,t,n){var i,a=l(e),o=c(a.length),r=u(n,o);if(s&&t!=t){for(;r<o;)if((i=a[r++])!=i)return!0}else for(;r<o;r++)if((s||r in a)&&a[r]===t)return s||r||0;return!s&&-1}}},function(e,t,n){var i=n(29),a=Math.max,o=Math.min;e.exports=function(e,t){return(e=i(e))<0?a(e+t,0):o(e,t)}},function(e,t,n){var o=n(35),i=n(24),r=n(10),s=n(239),n="["+s+"]",a=RegExp("^"+n+n+"*"),l=RegExp(n+n+"*$"),n=function(e,t,n){var i={},a=r(function(){return!!s[e]()||"​"!="​"[e]()}),t=i[e]=a?t(c):s[e];n&&(i[n]=t),o(o.P+o.F*a,"String",i)},c=n.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(a,"")),2&t&&(e=e.replace(l,"")),e};e.exports=n},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,n){var r=n(23),s=n(8),l=n(179);e.exports=n(7)?Object.defineProperties:function(e,t){s(e);for(var n,i=l(t),a=i.length,o=0;o<a;)r.f(e,n=i[o++],t[n]);return e}},function(e,t,n){n=n(2).document;e.exports=n&&n.documentElement},function(e,t,n){"use strict";var i=n(2),a=n(23),o=n(7),r=n(4)("species");e.exports=function(e){e=i[e];o&&e&&!e[r]&&a.f(e,r,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var u=n(0)(n(39)),n=function(){function s(e){var t=e.size;if("custom"===t){var n=e.dimension;if(!n.width&&!n.height)return"full";n="custom_"+n.width+"x"+n.height}else n=t;return n}var n=this,l={},c=[];n.onceTriggerChange=_.once(function(e){setTimeout(function(){e.get("settings").trigger("change",e.get("settings"))},700)}),n.getImageUrl=function(e){n.registerItem(e);var t=n.getItem(e);if(!t){if("custom"===e.size)return void(qazana.getPanelView()&&"editor"===qazana.getPanelView().getCurrentPageName()&&e.model&&n.onceTriggerChange(e.model));t=e.url}return t},n.getItem=function(e){var t=s(e),e=e.id;return!!t&&(!(!l[e]||!l[e][t])&&l[e][t])},n.registerItem=function(e){""!==e.id&&(n.getItem(e)||(c.push(e),n.debounceGetRemoteItems()))},n.getRemoteItems=function(){var e,t,n=[],i=(0,u.default)(c).length;if(0!==i)if(1===i&&(e=c[(0,u.default)(c)[0]])&&e.model&&!e.preview)e.model.renderRemoteServer();else{for(t in c){e=c[t];var a=s(e),o=e.id,r=!l[o]||0===(0,u.default)(l[o]).length;n.push({id:o,size:a,is_first_time:r})}qazana.ajax.send("get_images_details",{data:{items:n},success:function(e){var t,n;for(t in e)for(n in l[t]||(l[t]={}),e[t])l[t][n]=e[t][n];c=[]}})}},n.debounceGetRemoteItems=_.debounce(n.getRemoteItems,300)};e.exports=new n},function(e,t,n){"use strict";n(47),n(28);e.exports=new function(){function e(e){var t,n=e.originalEvent,i=n.error;i&&(t=!1,e=o.urlsToWatch,jQuery.each(e,function(){if(-1!==i.stack.indexOf(this))return!(t=!0)}),t&&a.addError({type:i.name,message:i.message,url:n.filename,line:n.lineno,column:n.colno}))}var a=this,n=[],o={},t={};this.addURLToWatch=function(e){o.urlsToWatch.push(e)},this.addCustomError=function(e,t,n){n={type:e.name,message:e.message,url:e.fileName||e.sourceURL,line:e.lineNumber||e.line,column:e.columnNumber||e.column,customFields:{category:t||"general",tag:n}};n.url||(e=e.stack.match(/\n {4}at (.*?(?=:(\d+):(\d+)))/))&&(n.url=e[1],n.line=e[2],n.column=e[3]),this.addError(n)},this.addError=function(e){var t={type:"Error",timestamp:Math.floor((new Date).getTime()/1e3),message:null,url:null,line:null,column:null,customFields:{}};n.push(jQuery.extend(!0,t,e)),a.sendErrors()},this.sendErrors=function(){t.$window.off("error",e),jQuery.ajax({url:QazanaConfig.ajaxurl,method:"POST",data:{action:"qazana_debug_log",data:n},success:function(){n=[],t.$window.on("error",e)}})},o={debounceDelay:500,urlsToWatch:["qazana/assets"]},t.$window=jQuery(window),t.$window.on("error",e),a.sendErrors=_.debounce(a.sendErrors,o.debounceDelay)}},function(e,t,n){"use strict";var a=n(0)(n(108));n(1);var l=n(180),c=n(153),n=function(){function t(i){var a=o.getWidgetSchemeControls(i);_.each(a,function(e){var t,n;t=e,n=a,e=i.widget_type,c.addControlStyleRules(r,t,n,function(e){return o.getSchemeValue(e.scheme.type,e.scheme.value,e.scheme.key).value},["{{WRAPPER}}"],[s+e])})}var o=this,r=new l,i={},s=".qazana-widget-",e={};this.init=function(){return e.$style=jQuery("<style>",{id:"qazana-style-scheme"}),e.$previewHead=qazana.$previewContents.find("head"),e.$previewHead.append(e.$style),i=qazana.helpers.cloneObject(qazana.config.schemes.items),o},this.getWidgetSchemeControls=function(e){return _.filter(e.controls,function(e){return _.isObject(e.scheme)})},this.getSchemes=function(){return i},this.getEnabledSchemesTypes=function(){return qazana.config.schemes.enabled_schemes},this.getScheme=function(e){return i[e]},this.getSchemeValue=function(e,t,n){if(this.getEnabledSchemesTypes().indexOf(e)<0)return!1;e=o.getScheme(e).items[t];if(n&&_.isObject(e)){t=qazana.helpers.cloneObject(e);return t.value=e.value[n],t}return e},this.printSchemesStyle=function(){r.empty(),_.each(qazana.config.widgets,function(e){t(e)}),e.$style.text(r)},this.resetSchemes=function(e){i[e]=qazana.helpers.cloneObject(qazana.config.schemes.items[e])},this.saveScheme=function(e){qazana.config.schemes.items[e].items=qazana.helpers.cloneObject(i[e].items);var n={};_.each(i[e].items,function(e,t){n[t]=e.value}),NProgress.start(),qazana.ajax.send("apply_scheme",{data:{scheme_name:e,data:(0,a.default)(n)},success:function(){NProgress.done()}})},this.setSchemeValue=function(e,t,n){i[e].items[t].value=n}};e.exports=new n},function(e,t,n){"use strict";var i={getPresetsDictionary:function(){return{11:100/9,12:12.5,14:100/7,16:100/6,33:100/3,66:2/3*100,83:5/6*100}},getAbsolutePresetValues:function(e){var n=qazana.helpers.cloneObject(e),i=this.getPresetsDictionary();return _.each(n,function(e,t){i[e]&&(n[t]=i[e])}),n},getPresets:function(e,t){var n=qazana.helpers.cloneObject(qazana.config.elements.section.presets);return e&&(n=n[e]),t&&(n=n[t]),n},getPresetByStructure:function(e){e=this.getParsedStructure(e);return this.getPresets(e.columnsCount,e.presetIndex)},getParsedStructure:function(e){return{columnsCount:(e+="").slice(0,-1),presetIndex:e.substr(-1)}},getPresetSVG:function(e,t,n,i){t=t||100,n=n||50,i=i||2;e=this.getAbsolutePresetValues(e),i=this._generatePresetSVGPath(e,t,n,i);return this._createSVGPreset(i,t,n)},_createSVGPreset:function(e,t,n){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),i.setAttribute("viewBox","0 0 "+t+" "+n);n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),i.appendChild(n),i},_generatePresetSVGPath:function(e,t,n,i){for(var a=t-i*(e.length-1),o=0,r="",s=0;s<e.length;s++){s&&(r+=" ");var l=e[s]/100*a;r+="M"+ +(o+=l).toFixed(4)+",0",r+="V"+n,r+="H"+ +(o-l).toFixed(4),r+="V0Z",o+=i}return r}};e.exports=i},function(e,t,n){"use strict";var i=n(0),u=i(n(60)),d=i(n(171)),h=i(n(94)),p=i(n(108)),g=n(248),f=n(260),n=function(){var e,t,a,i,o=this,r={},s={},l={},c={};this.init=function(){var n;n={saveDialog:{description:qazana.translate("save_your_template_description")},ajaxParams:{success:function(e){o.getTemplatesCollection().add(e),o.setTemplatesPage("local")},error:function(e){o.showErrorDialog(e)}}},_.each(["page","section"],function(e){var t=jQuery.extend(!0,{},n,{saveDialog:{title:qazana.translate("save_your_template",[qazana.translate(e)])}});o.registerTemplateType(e,t)}),c={text:{callback:function(t){return t=t.toLowerCase(),0<=this.get("title").toLowerCase().indexOf(t)||_.any(this.get("tags"),function(e){return 0<=e.toLowerCase().indexOf(t)})}},type:{},subtype:{},favorite:{}},qazana.addBackgroundClickListener("libraryToggleMore",{element:".qazana-template-library-template-more"})},this.getTemplateTypes=function(e){return e?l[e]:l},this.registerTemplateType=function(e,t){l[e]=t},this.deleteTemplate=function(t,n){var e=o.getDeleteDialog();e.onConfirm=function(){n.onConfirm&&n.onConfirm(),qazana.ajax.send("delete_template",{data:{source:t.get("source"),template_id:t.get("template_id")},success:function(e){i.remove(t,{silent:!0}),n.onSuccess&&n.onSuccess(e)}})},e.show()},this.importTemplate=function(t,n){n=n||{},a.showLoadingView(),o.requestTemplateContent(t.get("source"),t.get("template_id"),{data:{page_settings:n.withPageSettings},success:function(e){o.closeModal(),qazana.channels.data.trigger("template:before:insert",t),qazana.getPreviewView().addChildModel(e.content,s.importOptions||{}),qazana.channels.data.trigger("template:after:insert",t),n.withPageSettings&&qazana.settings.page.model.set(e.page_settings)},error:function(e){o.showErrorDialog(e)},complete:function(){a.hideLoadingView()}})},this.saveTemplate=function(e,t){var n=l[e];_.extend(t,{source:"local",type:e}),n.prepareSavedData&&(t=n.prepareSavedData(t)),t.content=(0,p.default)(t.content);t={data:t};n.ajaxParams&&_.extend(t,n.ajaxParams),qazana.ajax.send("save_template",t)},this.requestTemplateContent=function(e,t,n){t={data:{source:e,edit_mode:!0,display:!0,template_id:t}};return n&&jQuery.extend(!0,t,n),qazana.ajax.send("get_template_data",t)},this.markAsFavorite=function(e,t){t={data:{source:e.get("source"),template_id:e.get("template_id"),favorite:t}};return qazana.ajax.send("mark_template_as_favorite",t)},this.getDeleteDialog=function(){return e=e||qazana.dialogsManager.createWidget("confirm",{id:"qazana-template-library-delete-dialog",headerMessage:qazana.translate("delete_template"),message:qazana.translate("delete_template_confirm"),strings:{confirm:qazana.translate("delete")}})},this.getErrorDialog=function(){return t=t||qazana.dialogsManager.createWidget("alert",{id:"qazana-template-library-error-dialog",headerMessage:qazana.translate("an_error_occurred")})},this.getLayout=function(){return a},this.getTemplatesCollection=function(){return i},this.getConfig=function(e){return e?r[e]:r},this.requestLibraryData=function(t){var e;!i||t.forceUpdate?(t.onBeforeUpdate&&t.onBeforeUpdate(),e={data:{},success:function(e){i=new f(e.templates),r=e.config,t.onUpdate&&t.onUpdate()}},t.forceSync&&(e.data.sync=!0),qazana.ajax.send("get_library_data",e)):t.onUpdate&&t.onUpdate()},this.startModal=function(i){(a=a||new g).showModal(),o.requestLibraryData({onBeforeUpdate:a.showLoadingView.bind(a),onUpdate:function(){var e=qazana.config.document.remote_type,t=-1!==r.categories.indexOf(e),n=(0,h.default)(s);s=jQuery.extend({filters:{source:"remote",type:t?"block":"page",subtype:t?e:null},onReady:o.showTemplates},i),_.isEqual((0,d.default)(n),s)&&"qazana-template-library-templates"===a.modalContent.currentView.id||(a.hideLoadingView(),jQuery.each(s.filters,function(e,t){o.setFilter(e,t,!0)}),s.onReady())}})},this.closeModal=function(){a.hideModal()},this.getFilter=function(e){return qazana.channels.templates.request("filter:"+e)},this.setFilter=function(e,t,n){qazana.channels.templates.reply("filter:"+e,t),n||qazana.channels.templates.trigger("filter:change")},this.getFilterTerms=function(e){return e?c[e]:c},this.setTemplatesPage=function(e,t,n){qazana.channels.templates.stopReplying(),o.setFilter("source",e,!0),t&&o.setFilter("type",t,!0),n||o.showTemplates()},this.showTemplates=function(){var t=o.getFilter("source"),e=i.filter(function(e){if(t!==e.get("source"))return!1;e=l[e.get("type")];return!e||!1!==e.showInLibrary});a.showTemplatesView(new f(e))},this.showErrorDialog=function(e){var t;"object"===(0,u.default)(e)?(t="",_.each(e,function(e){t+="<div>"+e.message+".</div>"}),e=t):e?e+=".":e="<i>&#60;The error message is empty&#62;</i>",o.getErrorDialog().setMessage(qazana.translate("templates_request_error")+'<div id="qazana-template-library-error-info">'+e+"</div>").show()}};e.exports=new n},function(e,t,n){"use strict";var i=n(142),a=n(249),o=n(250),r=n(251),s=n(252),l=n(253),c=n(257),u=n(258),d=n(259);e.exports=i.extend({getModalOptions:function(){return{id:"qazana-template-library-modal"}},getLogoOptions:function(){return{title:qazana.translate("library"),click:function(){qazana.templates.setTemplatesPage("remote","page")}}},getTemplateActionButton:function(e){var t=qazana.hooks.applyFilters("qazana/editor/template-library/template/action-button","#tmpl-qazana-template-library-insert-button",e),t=Marionette.TemplateCache.get(t);return Marionette.Renderer.render(t)},setHeaderDefaultParts:function(){var e=this.getHeaderView();e.tools.show(new a),e.menuArea.show(new o),this.showLogo()},showTemplatesView:function(e){this.modalContent.show(new l({collection:e})),this.setHeaderDefaultParts()},showImportView:function(){this.getHeaderView().menuArea.reset(),this.modalContent.show(new u)},showSaveTemplateView:function(e){this.getHeaderView().menuArea.reset(),this.modalContent.show(new c({model:e}))},showPreviewView:function(e){this.modalContent.show(new d({url:e.get("url")}));var t=this.getHeaderView();t.menuArea.reset(),t.tools.show(new r({model:e})),t.logoArea.show(new s)}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-actions",id:"qazana-template-library-header-actions",ui:{import:"#qazana-template-library-header-import i",sync:"#qazana-template-library-header-sync i",save:"#qazana-template-library-header-save i"},events:{"click @ui.import":"onImportClick","click @ui.sync":"onSyncClick","click @ui.save":"onSaveClick"},onImportClick:function(){qazana.templates.getLayout().showImportView()},onSyncClick:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),qazana.templates.requestLibraryData({onUpdate:function(){e.ui.sync.removeClass("eicon-animation-spin"),qazana.templates.setTemplatesPage(qazana.templates.getFilter("source"),qazana.templates.getFilter("type"))},forceUpdate:!0,forceSync:!0})},onSaveClick:function(){qazana.templates.getLayout().showSaveTemplateView()}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({options:{activeClass:"qazana-active"},template:"#tmpl-qazana-template-library-header-menu",id:"qazana-template-library-header-menu",ui:{menuItems:".qazana-template-library-menu-item"},events:{"click @ui.menuItems":"onMenuItemClick"},$activeItem:null,activateMenuItem:function(e){var t=this.getOption("activeClass");this.$activeItem!==e&&(this.$activeItem&&this.$activeItem.removeClass(t),e.addClass(t),this.$activeItem=e)},onRender:function(){var e=qazana.templates.getFilter("source"),t=this.ui.menuItems.filter('[data-template-source="'+e+'"]');"remote"===e&&(t=t.filter('[data-template-type="'+qazana.templates.getFilter("type")+'"]')),this.activateMenuItem(t)},onMenuItemClick:function(e){var t=e.currentTarget,e=t.dataset;this.activateMenuItem(jQuery(t)),qazana.templates.setTemplatesPage(t.dataset.templateSource,e.templateType)}})},function(e,t,n){"use strict";n=n(181);e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-preview",id:"qazana-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:n}}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-back",id:"qazana-template-library-header-preview-back",events:{click:"onClick"},onClick:function(){qazana.templates.showTemplates()}})},function(e,t,n){"use strict";var i=n(254),a=n(255),o=n(156),r=Marionette.CompositeView.extend({template:"#tmpl-qazana-template-library-templates",id:"qazana-template-library-templates",childViewContainer:"#qazana-template-library-templates-container",reorderOnSort:!0,emptyView:function(){return new(n(256))},ui:{textFilter:"#qazana-template-library-filter-text",selectFilter:".qazana-template-library-filter-select",myFavoritesFilter:"#qazana-template-library-filter-my-favorites",orderInputs:".qazana-template-library-order-input",orderLabels:"label.qazana-template-library-order-label"},events:{"input @ui.textFilter":"onTextFilterInput","change @ui.selectFilter":"onSelectFilterChange","change @ui.myFavoritesFilter":"onMyFavoritesFilterChange","mousedown @ui.orderLabels":"onOrderLabelsClick"},comparators:{title:function(e){return e.get("title").toLowerCase()},popularityIndex:function(e){var t=e.get("popularityIndex");return t=t||e.get("date"),-t},trendIndex:function(e){var t=e.get("trendIndex");return t=t||e.get("date"),-t}},getChildView:function(e){return"remote"===e.get("source")?a:i},initialize:function(){this.listenTo(qazana.channels.templates,"filter:change",this._renderChildren)},filter:function(i){var e=qazana.templates.getFilterTerms(),a=!0;return jQuery.each(e,function(e){var t=qazana.templates.getFilter(e);if(t){if(this.callback){var n=this.callback.call(i,t);return n||(a=!1),n}e=t===i.get(e);return e||(a=!1),e}}),a},order:function(e,t){e=this.comparators[e]||e;t&&(e=this.reverseOrder(e)),this.collection.comparator=e,this.collection.sort()},reverseOrder:function(n){var t;return"function"!=typeof n&&(t=n,n=function(e){return e.get(t)}),function(e,t){e=n(e),t=n(t);return void 0===e?-1:void 0===t||e<t?1:t<e?-1:0}},addSourceData:function(){var e=this.children.isEmpty();this.$el.attr("data-template-source",e?"empty":qazana.templates.getFilter("source"))},setFiltersUI:function(){this.$(this.ui.selectFilter).select2({placeholder:qazana.translate("category"),allowClear:!0,width:150})},setMasonrySkin:function(){var e=new o({container:this.$childViewContainer,items:this.$childViewContainer.children()});this.$childViewContainer.imagesLoaded(e.run.bind(e))},toggleFilterClass:function(){this.$el.toggleClass("qazana-templates-filter-active",!(!qazana.templates.getFilter("text")&&!qazana.templates.getFilter("favorite")))},onRenderCollection:function(){this.addSourceData(),this.toggleFilterClass(),"remote"===qazana.templates.getFilter("source")&&"block"===qazana.templates.getFilter("type")&&(this.setFiltersUI(),this.setMasonrySkin())},onBeforeRenderEmpty:function(){this.addSourceData()},onTextFilterInput:function(){qazana.templates.setFilter("text",this.ui.textFilter.val())},onSelectFilterChange:function(e){var t=jQuery(e.currentTarget),e=t.data("qazana-filter");qazana.templates.setFilter(e,t.val())},onMyFavoritesFilterChange:function(){qazana.templates.setFilter("favorite",this.ui.myFavoritesFilter[0].checked)},onOrderLabelsClick:function(e){var t,e=jQuery(e.currentTarget.control);e[0].checked||(t="asc"!==e.data("default-ordering-direction")),e.toggleClass("qazana-template-library-order-reverse",t),this.order(e.val(),e.hasClass("qazana-template-library-order-reverse"))}});e.exports=r},function(e,t,n){"use strict";var i=n(182),n=i.extend({template:"#tmpl-qazana-template-library-template-local",ui:function(){return _.extend(i.prototype.ui.apply(this,arguments),{deleteButton:".qazana-template-library-template-delete",morePopup:".qazana-template-library-template-more",toggleMore:".qazana-template-library-template-more-toggle",toggleMoreIcon:".qazana-template-library-template-more-toggle i"})},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.deleteButton":"onDeleteButtonClick","click @ui.toggleMore":"onToggleMoreClick"})},onDeleteButtonClick:function(){var e=this.ui.toggleMoreIcon;qazana.templates.deleteTemplate(this.model,{onConfirm:function(){e.removeClass("eicon-ellipsis-h").addClass("fa fa-circle-o-notch fa-spin")},onSuccess:function(){qazana.templates.showTemplates()}})},onToggleMoreClick:function(){this.ui.morePopup.show()},onPreviewButtonClick:function(){open(this.model.get("url"),"_blank")}});e.exports=n},function(e,t,n){"use strict";var i=n(182),n=i.extend({template:"#tmpl-qazana-template-library-template-remote",ui:function(){return jQuery.extend(i.prototype.ui.apply(this,arguments),{favoriteCheckbox:".qazana-template-library-template-favorite-input"})},events:function(){return jQuery.extend(i.prototype.events.apply(this,arguments),{"change @ui.favoriteCheckbox":"onFavoriteCheckboxChange"})},onPreviewButtonClick:function(){qazana.templates.getLayout().showPreviewView(this.model)},onFavoriteCheckboxChange:function(){var e=this.ui.favoriteCheckbox[0].checked;this.model.set("favorite",e),qazana.templates.markAsFavorite(this.model,e),!e&&qazana.templates.getFilter("favorite")&&qazana.channels.templates.trigger("filter:change")}});e.exports=n},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({id:"qazana-template-library-templates-empty",template:"#tmpl-qazana-template-library-templates-empty",ui:{title:".qazana-template-library-blank-title",message:".qazana-template-library-blank-message"},modesStrings:{empty:{title:qazana.translate("templates_empty_title"),message:qazana.translate("templates_empty_message")},noResults:{title:qazana.translate("templates_no_results_title"),message:qazana.translate("templates_no_results_message")},noFavorites:{title:qazana.translate("templates_no_favorites_title"),message:qazana.translate("templates_no_favorites_message")}},getCurrentMode:function(){return qazana.templates.getFilter("text")?"noResults":qazana.templates.getFilter("favorite")?"noFavorites":"empty"},onRender:function(){var e=this.modesStrings[this.getCurrentMode()];this.ui.title.html(e.title),this.ui.message.html(e.message)}});e.exports=i},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({id:"qazana-template-library-save-template",template:"#tmpl-qazana-template-library-save-template",ui:{form:"#qazana-template-library-save-template-form",submitButton:"#qazana-template-library-save-template-submit"},events:{"submit @ui.form":"onFormSubmit"},getSaveType:function(){return this.model?this.model.get("elType"):"page"},templateHelpers:function(){var e=this.getSaveType();return qazana.templates.getTemplateTypes(e).saveDialog},onFormSubmit:function(e){e.preventDefault();var t=this.ui.form.qazanaSerializeObject(),n=this.model?this.model.get("elType"):"page",e={removeDefault:!0};t.content=this.model?[this.model.toJSON(e)]:qazana.elements.toJSON(e),this.ui.submitButton.addClass("qazana-button-state"),qazana.templates.saveTemplate(n,t)}});e.exports=i},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-import",id:"qazana-template-library-import",ui:{uploadForm:"#qazana-template-library-import-form",fileInput:"#qazana-template-library-import-form-input"},events:{"change @ui.fileInput":"onFileInputChange"},droppedFiles:null,submitForm:function(){var t=qazana.templates.getLayout(),e=new FormData;this.droppedFiles?(e.append("file",this.droppedFiles[0]),this.droppedFiles=null):(e.append("file",this.ui.fileInput[0].files[0]),this.ui.uploadForm[0].reset());e={data:e,processData:!1,contentType:!1,success:function(e){qazana.templates.getTemplatesCollection().add(e),qazana.templates.setTemplatesPage("local")},error:function(e){qazana.templates.showErrorDialog(e),t.showImportView()},complete:function(){t.hideLoadingView()}};qazana.ajax.send("import_template",e),t.showLoadingView()},onRender:function(){this.ui.uploadForm.on({"drag dragstart dragend dragover dragenter dragleave drop":this.onFormActions.bind(this),dragenter:this.onFormDragEnter.bind(this),"dragleave drop":this.onFormDragLeave.bind(this),drop:this.onFormDrop.bind(this)})},onFormActions:function(e){e.preventDefault(),e.stopPropagation()},onFormDragEnter:function(){this.ui.uploadForm.addClass("qazana-drag-over")},onFormDragLeave:function(e){jQuery(e.relatedTarget).closest(this.ui.uploadForm).length||this.ui.uploadForm.removeClass("qazana-drag-over")},onFormDrop:function(e){this.droppedFiles=e.originalEvent.dataTransfer.files,this.submitForm()},onFileInputChange:function(){this.submitForm()}});e.exports=i},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-preview",id:"qazana-template-library-preview",ui:{iframe:"> iframe"},onRender:function(){this.ui.iframe.attr("src",this.getOption("url"))}});e.exports=i},function(e,t,n){"use strict";n=n(261),n=Backbone.Collection.extend({model:n});e.exports=n},function(e,t,n){"use strict";e.exports=Backbone.Model.extend({defaults:{template_id:0,name:"",title:"",source:"",type:"",subtype:"",author:"",thumbnail:"",url:"",export_link:"",categories:[],tags:[],keywords:[]}})},function(e,t,n){"use strict";var a=n(0)(n(108)),n={config:{},requests:{},cache:{},initConfig:function(){this.config={ajaxParams:{type:"POST",url:qazana.config.ajaxurl,data:{}},actionPrefix:"qazana_"}},init:function(){this.initConfig(),this.debounceSendBatch=_.debounce(this.sendBatch.bind(this),500)},getCacheKey:function(e){return(0,a.default)({unique_id:e.unique_id,data:e.data})},loadObjects:function(t){var n=this,i={},a=[];t.before&&t.before(),t.ids.forEach(function(e){a.push(n.load({action:t.action,unique_id:t.data.unique_id+e,data:jQuery.extend({id:e},t.data)}).done(function(e){i=jQuery.extend(i,e)}))}),jQuery.when.apply(jQuery,a).done(function(){t.success(i)})},load:function(e){var t=this;e.unique_id||(e.unique_id=e.action),e.before&&e.before();var n=t.getCacheKey(e),e=_.has(t.cache,n)?jQuery.Deferred().done(e.success).resolve(t.cache[n]):t.addRequest(e.action,{data:e.data,unique_id:e.unique_id,success:function(e){t.cache[n]=e}}).done(e.success);return e},addRequest:function(e,t,n){(t=t||{}).unique_id||(t.unique_id=e),t.deferred=jQuery.Deferred().done(t.success).fail(t.error).always(t.complete);e={action:e,options:t};return n?((n={})[t.unique_id]=e,t.deferred.jqXhr=this.sendBatch(n)):(this.requests[t.unique_id]=e,this.debounceSendBatch()),t.deferred},sendBatch:function(n){var i={};return n||(n=this.requests,this.requests={}),_(n).each(function(e,t){i[t]={action:e.action,data:e.options.data}}),this.send("ajax",{data:{actions:(0,a.default)(i)},success:function(e){_.each(e.responses,function(e,t){t=n[t].options;t&&(e.success?t.deferred.resolve(e.data):e.success||t.deferred.reject(e.data))})},error:function(t){_.each(n,function(e){e.options&&e.options.deferred.reject(t)})}})},send:function(e,t){var n=this,i=qazana.helpers.cloneObject(this.config.ajaxParams);t=t||{},e=this.config.actionPrefix+e,jQuery.extend(i,t),i.data instanceof FormData?(i.data.append("action",e),i.data.append("_nonce",qazana.config.nonce),i.data.append("editor_post_id",qazana.config.document.id)):(i.data.action=e,i.data._nonce=qazana.config.nonce,i.data.editor_post_id=qazana.config.document.id);var a=i.success,o=i.error;return(a||o)&&(i.success=function(e){e.success&&a&&a(e.data),!e.success&&o&&o(e.data)},i.error=o?function(e){o(e)}:function(e){0===e.readyState&&"abort"===e.statusText||(e=n.createErrorMessage(e),qazana.notifications.showToast({message:e}))}),jQuery.ajax(i)},createErrorMessage:function(e){var t;return 4===e.readyState?(t=qazana.translate("server_error"),200!==e.status&&(t+=" ("+e.status+" "+e.statusText+")")):t=0===e.readyState?qazana.translate("server_connection_lost"):qazana.translate("unknown_error"),t+"."}};e.exports=n},function(e,t,n){"use strict";n(28),n(47),n=function(){var o=this;this.compare=function(e,t,n){switch(n){case"==":return e==t;case"!=":return e!=t;case"!==":return e!==t;case"in":return-1!==t.indexOf(e);case"!in":return-1===t.indexOf(e);case"contains":return-1!==e.indexOf(t);case"!contains":return-1===e.indexOf(t);case"<":return e<t;case"<=":return e<=t;case">":return t<e;case">=":return t<=e;default:return e===t}},this.check=function(e,n){var i="or"===e.relation,a=!i;return jQuery.each(e.terms,function(){var e,t=this.terms?o.check(this,n):(e=this.name.match(/(\w+)(?:\[(\w+)])?/),t=n[e[1]],e[2]&&(t=t[e[2]]),o.compare(t,this.value,this.operator));return i?(t&&(a=!0),!t):t?void 0:a=!1}),a}},e.exports=new n},function(e,t,n){"use strict";var i=n(265),a=function(){function e(){qazana.getPanelView().addPage("historyPage",{view:i,title:qazana.translate("history")})}var t=this;jQuery(window).on("qazana:init",function(){qazana.on("preview:loaded",e),t.history=n(271),t.revisions=n(291),t.revisions.init()})};e.exports=new a},function(e,t,n){"use strict";var i=n(266),a=n(267),o=n(268),r=n(270);e.exports=Marionette.LayoutView.extend({template:"#tmpl-qazana-panel-history-page",regions:{content:"#qazana-panel-history-content"},ui:{tabs:".qazana-panel-navigation-tab"},events:{"click @ui.tabs":"onTabClick"},regionViews:{},currentTab:null,initialize:function(){this.initRegionViews()},initRegionViews:function(){var e=qazana.history.history.getItems(),t=qazana.history.revisions.getItems();this.regionViews={history:{region:this.content,view:function(){return e.length?i:a},options:{collection:e}},revisions:{region:this.content,view:function(){return t.length?o:r},options:{collection:t}}}},activateTab:function(e){this.ui.tabs.removeClass("qazana-active").filter('[data-view="'+e+'"]').addClass("qazana-active"),this.showView(e)},getCurrentTab:function(){return this.currentTab},showView:function(e){var t=this.regionViews[e],n=t.options||{},i=t.view;"function"==typeof i&&(i=t.view()),n.viewName=e,this.currentTab=new i(n),t.region.show(this.currentTab)},onRender:function(){this.showView("history")},onTabClick:function(e){this.activateTab(e.currentTarget.dataset.view)},onDestroy:function(){qazana.getPanelView().getFooterView().ui.history.removeClass("qazana-open")}})},function(e,t,n){"use strict";n(183),n(1),e.exports=Marionette.CompositeView.extend({id:"qazana-panel-history",template:"#tmpl-qazana-panel-history-tab",childView:Marionette.ItemView.extend({template:"#tmpl-qazana-panel-history-item",ui:{item:".qazana-history-item"},triggers:{"click @ui.item":"item:click"}}),childViewContainer:"#qazana-history-list",currentItem:null,onRender:function(){var t=this;_.defer(function(){var e;t.children.length&&(e=t.collection.find(function(e){return"not_applied"===e.get("status")}),e=t.children.findByModel(e),t.updateCurrentItem(e.$el))})},updateCurrentItem:function(e){var t="qazana-history-item-current";this.currentItem&&this.currentItem.removeClass(t),this.currentItem=e,this.currentItem.addClass(t)},onChildviewItemClick:function(e,t){e.$el!==this.currentItem&&(t=t.model.collection.findIndex(t.model),qazana.history.history.doItem(t),this.updateCurrentItem(e.$el),this.isDestroyed||this.render())}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-history-no-items",id:"qazana-panel-history-no-items",className:"qazana-nerd-box"})},function(e,t,n){"use strict";e.exports=Marionette.CompositeView.extend({id:"qazana-panel-revisions",template:"#tmpl-qazana-panel-revisions",childView:n(269),childViewContainer:"#qazana-revisions-list",ui:{discard:".qazana-panel-scheme-discard .qazana-button",apply:".qazana-panel-scheme-save .qazana-button"},events:{"click @ui.discard":"onDiscardClick","click @ui.apply":"onApplyClick"},isRevisionApplied:!1,jqueryXhr:null,currentPreviewId:null,currentPreviewItem:null,initialize:function(){this.listenTo(qazana.channels.editor,"saved",this.onEditorSaved),this.currentPreviewId=qazana.config.current_revision_id},getRevisionViewData:function(t){var n=this;this.jqueryXhr=qazana.history.revisions.getRevisionDataAsync(t.model.get("id"),{success:function(e){qazana.history.revisions.setEditorData(e.elements),qazana.settings.page.model.set(e.settings),n.setRevisionsButtonsActive(!0),n.jqueryXhr=null,t.$el.removeClass("qazana-revision-item-loading"),n.enterReviewMode()},error:function(){t.$el.removeClass("qazana-revision-item-loading"),"abort"!==n.jqueryXhr.statusText&&(n.currentPreviewItem=null,n.currentPreviewId=null,alert("An error occurred"))}})},setRevisionsButtonsActive:function(e){this.ui.apply.add(this.ui.discard).prop("disabled",!e)},deleteRevision:function(e){var t=this;e.$el.addClass("qazana-revision-item-loading"),qazana.history.revisions.deleteRevision(e.model,{success:function(){e.model.get("id")===t.currentPreviewId&&t.onDiscardClick(),t.currentPreviewId=null},error:function(){e.$el.removeClass("qazana-revision-item-loading"),alert("An error occurred")}})},enterReviewMode:function(){qazana.changeEditMode("review")},exitReviewMode:function(){qazana.changeEditMode("edit")},navigate:function(e){var t=this.collection.indexOf(this.currentPreviewItem.model),t=e?t-1:t+1;t<0&&(t=this.collection.length-1),t>=this.collection.length&&(t=0),this.children.findByIndex(t).ui.detailsArea.trigger("click")},onEditorSaved:function(){this.exitReviewMode(),this.setRevisionsButtonsActive(!1),this.currentPreviewId=qazana.config.current_revision_id},onApplyClick:function(){qazana.saver.setFlagEditorChange(!0),qazana.saver.saveAutoSave(),this.isRevisionApplied=!0,this.currentPreviewId=null,qazana.history.history.getItems().reset()},onDiscardClick:function(){qazana.history.revisions.setEditorData(qazana.config.data),qazana.saver.setFlagEditorChange(this.isRevisionApplied),this.isRevisionApplied=!1,this.setRevisionsButtonsActive(!1),this.currentPreviewId=null,this.exitReviewMode(),this.currentPreviewItem&&this.currentPreviewItem.$el.removeClass("qazana-revision-current-preview")},onDestroy:function(){this.currentPreviewId&&this.currentPreviewId!==qazana.config.current_revision_id&&this.onDiscardClick()},onRenderCollection:function(){var e;!this.currentPreviewId||(e=this.collection.findWhere({id:this.currentPreviewId}))&&(this.currentPreviewItem=this.children.findByModelCid(e.cid),this.currentPreviewItem.$el.addClass("qazana-revision-current-preview"))},onChildviewDetailsAreaClick:function(e){var t=this,n=e.model.get("id");n!==t.currentPreviewId&&(this.jqueryXhr&&this.jqueryXhr.abort(),t.currentPreviewItem&&t.currentPreviewItem.$el.removeClass("qazana-revision-current-preview"),e.$el.addClass("qazana-revision-current-preview qazana-revision-item-loading"),qazana.saver.isEditorChanged()&&null===t.currentPreviewId?qazana.saver.saveEditor({status:"autosave",onSuccess:function(){t.getRevisionViewData(e)}}):t.getRevisionViewData(e),t.currentPreviewItem=e,t.currentPreviewId=n)},onChildviewDeleteClick:function(e){var t=this,n=e.model.get("type");qazana.dialogsManager.createWidget("confirm",{message:qazana.translate("dialog_confirm_delete",[n]),headerMessage:qazana.translate("delete_element",[n]),strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},defaultOption:"confirm",onConfirm:function(){t.deleteRevision(e)}}).show()}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-revisions-revision-item",className:"qazana-revision-item",ui:{detailsArea:".qazana-revision-item__details",deleteButton:".qazana-revision-item__tools-delete"},triggers:{"click @ui.detailsArea":"detailsArea:click","click @ui.deleteButton":"delete:click"}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-revisions-no-revisions",id:"qazana-panel-revisions-no-revisions",className:"qazana-nerd-box"})},function(e,t,n){"use strict";n(1);var d=n(272),h=n(184),p=n(273),g=n(274);e.exports=new function(){function e(e){return e.ElementHistory={behaviorClass:p},e.CollectionHistory={behaviorClass:g},e}function t(e){return e.CollectionHistory={behaviorClass:g},e}function n(e){var t=s.find(function(e){return"not_applied"===e.get("status")}),n=s.indexOf(t),n=e?n-1:n+1;!e&&!t||n<0||n>=s.length||o.doItem(n)}function i(){function e(e){return s.length&&qazana.hotKeys.isControlEvent(e)&&!jQuery(e.target).is("input, textarea, [contenteditable=true]")}qazana.hotKeys.addHotKeyHandler(72,"showHistoryPage",{isWorthHandling:function(e){return qazana.hotKeys.isControlEvent(e)&&e.shiftKey},handle:function(){qazana.getPanelView().setPage("historyPage")}}),qazana.hotKeys.addHotKeyHandler(89,"historyNavigationRedo",{isWorthHandling:e,handle:function(){n(!0)}}),qazana.hotKeys.addHotKeyHandler(90,"historyNavigation",{isWorthHandling:e,handle:function(e){n(e.shiftKey)}})}function a(){var e;2<=s.length&&(e=s.at(s.length-2),l="not_applied"===e.get("status"))}var o=this,r=null,s=new d,l=!1,c=!0,u={add:qazana.translate("added"),remove:qazana.translate("removed"),change:qazana.translate("edited"),move:qazana.translate("moved"),paste_style:qazana.translate("style_pasted"),reset_style:qazana.translate("style_reset")};this.setActive=function(e){c=e},this.getActive=function(){return c},this.getItems=function(){return s},this.startItem=function(e){r=this.addItem(e)},this.endItem=function(){r=null},this.isItemStarted=function(){return null!==r},this.addItem=function(e){if(this.getActive()){for(s.length||s.add({status:"not_applied",title:qazana.translate("editing_started"),subTitle:"",action:"",editing_started:!0});s.length&&"applied"===s.first().get("status");)s.shift();var t=r||(new Date).getTime(),n=s.findWhere({id:t});n||(n=new h({id:t,title:e.title,subTitle:e.subTitle,action:u[(i=e).type]||i.type,type:e.type,elementType:e.elementType}),o.startItemTitle="",o.startItemAction="");var i=0;"column"===e.elementType&&"remove"===e.type&&"column"===n.get("elementType")&&(i=1),n.get("items").add(e,{at:i}),s.add(n,{at:0});n=qazana.getPanelView();return"historyPage"===n.getCurrentPageName()&&n.getCurrentPageView().render(),t}},this.doItem=function(e){this.setActive(!1);var t=s.at(e);"not_applied"===t.get("status")?this.undoItem(e):this.redoItem(e),this.setActive(!0);var n,i=qazana.getPanelView(),e=i.getCurrentPageView();"editor"===i.getCurrentPageName()?e.getOption("editedElementView").isDestroyed?i.setPage("historyPage"):n=e.getOption("editedElementView"):("historyPage"===i.getCurrentPageName()&&e.render(),t instanceof Backbone.Model&&t.get("items").length&&((e=t.get("items").first().get("history"))&&e.behavior.view.model&&(n=o.findView(e.behavior.view.model.get("id"))))),n&&!qazana.helpers.isInViewport(n.$el[0],qazana.$previewContents.find("html")[0])&&qazana.helpers.scrollToView(n.$el),t.get("editing_started")&&(l||qazana.saver.setFlagEditorChange(!1))},this.undoItem=function(e){for(var t,n=0;n<e;n++)"not_applied"===(t=s.at(n)).get("status")&&(t.get("items").each(function(e){var t=e.get("history");t&&t.behavior.restore(e)}),t.set("status","applied"))},this.redoItem=function(e){for(var t=s.length-1;e<=t;t--){var n,i=s.at(t);"applied"===i.get("status")&&(n=_.toArray(i.get("items").models).reverse(),_(n).each(function(e){var t=e.get("history");t&&t.behavior.restore(e,!0)}),i.set("status","not_applied"))}},this.getModelLabel=function(e){return e instanceof Backbone.Model||(e=new Backbone.Model(e)),qazana.getElementData(e).title},this.findView=function(n,e){var i=this,a=!1;return e=e||qazana.getPreviewView().children,_.each(e._views,function(e){var t;a||(t=e.getEditModel?e.getEditModel():e.model,n===t.get("id")?a=e:e.children&&e.children.length&&(a=i.findView(n,e.children)))}),a},this.startMovingItem=function(e){qazana.history.history.startItem({type:"move",title:o.getModelLabel(e),elementType:e.elType||e.get("elType")})},this.startInsertTemplate=function(e){qazana.history.history.startItem({type:"add",title:qazana.translate("template"),subTitle:e.get("title"),elementType:"template"})},this.startDropElement=function(){var e=qazana.channels.panelElements.request("element:selected");qazana.history.history.startItem({type:"add",title:o.getModelLabel(e.model),elementType:e.model.get("widgetType")||e.model.get("elType")})},this.startAddElement=function(e){qazana.history.history.startItem({type:"add",title:o.getModelLabel(e),elementType:e.elType})},this.startPasteStyle=function(e){qazana.history.history.startItem({type:"paste_style",title:o.getModelLabel(e),elementType:e.get("elType")})},this.startResetStyle=function(e){qazana.history.history.startItem({type:"reset_style",title:o.getModelLabel(e),elementType:e.get("elType")})},this.startRemoveElement=function(e){qazana.history.history.startItem({type:"remove",title:o.getModelLabel(e),elementType:e.get("elType")})},i(),qazana.hooks.addFilter("elements/base/behaviors",e),qazana.hooks.addFilter("elements/base-section-container/behaviors",t),qazana.channels.data.on("drag:before:update",o.startMovingItem).on("drag:after:update",o.endItem).on("element:before:add",o.startAddElement).on("element:after:add",o.endItem).on("element:before:remove",o.startRemoveElement).on("element:after:remove",o.endItem).on("element:before:paste:style",o.startPasteStyle).on("element:after:paste:style",o.endItem).on("element:before:reset:style",o.startResetStyle).on("element:after:reset:style",o.endItem).on("section:before:drop",o.startDropElement).on("section:after:drop",o.endItem).on("template:before:insert",o.startInsertTemplate).on("template:after:insert",o.endItem),qazana.channels.editor.on("saved",a)}},function(e,t,n){"use strict";n=n(184);e.exports=Backbone.Collection.extend({model:n})},function(e,t,n){"use strict";var o=n(0)(n(39));n(28),e.exports=Marionette.Behavior.extend({oldValues:[],listenerAttached:!1,initialize:function(){this.lazySaveTextHistory=_.debounce(this.saveTextHistory.bind(this),800)},onBeforeRender:function(){this.listenerAttached||(this.listenTo(this.view.getEditModel().get("settings"),"change",this.saveHistory),this.listenerAttached=!0)},saveTextHistory:function(e,t,n){var i={},a=e.get(n.name),a=a instanceof Backbone.Collection?a.toJSON():a;i[n.name]={old:this.oldValues[n.name],new:a};i={type:"change",elementType:"control",title:qazana.history.history.getModelLabel(e),subTitle:n.label,history:{behavior:this,changed:i,model:this.view.getEditModel().toJSON()}};qazana.history.history.addItem(i),delete this.oldValues[n.name]},saveHistory:function(t,e){if(qazana.history.history.getActive()){var n=(0,o.default)(t.changed),i=t.controls[n[0]];if(!i&&e&&e.control&&(i=e.control),n.length&&i){if(1===n.length)return _.isUndefined(this.oldValues[i.name])&&(this.oldValues[i.name]=t.previous(i.name)),void(qazana.history.history.isItemStarted()?this.saveTextHistory(t,n,i):this.lazySaveTextHistory(t,n,i));var a={};_.each(n,function(e){a[e]={old:t.previous(e),new:t.get(e)}});e={type:"change",elementType:"control",title:qazana.history.history.getModelLabel(t),history:{behavior:this,changed:a,model:this.view.getEditModel().toJSON()}};1===n.length&&(e.subTitle=i.label),qazana.history.history.addItem(e)}}},restore:function(e,n){var i,t=e.get("history"),a=t.model.id,o=qazana.history.history.findView(a);o&&(a=(o.getEditModel?o.getEditModel():o.model).get("settings"),(o=o.getBehavior("ElementHistory")).stopListening(a,"change",this.saveHistory),i={},_.each(t.changed,function(e,t){i[t]=n?e.new:e.old}),a.setExternalChange(i),e.set("status",n?"not_applied":"applied"),o.listenTo(a,"change",this.saveHistory))}})},function(e,t,r){"use strict";e.exports=Marionette.Behavior.extend({listenerAttached:!1,onBeforeRender:function(){this.view.collection&&!this.listenerAttached&&(this.view.collection.on("update",this.saveCollectionHistory,this).on("reset",this.onDeleteAllContent,this),this.listenerAttached=!0)},onDeleteAllContent:function(e,t){var n;qazana.history.history.getActive()&&(n=[],_.each(t.previousModels,function(e){n.push(e.toJSON({copyHtmlCache:!0}))}),t={type:"remove",elementType:"section",title:qazana.translate("all_content"),history:{behavior:this,collection:t.previousModels,event:t,models:n}},qazana.history.history.addItem(t))},saveCollectionHistory:function(e,t){var n,i,a,o,r;qazana.history.history.getActive()&&(a=t.add?(i=(n=t.changes.added)[0],"add"):(i=(n=t.changes.removed)[0],"remove"),(o=qazana.history.history.getModelLabel(i))&&(r=[],_.each(n,function(e){r.push(e.toJSON({copyHtmlCache:!0}))}),t={type:a,elementType:i.get("elType"),elementID:i.get("id"),title:o,history:{behavior:this,collection:e,event:t,models:r}},qazana.history.history.addItem(t)))},add:function(e,t,n){"section"===e[0].elType&&_.each(e,function(e){e.allowEmpty=!0}),t.$el.hasClass("qazana-inner")&&t.$el[0].ownerDocument!==qazana.$previewContents[0]&&(t=qazana.getPreviewView()),t.addChildModel(e,{at:n,silent:0})},remove:function(e,t){t.remove(e,{silent:0})},restore:function(e,t){var n,i=e.get("type"),a=e.get("history"),o=!1,e=r(144);switch(a.behavior.view instanceof e&&(e=a.behavior.view.model.get("id"),(e=qazana.history.history.findView(e))&&(n=e.getBehavior("CollectionHistory"))),(n=n||a.behavior).view.collection.off("update",n.saveCollectionHistory),i){case"add":t?this.add(a.models,n.view,a.event.index):this.remove(a.models,n.view.collection),o=!0;break;case"remove":t?this.remove(a.models,n.view.collection):this.add(a.models,n.view,a.event.index),o=!0}return n.view.collection.on("update",n.saveCollectionHistory,a.behavior),o}})},function(e,t,n){e.exports=n(276)},function(e,t,n){n(277),e.exports=n(3).Array.isArray},function(e,t,n){var i=n(14);i(i.S,"Array",{isArray:n(102)})},function(e,t,n){"use strict";n(28);n=n(46).extend({getDefaultSettings:function(){return{actions:{},classes:{list:"qazana-context-menu-list",group:"qazana-context-menu-list__group",groupPrefix:"qazana-context-menu-list__group-",item:"qazana-context-menu-list__item",itemTypePrefix:"qazana-context-menu-list__item-",itemTitle:"qazana-context-menu-list__item__title",itemShortcut:"qazana-context-menu-list__item__shortcut",iconShortcut:"qazana-context-menu-list__item__icon",itemDisabled:"qazana-context-menu-list__item--disabled",divider:"qazana-context-menu-list__divider",hidden:"qazana-hidden"}}},buildActionItem:function(e){var t=this,n=t.getSettings("classes"),i=jQuery("<div>",{class:n.item+" "+n.itemTypePrefix+e.name}),a=jQuery("<div>",{class:n.itemTitle}).text(e.title),o=jQuery("<div>",{class:n.iconShortcut});return e.icon&&o.html(jQuery("<i>",{class:e.icon})),i.append(o,a),e.shortcut&&(n=jQuery("<div>",{class:n.itemShortcut}).html(e.shortcut),i.append(n)),e.callback&&i.on("click",function(){t.runAction(e)}),e.$item=i},buildActionsList:function(){var n=this,i=n.getSettings("classes"),e=n.getSettings("groups"),a=jQuery("<div>",{class:i.list});return e.forEach(function(e){var t=jQuery("<div>",{class:i.group+" "+i.groupPrefix+e.name});e.actions.forEach(function(e){t.append(n.buildActionItem(e))}),a.append(t),e.$item=t}),a},toggleGroupVisibility:function(e,t){e.$item.toggleClass(this.getSettings("classes.hidden"),!t)},toggleActionVisibility:function(e,t){e.$item.toggleClass(this.getSettings("classes.hidden"),!t)},toggleActionUsability:function(e,t){e.$item.toggleClass(this.getSettings("classes.itemDisabled"),!t)},isActionEnabled:function(e){return!(!e.callback&&!e.groups)&&(!e.isEnabled||e.isEnabled())},runAction:function(e){this.isActionEnabled(e)&&(e.callback(),this.getModal().hide())},initModal:function(){var e;this.getModal=function(){return e=e||qazana.dialogsManager.createWidget("simple",{className:"qazana-context-menu",message:this.buildActionsList(),iframe:qazana.$preview,effects:{hide:"hide",show:"show"},hide:{onOutsideContextMenu:!0},position:{my:(qazana.config.is_rtl?"right":"left")+" top",collision:"fit"}})}},show:function(e){var n=this,t=n.getModal();t.setSettings("position",{of:e}),n.getSettings("groups").forEach(function(e){var t=!1!==e.isVisible;n.toggleGroupVisibility(e,t),t&&e.actions.forEach(function(e){var t=!1!==e.isVisible;n.toggleActionVisibility(e,t),t&&n.toggleActionUsability(e,n.isActionEnabled(e))})}),t.show()},destroy:function(){this.getModal().destroy()},onInit:function(){this.initModal()}});e.exports=n},function(e,t,n){"use strict";var i=n(0);n(85)(t,"__esModule",{value:!0}),t.default=void 0,n(75),n(59);var a=i(n(99)),o=i(n(92)),r=i(n(93)),s=i(n(280)),l=i(n(100)),c=i(n(101)),u=i(n(96));function d(n){var i=function(){if("undefined"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,u.default)(n);return t=i?(e=(0,u.default)(this).constructor,(0,a.default)(t,arguments,e)):t.apply(this,arguments),(0,c.default)(this,t)}}n=function(e){(0,l.default)(n,e);var t=d(n);function n(){return(0,o.default)(this,n),t.apply(this,arguments)}return(0,r.default)(n,[{key:"className",value:function(){return(0,s.default)((0,u.default)(n.prototype),"className",this).call(this)+" qazana-add-section-inline"}},{key:"fadeToDeath",value:function(){var e=this;e.$el.slideUp(function(){e.destroy()})}},{key:"paste",value:function(){(0,s.default)((0,u.default)(n.prototype),"paste",this).call(this),this.destroy()}},{key:"onCloseButtonClick",value:function(){this.fadeToDeath()}},{key:"onPresetSelected",value:function(e){(0,s.default)((0,u.default)(n.prototype),"onPresetSelected",this).call(this,e),this.destroy()}},{key:"onAddTemplateButtonClick",value:function(){(0,s.default)((0,u.default)(n.prototype),"onAddTemplateButtonClick",this).call(this),this.destroy()}},{key:"onDropping",value:function(){(0,s.default)((0,u.default)(n.prototype),"onDropping",this).call(this),this.destroy()}}]),n}(i(n(187)).default);t.default=n},function(i,e,t){var a=t(281),o=t(284),r=t(287);function s(e,t,n){return"undefined"!=typeof Reflect&&o?i.exports=s=o:i.exports=s=function(e,t,n){e=r(e,t);if(e){t=a(e,t);return t.get?t.get.call(n):t.value}},s(e,t,n||e)}i.exports=s},function(e,t,n){e.exports=n(282)},function(e,t,n){n(283);var i=n(3).Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},function(e,t,n){var i=n(13),a=n(86).f;n(137)("getOwnPropertyDescriptor",function(){return function(e,t){return a(i(e),t)}})},function(e,t,n){e.exports=n(285)},function(e,t,n){n(286),e.exports=n(3).Reflect.get},function(e,t,n){var o=n(86),r=n(95),s=n(9),i=n(14),l=n(17),c=n(22);i(i.S,"Reflect",{get:function e(t,n){var i,a=arguments.length<3?t:arguments[2];return c(t)===a?t[n]:(i=o.f(t,n))?s(i,"value")?i.value:void 0!==i.get?i.get.call(a):void 0:l(i=r(t))?e(i,n,a):void 0}})},function(e,t,n){var i=n(96);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}},function(e,t,n){"use strict";var i=n(144),a=n(289),a=i.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-column-content"),emptyView:a,childViewContainer:"> .qazana-column-wrap > .qazana-widget-wrap",toggleEditTools:!0,behaviors:function(){var e=i.prototype.behaviors.apply(this,arguments);return _.extend(e,{Sortable:{behaviorClass:n(163),elChildType:"widget"},Resizable:{behaviorClass:n(290)}}),qazana.hooks.applyFilters("elements/column/behaviors",e,this)},className:function(){return i.prototype.className.apply(this,arguments)+" qazana-column qazana-"+(this.isInner()?"inner":"top")+"-column"},tagName:function(){return this.model.getSetting("html_tag")||"div"},ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.columnInner="> .qazana-column-wrap",e.percentsTooltip="> .qazana-element-overlay .qazana-column-percents-tooltip",e},initialize:function(){i.prototype.initialize.apply(this,arguments),this.addControlValidator("_inline_size",this.onEditorInlineSizeInputChange)},getContextMenuGroups:function(){var e=i.prototype.getContextMenuGroups.apply(this,arguments),t=e.indexOf(_.findWhere(e,{name:"general"}));return e.splice(t+1,0,{name:"addNew",actions:[{name:"addNew",icon:"eicon-plus",title:qazana.translate("new_column"),callback:this.addNewColumn.bind(this)}]}),e},isDroppingAllowed:function(){var e=qazana.channels.panelElements.request("element:selected");if(!e)return!1;e=e.model.get("elType");return"section"===e?!this.isInner():"widget"===e},getPercentsForDisplay:function(){return(+this.model.getSetting("_inline_size")||this.getPercentSize()).toFixed(1)+"%"},changeSizeUI:function(){var e=this,t=e.model.getSetting("_column_size");e.$el.attr("data-col",t),_.defer(function(){e.ui.percentsTooltip&&e.ui.percentsTooltip.text(e.getPercentsForDisplay())})},getPercentSize:function(e){return+((e=e||this.el.getBoundingClientRect().width)/this.$el.parent().width()*100).toFixed(3)},getSortableOptions:function(){return{connectWith:".qazana-widget-wrap",items:"> .qazana-element"}},changeChildContainerClasses:function(){var e="qazana-element-empty",t="qazana-element-populated";this.collection.isEmpty()?this.ui.columnInner.removeClass(t).addClass(e):this.ui.columnInner.removeClass(e).addClass(t)},addNewColumn:function(){this.trigger("request:add:new")},onCollectionChanged:function(){i.prototype.onCollectionChanged.apply(this,arguments),this.changeChildContainerClasses()},onRender:function(){var n=this;i.prototype.onRender.apply(n,arguments),n.changeChildContainerClasses(),n.changeSizeUI(),n.$el.html5Droppable({items:" > .qazana-column-wrap > .qazana-widget-wrap > .qazana-element, >.qazana-column-wrap > .qazana-widget-wrap > .qazana-empty-view > .qazana-first-add",axis:["vertical"],groups:["qazana-element"],isDroppingAllowed:n.isDroppingAllowed.bind(n),currentElementClass:"qazana-html5dnd-current-element",placeholderClass:"qazana-sortable-placeholder qazana-widget-placeholder",hasDraggingOnChildClass:"qazana-dragging-on-child",onDropping:function(e,t){t.stopPropagation();t=jQuery(this).index();"bottom"===e&&t++,n.addElementFromPanel({at:t})}})},onSettingsChanged:function(e){i.prototype.onSettingsChanged.apply(this,arguments);e=e.changedAttributes();("_column_size"in e||"_inline_size"in e)&&this.changeSizeUI()},onEditorInlineSizeInputChange:function(e,t){var n=[],i=this.model.getSetting("_column_size");if(100===i)return n.push("Could not resize one column"),n;t=t||i;try{this._parent.resizeChild(this,+t,+e)}catch(e){e.message===this._parent.errors.columnWidthTooLarge&&n.push(e.message)}return n},onAddButtonClick:function(e){e.stopPropagation(),this.addNewColumn()}});e.exports=a},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-empty-preview",className:"qazana-empty-view",events:{click:"onClickAdd"},behaviors:function(){return{contextMenu:{behaviorClass:n(145),groups:this.getContextMenuGroups()}}},getContextMenuGroups:function(){return[{name:"general",actions:[{name:"paste",title:qazana.translate("paste"),callback:this.paste.bind(this),isEnabled:this.isPasteEnabled.bind(this)}]}]},paste:function(){var t=this,e=qazana.getStorage("transfer").elements,n=0;e.forEach(function(e){t._parent.addChildElement(e,{at:n,clone:!0}),n++})},isPasteEnabled:function(){var e=qazana.getStorage("transfer");return!!e&&("section"===e.elementsType?e.elements[0].isInner&&!this._parent.isInner():"widget"===e.elementsType)},onClickAdd:function(){qazana.getPanelView().setPage("elements")}})},function(e,t,n){"use strict";var i=Marionette.Behavior.extend({defaults:{handles:qazana.config.is_rtl?"w":"e"},events:{resizestart:"onResizeStart",resizestop:"onResizeStop",resize:"onResize"},initialize:function(){Marionette.Behavior.prototype.initialize.apply(this,arguments),this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeSwitched)},active:function(){var e,t;qazana.userCan("design")&&(this.deactivate(),delete(t=_.clone(this.options)).behaviorClass,e=this.getChildViewContainer(),t=_.extend({},t),e.resizable(t))},deactivate:function(){this.getChildViewContainer().resizable("instance")&&this.getChildViewContainer().resizable("destroy")},onEditModeSwitched:function(e){"edit"===e?this.active():this.deactivate()},onRender:function(){var e=this;_.defer(function(){e.onEditModeSwitched(qazana.channels.dataEditMode.request("activeMode"))})},onDestroy:function(){this.deactivate()},onResizeStart:function(e){e.stopPropagation(),this.view.$el.data("originalWidth",this.view.el.getBoundingClientRect().width),this.view.triggerMethod("request:resize:start",e)},onResizeStop:function(e){e.stopPropagation(),this.view.triggerMethod("request:resize:stop")},onResize:function(e,t){e.stopPropagation(),this.view.triggerMethod("request:resize",t,e)},getChildViewContainer:function(){return this.$el}});e.exports=i},function(e,t,n){"use strict";var a=n(292),n=function(){var i,n=this;this.getItems=function(){return i};function t(t){var e;t.latest_revisions&&n.addRevisions(t.latest_revisions),t.revisions_ids&&(e=i.filter(function(e){return-1!==t.revisions_ids.indexOf(e.get("id"))}),i.reset(e))}this.setEditorData=function(e){var t=qazana.getRegion("sections").currentView.collection;qazana.history.history.setActive(!1),t.reset(e),qazana.history.history.setActive(!0)},this.getRevisionDataAsync=function(e,t){return _.extend(t,{data:{id:e}}),qazana.ajax.send("get_revision_data",t)},this.addRevisions=function(e){e.forEach(function(e){var t=i.findWhere({id:e.id});t&&i.remove(t),i.add(e)})},this.deleteRevision=function(t,n){var e={data:{id:t.get("id")},success:function(){var e;n.success&&n.success(),t.destroy(),i.length||"historyPage"===(e=qazana.getPanelView()).getCurrentPageName()&&e.getCurrentPageView().activateTab("revisions")}};n.error&&(e.error=n.error),qazana.ajax.send("delete_revision",e)},this.init=function(){var e;i=new a(qazana.config.revisions),qazana.channels.editor.on("saved",t),e={isWorthHandling:function(){var e=qazana.getPanelView();if("historyPage"!==e.getCurrentPageName())return!1;e=e.getCurrentPageView().getCurrentTab();return e.currentPreviewId&&e.currentPreviewItem&&1<e.children.length},handle:function(e){qazana.getPanelView().getCurrentPageView().getCurrentTab().navigate(38===e.which)}},qazana.hotKeys.addHotKeyHandler(38,"revisionNavigation",e),qazana.hotKeys.addHotKeyHandler(40,"revisionNavigation",e)}};e.exports=new n},function(e,t,n){"use strict";n=n(293);e.exports=Backbone.Collection.extend({model:n,comparator:function(e){return-e.get("timestamp")}})},function(e,t,n){"use strict";var i=Backbone.Model.extend();i.prototype.sync=function(){return null},e.exports=i},function(e,t,n){"use strict";n(1);n=n(188);e.exports=n.extend({ui:function(){return{buttonPreview:"#qazana-panel-header-saver-button-preview",buttonPublish:"#qazana-panel-header-saver-button-publish",buttonSaveOptions:"#qazana-panel-header-saver-button-save-options",buttonPublishLabel:"#qazana-panel-header-saver-button-publish-label",menuSaveDraft:"#qazana-panel-header-saver-button-save-draft",lastEditedWrapper:".qazana-last-edited-wrapper"}},events:function(){return{"click @ui.buttonPreview":"onClickButtonPreview","click @ui.buttonPublish":"onClickButtonPublish","click @ui.menuSaveDraft":"onClickMenuSaveDraft"}},activateSaveButtons:function(e){e=e||"draft"===qazana.settings.page.model.get("post_status"),this.ui.buttonPublish.add(this.ui.menuSaveDraft).toggleClass("qazana-saver-disabled",!e),this.ui.buttonSaveOptions.toggleClass("qazana-saver-disabled",!e)},addTooltip:function(){this.$el.find(".tooltip-target").tipsy({gravity:function(){var e=jQuery(this).data("tooltip-pos");return void 0!==e?e:"n"},title:function(){return this.getAttribute("data-tooltip")}})}})},function(e,t,n){"use strict";var i=n(0)(n(39));n(28),n(1);var a=n(296);e.exports=Marionette.Behavior.extend({tagView:null,listenerAttached:!1,ui:{tagArea:".qazana-control-tag-area",dynamicSwitcher:".qazana-control-dynamic-switcher"},events:{"click @ui.dynamicSwitcher":"onDynamicSwitcherClick"},initialize:function(){this.listenerAttached||(this.listenTo(this.view.options.elementSettingsModel,"change:external:__dynamic__",this.onAfterExternalChange),this.listenerAttached=!0)},renderTools:function(){var e;this.getOption("dynamicSettings").default||(e=jQuery(Marionette.Renderer.render("#tmpl-qazana-control-dynamic-switcher")),this.ui.controlTitle[this.view.model.get("label_block")?"after":"before"](e),this.ui.dynamicSwitcher=this.$el.find(this.ui.dynamicSwitcher.selector))},toggleDynamicClass:function(){this.$el.toggleClass("qazana-control-dynamic-value",this.isDynamicMode())},isDynamicMode:function(){var e=this.view.elementSettingsModel.get("__dynamic__");return!(!e||!e[this.view.model.get("name")])},createTagsList:function(){var n=_.groupBy(this.getOption("tags"),"group"),e=qazana.dynamicTags.getConfig("groups"),t=this.ui.tagsList=jQuery("<div>",{class:"qazana-tags-list"}),i=jQuery("<div>",{class:"qazana-tags-list__inner"});t.append(i),jQuery.each(e,function(e){var t=n[e];t&&(e=jQuery("<div>",{class:"qazana-tags-list__group-title"}).text(this.title),i.append(e),t.forEach(function(e){var t=jQuery("<div>",{class:"qazana-tags-list__item"});t.text(e.title).attr("data-tag-name",e.name),i.append(t)}))}),i.on("click",".qazana-tags-list__item",this.onTagsListItemClick.bind(this)),qazana.$body.append(t)},getTagsList:function(){return this.ui.tagsList||this.createTagsList(),this.ui.tagsList},toggleTagsList:function(){var e=this.getTagsList();e.is(":visible")?e.hide():e.show().position({my:"right top",at:"right bottom+5",of:this.ui.dynamicSwitcher})},setTagView:function(e,t,n){this.tagView&&this.tagView.destroy();n=this.tagView=new a({id:e,name:t,settings:n,dynamicSettings:this.getOption("dynamicSettings")});n.render(),this.ui.tagArea.after(n.el),this.listenTo(n.model,"change",this.onTagViewModelChange.bind(this)).listenTo(n,"remove",this.onTagViewRemove.bind(this))},setDefaultTagView:function(){var e=qazana.dynamicTags.tagTextToTagData(this.getDynamicValue());this.setTagView(e.id,e.name,e.settings)},tagViewToTagText:function(){var e=this.tagView;return qazana.dynamicTags.tagDataToTagText(e.getOption("id"),e.getOption("name"),e.model)},getDynamicValue:function(){return this.view.elementSettingsModel.get("__dynamic__")[this.view.model.get("name")]},getDynamicControlSettings:function(){return{control:{name:"__dynamic__",label:this.view.model.get("label")}}},setDynamicValue:function(e){var t=this.view.model.get("name"),n=this.view.elementSettingsModel.get("__dynamic__")||{};(n=qazana.helpers.cloneObject(n))[t]=e,this.view.elementSettingsModel.set("__dynamic__",n,this.getDynamicControlSettings(t)),this.toggleDynamicClass()},destroyTagView:function(){this.tagView&&(this.tagView.destroy(),this.tagView=null)},onRender:function(){this.$el.addClass("qazana-control-dynamic"),this.renderTools(),this.toggleDynamicClass(),this.isDynamicMode()&&this.setDefaultTagView()},onDynamicSwitcherClick:function(){this.toggleTagsList()},onTagsListItemClick:function(e){e=jQuery(e.currentTarget);this.setTagView(qazana.helpers.getUniqueID(),e.data("tagName"),{}),this.setDynamicValue(this.tagViewToTagText()),this.toggleTagsList(),this.tagView.getTagConfig().settings_required&&this.tagView.showSettingsPopup()},onTagViewModelChange:function(){this.setDynamicValue(this.tagViewToTagText())},onTagViewRemove:function(){var e=this.view.model.get("name"),t=this.view.elementSettingsModel.get("__dynamic__");delete(t=qazana.helpers.cloneObject(t))[e],(0,i.default)(t).length?this.view.elementSettingsModel.set("__dynamic__",t,this.getDynamicControlSettings(e)):this.view.elementSettingsModel.unset("__dynamic__",this.getDynamicControlSettings(e)),this.toggleDynamicClass()},onAfterExternalChange:function(){this.destroyTagView(),this.isDynamicMode()&&this.setDefaultTagView(),this.toggleDynamicClass()},onDestroy:function(){this.destroyTagView()}})},function(e,t,n){"use strict";var i=n(0)(n(172)),a=n(297),o=n(105);e.exports=Marionette.ItemView.extend({className:"qazana-dynamic-cover qazana-input-style",tagControlsStack:null,templateHelpers:function(){var e={};return this.model&&(e.controls=this.model.options.controls),e},ui:{remove:".qazana-dynamic-cover__remove"},events:function(){var e={"click @ui.remove":"onRemoveClick"};return this.hasSettings()&&(e.click="onClick"),e},getTemplate:function(){var e=this.getTagConfig(),t=Marionette.TemplateCache.get("#tmpl-qazana-control-dynamic-cover"),e=Marionette.Renderer.render(t,{hasSettings:this.hasSettings(),isRemovable:!this.getOption("dynamicSettings").default,title:e.title,content:e.panel_template});return Marionette.TemplateCache.prototype.compileTemplate(e.trim())},getTagConfig:function(){return qazana.dynamicTags.getConfig("tags."+this.getOption("name"))},initSettingsPopup:function(){var e={className:"qazana-tag-settings-popup",position:{my:"left top+5",at:"left bottom",of:this.$el,autoRefresh:!0}},t=qazana.dialogsManager.createWidget("buttons",e);this.getSettingsPopup=function(){return t}},hasSettings:function(){return!!(0,i.default)(this.getTagConfig().controls).length},showSettingsPopup:function(){this.tagControlsStack||this.initTagControlsStack();var e=this.getSettingsPopup();e.isVisible()||e.show()},initTagControlsStack:function(){this.tagControlsStack=new a({model:this.model,controls:this.model.controls,el:this.getSettingsPopup().getElements("message")[0]}),this.tagControlsStack.render()},initModel:function(){this.model=new o(this.getOption("settings"),{controls:this.getTagConfig().controls})},initialize:function(){this.hasSettings()&&(this.initModel(),this.initSettingsPopup(),this.listenTo(this.model,"change",this.render))},onClick:function(){this.showSettingsPopup()},onRemoveClick:function(e){e.stopPropagation(),this.destroy(),this.trigger("remove")},onDestroy:function(){this.hasSettings()&&this.getSettingsPopup().destroy()}})},function(e,t,n){"use strict";var i=n(146),n=n(302);e.exports=i.extend({activeTab:"content",template:_.noop,emptyView:n,isEmpty:function(){return this.collection.length<2},childViewOptions:function(){return{elementSettingsModel:this.model}},onRenderTemplate:function(){this.activateFirstSection()}})},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";function y(){return this}var z=n(70),q=n(35),w=n(25),b=n(11),C=n(165),_=n(300),S=n(189),x=n(301),k=n(4)("iterator"),T=!([].keys&&"next"in[].keys()),E="values";e.exports=function(e,t,n,i,a,o,r){_(n,t,i);function s(e){if(!T&&e in g)return g[e];switch(e){case"keys":case E:return function(){return new n(this,e)}}return function(){return new n(this,e)}}var l,c,u,d=t+" Iterator",h=a==E,p=!1,g=e.prototype,f=g[k]||g["@@iterator"]||a&&g[a],m=f||s(a),v=a?h?s("entries"):m:void 0,i="Array"==t&&g.entries||f;if(i&&(u=x(i.call(new e)))!==Object.prototype&&u.next&&(S(u,d,!0),z||"function"==typeof u[k]||b(u,k,y)),h&&f&&f.name!==E&&(p=!0,m=function(){return f.call(this)}),z&&!r||!T&&!p&&g[k]||b(g,k,m),C[t]=m,C[d]=y,a)if(l={values:h?m:s(E),keys:o?m:s("keys"),entries:v},r)for(c in l)c in g||w(g,c,l[c]);else q(q.P+q.F*(T||p),t,l);return l}},function(e,t,n){"use strict";var i=n(178),a=n(65),o=n(189),r={};n(11)(r,n(4)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=i(r,{next:a(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var i=n(42),a=n(66),o=n(150)("IE_PROTO"),r=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),i(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?r:null}},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({className:"qazana-tag-controls-stack-empty",template:"#tmpl-qazana-tag-controls-stack-empty"})},function(e,t,n){"use strict";var i=n(140);e.exports=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.button="button",e},events:{"click @ui.button":"onButtonClick"},onButtonClick:function(){var e=this.model.get("event");qazana.channels.editor.trigger(e,this)}})},function(e,t,n){"use strict";n(47);var i=n(41),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.editor=".qazana-code-editor",e},onReady:function(){var e,i,t=this;"undefined"!=typeof ace&&(e=ace.require("ace/ext/language_tools"),t.editor=ace.edit(this.ui.editor[0]),jQuery(t.editor.container).addClass("qazana-input-style qazana-code-editor"),t.editor.setOptions({mode:"ace/mode/"+t.model.attributes.language,minLines:10,maxLines:1/0,showGutter:!0,useWorker:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),t.editor.getSession().setUseWrapMode(!0),qazana.panel.$el.on("resize.aceEditor",t.onResize.bind(this)),"css"===t.model.attributes.language&&e.addCompleter({getCompletions:function(e,t,n,i,a){var o=[],n=t.getTokenAt(n.row,n.column);0<i.length&&"selector".match(i)&&"constant"===n.type&&(o=[{name:"selector",value:"selector",score:1,meta:"Qazana"}]),a(null,o)}}),t.editor.setValue(t.getControlValue(),-1),t.editor.on("change",function(){t.setValue(t.editor.getValue())}),"html"===t.model.attributes.language&&(i=t.editor.getSession()).on("changeAnnotation",function(){for(var e=i.getAnnotations()||[],t=e.length,n=e.length;n--;)/doctype first\. Expected/.test(e[n].text)&&e.splice(n,1);t>e.length&&i.setAnnotations(e)}))},onResize:function(){this.editor.resize()},onDestroy:function(){qazana.panel.$el.off("resize.aceEditor")}});e.exports=n},function(e,t,n){"use strict";var i=n(41),n=i.extend({applySavedValue:function(){i.prototype.applySavedValue.apply(this,arguments);var e=this,t=e.getControlValue();e.ui.input.wpColorPicker("instance")?(e.ui.input.wpColorPicker("color",t),t||e.ui.input.data("a8cIris")._change()):qazana.helpers.wpColorPicker(e.ui.input,{change:function(){e.setValue(e.ui.input.wpColorPicker("color"))},clear:function(){e.setValue("")}})},onBeforeDestroy:function(){this.ui.input.wpColorPicker("instance")&&this.ui.input.wpColorPicker("close"),this.$el.remove()}});e.exports=n},function(e,t,n){"use strict";n=n(41).extend({onReady:function(){var e=this,t=_.extend({onClose:function(){e.saveValue()},enableTime:!0,minuteIncrement:1},this.model.get("picker_options"));this.ui.input.flatpickr(t)},saveValue:function(){this.setValue(this.ui.input.val())},onBeforeDestroy:function(){this.saveValue(),this.ui.input.flatpickr().destroy()}});e.exports=n},function(e,t,n){"use strict";n(308);var i=n(193),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.controls=".qazana-control-dimension > input:enabled",e.link="button.qazana-link-dimensions",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.link":"onLinkDimensionsClicked"})},defaultDimensionValue:0,initialize:function(){i.prototype.initialize.apply(this,arguments),this.model.set("allowed_dimensions",this.filterDimensions(this.model.get("allowed_dimensions")))},getPossibleDimensions:function(){return["top","right","bottom","left"]},filterDimensions:function(e){e=e||"all";var t=this.getPossibleDimensions();return"all"===e?t:(_.isArray(e)||("horizontal"===e?e=["right","left"]:"vertical"===e&&(e=["top","bottom"])),e)},onReady:function(){var i=this,a=i.getControlValue();i.isLinkedDimensions()||(i.ui.link.addClass("unlinked"),i.ui.controls.each(function(e,t){var n=a[t.dataset.setting];_.isEmpty(n)&&(n=i.defaultDimensionValue),i.$(t).val(n)})),i.fillEmptyDimensions()},updateDimensionsValue:function(){var n={},e=this.getPossibleDimensions(),i=this.ui.controls,a=this.defaultDimensionValue;e.forEach(function(e){var t=i.filter('[data-setting="'+e+'"]');n[e]=t.length?t.val():a}),this.setValue(n)},fillEmptyDimensions:function(){var e=this.getPossibleDimensions(),n=this.model.get("allowed_dimensions"),i=this.ui.controls,a=this.defaultDimensionValue;this.isLinkedDimensions()||e.forEach(function(e){var t=i.filter('[data-setting="'+e+'"]');-1!==_.indexOf(n,e)&&t.length&&_.isEmpty(t.val())&&t.val(a)})},updateDimensions:function(){this.fillEmptyDimensions(),this.updateDimensionsValue()},resetDimensions:function(){this.ui.controls.val(""),this.updateDimensionsValue()},onInputChange:function(e){var t=e.target.dataset.setting;"unit"===t&&this.resetDimensions(),_.contains(this.getPossibleDimensions(),t)&&(this.isLinkedDimensions()&&(e=this.$(e.target),this.ui.controls.val(e.val())),this.updateDimensions())},onLinkDimensionsClicked:function(e){e.preventDefault(),e.stopPropagation(),this.ui.link.toggleClass("unlinked"),this.setValue("isLinked",!this.ui.link.hasClass("unlinked")),this.isLinkedDimensions()&&this.ui.controls.val(this.ui.controls.eq(0).val()),this.updateDimensions()},isLinkedDimensions:function(){return this.getControlValue("isLinked")}});e.exports=n},function(e,t,n){"use strict";n(309)("link",function(t){return function(e){return t(this,"a","href",e)}})},function(e,t,n){function i(e,t,n,i){var a=String(r(e)),e="<"+t;return""!==n&&(e+=" "+n+'="'+String(i).replace(s,"&quot;")+'"'),e+">"+a+"</"+t+">"}var a=n(35),o=n(10),r=n(24),s=/"/g;e.exports=function(t,e){var n={};n[t]=e(i),a(a.P+a.F*o(function(){var e=""[t]('"');return e!==e.toLowerCase()||3<e.split('"').length}),"String",n)}},function(e,t,n){"use strict";var i=n(139);e.exports=i.extend({getSelect2Options:function(){return{dir:qazana.config.is_rtl?"rtl":"ltr"}},templateHelpers:function(){var e=i.prototype.templateHelpers.apply(this,arguments),t=this.model.get("options");return e.getFontsByGroups=function(n){var i={};return _.each(t,function(e,t){(_.isArray(n)&&_.contains(n,e)||e===n)&&(i[t]=t)}),i},e}})},function(e,t,n){"use strict";var i=n(41),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.addImages=".qazana-control-gallery-add",e.clearGallery=".qazana-control-gallery-clear",e.galleryThumbnails=".qazana-control-gallery-thumbnails",e.status=".qazana-control-gallery-status-title",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.addImages":"onAddImagesClick","click @ui.clearGallery":"onClearGalleryClick","click @ui.galleryThumbnails":"onGalleryThumbnailsClick"})},onReady:function(){this.initRemoveDialog()},generateThumbnails:function(e){var n=[];return e.forEach(function(e){var t={id:e.id,url:e.url,size:"custom",dimension:{width:100,height:100},preview:!0},t=qazana.imagesManager.getImageUrl(t);t&&n.push({id:e.id,url:t})}),n},applySavedValue:function(){var e=this.getControlValue(),t=e.length,n=!!t;this.$el.toggleClass("qazana-gallery-has-images",n).toggleClass("qazana-gallery-empty",!n);var i=this.ui.galleryThumbnails;i.empty(),this.ui.status.text(qazana.translate(n?"gallery_images_selected":"gallery_no_images_selected",[t])),n&&(n=this.generateThumbnails(e),_.isEmpty(n)&&(n=e),n.forEach(function(e){var t=jQuery("<div>",{class:"qazana-control-gallery-thumbnail"});t.css("background-image","url("+e.url+")"),i.append(t)}))},hasImages:function(){return!!this.getControlValue().length},openFrame:function(e){this.initFrame(e),this.frame.open()},initFrame:function(e){e={frame:"post",multiple:!0,state:{create:"gallery",add:"gallery-library",edit:"gallery-edit"}[e],button:{text:qazana.translate("insert_media")}};this.hasImages()&&(e.selection=this.fetchSelection()),this.frame=wp.media(e),this.frame.on({update:this.select,"menu:render:default":this.menuRender,"content:render:browse":this.gallerySettings},this)},menuRender:function(e){e.unset("insert"),e.unset("featured-image")},gallerySettings:function(e){e.sidebar.on("ready",function(){e.sidebar.unset("gallery")})},fetchSelection:function(){var e=wp.media.query({orderby:"post__in",order:"ASC",type:"image",perPage:-1,post__in:_.pluck(this.getControlValue(),"id")});return new wp.media.model.Selection(e.models,{props:e.props.toJSON(),multiple:!0})},select:function(e){var t=[];e.each(function(e){t.push({id:e.get("id"),url:e.get("url")})}),this.setValue(t),this.applySavedValue()},onBeforeDestroy:function(){this.frame&&this.frame.off(),this.$el.remove()},resetGallery:function(){this.setValue(""),this.applySavedValue()},initRemoveDialog:function(){var e;this.getRemoveDialog=function(){return e=e||qazana.dialogsManager.createWidget("confirm",{message:qazana.translate("dialog_confirm_gallery_delete"),headerMessage:qazana.translate("delete_gallery"),strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},defaultOption:"confirm",onConfirm:this.resetGallery.bind(this)})}},onAddImagesClick:function(){this.openFrame(this.hasImages()?"add":"create")},onClearGalleryClick:function(){this.getRemoveDialog().show()},onGalleryThumbnailsClick:function(){this.openFrame("edit")}});e.exports=n},function(e,t,n){"use strict";var i=n(41),n=i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),this.filterIcons()},filterIcons:function(){var t=this.model.get("options"),e=this.model.get("include"),n=this.model.get("exclude");if(e){var i={};return _.each(e,function(e){i[e]=t[e]}),void this.model.set("options",i)}n&&_.each(n,function(e){delete t[e]})},iconsList:function(e){return e.id?jQuery('<span><i class="'+e.id+'"></i> '+e.text+"</span>"):e.text},onReady:function(){this.ui.select.fontIconPicker({theme:"fip-grey"})},templateHelpers:function(){var e=i.prototype.templateHelpers.apply(this,arguments);return e.getIconsByGroups=_.bind(function(n){var e=this.model.get("options"),i={};return _.each(e,function(e,t){(_.isArray(n)&&_.contains(n,e)||e===n)&&(i[t]=e)}),i},this),e}});e.exports=n},function(e,t,n){"use strict";n=n(136).extend({ui:function(){return{inputWidth:'input[data-setting="width"]',inputHeight:'input[data-setting="height"]',btnApply:"button.qazana-image-dimensions-apply-button"}},events:function(){return{"click @ui.btnApply":"onApplyClicked"}},onApplyClicked:function(e){e.preventDefault(),this.setValue({width:this.ui.inputWidth.val(),height:this.ui.inputHeight.val()})}});e.exports=n},function(e,t,n){"use strict";var i=n(136),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.controlMedia=".qazana-control-media",e.mediaImage=".qazana-control-media-image",e.mediaVideo=".qazana-control-media-video",e.frameOpeners=".qazana-control-preview-area",e.deleteButton=".qazana-control-media-delete",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.frameOpeners":"openFrame","click @ui.deleteButton":"deleteImage"})},getMediaType:function(){return this.model.get("media_type")},applySavedValue:function(){var e,t=this.getControlValue("url"),n=this.getMediaType();"image"===n?(e={id:this.getControlValue("id"),url:t,size:"custom",dimension:{width:245,height:135},preview:!0},e=qazana.imagesManager.getImageUrl(e),_.isEmpty(e)&&(e=t),this.ui.mediaImage.css("background-image",e?"url("+e+")":"")):"video"===n&&this.ui.mediaVideo.attr("src",t),this.ui.controlMedia.toggleClass("qazana-media-empty",!t)},openFrame:function(){this.frame||this.initFrame(),this.frame.open()},deleteImage:function(e){e.stopPropagation(),this.setValue({url:"",id:""}),this.applySavedValue()},initFrame:function(){wp.media.view.settings.post.id=qazana.config.document.id,this.frame=wp.media({button:{text:qazana.translate("insert_media")},states:[new wp.media.controller.Library({title:qazana.translate("insert_media"),library:wp.media.query({type:this.getMediaType()}),multiple:!1,date:!1})]}),this.frame.on("insert select",this.select.bind(this))},select:function(){this.trigger("before:select");var e=this.frame.state().get("selection").first().toJSON();e.url&&(this.setValue({url:e.url,id:e.id}),this.applySavedValue()),this.trigger("after:select")},onBeforeDestroy:function(){this.$el.remove()}});e.exports=n},function(e,t,n){"use strict";var a=n(41),o=n(316),n=a.extend({registerValidators:function(){a.prototype.registerValidators.apply(this,arguments);var n={},i=this.model;["min","max"].forEach(function(e){var t=i.get(e);_.isFinite(t)&&(n[e]=t)}),jQuery.isEmptyObject(n)||this.addValidator(new o({validationTerms:n}))}});e.exports=n},function(e,t,n){"use strict";n=n(162);e.exports=n.extend({validationMethod:function(e){var t=this.getSettings("validationTerms"),n=[];return _.isFinite(e)&&(void 0!==t.min&&e<t.min&&n.push("Value is less than minimum"),void 0!==t.max&&e>t.max&&n.push("Value is greater than maximum")),n}})},function(e,t,n){"use strict";var i=n(136),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.reverseOrderLabel=".qazana-control-order-label",e},changeLabelTitle:function(){var e=this.getControlValue("reverse_order");this.ui.reverseOrderLabel.attr("title",qazana.translate(e?"asc":"desc"))},onRender:function(){i.prototype.onRender.apply(this,arguments),this.changeLabelTitle()},onInputChange:function(){this.changeLabelTitle()}});e.exports=n},function(e,t,n){"use strict";n=n(139);e.exports=n.extend({isTitlesReceived:!1,getSelect2Options:function(){var i=this;return{ajax:{transport:function(e,t,n){e={q:e.data.q,filter_type:i.model.get("filter_type"),object_type:i.model.get("object_type")};return qazana.ajax.send("panel_posts_control_filter_autocomplete",{data:e,success:t,error:n})},data:function(e){return{q:e.term,page:e.page}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:2}},getValueTitles:function(){var t=this,e=t.getControlValue(),n=t.model.get("filter_type");e&&n&&(e={filter_type:n,object_type:t.model.get("object_type"),value:e},qazana.ajax.send("panel_posts_control_value_titles",{data:e}).then(function(e){t.isTitlesReceived=!0,t.model.set("options",e.data),t.render()}))},onReady:function(){qazana.modules.controls.Select2.prototype.onReady.apply(this,arguments),this.isTitlesReceived||this.getValueTitles()}})},function(e,t,n){"use strict";var i=n(192),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.popoverToggle=".qazana-control-popover-toggle-toggle",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.popoverToggle":"onPopoverToggleClick"})},onPopoverToggleClick:function(){this.$el.next(".qazana-controls-popover").toggle()}},{onPasteStyle:function(e,t){return!t||t===e.return_value}});e.exports=n},function(e,t,n){"use strict";var i=n(0);n(28),n(183);var o=i(n(39));n(1);var a=n(41),i=n(194),r=n(105),i=a.extend({ui:{btnAddRow:".qazana-repeater-add",fieldContainer:".qazana-repeater-fields-wrapper"},events:function(){return{"click @ui.btnAddRow":"onButtonAddRowClick","sortstart @ui.fieldContainer":"onSortStart","sortupdate @ui.fieldContainer":"onSortUpdate","sortstop @ui.fieldContainer":"onSortStop"}},childView:i,childViewContainer:".qazana-repeater-fields-wrapper",templateHelpers:function(){return{data:_.extend({},this.model.toJSON(),{controlValue:[]})}},childViewOptions:function(){return{controlFields:this.model.get("fields"),titleField:this.model.get("title_field")}},createItemModel:function(e,t,n){return(t=t||{}).controls=n.model.get("fields"),e._id||(e._id=qazana.helpers.getUniqueID()),new r(e,t)},fillCollection:function(){var e=this.model.get("name");this.collection=this.elementSettingsModel.get(e),this.collection instanceof Backbone.Collection||(this.collection=new Backbone.Collection(this.collection,{model:_.partial(this.createItemModel,_,_,this)}),this.elementSettingsModel.set(e,this.collection,{silent:!0}),this.listenTo(this.collection,"change",this.onRowControlChange),this.listenTo(this.collection,"update",this.onRowUpdate,this))},initialize:function(){a.prototype.initialize.apply(this,arguments),this.fillCollection(),this.listenTo(this.collection,"change",this.onRowControlChange),this.listenTo(this.collection,"update",this.onRowUpdate,this)},addRow:function(e,t){var n=qazana.helpers.getUniqueID();return e instanceof Backbone.Model?e.set("_id",n):e._id=n,this.collection.add(e,t)},editRow:function(e){var t;this.currentEditableChild&&((t=this.currentEditableChild.getChildViewContainer(this.currentEditableChild)).removeClass("editable"),t.find(".qazana-wp-editor").each(function(){tinymce.get(this.id).fire("hide")})),this.currentEditableChild!==e?(e.getChildViewContainer(e).addClass("editable"),this.currentEditableChild=e,this.updateActiveRow()):delete this.currentEditableChild},toggleMinRowsClass:function(){this.model.get("prevent_empty")&&this.$el.toggleClass("qazana-repeater-has-minimum-rows",this.collection.length<=1)},updateActiveRow:function(){var e=1;this.currentEditableChild&&(e=this.currentEditableChild.itemIndex),this.setEditSetting("activeItemIndex",e)},updateChildIndexes:function(){var t=this.collection;this.children.each(function(e){e.updateIndex(t.indexOf(e.model)+1),e.setTitle()})},onRender:function(){a.prototype.onRender.apply(this,arguments),this.ui.fieldContainer.sortable({axis:"y",handle:".qazana-repeater-row-tools"}),this.toggleMinRowsClass()},onSortStart:function(e,t){t.item.data("oldIndex",t.item.index())},onSortStop:function(e,t){var n,i=this;-1!==t.item.index()&&(t=(n=i.children.findByIndex(t.item.index())).children._views,jQuery.each(t,function(){if("wysiwyg"===this.model.get("type"))return n.render(),delete i.currentEditableChild,!1}))},onSortUpdate:function(e,t){var n=t.item.data("oldIndex"),n=this.collection.at(n),t=t.item.index();this.collection.remove(n),this.addRow(n,{at:t})},onAddChild:function(){this.updateChildIndexes(),this.updateActiveRow()},onRowUpdate:function(e,t){var n=this.elementSettingsModel,i=e.clone(),a=this.model.get("name");t.add?i.remove(t.changes.added[0]):i.add(t.changes.removed[0],{at:t.index}),n.changed={},n.changed[a]=e,n._previousAttributes={},n._previousAttributes[a]=i.toJSON(),n.trigger("change",n,n._pending),delete n.changed,delete n._previousAttributes,this.toggleMinRowsClass()},onRowControlChange:function(e){var t,n,i,a;(0,o.default)(e.changed).length&&(t=e.collection.toJSON(),n=e.collection.findIndex(e),i=this._parent.model.get("settings"),a=this.model.get("name"),t[n]=e._previousAttributes,i.changed={},i.changed[a]=e.collection,i._previousAttributes={},i._previousAttributes[a]=t,i.trigger("change",i),delete i.changed,delete i._previousAttributes)},onButtonAddRowClick:function(){var t={};_.each(this.model.get("fields"),function(e){t[e.name]=e.default});var e=this.addRow(t),e=this.children.findByModel(e);this.editRow(e)},onChildviewClickRemove:function(e){e.model.destroy(),e===this.currentEditableChild&&delete this.currentEditableChild,this.updateChildIndexes(),this.updateActiveRow()},onChildviewClickDuplicate:function(e){var t=this.createItemModel(e.model.toJSON(),{},this);this.addRow(t,{at:e.itemIndex})},onChildviewClickEdit:function(e){this.editRow(e)},onAfterExternalChange:function(){this.fillCollection(),a.prototype.onAfterExternalChange.apply(this,arguments)}});e.exports=i},function(e,t,n){"use strict";var i=n(140),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.heading=".qazana-panel-heading",e},triggers:{click:"control:section:clicked"}});e.exports=n},function(e,t,n){"use strict";var i=n(41).extend({},{onPasteStyle:function(e,t){return e.groups?e.groups.some(function(e){return i.onPasteStyle(e,t)}):void 0!==e.options[t]}});e.exports=i},function(e,t,n){"use strict";var i=n(193),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.slider=".qazana-slider",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"slide @ui.slider":"onSlideChange"})},initSlider:function(){var e=this.getControlValue("size"),t=this.getCurrentRange();this.ui.input.attr(t).val(e),this.ui.slider.slider(_.extend({},t,{value:e}))},resetSize:function(){this.setValue("size",""),this.initSlider()},onReady:function(){this.initSlider()},onSlideChange:function(e,t){this.setValue("size",t.value),this.ui.input.val(t.value)},onInputChange:function(e){e=e.currentTarget.dataset.setting;"size"===e?this.ui.slider.slider("value",this.getControlValue("size")):"unit"===e&&this.resetSize()},onBeforeDestroy:function(){this.ui.slider.data("uiSlider")&&this.ui.slider.slider("destroy"),this.$el.remove()}});e.exports=n},function(e,t,n){"use strict";var i=n(41),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.resetStructure=".qazana-control-structure-reset",e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"click @ui.resetStructure":"onResetStructureClick"})},templateHelpers:function(){var e=i.prototype.templateHelpers.apply(this,arguments);return e.getMorePresets=this.getMorePresets.bind(this),e},getCurrentEditedSection:function(){return qazana.getPanelView().getCurrentPageView().getOption("editedElementView")},getMorePresets:function(){var e=qazana.presetsFactory.getParsedStructure(this.getControlValue());return qazana.presetsFactory.getPresets(e.columnsCount)},onInputChange:function(){this.getCurrentEditedSection().redefineLayout(),this.render()},onResetStructureClick:function(){this.getCurrentEditedSection().resetColumnsCustomSize()}});e.exports=n},function(e,t,n){"use strict";n=n(41);e.exports=n.extend({setInputValue:function(e,t){this.$(e).prop("checked",this.model.get("return_value")===t)}},{onPasteStyle:function(e,t){return!t||t===e.return_value}})},function(e,t,n){"use strict";n=n(140).extend({triggers:{click:{event:"control:tab:clicked",stopPropagation:!1}}});e.exports=n},function(e,t,n){"use strict";n=n(136);e.exports=n.extend({onReady:function(){var n,i,a=this,e=qazana.config.is_rtl?"right":"left";this.ui.input.autocomplete({source:function(e,t){if(n!==e.term){if(/^https?:/.test(e.term)||-1!==e.term.indexOf("."))return t();a.ui.input.prev().show(),jQuery.post(window.ajaxurl,{editor:"qazana",action:"wp-link-ajax",page:1,search:e.term,_ajax_linking_nonce:jQuery("#_ajax_linking_nonce").val()},function(e){t(i=e)},"json").always(function(){a.ui.input.prev().hide()}),n=e.term}else t(i)},focus:function(e){e.preventDefault()},select:function(e,t){return a.ui.input.val(t.item.permalink),a.setValue("url",t.item.permalink),!1},open:function(e){jQuery(e.target).data("uiAutocomplete").menu.activeMenu.addClass("qazana-autocomplete-menu")},minLength:2,position:{my:e+" top+2",at:e+" bottom"}}).autocomplete("instance")._renderItem=function(e,t){var n=window.wpLinkL10n?window.wpLinkL10n.noTitle:"",n=t.title||n;return jQuery('<li role="option" id="mce-wp-autocomplete-'+t.ID+'">').append("<span>"+n+'</span>&nbsp;<span class="qazana-autocomplete-item-info">'+t.info+"</span>").appendTo(e)}},onBeforeDestroy:function(){this.ui.input.data("autocomplete")&&this.ui.input.autocomplete("destroy"),this.$el.remove()}})},function(e,t,n){"use strict";var i=n(41),n=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.form="form",e.loading=".wp-widget-form-loading",e},events:function(){return{"keyup @ui.form :input":"onFormChanged","change @ui.form :input":"onFormChanged"}},onFormChanged:function(){var e="widget-"+this.model.get("id_base"),e=this.ui.form.qazanaSerializeObject()[e].REPLACE_TO_ID;this.setValue(e)},onReady:function(){var t=this;qazana.ajax.addRequest("editor_get_wp_widget_form",{data:{editor_post_id:qazana.config.document.id,id:t.model.cid,widget_type:t.model.get("widget"),data:t.elementSettingsModel.toJSON()},success:function(e){t.ui.form.html(e),wp.textWidgets&&(t.ui.form.addClass("open"),e=new jQuery.Event("widget-added"),wp.textWidgets.handleWidgetAdded(e,t.ui.form),wp.mediaWidgets.handleWidgetAdded(e,t.ui.form),wp.customHtmlWidgets&&wp.customHtmlWidgets.handleWidgetAdded(e,t.ui.form)),qazana.hooks.doAction("panel/widgets/"+t.model.get("widget")+"/controls/wp_widget/loaded",t)}})}});e.exports=n},function(e,t,n){"use strict";n(27),n(45);var i=n(41),n=i.extend({editor:null,ui:function(){var e=i.prototype.ui.apply(this,arguments);return jQuery.extend(e,{inputWrapper:".qazana-control-input-wrapper"}),e},events:function(){return _.extend(i.prototype.events.apply(this,arguments),{"keyup textarea.qazana-wp-editor":"onBaseInputChange"})},buttons:{addToBasic:{underline:"italic"},addToAdvanced:{},moveToAdvanced:{blockquote:"removeformat",alignleft:"blockquote",aligncenter:"alignleft",alignright:"aligncenter"},moveToBasic:{},removeFromBasic:["unlink","wp_more"],removeFromAdvanced:[]},initialize:function(){i.prototype.initialize.apply(this,arguments);var e,t=this;t.editorID="qazanawpeditor"+t.cid,_.defer(function(){quicktags({buttons:"strong,em,del,link,img,close",id:t.editorID}),qazana.config.rich_editing_enabled&&switchEditors.go(t.editorID,"tmce"),delete QTags.instances[0]}),qazana.config.rich_editing_enabled?(e={id:t.editorID,selector:"#"+t.editorID,setup:function(e){t.editor=e}},tinyMCEPreInit.mceInit[t.editorID]=_.extend(_.clone(tinyMCEPreInit.mceInit.qazanawpeditor),e),qazana.config.tinymceHasCustomConfig||t.rearrangeButtons()):t.$el.addClass("qazana-rich-editing-disabled")},applySavedValue:function(){var e;this.editor&&(e=this.getControlValue(),this.editor.setContent(e),jQuery("#"+this.editorID).val(e))},saveEditor:function(){this.editor.save(),this.setValue(this.editor.getContent())},moveButtons:function(e,a,o){o||(o=a,a=null),_.each(e,function(e,t){var n=o.indexOf(e);if(a){var i=a.indexOf(t);if(-1===i)throw new ReferenceError("Trying to move non-existing button `"+t+"`");a.splice(i,1)}if(-1===n)throw new ReferenceError("Trying to move button after non-existing button `"+e+"`");o.splice(n+1,0,t)})},rearrangeButtons:function(){var e=tinyMCEPreInit.mceInit[this.editorID],t=e.toolbar1.split(","),n=e.toolbar2.split(","),t=_.difference(t,this.buttons.removeFromBasic),n=_.difference(n,this.buttons.removeFromAdvanced);this.moveButtons(this.buttons.moveToBasic,n,t),this.moveButtons(this.buttons.moveToAdvanced,t,n),this.moveButtons(this.buttons.addToBasic,t),this.moveButtons(this.buttons.addToAdvanced,n),e.toolbar1=t.join(","),e.toolbar2=n.join(",")},onReady:function(){var e=this,t=jQuery(qazana.config.wp_editor.replace(/qazanawpeditor/g,e.editorID).replace("%%EDITORCONTENT%%",e.getControlValue()));e.ui.inputWrapper.html(t),setTimeout(function(){e.editor.on("keyup change undo redo SetContent",e.saveEditor.bind(e))},100)},onBeforeDestroy:function(){delete QTags.instances[this.editorID],qazana.config.rich_editing_enabled&&(tinymce.EditorManager.execCommand("mceRemoveEditor",!0,this.editorID),delete tinyMCEPreInit.mceInit[this.editorID],delete tinyMCEPreInit.qtInit[this.editorID])}});e.exports=n},function(e,t,n){"use strict";n=n(105).extend({defaults:{_column_size:100}});e.exports=n},function(e,t,n){"use strict";n(27),n(45),n(152),n(1);var i=n(144),a=i.extend({_templateType:null,toggleEditTools:!0,getTemplate:function(){var e=this.getEditModel();return"remote"!==this.getTemplateType()?Marionette.TemplateCache.get("#tmpl-qazana-"+e.get("widgetType")+"-content"):_.template("")},className:function(){return i.prototype.className.apply(this,arguments)+" qazana-widget "+qazana.getElementData(this.getEditModel()).html_wrapper_class},events:function(){var e=i.prototype.events.apply(this,arguments);return e.click="onClickEdit",e},behaviors:function(){var e=i.prototype.behaviors.apply(this,arguments);return _.extend(e,{InlineEditing:{behaviorClass:n(332),inlineEditingClass:"qazana-inline-editing"}}),qazana.hooks.applyFilters("elements/widget/behaviors",e,this)},initialize:function(){i.prototype.initialize.apply(this,arguments);var e=this.getEditModel();e.on({"before:remote:render":this.onModelBeforeRemoteRender.bind(this),"remote:render":this.onModelRemoteRender.bind(this)}),"remote"!==this.getTemplateType()||this.getEditModel().getHtmlCache()||e.renderRemoteServer();var t=this.onRender;this.render=_.throttle(this.render,300),this.onRender=function(){_.defer(t.bind(this))}},render:function(){if(this.model.isRemoteRequestActive())return this.handleEmptyWidget(),void this.$el.addClass("qazana-element");Marionette.CompositeView.prototype.render.apply(this,arguments)},handleEmptyWidget:function(){this.$el.addClass("qazana-widget-empty").append('<i class="qazana-widget-empty-icon '+this.getEditModel().getIcon()+'"></i>')},getTemplateType:function(){var e;return null===this._templateType&&(e=this.getEditModel(),e=jQuery("#tmpl-qazana-"+e.get("widgetType")+"-content"),this._templateType=e.length?"js":"remote"),this._templateType},getHTMLContent:function(e){return this.getEditModel().getHtmlCache()||e},attachElContent:function(e){var t=this,n=t.getHTMLContent(e);return _.defer(function(){qazanaFrontend.getElements("window").jQuery(t.el).html(n),t.bindUIElements()}),this},addInlineEditingAttributes:function(e,t){this.addRenderAttribute(e,{class:"qazana-inline-editing","data-qazana-setting-key":e}),t&&this.addRenderAttribute(e,{"data-qazana-inline-editing-toolbar":t})},getRepeaterSettingKey:function(e,t,n){return[t,n,e].join(".")},onModelBeforeRemoteRender:function(){this.$el.addClass("qazana-loading")},onBeforeDestroy:function(){qazana.$previewContents.find("#qazana-style-"+this.model.cid).remove()},onModelRemoteRender:function(){this.isDestroyed||(this.$el.removeClass("qazana-loading"),this.render())},alterClass:function(e,t,n){if(-1===t.indexOf("*"))return e.removeClass(t),n?e.addClass(n):e;var i=new RegExp("\\s"+t.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");return e.each(function(e,t){for(var n=" "+t.className+" ";i.test(n);)n=n.replace(i," ");t.className=n.trim()}),n?e.addClass(n):e},onRender:function(){var e=this;i.prototype.onRender.apply(e,arguments);var t=e.getEditModel(),n=t.getSetting("_skin")||"default";e.$el.attr("data-element_type",t.get("widgetType")+"."+n).removeClass("qazana-widget-empty").children(".qazana-widget-empty-icon").remove(),e.$el.imagesLoaded().always(function(){setTimeout(function(){e.$el.height()<1&&e.handleEmptyWidget()},200)}),e.alterClass(e.$el,t.get("widgetType")+"-*",t.get("widgetType")+"-skin-"+n)},onClickEdit:function(){this.model.trigger("request:edit")}});e.exports=a},function(e,t,n){"use strict";n(45),n=Marionette.Behavior.extend({editing:!1,$currentEditingArea:null,ui:function(){return{inlineEditingArea:"."+this.getOption("inlineEditingClass")}},events:function(){return{"click @ui.inlineEditingArea":"onInlineEditingClick","input @ui.inlineEditingArea":"onInlineEditingUpdate"}},getEditingSettingKey:function(){return this.$currentEditingArea.data().qazanaSettingKey},startEditing:function(e){var t=e.data().qazanaSettingKey,n=t,i=t.split("."),a=3===i.length,t=this.view.getEditModel().get("settings");a&&(t=t.get(i[0]).models[i[1]],n=i[2]);i=t.get("__dynamic__"),t=i&&i[n];this.editing||t||"edit"!==qazana.channels.dataEditMode.request("activeMode")||this.view.model.isRemoteRequestActive()||(this.$currentEditingArea=e,n="advanced"===(i=this.$currentEditingArea.data().qazanaInlineEditingToolbar)?"advanced":"basic",t=this.view.getEditModel(),e=qazana.config.inlineEditing,t=t.getSetting(this.getEditingSettingKey()),"advanced"==n&&(t=wp.editor.autop(t)),this.$currentEditingArea.html(t),t=qazanaFrontend.getElements("window").QazanaInlineEditor,this.editing=!0,this.view.allowRender=!1,this.view.model.setHtmlCache(""),this.editor=new t({linksInNewWindow:!0,stay:!1,editor:this.$currentEditingArea[0],mode:n,list:"none"===i?[]:e.toolbar[i||"basic"],cleanAttrs:["id","class","name"],placeholder:qazana.translate("type_here")+"...",toolbarIconsPrefix:"eicon-editor-",toolbarIconsDictionary:{externalLink:{className:"eicon-editor-external-link"},list:{className:"eicon-editor-list-ul"},insertOrderedList:{className:"eicon-editor-list-ol"},insertUnorderedList:{className:"eicon-editor-list-ul"},createlink:{className:"eicon-editor-link"},unlink:{className:"eicon-editor-unlink"},blockquote:{className:"eicon-editor-quote"},p:{className:"eicon-editor-paragraph"},pre:{className:"eicon-editor-code"}}}),jQuery(this.editor._menu).children().on("mousedown",function(e){e.preventDefault()}),this.$currentEditingArea.on("blur",this.onInlineEditingBlur.bind(this)))},stopEditing:function(){this.editing=!1,this.editor.destroy(),this.view.allowRender=!0,"advanced"===this.$currentEditingArea.data().qazanaInlineEditingToolbar&&this.view.getEditModel().renderRemoteServer()},onInlineEditingClick:function(e){var t=this,n=jQuery(e.currentTarget);setTimeout(function(){t.startEditing(n)},30)},onInlineEditingBlur:function(){var t=this;setTimeout(function(){var e=qazanaFrontend.getElements("window").getSelection();jQuery(e.focusNode).closest(".pen-input-wrapper").length||t.stopEditing()},20)},onInlineEditingUpdate:function(){this.view.getEditModel().setSetting(this.getEditingSettingKey(),this.editor.getContent())}}),e.exports=n},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){"use strict";n=Marionette.CollectionView.extend({childView:n(199),id:"qazana-panel-elements",initialize:function(){this.listenTo(qazana.channels.panelElements,"filter:change",this.onFilterChanged)},filter:function(e){var t=qazana.channels.panelElements.request("filter:value");return!t||(-1!==e.get("title").toLowerCase().indexOf(t.toLowerCase())||_.any(e.get("keywords"),function(e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}))},onFilterChanged:function(){qazana.channels.panelElements.request("filter:value")||this.onFilterEmpty(),this._renderChildren(),this.triggerMethod("children:render")},onFilterEmpty:function(){qazana.getPanelView().getCurrentPageView().showView("categories")}});e.exports=n},function(e,t,n){"use strict";var n=n(336),i=Marionette.CompositeView.extend({id:"qazana-panel-page-menu",template:"#tmpl-qazana-panel-menu",childView:n,childViewContainer:"#qazana-panel-page-menu-content",initialize:function(){this.collection=i.getGroups()},onDestroy:function(){var e="eicon-arrow-"+(qazana.config.is_rtl?"right":"left");qazana.panel.currentView.getHeaderView().ui.menuIcon.removeClass(e).addClass("eicon-menu-bar")}},{groups:null,initGroups:function(){var e=[];qazana.config.user.is_administrator&&(e=[{name:"style",title:qazana.translate("global_style"),items:[{name:"global-colors",icon:"fa fa-paint-brush",title:qazana.translate("global_colors"),type:"page",pageName:"colorScheme"},{name:"global-fonts",icon:"fa fa-font",title:qazana.translate("global_fonts"),type:"page",pageName:"typographyScheme"},{name:"color-picker",icon:"fa fa-eyedropper",title:qazana.translate("color_picker"),type:"page",pageName:"colorPickerScheme"}]},{name:"settings",title:qazana.translate("settings"),items:[{name:"qazana-settings",icon:"fa fa-external-link",title:qazana.translate("qazana_settings"),type:"link",link:qazana.config.settings_page_link,newTab:!0},{name:"about-qazana",icon:"fa fa-info-circle",title:qazana.translate("about_qazana"),type:"link",link:qazana.config.qazana_site,newTab:!0}]}]),this.groups=new Backbone.Collection(e)},getGroups:function(){return this.groups||this.initGroups(),this.groups},addItem:function(e,t,n){var i,t=this.getGroups().findWhere({name:t});t&&(t=t.get("items"),n&&(i=_.findWhere(t,{name:n})),i?t.splice(t.indexOf(i),0,e):t.push(e))}});e.exports=i},function(e,t,n){"use strict";n=n(337);e.exports=Marionette.CompositeView.extend({template:"#tmpl-qazana-panel-menu-group",className:"qazana-panel-menu-group",childView:n,childViewContainer:".qazana-panel-menu-items",initialize:function(){this.collection=new Backbone.Collection(this.model.get("items"))},onChildviewClick:function(e){switch(e.model.get("type")){case"page":var t=e.model.get("pageName"),n=e.model.get("title");qazana.getPanelView().setPage(t,n);break;case"link":var i=e.model.get("link");e.model.get("newTab")?open(i,"_blank"):location.href=e.model.get("link");break;default:i=e.model.get("callback");_.isFunction(i)&&i.call(e)}}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-menu-item",className:"qazana-panel-menu-item",triggers:{click:"click"}})},function(e,t,n){"use strict";var i=n(0);n(47),n(28),n(27);var a=i(n(39)),o=i(n(108)),i=n(46),r=n(105);e.exports=i.extend({CACHE_KEY_NOT_FOUND_ERROR:"Cache key not found",tags:{Base:n(339)},cache:{},cacheRequests:{},cacheCallbacks:[],addCacheRequest:function(e){this.cacheRequests[this.createCacheKey(e)]=!0},createCacheKey:function(e){return btoa(e.getOption("name"))+"-"+btoa(encodeURIComponent((0,o.default)(e.model)))},loadTagDataFromCache:function(e){var t=this.createCacheKey(e);if(void 0!==this.cache[t])return this.cache[t];this.cacheRequests[t]||this.addCacheRequest(e)},loadCacheRequests:function(){var t=this.cache,e=this.cacheRequests,n=this.cacheCallbacks;this.cacheRequests={},this.cacheCallbacks=[],jQuery.ajax({type:"POST",url:qazana.config.ajaxurl,data:{action:"qazana_render_tags",post_id:qazana.config.document.id,tags:(0,a.default)(e),_nonce:qazana.config.nonce,editor_post_id:qazana.config.document.id},dataType:"json",success:function(e){jQuery.extend(t,e),n.forEach(function(e){e()})}})},refreshCacheFromServer:function(e){this.cacheCallbacks.push(e),this.loadCacheRequests()},getConfig:function(e){return this.getItems(qazana.config.dynamicTags,e)},parseTagsText:function(e,t,n){var i=this;return"object"===t.returnType?i.parseTagText(e,t,n):e.replace(/\[qazana-tag[^\]]+]/g,function(e){return i.parseTagText(e,t,n)})},parseTagText:function(e,t,n){e=this.tagTextToTagData(e);return e?n(e.id,e.name,e.settings):"object"===t.returnType?{}:""},tagTextToTagData:function(e){var t=e.match(/id="(.*?(?="))"/),n=e.match(/name="(.*?(?="))"/),e=e.match(/settings="(.*?(?="]))/);return!!(t&&n&&e)&&{id:t[1],name:n[1],settings:JSON.parse(decodeURIComponent(e[1]))}},createTag:function(e,t,n){var i=this.getConfig("tags."+t);if(i)return new(this.tags[t]||this.tags.Base)({id:e,name:t,model:new r(n,{controls:i.controls})})},getTagDataContent:function(e,t,n){n=this.createTag(e,t,n);if(n)return n.getContent()},tagDataToTagText:function(e,t,n){return'[qazana-tag id="'+e+'" name="'+t+'" settings="'+(n=encodeURIComponent((0,o.default)(n&&n.toJSON({removeDefault:!0})||{})))+'"]'},cleanCache:function(){this.cache={}},onInit:function(){this.loadCacheRequests=_.debounce(this.loadCacheRequests,300)}})},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({hasTemplate:!0,tagName:"span",className:function(){return"qazana-tag"},getTemplate:function(){return!!this.hasTemplate&&Marionette.TemplateCache.get("#tmpl-qazana-tag-"+this.getOption("name")+"-content")},initialize:function(){try{this.getTemplate()}catch(e){this.hasTemplate=!1}},getConfig:function(e){var t=qazana.dynamicTags.getConfig("tags."+this.getOption("name"));return e?t[e]:t},getContent:function(){var e,t=this.getConfig("content_type");if(!this.hasTemplate&&void 0===(e=qazana.dynamicTags.loadTagDataFromCache(this)))throw new Error(qazana.dynamicTags.CACHE_KEY_NOT_FOUND_ERROR);if("ui"===t){if(this.render(),this.hasTemplate)return this.el.outerHTML;this.getConfig("wrapped_tag")&&(e=jQuery(e).html()),this.$el.html(e)}return e},onRender:function(){this.el.id="qazana-tag-"+this.getOption("id")}})},function(e,t,n){"use strict";var i=n(46);e.exports=i.extend({modules:{base:n(167),general:n(341),page:n(342)},panelPages:{base:n(343)},onInit:function(){this.initSettings()},initSettings:function(){var i=this;_.each(qazana.config.settings,function(e,t){var n=i.modules[t]||i.modules.base;i[t]=new n(e)})}})},function(e,t,n){"use strict";n(27);n=n(167);e.exports=n.extend({changeCallbacks:{qazana_page_title_selector:function(e){e=e||"h1.entry-title";(qazana.settings.page.model.controls.hide_title.selectors={})[e]="display: none",qazana.settings.page.updateStylesheet()},custom_css:function(e){this.custom_css(e)}},custom_css:function(e){var t=this.getControlsCSS();(e=e||this.model.get("custom_css"))&&(e=e.replace(/selector/g,this.getSettings("cssWrapperSelector")),t.stylesheet.addRawCSS("general-settings-custom-css",e))},updateStylesheet:function(e){var t=this.getControlsCSS();e||t.stylesheet.empty(),t.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/{{WRAPPER}}/g],[this.getSettings("cssWrapperSelector")]),this.custom_css(),t.addStyleToDocument()},reloadPreview:function(){qazana.reloadPreview(),qazana.once("preview:loaded",function(){qazana.getPanelView().setPage("general_settings")})}})},function(e,t,n){"use strict";n(27),n(1);var i=n(167);e.exports=i.extend({save:function(){},changeCallbacks:{post_title:function(e){qazanaFrontend.getElements("$document").find(qazana.config.page_title_selector).text(e)},template:function(){qazana.saver.saveAutoSave({onSuccess:function(){qazana.reloadPreview(),qazana.once("preview:loaded",function(){qazana.getPanelView().setPage("page_settings")})}})},custom_css:function(e){this.custom_css(e)}},custom_css:function(e){var t=this.getControlsCSS();(e=e||this.model.get("custom_css"))&&(e=e.replace(/selector/g,this.getSettings("cssWrapperSelector")),t.stylesheet.addRawCSS("page-settings-custom-css",e))},updateStylesheet:function(e){var t=this.getControlsCSS();e||t.stylesheet.empty(),t.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/{{WRAPPER}}/g],[this.getSettings("cssWrapperSelector")]),this.custom_css(),t.addStyleToDocument()},renderStyles:function(){var e=this.getControlsCSS();e.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/\{\{WRAPPER}}/g],["body.qazana-page-"+qazana.config.post_id]),e.stylesheet.addRawCSS("page-settings-custom-css",this.model.get("custom_css").replace(/selector/g,"body.qazana-page-"+qazana.config.post_id))},onModelChange:function(){qazana.saver.setFlagEditorChange(!0),i.prototype.onModelChange.apply(this,arguments)},getDataToSave:function(e){return e.id=qazana.config.document.id,e},reloadPreview:function(){qazana.reloadPreview(),qazana.once("preview:loaded",function(){qazana.getPanelView().setPage("page_settings")})}})},function(e,t,n){"use strict";n=n(146);e.exports=n.extend({id:function(){return"qazana-panel-"+this.getOption("name")+"-settings"},getTemplate:function(){return"#tmpl-qazana-panel-"+this.getOption("name")+"-settings"},childViewContainer:function(){return"#qazana-panel-"+this.getOption("name")+"-settings-controls"},childViewOptions:function(){return{elementSettingsModel:this.model}}})},function(e,t,n){"use strict";n=n(46);e.exports=n.extend({autoSaveTimer:null,autosaveInterval:1e3*qazana.config.autosave_interval,isSaving:!1,isChangedDuringSave:!1,__construct:function(){this.setWorkSaver()},startTimer:function(e){clearTimeout(this.autoSaveTimer),e&&(this.autoSaveTimer=setTimeout(_.bind(this.doAutoSave,this),this.autosaveInterval))},saveDraft:function(){var e=qazana.settings.page.model.get("post_status");if(qazana.saver.isEditorChanged()||"draft"===e)switch(e){case"publish":case"private":this.doAutoSave();break;default:this.update()}},doAutoSave:function(){"edit"===qazana.channels.dataEditMode.request("activeMode")&&this.saveAutoSave()},saveAutoSave:function(e){this.isEditorChanged()&&(e=_.extend({status:"autosave"},e),this.saveEditor(e))},savePending:function(e){e=_.extend({status:"pending"},e),this.saveEditor(e)},discard:function(){var e=this;qazana.ajax.addRequest("discard_changes",{success:function(){e.setFlagEditorChange(!1),location.href=qazana.config.document.urls.exit_to_dashboard}})},update:function(e){e=_.extend({status:qazana.settings.page.model.get("post_status")},e),this.saveEditor(e)},publish:function(e){e=_.extend({status:"publish"},e),this.saveEditor(e)},setFlagEditorChange:function(e){e&&this.isSaving&&(this.isChangedDuringSave=!0),this.startTimer(e),qazana.channels.editor.reply("status",e).trigger("status:change",e)},isEditorChanged:function(){return!0===qazana.channels.editor.request("status")},setWorkSaver:function(){var e=this;qazana.$window.on("beforeunload",function(){if(e.isEditorChanged())return qazana.translate("before_unload_alert")})},saveEditor:function(n){var i,t,e,a,o;this.isSaving||(n=_.extend({status:"draft",onSuccess:null},n),i=this,t=qazana.elements.toJSON({removeDefault:!0}),e=qazana.settings.page.model.toJSON({removeDefault:!0}),a=qazana.settings.page.model.get("post_status"),o=a!==n.status,i.trigger("before:save",n).trigger("before:save:"+n.status,n),i.isSaving=!0,i.isChangedDuringSave=!1,e.post_status=n.status,qazana.ajax.addRequest("save_builder",{data:{status:n.status,elements:t,settings:e},success:function(e){i.afterAjax(),"autosave"!==n.status&&(o&&qazana.settings.page.model.set("post_status",n.status),i.isChangedDuringSave||i.setFlagEditorChange(!1)),e.config&&jQuery.extend(!0,qazana.config,e.config),qazana.config.data=t,qazana.channels.editor.trigger("saved",e),i.trigger("after:save",e).trigger("after:save:"+n.status,e),o&&i.trigger("page:status:change",n.status,a),_.isFunction(n.onSuccess)&&n.onSuccess.call(this,e)},error:function(e){var t;i.afterAjax(),i.trigger("after:saveError",e).trigger("after:saveError:"+n.status,e),_.isString(e)?t=e:e.statusText?(t=qazana.ajax.createErrorMessage(e),0===e.readyState&&(t+=" "+qazana.translate("saving_disabled"))):e[0]&&e[0].code&&(t=qazana.translate("server_error")+" "+e[0].code),qazana.notifications.showToast({message:t})}}))},afterAjax:function(){this.isSaving=!1}})},function(e,t,n){"use strict";var i=n(0)(n(104)),n=n(46);e.exports=n.extend({initToast:function(){var n=qazana.dialogsManager.createWidget("buttons",{id:"qazana-toast",position:{my:"center bottom",at:"center bottom-10",of:"#qazana-panel-content",autoRefresh:!0},hide:{onClick:!0,auto:!0,autoDelay:1e4},effects:{show:function(){var e=n.getElements("widget");e.show(),n.refreshPosition();var t=(0,i.default)(e.css("top"),10);e.hide().css("top",t+100),e.animate({opacity:"show",height:"show",paddingBottom:"show",paddingTop:"show",top:t},{easing:"linear",duration:300})},hide:function(){var e=n.getElements("widget"),t=(0,i.default)(e.css("top"),10);e.animate({opacity:"hide",height:"hide",paddingBottom:"hide",paddingTop:"hide",top:t+100},{easing:"linear",duration:300})}},button:{tag:"div"}});this.getToast=function(){return n}},showToast:function(e){var t=this.getToast();t.setMessage(e.message),t.getElements("buttonsWrapper").empty(),e.buttons&&e.buttons.forEach(function(e){t.addButton(e)}),t.show()},onInit:function(){this.initToast()}})},function(e,t,n){"use strict";n(1),n(45);var i=n(46);e.exports=i.extend({onInit:function(){var e=this;this.hasDocumentConditions()&&(this.config=qazana.config.documentConditions,qazana.addControlView("Conditions_repeater",n(347)),qazana.hooks.addFilter("panel/header/behaviors",this.addHeaderSaver),qazana.hooks.addFilter("panel/footer/behaviors",this.addFooterSaver),this.initConditionsLayout()),qazana.once("preview:loaded",function(){e.onQazanaPreviewLoaded()})},hasDocumentConditions:function(){return void 0!==qazana.config.documentConditions},addHeaderSaver:function(e){return e.saver={behaviorClass:n(349)},e},addFooterSaver:function(e){return e.saver={behaviorClass:n(350)},e},saveAndReload:function(){qazana.saver.saveAutoSave({onSuccess:function(){qazana.dynamicTags.cleanCache(),qazana.reloadPreview()}})},onApplyPreview:function(){this.saveAndReload()},onPageSettingsChange:function(e){e.changed.preview_type&&(e.set({preview_id:"",preview_search_term:""}),this.updatePreviewIdOptions(!0)),_.isUndefined(e.changed.page_template)||qazana.saver.saveAutoSave({onSuccess:function(){qazana.reloadPreview(),qazana.once("preview:loaded",function(){qazana.getPanelView().setPage("page_settings")})}})},updatePreviewIdOptions:function(e){var t,n,i=qazana.settings.page.model.get("preview_type");i&&(i=i.split("/"),t=(n=qazana.getPanelView().getCurrentPageView()).collection.findWhere({name:"preview_id"}),"author"===i[1]?t.set({filter_type:"author",object_type:"author"}):"taxonomy"===i[0]?t.set({filter_type:"taxonomy",object_type:i[1]}):"single"===i[0]?t.set({filter_type:"post",object_type:i[1]}):t.set({filter_type:"",object_type:""}),!0===e&&((n=n.children.findByModel(t)).render(),n.$el.toggle(!!t.get("filter_type"))))},onQazanaPreviewLoaded:function(){qazana.getPanelView().on("set:page:page_settings",this.updatePreviewIdOptions),qazana.settings.page.model.on("change",this.onPageSettingsChange.bind(this)),qazana.channels.editor.on("qazanaDocumentConditions:ApplyPreview",this.onApplyPreview.bind(this)),setTimeout(function(){qazana.$previewContents.find("html, body").animate({scrollTop:qazana.$previewContents.find("#qazana").offset().top-qazana.$preview[0].contentWindow.innerHeight/2})},500)},initConditionsLayout:function(){var e=n(351);this.conditionsLayout=new e},showConditionsModal:function(){var e=n(352),t=new qazana.modules.elements.models.BaseSettings(this.config.settings,{controls:this.config.template_conditions.controls});this.conditionsLayout.modalContent.show(new e({model:t,controls:t.controls})),this.conditionsLayout.modal.show()}})},function(e,t,n){"use strict";n=n(348);e.exports=qazana.modules.controls.Repeater.extend({childView:n,updateActiveRow:function(){},initialize:function(){qazana.modules.controls.Repeater.prototype.initialize.apply(this,arguments),this.config=qazana.config.documentConditions,this.updateConditionsOptions()},checkConflicts:function(e){var t=e.get("_id"),n="qazana-condition-id-"+t,i="qazana-conditions-conflict-message-"+t,t=jQuery("#"+i);jQuery("#"+n).removeClass("qazana-error"),t.remove(),qazana.ajax.addRequest("document_conditions_check_conflicts",{unique_id:n,data:{condition:e.toJSON({removeDefaults:!0})},success:function(e){_.isEmpty(e)||jQuery("#"+n).addClass("qazana-error").after('<div id="'+i+'" class="qazana-conditions-conflict-message">'+e+"</div>")}})},updateConditionsOptions:function(){var a=this,e=qazana.config.documentProperties.condition_type,o={};_([e]).each(function(e,t){var n=a.config.conditions[e],i={label:n.label,options:{}};i.options[e]=n.all_label,_(n.sub_conditions).each(function(e){i.options[e]=a.config.conditions[e].label}),o[t]=i});var t=this.model.get("fields");"general"===(t[1].default=e)?t[1].groups=o:t[2].groups=o},togglePublishButtonState:function(){var e=qazana.documentConditions.conditionsLayout.modalContent.currentView.ui,t=e.publishButton,e=e.publishButtonTitle;this.collection.length?(t.addClass("qazana-button-success"),e.text(qazana.translate("publish"))):(t.removeClass("qazana-button-success"),e.text(qazana.translate("save_without_conditions")))},onRender:function(){this.ui.btnAddRow.text(qazana.translate("add_condition"));var t=this;this.collection.each(function(e){t.checkConflicts(e)}),_.defer(this.togglePublishButtonState.bind(this))},onRowControlChange:function(e){this.checkConflicts(e)},onRowUpdate:function(){qazana.modules.controls.Repeater.prototype.onRowUpdate.apply(this,arguments),this.togglePublishButtonState()}})},function(e,t,n){"use strict";n(28),e.exports=qazana.modules.controls.RepeaterRow.extend({template:"#tmpl-qazana-document-conditions-repeater-row",childViewContainer:".qazana-document-conditions-repeater-row-controls",id:function(){return"qazana-condition-id-"+this.model.get("_id")},onBeforeRender:function(){var e=this.collection.findWhere({name:"sub_name"}),t=this.collection.findWhere({name:"sub_id"}),n=this.config.conditions[this.model.attributes.sub_name];e.attributes.groups=this.getOptions(),n&&n.controls&&_(n.controls).each(function(e){t.set(e),t.set("name","sub_id")})},initialize:function(){qazana.modules.controls.RepeaterRow.prototype.initialize.apply(this,arguments),this.config=qazana.config.documentConditions},updateOptions:function(){this.model.changed.name&&this.model.set({sub_name:"",sub_id:""}),(this.model.changed.name||this.model.changed.sub_name)&&(this.model.set("sub_id",""),this.collection.findWhere({name:"sub_id"}).set({type:"select",options:{"":"All"}}),this.render()),this.model.changed.type&&this.setTypeAttribute()},getOptions:function(){var a=this,e=a.config.conditions[this.model.get("name")];if(e){var o={"":e.all_label};return _(e.sub_conditions).each(function(e,t){var n,i=a.config.conditions[e];i&&(i.sub_conditions.length?((n={label:i.label,options:{}}).options[e]=i.all_label,_(i.sub_conditions).each(function(e){a.config.conditions[e]&&(n.options[e]=a.config.conditions[e].label)}),o["key"+t]=n):o[e]=i.label)}),o}},setTypeAttribute:function(){var e=this.children.findByModel(this.collection.findWhere({name:"type"}));e.$el.attr("data-qazana-condition-type",e.getControlValue())},onRender:function(){var e=this.collection.findWhere({name:"name"}),t=this.collection.findWhere({name:"sub_name"}),n=this.collection.findWhere({name:"sub_id"}),i=this.children.findByModel(e),a=this.children.findByModel(t),e=this.children.findByModel(n),t=this.config.conditions[this.model.attributes.name],n=this.config.conditions[this.model.attributes.sub_name];this.config.types[this.config.settings.template_type].condition_type!==i.getControlValue()||"general"===i.getControlValue()||_.isEmpty(t.sub_conditions)||i.$el.hide(),(!t||_.isEmpty(t.sub_conditions)&&_.isEmpty(t.controls)||!i.getControlValue()||"general"===i.getControlValue())&&a.$el.hide(),n&&!_.isEmpty(n.controls)&&a.getControlValue()||e.$el.hide(),this.setTypeAttribute()},onModelChange:function(){qazana.modules.controls.RepeaterRow.prototype.onModelChange.apply(this,arguments),this.updateOptions()}})},function(e,t,n){"use strict";var i=qazana.modules.components.saver.behaviors.HeaderSaver;e.exports=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.menuConditions="#qazana-panel-footer-saver-conditions",e.previewWrapper="#qazana-panel-header-document-conditions-button-preview-wrapper",e.buttonPreviewSettings="#qazana-panel-header-document-conditions-button-preview-settings",e.buttonOpenPreview="#qazana-panel-header-document-conditions-button-open-preview",e},events:function(){var e=i.prototype.events.apply(this,arguments);return e["click @ui.previewWrapper"]="onClickPreviewWrapper",e["click @ui.menuConditions"]="onClickMenuConditions",e["click @ui.buttonPreviewSettings"]="onClickButtonPreviewSettings",e["click @ui.buttonOpenPreview"]="onClickButtonPreview",e},initialize:function(){i.prototype.initialize.apply(this,arguments),this.config=qazana.config.documentConditions,qazana.settings.page.model.on("change",this.onChangeLocation.bind(this))},onRender:function(){i.prototype.onRender.apply(this,arguments);var e=jQuery("<div />",{id:"qazana-panel-footer-saver-conditions",class:"qazana-panel-header-sub-menu-item",html:'<i class="qazana-icon fa fa-paper-plane"></i><span class="qazana-title">'+qazana.translate("display_conditions")+"</span>"});this.ui.menuConditions=e,this.toggleMenuConditions(),this.ui.saveTemplate.before(e),this.ui.buttonPreview.replaceWith(jQuery("#tmpl-qazana-document-conditions-button-preview").html())},toggleMenuConditions:function(){this.ui.menuConditions.toggle(!!this.config.settings.location)},onChangeLocation:function(e){_.isUndefined(e.changed.location)||(this.config.settings.location=e.changed.location,this.toggleMenuConditions())},onClickPreviewWrapper:function(e){var t=jQuery(e.target),n=t.closest(".qazana-panel-header-tool");t.closest(".qazana-panel-header-sub-menu-wrapper").length?n.removeClass("qazana-open"):(this.ui.menuButtons.filter(":not(.qazana-leave-open)").removeClass("qazana-open"),t=n.length&&!n.hasClass("qazana-open"),n.toggleClass("qazana-open",t),e.stopPropagation())},onClickMenuConditions:function(){qazana.documentConditions.showConditionsModal()},onClickButtonPublish:function(){var e=this.config.settings.conditions.length,t=this.config.settings.location,n="draft"===qazana.settings.page.model.get("post_status");e&&!n||!t?i.prototype.onClickButtonPublish.apply(this,arguments):qazana.documentConditions.showConditionsModal()},onClickButtonPreviewSettings:function(){var e=qazana.getPanelView();e.setPage("page_settings"),e.getCurrentPageView().activateSection("preview_settings"),e.getCurrentPageView()._renderChildren()}})},function(e,t,n){"use strict";var i=qazana.modules.components.saver.behaviors.FooterSaver;e.exports=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.menuConditions="#qazana-panel-footer-saver-conditions",e.previewWrapper="#qazana-panel-footer-document-conditions-button-preview-wrapper",e.buttonPreviewSettings="#qazana-panel-footer-document-conditions-button-preview-settings",e.buttonOpenPreview="#qazana-panel-footer-document-conditions-button-open-preview",e},events:function(){var e=i.prototype.events.apply(this,arguments);return e["click @ui.previewWrapper"]="onClickPreviewWrapper",e["click @ui.menuConditions"]="onClickMenuConditions",e["click @ui.buttonPreviewSettings"]="onClickButtonPreviewSettings",e["click @ui.buttonOpenPreview"]="onClickButtonPreview",e},initialize:function(){i.prototype.initialize.apply(this,arguments),this.config=qazana.config.documentConditions,qazana.settings.page.model.on("change",this.onChangeLocation.bind(this))},onRender:function(){i.prototype.onRender.apply(this,arguments);var e=jQuery("<div />",{id:"qazana-panel-footer-saver-conditions",class:"qazana-panel-footer-sub-menu-item",html:'<i class="qazana-icon fa fa-paper-plane"></i><span class="qazana-title">'+qazana.translate("display_conditions")+"</span>"});this.ui.menuConditions=e,this.toggleMenuConditions(),this.ui.saveTemplate.before(e),this.ui.buttonPreview.replaceWith(jQuery("#tmpl-qazana-document-conditions-button-preview").html())},toggleMenuConditions:function(){this.ui.menuConditions.toggle(!!this.config.settings.location)},onChangeLocation:function(e){_.isUndefined(e.changed.location)||(this.config.settings.location=e.changed.location,this.toggleMenuConditions())},onClickPreviewWrapper:function(e){var t=jQuery(e.target),n=t.closest(".qazana-panel-footer-tool");t.closest(".qazana-panel-footer-sub-menu-wrapper").length?n.removeClass("qazana-open"):(this.ui.menuButtons.filter(":not(.qazana-leave-open)").removeClass("qazana-open"),t=n.length&&!n.hasClass("qazana-open"),n.toggleClass("qazana-open",t),e.stopPropagation())},onClickMenuConditions:function(){qazana.documentConditions.showConditionsModal()},onClickButtonPublish:function(){var e=this.config.settings.conditions.length,t=this.config.settings.location,n="draft"===qazana.settings.page.model.get("post_status");e&&!n||!t?i.prototype.onClickButtonPublish.apply(this,arguments):qazana.documentConditions.showConditionsModal()},onClickButtonPreviewSettings:function(){var e=qazana.getPanelView();e.setPage("page_settings"),e.getCurrentPageView().activateSection("preview_settings"),e.getCurrentPageView()._renderChildren()}})},function(e,t,n){"use strict";var i=qazana.modules.components.templateLibrary.views.BaseModalLayout;e.exports=i.extend({getModalOptions:function(){return{id:"qazana-conditions-modal"}},getLogoOptions:function(){return{title:qazana.translate("display_conditions")}},initialize:function(){i.prototype.initialize.apply(this,arguments),this.showLogo()}})},function(e,t,n){"use strict";var i=n(353);e.exports=i.extend({id:"qazana-document-conditions-view",template:"#tmpl-qazana-document-conditions-view",childViewContainer:"#qazana-document-conditions-controls",ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.publishButton="#qazana-document-conditions__publish",e.publishButtonTitle="#qazana-document-conditions__publish__title",e},events:{"click @ui.publishButton":"onClickPublish"},templateHelpers:function(){return{title:qazana.translate("conditions_title"),description:qazana.translate("conditions_description")}},childViewOptions:function(){return{elementSettingsModel:this.model}},onClickPublish:function(e){var t=this,n=jQuery(e.currentTarget),i=this.model.toJSON({removeDefault:!0});e.stopPropagation(),n.attr("disabled",!0).addClass("qazana-button-state"),qazana.ajax.addRequest("document_save_conditions",{data:i,success:function(){qazana.config.documentConditions.settings.conditions=t.model.get("conditions"),qazana.saver.publish()},complete:function(){t.afterAjax(n)}})},afterAjax:function(e){e.attr("disabled",!1).removeClass("qazana-button-state"),qazana.documentConditions.conditionsLayout.modal.hide()}})},function(e,t,n){"use strict";n(164),n(147),n(59),e.exports=qazana.modules.views.ControlsStack.extend({activeTab:"content",activeSection:"settings",initialize:function(){this.collection=new Backbone.Collection(_.values(this.options.controls))},filter:function(e){if("section"===e.get("type"))return!0;e=e.get("section");return!e||e===this.activeSection},childViewOptions:function(){return{elementSettingsModel:this.model}}})},function(e,t,n){"use strict";var i=n(0);n(1);var a=i(n(39)),o=n(173),r=n(355);e.exports=o.extend({el:"#qazana-panel",getStorageKey:function(){return"panel"},getDefaultStorage:function(){return{docked:!1,visible:!0,size:{width:"",height:"",top:"",bottom:"",right:"",left:""}}},constructor:function(){o.prototype.constructor.apply(this,arguments);var e=qazana.getStorage(this.getStorageKey());this.storage=e||this.getDefaultStorage(),this.storageSizeKeys=(0,a.default)(this.storage.size),this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeSwitched),this.isDocked=!0,this.opened=!1,this.ensurePosition=this.ensurePosition.bind(this),this.storage.visible&&this.open()},beforeFirstOpen:function(){this.show(new r),this.$el.draggable(this.getDraggableOptions()),this.$el.resizable(this.getResizableOptions())},getLayout:function(){return this.currentView},getDraggableOptions:function(){return{iframeFix:!0,handle:"#qazana-panel-header",drag:this.onDrag.bind(this),stop:this.onDragStop.bind(this)}},getResizableOptions:function(){var e=this,n=qazana.config.is_rtl?"right":"left";return{handles:qazana.config.is_rtl?"w":"e",containment:"document",minWidth:200,maxWidth:680,minHeight:240,start:function(){qazana.$previewWrapper.addClass("ui-resizable-resizing")},stop:function(){qazana.$previewWrapper.removeClass("ui-resizable-resizing"),qazana.getPanelView().updateScrollbar(),e.isDocked?(e.storage.size.width=qazana.helpers.getElementInlineStyle(e.$el,["width"]).width,qazana.setStorage("panel",e.storage)):(e.storage.size.height=qazana.helpers.getElementInlineStyle(e.$el,["height"]).height-200,e.saveSize())},resize:function(e,t){qazana.$previewWrapper.css(n,t.size.width)}}},setSize:function(){var e=this.storage.size.width,t=qazana.config.is_rtl?"right":"left";this.$el.css("width",e),qazana.$previewWrapper.css(t,e)},setDockedSize:function(){this.$el.css("width",this.storage.size.width)},open:function(e){this.opened||(this.beforeFirstOpen(),this.opened=!0),this.$el.show(),this.storage.docked?(this.dock(),this.setDockedSize()):this.setSize(),e&&e.trigger("request:edit"),this.saveStorage("visible",!0),this.ensurePosition(),qazana.$window.on("resize",this.ensurePosition)},close:function(e){this.isDocked&&this.undock(!0),e||this.saveStorage("visible",!1),qazana.$window.off("resize",this.ensurePosition)},isOpen:function(){return this.$el.is(":visible")},dock:function(){qazana.$body.addClass("qazana-panel-docked").removeClass("qazana-panel-undocked");var n=Boolean(qazana.config.is_rtl)?"right":"left",e=this.getResizableOptions();this.$el.css({height:"",top:"",bottom:"",left:"",right:""}),qazana.$previewWrapper.css(n,this.storage.size.width),this.$el.resizable("destroy"),e.handles=Boolean(qazana.config.is_rtl)?"e":"w",e.resize=function(e,t){qazana.$previewWrapper.css(n,t.size.width)},this.$el.resizable(e),this.isDocked=!0,this.saveStorage("docked",!0)},undock:function(e){qazana.$body.removeClass("qazana-panel-docked").addClass("qazana-panel-undocked");var t=Boolean(qazana.config.is_rtl)?"left":"right";qazana.$body.find("#qazana-preview").css(t,""),this.setSize();t=this.storage.size.height;this.$el.css("height",t),this.$el.resizable("destroy"),this.$el.resizable(this.getResizableOptions()),this.isDocked=!1,e||this.saveStorage("docked",!1)},ensurePosition:function(){var e;this.isDocked||((e=this.$el.offset()).left>innerWidth&&this.$el.css({left:"",right:""}),e.top>innerHeight&&this.$el.css({top:"",bottom:""}))},onDrag:function(e,t){if(this.isDocked)if(t.position.left===t.originalPosition.left){if(t.position.top!==t.originalPosition.top)return!1}else this.undock();else{t.position.top<0&&(t.position.top=0);var n=0===t.position.left,i=t.position.left+this.el.offsetWidth>innerWidth;qazana.config.is_rtl?i&&(t.position.left=innerWidth-this.el.offsetWidth):n&&(t.position.left=0),qazana.$body.toggleClass("qazana-panel--dock-hint",qazana.config.is_rtl?n:i)}},onDragStop:function(e,t){var n;this.isDocked||(this.saveSize(),n=t.position.left+this.el.offsetWidth,(t.position.left<0||n>innerWidth)&&this.dock(),qazana.$body.removeClass("qazana-panel--dock-hint"))},onEditModeSwitched:function(e){"edit"===e&&this.storage.visible?this.open():this.close(!0)}})},function(e,t,i){"use strict";var a=i(0)(i(39)),n=i(356),o=Marionette.LayoutView.extend({template:"#tmpl-qazana-panel",id:"qazana-panel-inner",regions:{content:"#qazana-panel-content",header:"#qazana-panel-header",footer:"#qazana-panel-footer",modeSwitcher:"#qazana-mode-switcher"},pages:{},childEvents:{"click:add":function(){this.setPage("elements")},"editor:destroy":function(){this.setPage("elements",null,{autoFocusSearch:!1})}},currentPageName:null,currentPageView:null,_isScrollbarInitialized:!1,initialize:function(){this.initPages()},buildPages:function(){var n={elements:{view:i(357),title:qazana.config.document.title},editor:{view:i(362)},menu:{view:qazana.modules.layouts.panel.pages.menu.Menu,title:qazana.config.document.title},colorScheme:{view:i(202)},typographyScheme:{view:i(365)},colorPickerScheme:{view:i(366)}},e=(0,a.default)(qazana.schemes.getSchemes()),e=_.difference(e,qazana.schemes.getEnabledSchemesTypes());return _.each(e,function(e){var t=qazana.schemes.getScheme(e);n[e+"Scheme"].view=i(367).extend({disabledTitle:t.disabled_title})}),n},initPages:function(){var n;this.getPages=function(e){return n=n||this.buildPages(),e?n[e]:n},this.addPage=function(e,t){(n=n||this.buildPages())[e]=t}},getHeaderView:function(){return this.getChildView("header")},getFooterView:function(){return this.getChildView("footer")},getCurrentPageName:function(){return this.currentPageName},getCurrentPageView:function(){return this.currentPageView},setPage:function(e,t,n){var i=this.getPages();"elements"!==e||qazana.userCan("design")||i.page_settings&&(e="page_settings");var a=i[e];if(!a)throw new ReferenceError("Qazana panel doesn't have page named '"+e+"'");a.options&&(n=_.extend(a.options,n));i=a.view;a.getView&&(i=a.getView()),this.currentPageName=e,this.currentPageView=new i(n),this.showChildView("content",this.currentPageView),this.getHeaderView().setTitle(t||a.title),this.trigger("set:page",this.currentPageView).trigger("set:page:"+e,this.currentPageView)},openEditor:function(e,t){this.setPage("editor",qazana.translate("edit_element",[qazana.getElementData(e).title]),{model:e,controls:qazana.getElementControls(e),editedElementView:t});var n="panel/open_editor/"+e.get("elType");qazana.hooks.doAction(n,this,e,t),qazana.hooks.doAction(n+"/"+e.get("widgetType"),this,e,t)},onBeforeShow:function(){var e=i(368),t=i(369);this.showChildView("modeSwitcher",new n),this.showChildView("header",new t),this.showChildView("footer",new e),this.updateScrollbar=_.throttle(this.updateScrollbar,100),this.getRegion("content").on("before:show",this.onEditorBeforeShow.bind(this)).on("empty",this.onEditorEmpty.bind(this)).on("show",this.updateScrollbar.bind(this)),this.setPage("elements")},onEditorBeforeShow:function(){_.defer(this.updateScrollbar.bind(this))},onEditorEmpty:function(){this.updateScrollbar()},updateScrollbar:function(){var e=this.content.$el;if(!this._isScrollbarInitialized)return e.perfectScrollbar(),void(this._isScrollbarInitialized=!0);e.perfectScrollbar("update")}});e.exports=o},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({template:"#tmpl-qazana-mode-switcher-content",id:"qazana-mode-switcher-inner",ui:{previewButton:"#qazana-mode-switcher-preview-input",previewLabel:"#qazana-mode-switcher-preview",previewLabelA11y:"#qazana-mode-switcher-preview .qazana-screen-only"},events:{"change @ui.previewButton":"onPreviewButtonChange"},initialize:function(){this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeChanged)},getCurrentMode:function(){return this.ui.previewButton.is(":checked")?"preview":"edit"},setMode:function(e){this.ui.previewButton.prop("checked","preview"===e).trigger("change")},toggleMode:function(){this.setMode(this.ui.previewButton.prop("checked")?"edit":"preview")},onRender:function(){this.onEditModeChanged()},onPreviewButtonChange:function(){qazana.changeEditMode(this.getCurrentMode())},onEditModeChanged:function(){var e=qazana.channels.dataEditMode.request("activeMode"),e=qazana.translate("preview"===e?"back_to_editor":"preview");this.ui.previewLabel.attr("title",e),this.ui.previewLabelA11y.text(e)}});e.exports=i},function(e,t,n){"use strict";n(198);var a=n(358),i=n(201),o=n(359),r=qazana.modules.layouts.panel.pages.elements.views.Elements,s=n(361),l=n(197),n=Marionette.LayoutView.extend({template:"#tmpl-qazana-panel-elements",options:{autoFocusSearch:!0},regions:{elements:"#qazana-panel-elements-wrapper",search:"#qazana-panel-elements-search-area"},ui:{tabs:".qazana-panel-navigation-tab"},events:{"click @ui.tabs":"onTabClick"},regionViews:{},elementsCollection:null,categoriesCollection:null,initialize:function(){this.listenTo(qazana.channels.panelElements,"element:selected",this.destroy),this.initElementsCollection(),this.initCategoriesCollection(),this.initRegionViews()},initRegionViews:function(){var e={elements:{region:this.elements,view:r,options:{collection:this.elementsCollection}},categories:{region:this.elements,view:o,options:{collection:this.categoriesCollection}},search:{region:this.search,view:s},global:{region:this.elements,view:l}};this.regionViews=qazana.hooks.applyFilters("panel/elements/regionViews",e)},initElementsCollection:function(){var t=new i,e=qazana.config.elements.section;t.add({title:qazana.translate("inner_section"),elType:"section",categories:["basic"],keywords:["row","columns","nested"],icon:e.icon}),_.each(qazana.config.widgets,function(e){e.show_in_panel&&t.add({title:e.title,elType:e.elType,categories:e.categories,keywords:e.keywords,icon:e.icon,widgetType:e.widget_type,custom:e.custom})}),this.elementsCollection=t},initCategoriesCollection:function(){var n={};this.elementsCollection.each(function(t){_.each(t.get("categories"),function(e){n[e]||(n[e]=[]),n[e].push(t)})});var i=new a;_.each(qazana.config.document.panel.elements_categories,function(e,t){n[t]&&(void 0===e.active&&(e.active=!0),void 0===e.icon&&(e.icon="font"),i.add({name:t,title:e.title,icon:e.icon,defaultActive:e.active,items:n[t]}))}),this.categoriesCollection=i},activateTab:function(e){this.ui.tabs.removeClass("qazana-active").filter('[data-view="'+e+'"]').addClass("qazana-active"),this.showView(e)},showView:function(e){var t=this.regionViews[e],e=t.options||{};t.region.show(new t.view(e))},clearSearchInput:function(){this.getChildView("search").clearInput()},changeFilter:function(e){qazana.channels.panelElements.reply("filter:value",e).trigger("filter:change")},clearFilters:function(){this.changeFilter(null),this.clearSearchInput()},focusSearch:function(){qazana.userCan("design")&&this.search.currentView.ui.input.focus()},onChildviewChildrenRender:function(){qazana.getPanelView().updateScrollbar()},onChildviewSearchChangeInput:function(e){this.changeFilter(e.ui.input.val(),"search")},onDestroy:function(){qazana.channels.panelElements.reply("filter:value",null)},onShow:function(){this.showView("categories"),this.showView("search"),this.options.autoFocusSearch&&setTimeout(this.focusSearch.bind(this))},onTabClick:function(e){this.activateTab(e.currentTarget.dataset.view)}});e.exports=n},function(e,t,n){"use strict";n=n(200),n=Backbone.Collection.extend({model:n});e.exports=n},function(e,t,n){"use strict";n=n(360),n=Marionette.CompositeView.extend({template:"#tmpl-qazana-panel-categories",childView:n,childViewContainer:"#qazana-panel-categories",id:"qazana-panel-elements-categories",initialize:function(){this.listenTo(qazana.channels.panelElements,"filter:change",this.onPanelElementsFilterChange)},onPanelElementsFilterChange:function(){qazana.channels.panelElements.request("filter:value")&&qazana.getPanelView().getCurrentPageView().showView("elements")}});e.exports=n},function(e,t,n){"use strict";var i=n(201),n=Marionette.CompositeView.extend({template:"#tmpl-qazana-panel-elements-category",className:"qazana-panel-category",ui:{title:".qazana-panel-category-title",items:".qazana-panel-category-items"},events:{"click @ui.title":"onTitleClick"},id:function(){return"qazana-panel-category-"+this.model.get("name")},childView:n(199),childViewContainer:".qazana-panel-category-items",initialize:function(){this.collection=new i(this.model.get("items"))},onRender:function(){var e=qazana.channels.panelElements.request("category:"+this.model.get("name")+":active");void 0===e&&(e=this.model.get("defaultActive")),e&&(this.$el.addClass("qazana-active"),this.ui.items.show())},onTitleClick:function(){var e=this.ui.items,t="qazana-active",n=this.$el.hasClass(t),i=n?"slideUp":"slideDown";qazana.channels.panelElements.reply("category:"+this.model.get("name")+":active",!n),this.$el.toggleClass(t,!n),e[i](300,function(){qazana.getPanelView().updateScrollbar()})}});e.exports=n},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-element-search",id:"qazana-panel-elements-search-wrapper",ui:{input:"input"},events:{"input @ui.input":"onInputChanged"},clearInput:function(){this.ui.input.val("")},onInputChanged:function(e){27===e.keyCode&&this.clearInput(),this.triggerMethod("search:change:input")}});e.exports=i},function(e,t,n){"use strict";var i=n(146),n=i.extend({template:Marionette.TemplateCache.get("#tmpl-editor-content"),id:"qazana-panel-page-editor",childViewContainer:"#qazana-controls",childViewOptions:function(){return{elementSettingsModel:this.model.get("settings"),elementEditSettings:this.model.get("editSettings")}},openActiveSection:function(){i.prototype.openActiveSection.apply(this,arguments),qazana.channels.editor.trigger("section:activated",this.activeSection,this)},isVisibleSectionControl:function(e){return i.prototype.isVisibleSectionControl.apply(this,arguments)&&qazana.helpers.isActiveControl(e,this.model.get("settings").attributes)},scrollToEditedElement:function(){qazana.helpers.scrollToView(this.getOption("editedElementView").$el)},getControlView:function(e){return this.children.findByModelCid(this.getControlModel(e).cid)},getControlModel:function(e){return this.collection.findWhere({name:e})},onDestroy:function(){var e=this.getOption("editedElementView");e&&e.$el.removeClass("qazana-element-editable"),this.model.trigger("editor:close"),this.triggerMethod("editor:destroy")},onRender:function(){var e=this.getOption("editedElementView");e&&e.$el.addClass("qazana-element-editable")},onDeviceModeChange:function(){i.prototype.onDeviceModeChange.apply(this,arguments),this.scrollToEditedElement()},onChildviewSettingsChange:function(e){var t=this.getOption("editedElementView"),n=t.model.get("elType");"widget"===n&&(n=t.model.get("widgetType")),qazana.channels.editor.trigger("change",e,t).trigger("change:"+n,e,t).trigger("change:"+n+":"+e.model.get("name"),e,t)}});e.exports=n},function(e,t,n){"use strict";n(75),n(59);n=n(204).extend({getUIType:function(){return"color"},ui:{input:".qazana-panel-scheme-color-value"},changeUIValue:function(e){this.ui.input.wpColorPicker("color",e)},onBeforeDestroy:function(){this.ui.input.wpColorPicker("instance")&&this.ui.input.wpColorPicker("close")},onRender:function(){var n=this;qazana.helpers.wpColorPicker(n.ui.input,{change:function(e,t){n.triggerMethod("value:change",t.color.toString())}})}});e.exports=n},function(e,t,n){"use strict";var i=n(204),n=i.extend({getUIType:function(){return"typography"},className:function(){return i.prototype.className.apply(this,arguments)+" qazana-panel-box"},ui:{heading:".qazana-panel-heading",allFields:".qazana-panel-scheme-typography-item-field",inputFields:"input.qazana-panel-scheme-typography-item-field",selectFields:"select.qazana-panel-scheme-typography-item-field",selectFamilyFields:'select.qazana-panel-scheme-typography-item-field[name="font_family"]'},events:{"input @ui.inputFields":"onFieldChange","change @ui.selectFields":"onFieldChange","click @ui.heading":"toggleVisibility"},onRender:function(){var n=this;this.ui.inputFields.add(this.ui.selectFields).each(function(){var e=jQuery(this),t=e.attr("name"),t=n.model.get("value")[t];e.val(t)}),this.ui.selectFamilyFields.select2({dir:qazana.config.is_rtl?"rtl":"ltr"})},toggleVisibility:function(){this.$el.toggleClass("qazana-open")},changeUIValue:function(n){this.ui.allFields.each(function(){var e=jQuery(this),t=e.attr("name"),t=n[t];e.val(t).trigger("change")})},onFieldChange:function(e){var t=this.$(e.currentTarget),n=qazana.schemes.getSchemeValue("typography",this.model.get("key")).value,e=t.attr("name");n[e]=t.val(),"font_family"!==e||_.isEmpty(n[e])||qazana.helpers.enqueueFont(n[e]),this.triggerMethod("value:change",n)}});e.exports=n},function(e,t,n){"use strict";n=n(203).extend({getType:function(){return"typography"}});e.exports=n},function(e,t,n){"use strict";n=n(202).extend({getType:function(){return"color-picker"},getUIType:function(){return"color"},onSchemeChange:function(){},getViewComparator:function(){return this.orderView},orderView:function(e){return qazana.helpers.getColorPickerPaletteIndex(e.get("key"))}});e.exports=n},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-schemes-disabled",id:"qazana-panel-schemes-disabled",className:"qazana-nerd-box",disabledTitle:"",templateHelpers:function(){return{disabledTitle:this.disabledTitle}}});e.exports=i},function(e,t,n){"use strict";e.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-footer-content",tagName:"nav",id:"qazana-panel-footer-tools",possibleRotateModes:["portrait","landscape"],ui:{buttonSave:"#qazana-panel-footer-saver-button-publish, #qazana-panel-footer-saver-menu-save-draft",menuButtons:".qazana-panel-footer-tool",settings:"#qazana-panel-footer-settings",deviceModeIcon:"#qazana-panel-footer-responsive > i",deviceModeButtons:"#qazana-panel-footer-responsive .qazana-panel-footer-sub-menu-item",saveTemplate:"#qazana-panel-footer-saver-menu-save-template",history:"#qazana-panel-footer-history",navigator:"#qazana-panel-footer-navigator"},events:{"click @ui.menuButtons":"onMenuButtonsClick","click @ui.settings":"onSettingsClick","click @ui.deviceModeButtons":"onResponsiveButtonsClick","click @ui.saveTemplate":"onSaveTemplateClick","click @ui.history":"onHistoryClick","click @ui.navigator":"onNavigatorClick"},behaviors:function(){var e={saver:{behaviorClass:qazana.modules.components.saver.behaviors.FooterSaver}};return qazana.hooks.applyFilters("panel/footer/behaviors",e,this)},initialize:function(){this.listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange)},getDeviceModeButton:function(e){return this.ui.deviceModeButtons.filter('[data-device-mode="'+e+'"]')},onMenuButtonsClick:function(e){var t=jQuery(e.currentTarget);t.hasClass("qazana-toggle-state")&&!jQuery(e.target).closest(".qazana-panel-footer-sub-menu-item").length&&(e=t.hasClass("qazana-open"),this.ui.menuButtons.not(".qazana-leave-open").removeClass("qazana-open"),e||t.addClass("qazana-open"))},onSettingsClick:function(){var e=this;"page_settings"!==qazana.getPanelView().getCurrentPageName()&&(qazana.getPanelView().setPage("page_settings"),qazana.getPanelView().getCurrentPageView().once("destroy",function(){e.ui.settings.removeClass("qazana-open")}))},onDeviceModeChange:function(){var e=qazana.channels.deviceMode.request("previousMode"),t=qazana.channels.deviceMode.request("currentMode");this.getDeviceModeButton(e).removeClass("active"),this.getDeviceModeButton(t).addClass("active"),this.ui.deviceModeIcon.removeClass("eicon-device-"+e).addClass("eicon-device-"+t)},onResponsiveButtonsClick:function(e){e=this.$(e.currentTarget).data("device-mode");qazana.changeDeviceMode(e)},onSaveTemplateClick:function(){qazana.templates.startModal({onReady:function(){qazana.templates.getLayout().showSaveTemplateView()}})},onHistoryClick:function(){"historyPage"!==qazana.getPanelView().getCurrentPageName()&&qazana.getPanelView().setPage("historyPage")},onNavigatorClick:function(){qazana.navigator.isOpen()?qazana.navigator.close():qazana.navigator.open()}})},function(e,t,n){"use strict";var i=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-header-content",id:"qazana-panel-header",ui:{menuButton:"#qazana-panel-header-menu-button",menuButtons:".qazana-panel-header-tool",menuIcon:"#qazana-panel-header-menu-button i",title:"#qazana-panel-header-title",addButton:"#qazana-panel-header-add-button",saveTemplate:"#qazana-panel-header-saver-button-save-template"},events:{"click @ui.addButton":"onClickAdd","click @ui.menuButton":"onClickMenu","click @ui.saveTemplate":"onClickSaveTemplate"},behaviors:function(){var e={saver:{behaviorClass:qazana.modules.components.saver.behaviors.HeaderSaver}};return qazana.hooks.applyFilters("panel/header/behaviors",e,this)},onPanelClick:function(e){var t=jQuery(e.target);t.closest(".qazana-panel-header-sub-menu-wrapper").length||(t=(e=t.closest(".qazana-panel-header-tool")).length&&!e.hasClass("qazana-open"),this.ui.menuButtons.filter(":not(.qazana-leave-open)").removeClass("qazana-open"),t&&e.addClass("qazana-open"))},onClickSettings:function(){var e=this;"page_settings"!==qazana.getPanelView().getCurrentPageName()&&(qazana.getPanelView().setPage("page_settings"),qazana.getPanelView().getCurrentPageView().once("destroy",function(){e.ui.settings.removeClass("qazana-open")}))},setTitle:function(e){this.ui.title.html(e)},onClickAdd:function(){qazana.getPanelView().setPage("elements")},onClickSaveTemplate:function(){qazana.templates.startModal({onReady:function(){qazana.templates.getLayout().showSaveTemplateView()}})},onClickMenu:function(){var e,t=qazana.getPanelView(),n="menu"===t.getCurrentPageName()?"elements":"menu";"menu"==n&&(e="eicon-arrow-"+(qazana.config.is_rtl?"right":"left"),this.ui.menuIcon.removeClass("eicon-menu-bar").addClass(e)),t.setPage(n)},onRender:function(){var e=this;_.defer(function(){qazana.getPanelView().$el.on("click",e.onPanelClick.bind(e))})}});e.exports=i},function(e,t,n){"use strict";var i=n(0)(n(371)),a=n(372),o=a.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-preview"),className:"qazana-inner",childViewContainer:".qazana-section-wrap",behaviors:function(){var e=a.prototype.behaviors.apply(this,arguments),t={contextMenu:{behaviorClass:n(145),groups:this.getContextMenuGroups()}};return jQuery.extend(e,t)},getContextMenuGroups:function(){function e(){return 0<qazana.elements.length}return[{name:"paste",actions:[{name:"paste",title:qazana.translate("paste"),callback:this.paste.bind(this),isEnabled:this.isPasteEnabled.bind(this)}]},{name:"content",actions:[{name:"copy_all_content",title:qazana.translate("copy_all_content"),callback:this.copy.bind(this),isEnabled:e},{name:"delete_all_content",title:qazana.translate("delete_all_content"),callback:qazana.clearPage.bind(qazana),isEnabled:e}]}]},copy:function(){qazana.setStorage("transfer",{type:"copy",elementsType:"section",elements:qazana.elements.toJSON({copyHtmlCache:!0})})},paste:function(e){var t,n=this,i=qazana.getStorage("transfer"),a=void 0!==e?e:this.collection.length;qazana.channels.data.trigger("element:before:add",i.elements[0]),"section"===i.elementsType?i.elements.forEach(function(e){n.addChildElement(e,{at:a,edit:!1,clone:!0}),a++}):"column"===i.elementsType?((t=n.addChildElement({allowEmpty:!0},{at:e})).model.unset("allowEmpty"),a=0,i.elements.forEach(function(e){t.addChildElement(e,{at:a,clone:!0}),a++}),t.redefineLayout()):(t=n.addChildElement(null,{at:e}),a=0,i.elements.forEach(function(e){t.addChildElement(e,{at:a,clone:!0}),a++})),qazana.channels.data.trigger("element:after:add",i.elements[0])},isPasteEnabled:function(){return qazana.getStorage("transfer")},onRender:function(){var e;qazana.userCan("design")&&((e=new i.default).render(),this.$el.append(e.$el))}});e.exports=o},function(e,t,n){"use strict";var i=n(0);n(85)(t,"__esModule",{value:!0}),t.default=void 0,n(75),n(59);var a=i(n(99)),o=i(n(92)),r=i(n(93)),s=i(n(100)),l=i(n(101)),c=i(n(96));function u(n){var i=function(){if("undefined"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(n);return t=i?(e=(0,c.default)(this).constructor,(0,a.default)(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,t)}}n=function(e){(0,s.default)(n,e);var t=u(n);function n(){return(0,o.default)(this,n),t.apply(this,arguments)}return(0,r.default)(n,[{key:"onCloseButtonClick",value:function(){this.closeSelectPresets()}},{key:"id",get:function(){return"qazana-add-new-section"}}]),n}(i(n(187)).default);t.default=n},function(e,t,n){"use strict";n(1);var i=n(186),a=n(185),i=a.extend({childView:i,behaviors:function(){var e={Sortable:{behaviorClass:n(163),elChildType:"section"}};return qazana.hooks.applyFilters("elements/base-section-container/behaviors",e,this)},getSortableOptions:function(){return{handle:"> .qazana-element-overlay .qazana-editor-element-edit",items:"> .qazana-section"}},getChildType:function(){return["section"]},initialize:function(){a.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove reset",this.onCollectionChanged).listenTo(qazana.channels.panelElements,"element:drag:start",this.onPanelElementDragStart).listenTo(qazana.channels.panelElements,"element:drag:end",this.onPanelElementDragEnd)},onCollectionChanged:function(){qazana.saver.setFlagEditorChange(!0)},onPanelElementDragStart:function(){qazana.helpers.disableElementEvents(this.$el.find("iframe"))},onPanelElementDragEnd:function(){qazana.helpers.enableElementEvents(this.$el.find("iframe"))}});e.exports=i}]);